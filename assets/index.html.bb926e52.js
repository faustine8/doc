import{_ as t,r as o,o as l,a as c,b as n,d as e,F as r,c as p,e as s}from"./app.40df414d.js";var i="/doc/assets/README-1643164732768.b8370b92.png";const u={},b=p('<h1 id="sqoop" tabindex="-1"><a class="header-anchor" href="#sqoop" aria-hidden="true">#</a> Sqoop</h1><blockquote><p>\u6570\u636E\u8FC1\u79FB\u5DE5\u5177</p></blockquote><h2 id="\u7B2C\u4E00\u90E8\u5206-sqoop\u6982\u8FF0" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E00\u90E8\u5206-sqoop\u6982\u8FF0" aria-hidden="true">#</a> \u7B2C\u4E00\u90E8\u5206 Sqoop\u6982\u8FF0</h2><p>Sqoop\u662F\u4E00\u6B3E\u5F00\u6E90\u7684\u5DE5\u5177\uFF0C\u4E3B\u8981\u7528\u4E8E\u5728Hadoop(Hive)\u4E0E\u4F20\u7EDF\u7684\u6570\u636E\u5E93(mysql\u3001postgresql\u7B49)\u95F4\u8FDB\u884C\u6570\u636E\u7684\u4F20\u9012\u3002 \u53EF\u4EE5\u5C06\u5173\u7CFB\u578B\u6570\u636E\u5E93(MySQL,Oracle,Postgres\u7B49)\u4E2D\u7684\u6570\u636E\u5BFC\u5165\u5230HDFS\u4E2D\uFF0C\u4E5F\u53EF\u4EE5\u5C06HDFS\u7684\u6570\u636E\u5BFC\u8FDB\u5230\u5173\u7CFB\u578B\u6570\u636E\u5E93\u4E2D\u3002</p><blockquote><p>Import: RDBMS -&gt; Hadoop; Export: Hadoop -&gt; RDBMS;</p><p>\u7AD9\u5728\u5927\u6570\u636E\u7BA1\u7406\u5E73\u53F0\u7684\u89D2\u5EA6</p></blockquote><p>Sqoop\u9879\u76EE\u5F00\u59CB\u4E8E2009\u5E74\uFF0C\u6700\u65E9\u662F\u4F5C\u4E3AHadoop\u7684\u4E00\u4E2A\u7B2C\u4E09\u65B9\u6A21\u5757\u5B58\u5728\uFF0C\u540E\u6765\u4E3A\u4E86\u8BA9\u4F7F\u7528\u8005\u80FD\u591F\u5FEB\u901F\u90E8\u7F72\uFF0C\u4E5F\u4E3A\u4E86\u8BA9\u5F00\u53D1\u4EBA\u5458\u80FD\u591F\u66F4\u5FEB\u901F\u7684\u8FED\u4EE3\u5F00\u53D1\uFF0CSqoop\u72EC\u7ACB\u6210\u4E3A\u4E00\u4E2A Apache \u9879\u76EE\u3002</p><p><img src="'+i+'" alt="Sqoop\u67B6\u6784"></p><p>\u5C06\u5BFC\u5165\u6216\u5BFC\u51FA\u547D\u4EE4\u8F6C\u6362\u4E3A MapReduce \u7A0B\u5E8F\u6765\u5B9E\u73B0\u3002\u7FFB\u8BD1\u51FA\u7684 MapReduce \uFF0C\u4E3B\u8981\u662F\u5BF9 <code>inputformat</code> \u548C <code>outputformat</code> \u8FDB\u884C\u5B9A\u5236\u3002</p><h2 id="\u7B2C\u4E8C\u90E8\u5206-\u5B89\u88C5\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E8C\u90E8\u5206-\u5B89\u88C5\u914D\u7F6E" aria-hidden="true">#</a> \u7B2C\u4E8C\u90E8\u5206 \u5B89\u88C5\u914D\u7F6E</h2>',9),d=s("Sqoop\u5B98\u7F51: "),k={href:"http://sqoop.apache.org/",target:"_blank",rel:"noopener noreferrer"},m=s("http://sqoop.apache.org/"),h=s("\u4E0B\u8F7D\u5730\u5740: "),v={href:"http://archive.apache.org/dist/sqoop/",target:"_blank",rel:"noopener noreferrer"},g=s("http://archive.apache.org/dist/sqoop/"),q=p(`<ol><li>\u4E0B\u8F7D\u3001\u4E0A\u4F20\u5E76\u89E3\u538B</li></ol><p>\u5C06\u4E0B\u8F7D\u7684\u5B89\u88C5\u5305 <code>sqoop-1.4.7.bin__hadoop-2.6.0.tar.gz</code> \u4E0A\u4F20\u5230\u865A\u62DF\u673A\u4E2D; \u89E3\u538B\u7F29\u8F6F\u4EF6\u5305;</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">tar</span> zxvf sqoop-1.4.7.bin__hadoop-2.6.0.tar.gz

<span class="token function">mv</span> sqoop-1.4.7.bin__hadoop-2.6.0/ <span class="token punctuation">..</span>/servers/sqoop-1.4.7/
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>\u589E\u52A0\u73AF\u5883\u53D8\u91CF\uFF0C\u5E76\u4F7F\u5176\u751F\u6548</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vi</span> /etc/profile
<span class="token comment"># \u589E\u52A0\u4EE5\u4E0B\u5185\u5BB9</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">SQOOP_HOME</span><span class="token operator">=</span>/opt/zmn/servers/sqoop-1.4.7 
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$SQOOP_HOME</span>/bin

<span class="token builtin class-name">source</span> /etc/profile
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="3"><li>\u521B\u5EFA\u3001\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u914D\u7F6E\u6587\u4EF6\u4F4D\u7F6E $SQOOP_HOME/conf; \u8981\u4FEE\u6539\u7684\u914D\u7F6E\u6587\u4EF6\u4E3A sqoop-env.sh </span>
<span class="token function">cp</span> sqoop-env-template.sh sqoop-env.sh
<span class="token function">vi</span> sqoop-env.sh

<span class="token comment"># \u5728\u6587\u4EF6\u6700\u540E\u589E\u52A0\u4EE5\u4E0B\u5185\u5BB9</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_COMMON_HOME</span><span class="token operator">=</span>/opt/zmn/servers/hadoop-2.9.2 
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_MAPRED_HOME</span><span class="token operator">=</span>/opt/zmn/servers/hadoop-2.9.2 
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HIVE_HOME</span><span class="token operator">=</span>/opt/zmn/servers/hive-2.3.7
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="4"><li>\u62F7\u8D1DJDBC\u9A71\u52A8\u7A0B\u5E8F</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u62F7\u8D1Djdbc\u9A71\u52A8\u5230sqoop\u7684lib\u76EE\u5F55\u4E0B(\u5907\u6CE8:\u5EFA\u7ACB\u8F6F\u94FE\u63A5\u4E5F\u53EF\u4EE5)</span>
<span class="token function">ln</span> -s /opt/zmn/servers/hive-2.3.7/lib/mysql-connector-java-5.1.46.jar /opt/zmn/servers/sqoop-1.4.7/lib/
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="5"><li>\u62F7\u8D1D jar</li></ol><p>\u5C06 $HIVE_HOME/lib \u4E0B\u7684 hive-common-2.3.7.jar\uFF0C\u62F7\u8D1D\u5230 $SQOOP_HOME/lib \u76EE\u5F55\u4E0B\u3002</p><blockquote><p>\u5982\u4E0D\u62F7\u8D1D\uFF0C\u5F53MySQL\u5F80Hive\u5BFC\u6570\u636E\u7684\u65F6\u5019\u5C06\u4F1A\u51FA\u73B0\u9519\u8BEF: <code>ClassNotFoundException: org.apache.hadoop.hive.conf.HiveConf</code></p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u786C\u62F7\u8D1D \u548C \u5EFA\u7ACB\u8F6F\u94FE\u63A5\u90FD\u53EF\u4EE5\uFF0C\u9009\u62E9\u4E00\u4E2A\u6267\u884C\u5373\u53EF\u3002\u4E0B\u9762\u662F\u786C\u62F7\u8D1D</span>
<span class="token function">cp</span> <span class="token variable">$HIVE_HOME</span>/lib/hive-common-2.3.7.jar <span class="token variable">$SQOOP_HOME</span>/lib/

<span class="token comment"># \u5EFA\u7ACB\u8F6F\u94FE\u63A5</span>
<span class="token function">ln</span> -s /opt/zmn/servers/hive-2.3.7/lib/hive-common-2.3.7.jar /opt/zmn/servers/sqoop-1.4.7/lib/hive-common-2.3.7.jar
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u5C06 $HADOOP_HOME/share/hadoop/tools/lib/json-20170516.jar \u62F7\u8D1D\u5230 $SQOOP_HOME/lib/ \u76EE\u5F55\u4E0B; \u5426\u5219\u5728\u521B\u5EFAsqoop job\u65F6\u4F1A\u62A5: <code>java.lang.NoClassDefFoundError: org/json/JSONObject</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">cp</span> <span class="token variable">$HADOOP_HOME</span>/share/hadoop/tools/lib/json-20170516.jar <span class="token variable">$SQOOP_HOME</span>/lib/
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="6"><li>\u5B89\u88C5\u9A8C\u8BC1</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>sqoop version

<span class="token comment"># \u6D4B\u8BD5Sqoop\u662F\u5426\u80FD\u591F\u6210\u529F\u8FDE\u63A5\u6570\u636E\u5E93</span>
sqoop list-databases --connect jdbc:mysql://linux123:3306/?useSSL<span class="token operator">=</span>false --username hive --password <span class="token number">12345678</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="\u7B2C\u4E09\u90E8\u5206-\u5E94\u7528\u6848\u4F8B" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E09\u90E8\u5206-\u5E94\u7528\u6848\u4F8B" aria-hidden="true">#</a> \u7B2C\u4E09\u90E8\u5206 \u5E94\u7528\u6848\u4F8B</h2><p>\u5728Sqoop\u4E2D</p><ul><li>\u5BFC\u5165: \u662F\u6307\u4ECE\u5173\u7CFB\u578B\u6570\u636E\u5E93\u5411\u5927\u6570\u636E\u96C6\u7FA4(HDFS\u3001HIVE\u3001HBASE)\u4F20\u8F93\u6570\u636E; \u4F7F\u7528 <code>import</code> \u5173\u952E\u5B57;</li><li>\u5BFC\u51FA: \u662F\u6307\u4ECE\u5927\u6570\u636E\u96C6\u7FA4\u5411\u5173\u7CFB\u578B\u6570\u636E\u5E93\u4F20\u8F93\u6570\u636E; \u4F7F\u7528 <code>export</code> \u5173\u952E\u5B57;</li></ul><p>\u51C6\u5907\u6D4B\u8BD5\u6570\u636E\u811A\u672C</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- \u7528\u4E8E\u5728 Mysql \u4E2D\u751F\u6210\u6D4B\u8BD5\u6570\u636E</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> sqoop<span class="token punctuation">;</span>
<span class="token keyword">use</span> sqoop<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> sqoop<span class="token punctuation">.</span>goodtbl
<span class="token punctuation">(</span>
 gname        <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 serialNumber <span class="token keyword">int</span><span class="token punctuation">,</span>
 price        <span class="token keyword">int</span><span class="token punctuation">,</span>
 stock_number <span class="token keyword">int</span><span class="token punctuation">,</span>
 create_time  <span class="token keyword">date</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> goodtbl <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>serialNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DROP</span> <span class="token keyword">FUNCTION</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>rand_string<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">\`</span>batchInsertTestData<span class="token punctuation">\`</span></span><span class="token punctuation">;</span>

<span class="token comment">-- \u66FF\u6362\u8BED\u53E5\u9ED8\u8BA4\u7684\u6267\u884C\u7B26\u53F7\uFF0C\u5C06;\u66FF\u6362\u6210 //</span>
<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> <span class="token identifier"><span class="token punctuation">\`</span>rand_string<span class="token punctuation">\`</span></span><span class="token punctuation">(</span>n <span class="token keyword">INT</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">CHARSET</span> <span class="token string">&#39;utf8&#39;</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">DECLARE</span> char_str <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">DECLARE</span> return_str <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">WHILE</span> i <span class="token operator">&lt;</span> n
        <span class="token keyword">DO</span>
            <span class="token keyword">SET</span> return_str <span class="token operator">=</span> concat<span class="token punctuation">(</span>return_str<span class="token punctuation">,</span> substring<span class="token punctuation">(</span>char_str<span class="token punctuation">,</span> FLOOR<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">SET</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
<span class="token keyword">RETURN</span> return_str<span class="token punctuation">;</span>
<span class="token keyword">END</span>
<span class="token comment">//</span>

<span class="token comment">-- \u7B2C\u4E00\u4E2A\u53C2\u6570\u8868\u793A:\u5E8F\u53F7\u4ECE\u51E0\u5F00\u59CB;\u7B2C\u4E8C\u4E2A\u53C2\u6570\u8868\u793A:\u63D2\u5165\u591A\u5C11\u6761\u8BB0\u5F55</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> <span class="token identifier"><span class="token punctuation">\`</span>batchInsertTestData<span class="token punctuation">\`</span></span><span class="token punctuation">(</span>m <span class="token keyword">INT</span><span class="token punctuation">,</span> n <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">WHILE</span> i <span class="token operator">&lt;</span> n
        <span class="token keyword">DO</span>
            <span class="token keyword">insert</span> <span class="token keyword">into</span> goodtbl <span class="token punctuation">(</span>gname<span class="token punctuation">,</span> serialNumber<span class="token punctuation">,</span> price<span class="token punctuation">,</span> stock_number<span class="token punctuation">,</span> create_time<span class="token punctuation">)</span>
            <span class="token keyword">values</span> <span class="token punctuation">(</span>rand_string<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i <span class="token operator">+</span> m<span class="token punctuation">,</span> <span class="token function">ROUND</span><span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> FLOOR<span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">SET</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
<span class="token keyword">END</span>
<span class="token comment">//</span>

<span class="token keyword">delimiter</span> <span class="token punctuation">;</span>

<span class="token keyword">call</span> batchInsertTestData<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><blockquote><p>\u4EE5\u4E0B\u6848\u4F8B\u9700\u8981\u542F\u52A8:HDFS\u3001YARN\u3001MySQL \u5BF9\u5E94\u7684\u670D\u52A1;</p></blockquote><h3 id="\u7B2C-1-\u8282-\u5BFC\u5165\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#\u7B2C-1-\u8282-\u5BFC\u5165\u6570\u636E" aria-hidden="true">#</a> \u7B2C 1 \u8282 \u5BFC\u5165\u6570\u636E</h3><h4 id="_1-1-mysql-\u5230-hdfs" tabindex="-1"><a class="header-anchor" href="#_1-1-mysql-\u5230-hdfs" aria-hidden="true">#</a> 1.1.MySQL \u5230 HDFS</h4><h5 id="_1-\u5BFC\u5165\u5168\u90E8\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_1-\u5BFC\u5165\u5168\u90E8\u6570\u636E" aria-hidden="true">#</a> 1. \u5BFC\u5165\u5168\u90E8\u6570\u636E</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># MySQL =&gt; HDFS</span>
sqoop <span class="token function">import</span> <span class="token punctuation">\\</span>
  --connect jdbc:mysql://linux123:3306/sqoop <span class="token punctuation">\\</span>
  --username hive <span class="token punctuation">\\</span>
  --password <span class="token number">12345678</span> <span class="token punctuation">\\</span>
  --table goodtbl <span class="token punctuation">\\</span>
  --target-dir /root/zmn <span class="token punctuation">\\</span>
  --delete-target-dir <span class="token punctuation">\\</span>
  --num-mappers <span class="token number">1</span> <span class="token punctuation">\\</span>
  --fields-terminated-by <span class="token string">&quot;<span class="token entity" title="\\t">\\t</span>&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u5907\u6CE8:</p><ul><li><code>target-dir</code>: \u5C06\u6570\u636E\u5BFC\u5165 HDFS \u7684\u8DEF\u5F84;</li><li><code>delete-target-dir</code>: \u5982\u679C\u76EE\u6807\u6587\u4EF6\u5939\u5728 HDFS \u4E0A\u5DF2\u7ECF\u5B58\u5728\uFF0C\u90A3\u4E48\u518D\u6B21\u8FD0\u884C\u5C31\u4F1A\u62A5\u9519\u3002\u53EF\u4EE5\u4F7F\u7528 <code>--delete-target-dir</code> \u6765\u5148\u5220\u9664\u76EE\u5F55\u3002\u4E5F\u53EF\u4EE5\u4F7F\u7528 <code>append</code> \u53C2\u6570\uFF0C\u8868\u793A\u8FFD\u52A0\u6570\u636E;</li><li><code>num-mappers</code>: \u542F\u52A8\u591A\u5C11\u4E2AMap Task; \u9ED8\u8BA4\u542F\u52A84\u4E2AMap Task; \u4E5F\u53EF\u4EE5\u5199\u6210 <code>-m 1</code></li><li><code>fields-terminated-by</code>: HDFS\u6587\u4EF6\u4E2D\u6570\u636E\u7684\u5206\u9694\u7B26;</li></ul><h5 id="_2-\u5BFC\u5165\u67E5\u8BE2\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_2-\u5BFC\u5165\u67E5\u8BE2\u6570\u636E" aria-hidden="true">#</a> 2. \u5BFC\u5165\u67E5\u8BE2\u6570\u636E</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>sqoop <span class="token function">import</span> <span class="token punctuation">\\</span>
  --connect jdbc:mysql://linux123:3306/sqoop <span class="token punctuation">\\</span>
  --username hive <span class="token punctuation">\\</span>
  --password <span class="token number">12345678</span> <span class="token punctuation">\\</span>
  --target-dir /root/zmn/2 <span class="token punctuation">\\</span>
  --append <span class="token punctuation">\\</span>
  -m <span class="token number">1</span> <span class="token punctuation">\\</span>
  --fields-terminated-by <span class="token string">&quot;<span class="token entity" title="\\t">\\t</span>&quot;</span> <span class="token punctuation">\\</span>
  --query <span class="token string">&#39;select gname, serialNumber, price, stock_number, create_time from goodtbl where price &gt; 88 and $CONDITIONS;&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>\u6B64\u5904\u4F7F\u7528\u4E86 <code>--append</code> \u53C2\u6570\uFF0C\u591A\u6B21\u6267\u884C\u4F1A\u8FFD\u52A0\u6570\u636E</p></blockquote><p>\u5907\u6CE8:</p><ul><li>\u67E5\u8BE2\u8BED\u53E5\u7684where\u5B50\u53E5\u4E2D\u5FC5\u987B\u5305\u542B <code>&#39;$CONDITIONS&#39;</code></li><li>\u5982\u679Cquery\u540E\u4F7F\u7528\u7684\u662F\u53CC\u5F15\u53F7\uFF0C\u5219 <code>$CONDITIONS</code> \u524D\u5FC5\u987B\u52A0\u8F6C\u4E49\u7B26\uFF0C\u9632\u6B62shell\u8BC6\u522B\u4E3A\u81EA\u5DF1\u7684\u53D8\u91CF</li></ul><h5 id="_3-\u5BFC\u5165\u6307\u5B9A\u7684\u5217" tabindex="-1"><a class="header-anchor" href="#_3-\u5BFC\u5165\u6307\u5B9A\u7684\u5217" aria-hidden="true">#</a> 3. \u5BFC\u5165\u6307\u5B9A\u7684\u5217</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>sqoop <span class="token function">import</span> <span class="token punctuation">\\</span>
  --connect jdbc:mysql://linux123:3306/sqoop <span class="token punctuation">\\</span>
  --username hive <span class="token punctuation">\\</span>
  --password <span class="token number">12345678</span> <span class="token punctuation">\\</span>
  --target-dir /root/zmn/3 <span class="token punctuation">\\</span>
  --delete-target-dir <span class="token punctuation">\\</span>
  --num-mappers <span class="token number">1</span> <span class="token punctuation">\\</span>
  --fields-terminated-by <span class="token string">&quot;<span class="token entity" title="\\t">\\t</span>&quot;</span> <span class="token punctuation">\\</span>
  --columns gname,serialNumber,price <span class="token punctuation">\\</span>
  --table goodtbl
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>\u5907\u6CE8: columns\u4E2D\u5982\u679C\u6D89\u53CA\u5230\u591A\u5217\uFF0C\u7528\u9017\u53F7\u5206\u9694\uFF0C<strong>\u4E0D\u80FD\u6DFB\u52A0\u7A7A\u683C</strong></p></blockquote><h5 id="_4-\u5BFC\u5165\u67E5\u8BE2\u6570\u636E-\u4F7F\u7528\u5173\u952E\u5B57" tabindex="-1"><a class="header-anchor" href="#_4-\u5BFC\u5165\u67E5\u8BE2\u6570\u636E-\u4F7F\u7528\u5173\u952E\u5B57" aria-hidden="true">#</a> 4. \u5BFC\u5165\u67E5\u8BE2\u6570\u636E(\u4F7F\u7528\u5173\u952E\u5B57)</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>sqoop <span class="token function">import</span> <span class="token punctuation">\\</span>
  --connect jdbc:mysql://linux123:3306/sqoop <span class="token punctuation">\\</span>
  --username hive <span class="token punctuation">\\</span>
  --password <span class="token number">12345678</span> <span class="token punctuation">\\</span>
  --target-dir /root/zmn/4 <span class="token punctuation">\\</span>
  --delete-target-dir <span class="token punctuation">\\</span>
  -m <span class="token number">1</span> <span class="token punctuation">\\</span>
  --fields-terminated-by <span class="token string">&quot;<span class="token entity" title="\\t">\\t</span>&quot;</span> <span class="token punctuation">\\</span>
  --table goodtbl <span class="token punctuation">\\</span>
  --where <span class="token string">&quot;price&gt;=68&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="_5-\u542F\u52A8\u591A\u4E2Amap-task\u5BFC\u5165\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_5-\u542F\u52A8\u591A\u4E2Amap-task\u5BFC\u5165\u6570\u636E" aria-hidden="true">#</a> 5. \u542F\u52A8\u591A\u4E2AMap Task\u5BFC\u5165\u6570\u636E</h5><blockquote><p>\u5728 <code>goodtbl</code> \u4E2D\u589E\u52A0\u6570\u636E: <code>call batchInsertTestData(300, 100000);</code></p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>sqoop <span class="token function">import</span> <span class="token punctuation">\\</span>
  --connect jdbc:mysql://linux123:3306/sqoop <span class="token punctuation">\\</span>
  --username hive <span class="token punctuation">\\</span>
  --password <span class="token number">12345678</span> <span class="token punctuation">\\</span>
  --target-dir /root/zmn/5 <span class="token punctuation">\\</span>
  --delete-target-dir <span class="token punctuation">\\</span>
  --fields-terminated-by <span class="token string">&quot;<span class="token entity" title="\\t">\\t</span>&quot;</span> <span class="token punctuation">\\</span>
  --table goodtbl <span class="token punctuation">\\</span>
  --split-by serialNumber

<span class="token comment"># \u7ED9 goodtbl \u8868\u589E\u52A0\u4E3B\u952E</span>
alter table goodtbl <span class="token function">add</span> primary key<span class="token punctuation">(</span>serialNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u5907\u6CE8:</p><p>\u4F7F\u7528\u591A\u4E2A Map Task \u8FDB\u884C\u6570\u636E\u5BFC\u5165\u65F6\uFF0Csqoop \u8981\u5BF9\u6BCF\u4E2ATask\u7684\u6570\u636E\u8FDB\u884C\u5206\u533A</p><ul><li>\u5982\u679C MySQL \u4E2D\u7684\u8868\u6709\u4E3B\u952E\uFF0C\u6307\u5B9A Map Task \u7684\u4E2A\u6570\u5C31\u884C</li><li>\u5982\u679C MySQL \u4E2D\u7684\u8868\u6CA1\u6709\u4E3B\u952E\uFF0C\u8981\u4F7F\u7528 split-by \u6307\u5B9A\u5206\u533A\u5B57\u6BB5</li><li>\u5982\u679C\u5206\u533A\u5B57\u6BB5\u662F\u5B57\u7B26\u7C7B\u578B\uFF0C\u4F7F\u7528 sqoop \u547D\u4EE4\u7684\u65F6\u5019\u8981\u6DFB\u52A0: <code>-Dorg.apache.sqoop.splitter.allow_text_splitter=true</code></li></ul><p>\u67E5\u8BE2\u8BED\u53E5\u7684where\u5B50\u53E5\u4E2D\u7684 <code>&#39;$CONDITIONS&#39;</code>\uFF0C\u4E5F\u662F\u4E3A\u4E86\u505A\u6570\u636E\u5206\u533A\u4F7F\u7528\u7684\uFF0C\u5373\u4F7F\u53EA\u67091\u4E2AMap Task</p><h4 id="_1-2-mysql-\u5230-hive" tabindex="-1"><a class="header-anchor" href="#_1-2-mysql-\u5230-hive" aria-hidden="true">#</a> 1.2.MySQL \u5230 Hive</h4><p>\u5728 hive \u4E2D\u521B\u5EFA\u8868:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mydb<span class="token punctuation">.</span>goodtbl
<span class="token punctuation">(</span>
    gname string<span class="token punctuation">,</span>
    serialNumber <span class="token keyword">int</span><span class="token punctuation">,</span>
    price        <span class="token keyword">int</span><span class="token punctuation">,</span>
    stock_number <span class="token keyword">int</span><span class="token punctuation">,</span>
    create_time  <span class="token keyword">date</span>
<span class="token punctuation">)</span> <span class="token keyword">row</span> format delimited <span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">&quot;\\t&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>sqoop <span class="token function">import</span> <span class="token punctuation">\\</span>
  --connect jdbc:mysql://linux123:3306/sqoop <span class="token punctuation">\\</span>
  --username hive <span class="token punctuation">\\</span>
  --password <span class="token number">12345678</span> <span class="token punctuation">\\</span>
  --table goodtbl <span class="token punctuation">\\</span>
  -m <span class="token number">1</span> <span class="token punctuation">\\</span>
  --hive-import <span class="token punctuation">\\</span>
  --hive-table mydb.goodtbl <span class="token punctuation">\\</span>
  --hive-overwrite <span class="token punctuation">\\</span>
  --fields-terminated-by <span class="token string">&quot;<span class="token entity" title="\\t">\\t</span>&quot;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u53C2\u6570\u8BF4\u660E:</p><ul><li><code>hive-import</code> \u5FC5\u987B\u53C2\u6570\uFF0C\u6307\u5B9A\u5BFC\u5165hive</li><li><code>hive-database</code> Hive\u5E93\u540D(\u7F3A\u7701\u503Cdefault)</li><li><code>hive-table</code> Hive\u8868\u540D</li><li><code>fields-terminated-by</code> Hive\u5B57\u6BB5\u5206\u9694\u7B26</li><li><code>hive-overwrite</code> \u8986\u76D6\u4E2D\u5DF2\u7ECF\u5B58\u5728\u7684\u6570\u636E</li><li><code>create-hive-table</code> \u521B\u5EFA\u597D hive \u8868\uFF0C\u4F46\u662F\u8868\u53EF\u80FD\u5B58\u5728\u9519\u8BEF\u3002<em>\u4E0D\u5EFA\u8BAE\u4F7F\u7528\u8FD9\u4E2A\u53C2\u6570\uFF0C\u5EFA\u8BAE\u63D0\u524D\u5EFA\u597D\u8868</em></li></ul><h3 id="\u7B2C-2-\u8282-\u5BFC\u51FA\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#\u7B2C-2-\u8282-\u5BFC\u51FA\u6570\u636E" aria-hidden="true">#</a> \u7B2C 2 \u8282 \u5BFC\u51FA\u6570\u636E</h3><p>Hive/HDFS\u5230RDBMS</p><blockquote><p>\u5907\u6CE8: MySQL\u8868\u9700\u8981\u63D0\u524D\u521B\u5EFA</p></blockquote><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># \u63D0\u524D\u521B\u5EFA\u8868</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> sqoop<span class="token punctuation">.</span>goodtbl2
<span class="token punctuation">(</span>
    gname        <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    serialNumber <span class="token keyword">int</span><span class="token punctuation">,</span>
    price        <span class="token keyword">int</span><span class="token punctuation">,</span>
    stock_number <span class="token keyword">int</span><span class="token punctuation">,</span>
    create_time  <span class="token keyword">date</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u6267\u884C\u5BFC\u51FA</span>
sqoop <span class="token builtin class-name">export</span> <span class="token punctuation">\\</span>
  --connect jdbc:mysql://linux123:3306/sqoop <span class="token punctuation">\\</span>
  --username hive <span class="token punctuation">\\</span>
  --password <span class="token number">12345678</span> <span class="token punctuation">\\</span>
  --table goodtbl2 <span class="token punctuation">\\</span>
  --num-mappers <span class="token number">1</span> <span class="token punctuation">\\</span>
  --export-dir /user/hive/warehouse/mydb.db/goodtbl <span class="token punctuation">\\</span>
  --input-fields-terminated-by <span class="token string">&quot;<span class="token entity" title="\\t">\\t</span>&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="\u7B2C-3-\u8282-\u589E\u91CF\u6570\u636E\u5BFC\u5165" tabindex="-1"><a class="header-anchor" href="#\u7B2C-3-\u8282-\u589E\u91CF\u6570\u636E\u5BFC\u5165" aria-hidden="true">#</a> \u7B2C 3 \u8282 \u589E\u91CF\u6570\u636E\u5BFC\u5165</h3><p>\u53D8\u5316\u6570\u636E\u6355\u83B7(CDC)</p><p>\u524D\u9762\u90FD\u662F\u6267\u884C\u7684\u5168\u91CF\u6570\u636E\u5BFC\u5165\u3002\u5982\u679C\u6570\u636E\u91CF\u5F88\u5C0F\uFF0C\u5219\u91C7\u53D6\u5B8C\u5168\u6E90\u6570\u636E\u62BD\u53D6; \u5982\u679C\u6E90\u6570\u636E\u91CF\u5F88\u5927\uFF0C\u5219\u9700\u8981\u62BD\u53D6\u53D1\u751F\u53D8\u5316\u7684\u6570\u636E\uFF0C\u8FD9\u79CD\u6570\u636E\u62BD\u53D6\u6A21\u5F0F\u53EB\u505A\u53D8\u5316\u6570\u636E\u6355\u83B7\uFF0C\u7B80\u79F0 CDC(Change Data Capture)\u3002</p><p>CDC\u5927\u4F53\u5206\u4E3A\u4E24\u79CD: \u4FB5\u5165\u5F0F\u548C\u975E\u4FB5\u5165\u5F0F\u3002\u4FB5\u5165\u5F0F\u6307CDC\u64CD\u4F5C\u4F1A\u7ED9\u6E90\u7CFB\u7EDF\u5E26\u6765\u6027\u80FD\u5F71\u54CD\uFF0C\u53EA\u8981CDC\u64CD\u4F5C\u4EE5\u4EFB\u4F55\u4E00\u79CD\u65B9\u5F0F\u5BF9\u6E90\u6570\u636E\u5E93\u6267\u884C\u4E86SQL\u64CD\u4F5C\uFF0C\u5C31\u8BA4\u4E3A\u662F\u4FB5\u5165\u5F0F\u7684\u3002</p><p>\u5E38\u7528\u76844\u79CDCDC\u65B9\u6CD5\u662F(\u524D\u4E09\u79CD\u662F\u4FB5\u5165\u5F0F\u7684):</p><ol><li>\u57FA\u4E8E\u65F6\u95F4\u6233\u7684CDC\u3002</li></ol><p>\u62BD\u53D6\u8FC7\u7A0B\u53EF\u4EE5\u6839\u636E\u67D0\u4E9B\u5C5E\u6027\u5217\u6765\u5224\u65AD\u54EA\u4E9B\u6570\u636E\u662F\u589E\u91CF\u7684\uFF0C\u6700\u5E38\u89C1\u7684\u5C5E\u6027\u5217\u6709\u4EE5\u4E0B\u4E24\u79CD:</p><ul><li>\u65F6\u95F4\u6233: \u6700\u597D\u6709\u4E24\u4E2A\u5217\uFF0C\u4E00\u4E2A\u63D2\u5165\u65F6\u95F4\u6233\uFF0C\u8868\u793A\u4F55\u65F6\u521B\u5EFA\uFF0C\u4E00\u4E2A\u66F4\u65B0\u65F6\u95F4\u6233\uFF0C\u8868\u793A\u6700\u540E\u4E00\u6B21\u66F4\u65B0\u7684\u65F6\u95F4;</li><li>\u5E8F\u5217: \u5927\u591A\u6570\u6570\u636E\u5E93\u90FD\u63D0\u4F9B\u81EA\u589E\u529F\u80FD\uFF0C\u8868\u4E2D\u7684\u5217\u5B9A\u4E49\u6210\u81EA\u589E\u7684\uFF0C\u5F88\u5BB9\u6613\u5730\u6839\u636E\u8BE5\u5217\u8BC6\u522B\u65B0\u63D2\u5165\u7684\u6570\u636E;</li></ul><p>\u65F6\u95F4\u6233\u7684CDC\u662F\u6700\u7B80\u5355\u4E14\u5E38\u7528\u7684\uFF0C\u4F46\u662F\u6709\u5982\u4E0B\u7F3A\u70B9:</p><ul><li>\u4E0D\u80FD\u8BB0\u5F55\u5220\u9664\u8BB0\u5F55\u7684\u64CD\u4F5C</li><li>\u65E0\u6CD5\u8BC6\u522B\u591A\u6B21\u66F4\u65B0</li><li>\u4E0D\u5177\u6709\u5B9E\u65F6\u80FD\u529B</li></ul><ol start="2"><li>\u57FA\u4E8E\u89E6\u53D1\u5668\u7684CDC</li></ol><p>\u5F53\u6267\u884CINSERT\u3001UPDATE\u3001DELETE \u8FD9\u4E9BSQL\u8BED\u53E5\u65F6\uFF0C\u6FC0\u6D3B\u6570\u636E\u5E93\u91CC\u7684\u89E6\u53D1\u5668\uFF0C\u4F7F\u7528\u89E6\u53D1\u5668\u53EF\u6355\u83B7\u53D8\u66F4\u7684\u6570\u636E\uFF0C\u5E76\u628A\u6570\u636E\u4FDD\u5B58\u5728\u4E2D\u95F4\u4E34\u65F6\u8868\u91CC\u3002 \u7136\u540E\u8FD9\u4E9B\u53D8\u66F4\u6570\u636E\u518D\u4ECE\u4E34\u65F6\u8868\u53D6\u51FA\u3002</p><blockquote><p>\u5927\u591A\u6570\u573A\u5408\u4E0B\uFF0C\u4E0D\u5141\u8BB8\u5411\u64CD\u4F5C\u578B\u6570\u636E\u5E93\u91CC\u6DFB\u52A0\u89E6\u53D1\u5668\uFF0C\u4E14\u8FD9\u79CD\u65B9\u6CD5\u4F1A\u964D\u4F4E\u7CFB\u7EDF\u6027\u80FD\uFF0C\u57FA\u672C\u4E0D\u4F1A\u88AB\u91C7\u7528;</p></blockquote><ol start="3"><li>\u57FA\u4E8E\u5FEB\u7167\u7684CDC\u3002</li></ol><p>\u53EF\u4EE5\u901A\u8FC7\u6BD4\u8F83\u6E90\u8868\u548C\u5FEB\u7167\u8868\u6765\u83B7\u5F97\u6570\u636E\u53D8\u5316\u3002\u57FA\u4E8E\u5FEB\u7167\u7684CDC\u53EF\u4EE5\u68C0\u6D4B\u5230\u63D2\u5165\u3001\u66F4\u65B0\u548C\u5220\u9664\u7684\u6570\u636E\uFF0C\u8FD9\u662F\u76F8\u5BF9\u4E8E\u57FA\u4E8E\u65F6\u95F4\u6233\u7684CDC\u65B9\u6848\u7684\u4F18\u70B9\u3002\u5176\u7F3A\u70B9\u662F\u9700\u8981\u5927\u91CF\u5B58\u50A8\u7A7A\u95F4\u6765\u4FDD\u5B58\u5FEB\u7167;</p><ol start="4"><li>\u57FA\u4E8E\u65E5\u5FD7\u7684CDC\u3002</li></ol><p>\u6700\u590D\u6742\u7684\u548C\u6CA1\u6709\u4FB5\u5165\u6027\u7684CDC\u65B9\u6CD5\u662F\u57FA\u4E8E\u65E5\u5FD7\u7684\u65B9\u5F0F\u3002\u6570\u636E\u5E93\u4F1A\u628A\u6BCF\u4E2A\u63D2\u5165\u3001\u66F4\u65B0\u3001\u5220\u9664\u64CD\u4F5C\u8BB0\u5F55\u5230\u65E5\u5FD7\u91CC\u3002\u89E3\u6790\u65E5\u5FD7\u6587\u4EF6\uFF0C\u5C31\u53EF\u4EE5\u83B7\u53D6\u76F8\u5173\u4FE1\u606F\u3002 \u6BCF\u4E2A\u5173\u7CFB\u578B\u6570\u636E\u5E93\u65E5\u5FD7\u683C\u5F0F\u4E0D\u4E00\u81F4\uFF0C\u6CA1\u6709\u901A\u7528\u7684\u4EA7\u54C1\u3002</p><blockquote><p>\u963F\u91CC\u5DF4\u5DF4\u7684canal\u53EF\u4EE5\u5B8C\u6210MySQL\u65E5\u5FD7\u6587\u4EF6\u89E3\u6790\u3002</p></blockquote><blockquote><p>Sqoop \u5B9E\u73B0\u7684\u662F\u57FA\u4E8E\u65F6\u95F4\u6233\u7684CDC\u3002</p></blockquote><p>\u589E\u91CF\u5BFC\u5165\u6570\u636E\u5206\u4E3A\u4E24\u79CD\u65B9\u5F0F:</p><ul><li>\u57FA\u4E8E\u9012\u589E\u5217\u7684\u589E\u91CF\u6570\u636E\u5BFC\u5165(Append\u65B9\u5F0F)</li><li>\u57FA\u4E8E\u65F6\u95F4\u5217\u7684\u6570\u636E\u589E\u91CF\u5BFC\u5165(LastModified\u65B9\u5F0F)</li></ul><h4 id="append\u65B9\u5F0F\u6848\u4F8B" tabindex="-1"><a class="header-anchor" href="#append\u65B9\u5F0F\u6848\u4F8B" aria-hidden="true">#</a> Append\u65B9\u5F0F\u6848\u4F8B</h4><ol><li>\u51C6\u5907\u521D\u59CB\u6570\u636E</li></ol><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- \u5220\u9664 MySQL \u8868\u4E2D\u7684\u5168\u90E8\u6570\u636E </span>
<span class="token keyword">truncate</span> <span class="token keyword">table</span> sqoop<span class="token punctuation">.</span>goodtbl<span class="token punctuation">;</span>
<span class="token comment">-- \u5220\u9664 Hive \u8868\u4E2D\u7684\u5168\u90E8\u6570\u636E </span>
<span class="token keyword">truncate</span> <span class="token keyword">table</span> mydb<span class="token punctuation">.</span>goodtbl<span class="token punctuation">;</span>
<span class="token comment">-- \u5411MySQL\u7684\u8868\u4E2D\u63D2\u5165100\u6761\u6570\u636E</span>
<span class="token keyword">call</span> batchInsertTestData<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="2"><li>\u5C06\u6570\u636E\u5BFC\u5165Hive</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>sqoop <span class="token function">import</span> <span class="token punctuation">\\</span>
  --connect jdbc:mysql://linux123:3306/sqoop <span class="token punctuation">\\</span>
  --username hive --password <span class="token number">12345678</span> <span class="token punctuation">\\</span>
  --table goodtbl <span class="token punctuation">\\</span>
  --hive-import <span class="token punctuation">\\</span>
  --hive-table mydb.goodtbl <span class="token punctuation">\\</span>
  --fields-terminated-by <span class="token string">&quot;<span class="token entity" title="\\t">\\t</span>&quot;</span> <span class="token punctuation">\\</span>
  --incremental append <span class="token punctuation">\\</span>
  --check-column serialNumber <span class="token punctuation">\\</span>
  --last-value <span class="token number">0</span> <span class="token punctuation">\\</span>
  -m <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u53C2\u6570\u8BF4\u660E:</p><ul><li><code>check-column</code> \u7528\u6765\u6307\u5B9A\u4E00\u4E9B\u5217(\u5373\u53EF\u4EE5\u6307\u5B9A\u591A\u4E2A\u5217)\uFF0C\u8FD9\u4E9B\u5217\u5728\u589E\u91CF\u5BFC\u5165\u65F6\u7528\u6765\u68C0\u67E5\u8FD9\u4E9B\u6570\u636E\u662F\u5426\u4F5C\u4E3A\u589E\u91CF\u6570\u636E\u8FDB\u884C\u5BFC\u5165\uFF0C\u548C\u5173\u7CFB\u578B\u6570\u636E\u5E93\u4E2D\u7684\u81EA\u589E\u5B57\u6BB5\u53CA\u65F6\u95F4\u6233\u7C7B\u4F3C\u3002\u8FD9\u4E9B\u88AB\u6307\u5B9A\u7684\u5217\u7684\u7C7B\u578B\u4E0D\u80FD\u4F7F\u4EFB\u610F\u5B57\u7B26\u7C7B\u578B\uFF0C\u5982char\u3001varchar\u7B49\u7C7B\u578B\u90FD\u4E0D\u53EF\u4EE5</li><li><code>last-value</code> \u6307\u5B9A\u4E0A\u4E00\u6B21\u5BFC\u5165\u4E2D\u68C0\u67E5\u5217\u6307\u5B9A\u5B57\u6BB5\u6700\u5927\u503C</li></ul><ol start="3"><li>\u68C0\u67E5hive\u8868\u4E2D\u662F\u5426\u6709\u6570\u636E\uFF0C\u6709\u591A\u5C11\u6761\u6570\u636E</li><li>\u518D\u5411MySQL\u4E2D\u52A0\u51651000\u6761\u6570\u636E\uFF0C\u7F16\u53F7\u4ECE200\u5F00\u59CB</li></ol><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">call</span> batchInsertTestData<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="5"><li>\u518D\u6B21\u6267\u884C\u589E\u91CF\u5BFC\u5165\uFF0C\u5C06\u6570\u636E\u4ECE MySQL \u5BFC\u5165 Hive \u4E2D; \u6B64\u65F6\u8981\u5C06 <code>last-value</code> \u6539\u4E3A <code>100</code></li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>sqoop <span class="token function">import</span> <span class="token punctuation">\\</span>
  --connect jdbc:mysql://linux123:3306/sqoop <span class="token punctuation">\\</span>
  --username hive --password <span class="token number">12345678</span> <span class="token punctuation">\\</span>
  --table goodtbl <span class="token punctuation">\\</span>
  --incremental append <span class="token punctuation">\\</span>
  --hive-import <span class="token punctuation">\\</span>
  --fields-terminated-by <span class="token string">&quot;<span class="token entity" title="\\t">\\t</span>&quot;</span> <span class="token punctuation">\\</span>
  --hive-table mydb.goodtbl <span class="token punctuation">\\</span>
  --check-column serialNumber <span class="token punctuation">\\</span>
  --last-value <span class="token number">100</span> <span class="token punctuation">\\</span>
  -m <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="6"><li>\u518D\u68C0\u67E5hive\u8868\u4E2D\u662F\u5426\u6709\u6570\u636E\uFF0C\u6709\u591A\u5C11\u6761\u6570\u636E</li></ol><h3 id="\u7B2C-4-\u8282-\u6267\u884C-job" tabindex="-1"><a class="header-anchor" href="#\u7B2C-4-\u8282-\u6267\u884C-job" aria-hidden="true">#</a> \u7B2C 4 \u8282 \u6267\u884C job</h3><p>\u6267\u884C\u6570\u636E\u589E\u91CF\u5BFC\u5165\u6709\u4E24\u79CD\u5B9E\u73B0\u65B9\u5F0F:</p><ol><li>\u6BCF\u6B21\u624B\u5DE5\u914D\u7F6Elast-value\uFF0C\u624B\u5DE5\u8C03\u5EA6</li><li>\u4F7F\u7528job\uFF0C\u7ED9\u5B9A\u521D\u59CBlast-value\uFF0C\u5B9A\u65F6\u4EFB\u52A1\u6BCF\u5929\u5B9A\u65F6\u8C03\u5EA6\u3002</li></ol><blockquote><p>\u5F88\u660E\u663E\u65B9\u5F0F2\u66F4\u7B80\u4FBF</p></blockquote><ol><li>\u521B\u5EFA\u53E3\u4EE4\u6587\u4EF6</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> -n <span class="token string">&quot;12345678&quot;</span> <span class="token operator">&gt;</span> sqoopPWD.pwd
hdfs dfs -mkdir -p /sqoop/pwd
hdfs dfs -put sqoopPWD.pwd /sqoop/pwd
hdfs dfs -chmod <span class="token number">400</span> /sqoop/pwd/sqoopPWD.pwd

<span class="token comment"># \u53EF\u4EE5\u5728 sqoop \u7684 job \u4E2D\u589E\u52A0: --password-file /sqoop/pwd/sqoopPWD.pwd</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="2"><li>\u521B\u5EFA sqoop job</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u521B\u5EFA sqoop job</span>
sqoop job --create myjob1 -- <span class="token function">import</span> <span class="token punctuation">\\</span>
  --connect jdbc:mysql://linux123:3306/sqoop?useSSL<span class="token operator">=</span>false <span class="token punctuation">\\</span>
  --username hive <span class="token punctuation">\\</span>
  --password-file /sqoop/pwd/sqoopPWD.pwd <span class="token punctuation">\\</span>
  --table goodtbl <span class="token punctuation">\\</span>
  --incremental append <span class="token punctuation">\\</span>
  --hive-import <span class="token punctuation">\\</span>
  --hive-table mydb.goodtbl <span class="token punctuation">\\</span>
  --check-column serialNumber <span class="token punctuation">\\</span>
  --last-value <span class="token number">0</span> <span class="token punctuation">\\</span>
  -m <span class="token number">1</span>

<span class="token comment"># \u67E5\u770B\u5DF2\u521B\u5EFA\u7684job </span>
sqoop job --list
<span class="token comment"># \u67E5\u770Bjob\u8BE6\u7EC6\u8FD0\u884C\u65F6\u53C2\u6570 </span>
sqoop job --show myjob1
<span class="token comment"># \u6267\u884Cjob</span>
sqoop job --exec myjob1
<span class="token comment"># \u5220\u9664job</span>
sqoop job --delete myjob1
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ol start="3"><li>\u6267\u884Cjob</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>sqoop job -exec myjob1
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="4"><li>\u67E5\u770B\u6570\u636E</li></ol><p><strong>\u5B9E\u73B0\u539F\u7406</strong></p><p>\u56E0\u4E3Ajob\u6267\u884C\u5B8C\u6210\u540E\uFF0C\u4F1A\u628A\u5F53\u524Dcheck-column\u7684\u6700\u5927\u503C\u8BB0\u5F55\u5230meta\u4E2D\uFF0C\u4E0B\u6B21\u518D\u8C03\u8D77\u65F6\u628A\u6B64\u503C\u8D4B\u7ED9last-value\u3002</p><p>\u7F3A\u7701\u60C5\u51B5\u4E0B\u5143\u6570\u636E\u4FDD\u5B58\u5728 <code>~/.sqoop/</code></p><p>\u5176\u4E2D\uFF0C<code>metastore.db.script</code> \u6587\u4EF6\u8BB0\u5F55\u4E86\u5BF9last-value\u7684\u66F4\u65B0\u64CD\u4F5C:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> metastore.db.script <span class="token operator">|</span> <span class="token function">grep</span> incremental.last.value
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="\u7B2C\u56DB\u90E8\u5206-\u5E38\u7528\u547D\u4EE4\u53CA\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u56DB\u90E8\u5206-\u5E38\u7528\u547D\u4EE4\u53CA\u53C2\u6570" aria-hidden="true">#</a> \u7B2C\u56DB\u90E8\u5206 \u5E38\u7528\u547D\u4EE4\u53CA\u53C2\u6570</h2><h3 id="\u7B2C-1-\u8282-\u5E38\u7528\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#\u7B2C-1-\u8282-\u5E38\u7528\u547D\u4EE4" aria-hidden="true">#</a> \u7B2C 1 \u8282 \u5E38\u7528\u547D\u4EE4</h3><table><thead><tr><th>\u5E8F\u53F7</th><th>\u547D\u4EE4</th><th>\u7C7B</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td>1</td><td>import</td><td>ImportTool</td><td>\u5C06\u6570\u636E\u5BFC\u5165\u5230\u96C6\u7FA4</td></tr><tr><td>2</td><td>export</td><td>ExportTool</td><td>\u5C06\u96C6\u7FA4\u6570\u636E\u5BFC\u51FA</td></tr><tr><td>3</td><td>codegen</td><td>CodeGenTool</td><td>\u83B7\u53D6\u6570\u636E\u5E93\u4E2D\u67D0\u5F20\u8868\u6570\u636E\u751F\u6210 Java\u5E76\u6253\u5305Jar</td></tr><tr><td>4</td><td>create-hive-table</td><td>CreateHiveTableTool</td><td>\u521B\u5EFAHive\u8868</td></tr><tr><td>5</td><td>eval</td><td>EvalSqlTool</td><td>\u67E5\u770BSQL\u6267\u884C\u7ED3\u679C</td></tr><tr><td>6</td><td>import- all-tables</td><td>ImportAllTablesTool</td><td>\u5BFC\u5165\u67D0\u4E2A\u6570\u636E\u5E93\u4E0B\u6240\u6709\u8868\u5230HDFS\u4E2D</td></tr><tr><td>7</td><td>job</td><td>JobTool</td><td>\u7528\u6765\u751F\u6210\u4E00\u4E2Asqoop\u7684\u4EFB\u52A1\uFF0C\u751F\u6210\u540E\uFF0C\u8BE5\u4EFB\u52A1\u5E76\u4E0D\u6267\u884C\uFF0C\u9664\u975E\u4F7F\u7528\u547D\u4EE4\u6267\u884C\u8BE5\u4EFB\u52A1\u3002</td></tr><tr><td>8</td><td>list-databases</td><td>ListDatabasesTool</td><td>\u5217\u51FA\u6240\u6709\u6570\u636E\u5E93\u540D</td></tr><tr><td>9</td><td>list-tables</td><td>ListTablesTool</td><td>\u5217\u51FA\u67D0\u4E2A\u6570\u636E\u5E93\u4E0B\u6240\u6709\u8868</td></tr><tr><td>10</td><td>merge</td><td>MergeTool</td><td>\u5C06HDFS\u4E2D\u4E0D\u540C\u76EE\u5F55\u4E0B\u9762\u7684\u6570\u636E\u5408 \u5728\u4E00\u8D77\uFF0C\u5E76\u5B58\u653E\u5728\u6307\u5B9A\u7684\u76EE\u5F55\u4E2D</td></tr><tr><td>11</td><td>metastore</td><td>MetastoreTool</td><td>\u8BB0\u5F55sqoop job\u7684\u5143\u6570\u636E\u4FE1\u606F\uFF0C \u5982\u679C\u4E0D\u542F\u52A8metastore\u5B9E\u4F8B\uFF0C\u5219 \u9ED8\u8BA4\u7684\u5143\u6570\u636E\u5B58\u50A8\u76EE\u5F55\u4E3A: ~/.sqoop\uFF0C\u5982\u679C\u8981\u66F4\u6539\u5B58\u50A8\u76EE \u5F55\uFF0C\u53EF\u4EE5\u5728\u914D\u7F6E\u6587\u4EF6sqoop- site.xml\u4E2D\u8FDB\u884C\u66F4\u6539\u3002</td></tr><tr><td>12</td><td>help</td><td>HelpTool</td><td>\u6253\u5370sqoop\u5E2E\u52A9\u4FE1\u606F</td></tr><tr><td>13</td><td>version</td><td>VersionTool</td><td>\u6253\u5370sqoop\u7248\u672C\u4FE1\u606F</td></tr></tbody></table><h3 id="\u7B2C-2-\u8282-\u5E38\u7528\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#\u7B2C-2-\u8282-\u5E38\u7528\u53C2\u6570" aria-hidden="true">#</a> \u7B2C 2 \u8282 \u5E38\u7528\u53C2\u6570</h3><blockquote><p>\u6240\u8C13\u516C\u7528\u53C2\u6570\uFF0C\u5C31\u662F\u5927\u591A\u6570\u547D\u4EE4\u90FD\u652F\u6301\u7684\u53C2\u6570\u3002</p></blockquote>`,111);function y(w,f){const a=o("ExternalLinkIcon");return l(),c(r,null,[b,n("blockquote",null,[n("p",null,[d,n("a",k,[m,e(a)])]),n("p",null,[h,n("a",v,[g,e(a)])])]),q],64)}var _=t(u,[["render",y],["__file","index.html.vue"]]);export{_ as default};
