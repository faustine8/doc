import{_ as o,r as l,o as c,a as r,b as n,d as a,F as i,e as s,c as t}from"./app.40df414d.js";var u="/doc/assets/README-1651819098507.a1a2ecdd.png";const d={},m=n("h1",{id:"skywalking-\u4F7F\u7528\u5B9E\u6218",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#skywalking-\u4F7F\u7528\u5B9E\u6218","aria-hidden":"true"},"#"),s(" SkyWalking \u4F7F\u7528\u5B9E\u6218")],-1),b=n("h2",{id:"java-\u5E94\u7528\u63A5\u5165",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#java-\u5E94\u7528\u63A5\u5165","aria-hidden":"true"},"#"),s(" Java \u5E94\u7528\u63A5\u5165")],-1),k=s("Agent \u547D\u4EE4\u53C2\u6570\u53C2\u8003 "),g={href:"https://skywalking.apache.org/docs/skywalking-java/v8.10.0/en/setup/service-agent/java-agent/configurations/",target:"_blank",rel:"noopener noreferrer"},v=s("https://skywalking.apache.org/docs/skywalking-java/v8.10.0/en/setup/service-agent/java-agent/configurations/"),h=s("\u65B9\u5F0F\u4E00 "),_=t(`<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>-javaagent:/opt/zmn/software/skywalking-agent/skywalking-agent.jar <span class="token punctuation">\\</span>
  -Dskywalking.agent.service_name<span class="token operator">=</span>zmn-owl::zmn-owl-admin <span class="token punctuation">\\</span>
  -Dskywalking.collector.backend_service<span class="token operator">=</span><span class="token number">192.168</span>.99.23:11800 <span class="token punctuation">\\</span>
  -jar xxx.jar
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u65B9\u5F0F\u4E8C</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u542F\u52A8\u547D\u4EE4</span>
<span class="token comment"># SkyWalking Agent \u914D\u7F6E</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">SW_AGENT_NAME</span><span class="token operator">=</span>zmn-owl::zmn-owl-admin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">SW_AGENT_COLLECTOR_BACKEND_SERVICES</span><span class="token operator">=</span><span class="token number">192.168</span>.99.23:11800
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_AGENT</span><span class="token operator">=</span>-javaagent:/opt/zmn/software/skywalking-agent/skywalking-agent.jar

<span class="token comment"># Jar \u542F\u52A8</span>
java -jar <span class="token variable">$JAVA_AGENT</span> -jar xxx.jar
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u5E94\u7528\u63A5\u5165\u540E\uFF0C\u5C31\u53EF\u4EE5\u5728 SkyWalking \u4E2D\u67E5\u770B\u94FE\u8DEF\u8FFD\u8E2A\u3001\u62D3\u6251\u56FE\uFF0C\u5982\u679C\u9700\u8981\u67E5\u770B\u8BE6\u7EC6\u7684\u4E1A\u52A1\u65E5\u5FD7\u8FD8\u9700\u8981\u63A5\u5165\u65E5\u5FD7\u3002</p><h2 id="\u65E5\u5FD7\u63A5\u5165" tabindex="-1"><a class="header-anchor" href="#\u65E5\u5FD7\u63A5\u5165" aria-hidden="true">#</a> \u65E5\u5FD7\u63A5\u5165</h2><blockquote><p>\u4F1A\u5728 <code>zmn-framework</code> \u4E2D\u7EDF\u4E00\u6DFB\u52A0\uFF0C\u6B64\u5904\u4EC5\u505A\u5B66\u4E60\u53C2\u8003\u3002</p></blockquote><h3 id="springboot-\u9879\u76EE\u65E5\u5FD7\u63A5\u5165" tabindex="-1"><a class="header-anchor" href="#springboot-\u9879\u76EE\u65E5\u5FD7\u63A5\u5165" aria-hidden="true">#</a> SpringBoot \u9879\u76EE\u65E5\u5FD7\u63A5\u5165</h3><ol><li>\u6DFB\u52A0 pom \u4F9D\u8D56</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- SkyWalking --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.skywalking<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>apm-toolkit-logback-1.x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.skywalking<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>apm-toolkit-trace<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="2"><li><code>logback-spring.xml</code> \u6587\u4EF6\u4E2D\u6DFB\u52A0\u65E5\u5FD7\u6536\u96C6\u5668</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span> <span class="token attr-name">scan</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scanPeriod</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span> 5 seconds<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stdout<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.encoder.LayoutWrappingEncoder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.skywalking.apm.toolkit.log.logback.v1.x.mdc.TraceIdMDCPatternLogbackLayout<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Pattern</span><span class="token punctuation">&gt;</span></span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%X{tid}] [%thread] %-5level %logger{36} -%msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Pattern</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>grpc-log<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.skywalking.apm.toolkit.log.logback.v1.x.log.GRPCLogClientAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.encoder.LayoutWrappingEncoder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.skywalking.apm.toolkit.log.logback.v1.x.mdc.TraceIdMDCPatternLogbackLayout<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Pattern</span><span class="token punctuation">&gt;</span></span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%X{tid}] [%thread] %-5level %logger{36} -%msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Pattern</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>INFO<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>grpc-log<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stdout<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="ui-\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#ui-\u4F7F\u7528" aria-hidden="true">#</a> UI \u4F7F\u7528</h2><ul><li>Service: \u5FAE\u670D\u52A1</li><li>Topology: \u62D3\u6251\u56FE (\u62D3\u6251\u7ED3\u6784\u56FE\u662F\u6307\u7531\u7F51\u7EDC\u8282\u70B9\u8BBE\u5907\u548C\u901A\u4FE1\u4ECB\u8D28\u6784\u6210\u7684\u7F51\u7EDC\u7ED3\u6784\u56FE\u3002)</li><li>Trace: \u94FE\u8DEF\u8FFD\u8E2A</li><li>Endpoint: \u7AEF\u70B9\uFF0C\u662F\u670D\u52A1\u4E2D\u7684\u67D0\u4E2A\u8DEF\u5F84\u6216\u8005\u8BF4URI</li></ul><p>SkyWalking \u5141\u8BB8\u7528\u6237\u4E86\u89E3\u670D\u52A1\u548C\u7AEF\u70B9\u4E4B\u95F4\u7684\u62D3\u6251\u5173\u7CFB\uFF0C\u67E5\u770B\u6BCF\u4E2A\u670D\u52A1/\u670D\u52A1\u5B9E\u4F8B/\u7AEF\u70B9\u7684\u5EA6\u91CF\uFF0C\u5E76\u8BBE\u7F6E\u8B66\u62A5\u89C4\u5219\u3002</p><h3 id="\u6982\u89C8" tabindex="-1"><a class="header-anchor" href="#\u6982\u89C8" aria-hidden="true">#</a> \u6982\u89C8</h3><ul><li>Apdex\uFF1A\u4E00\u4E2A\u6807\u51C6\u7684\u5E94\u7528\u6027\u80FD\u5DE5\u4E1A\u6307\u6807\u3002</li></ul>`,16),y=n("p",null,"Apdex (Application Performance Index) \u6027\u80FD\u6307\u6570, \u662F\u4E00\u4E2A\u56FD\u9645\u901A\u7528\u6807\u51C6\uFF0C\u662F\u7528\u6237\u5BF9\u5E94\u7528\u6027\u80FD\u6EE1\u610F\u5EA6\u7684\u91CF\u5316\u503C\u3002",-1),f=s("\u53C2\u8003\uFF1A"),q={href:"https://support.huaweicloud.com/apm_faq/apm_03_0010.html",target:"_blank",rel:"noopener noreferrer"},S=s("https://support.huaweicloud.com/apm_faq/apm_03_0010.html"),x=t('<ul><li><p>Percentile\uFF1A\u767E\u5206\u4F4D\u6570\uFF0C\u7528\u4E8E\u53CD\u6620\u54CD\u5E94\u65F6\u95F4\u7684\u957F\u5C3E\u6548\u5E94\uFF0C\u4F8B\u5982 p99=200ms\uFF0C\u4EE3\u8868 99% \u7684\u8BF7\u6C42\u54CD\u5E94\u65F6\u95F4\u53EF\u4EE5\u5C0F\u4E8E\u7B49\u4E8E 200ms\u3002</p></li><li><p>SLA\uFF1A\u53C8\u53EB &quot;Success Rate&quot;\uFF0C\u6210\u529F\u7387\u3002</p></li></ul><blockquote><p>SLA (Service Level Agreement) \u670D\u52A1\u7EA7\u522B\u534F\u8BAE\uFF0C\u662F\u6307\u63D0\u4F9B\u670D\u52A1\u7684\u4F01\u4E1A\u4E0E\u5BA2\u6237\u4E4B\u95F4\u5C31\u670D\u52A1\u7684\u54C1\u8D28\u3001\u6C34\u51C6\u3001\u6027\u80FD\u7B49\u65B9\u9762\u6240\u8FBE\u6210\u7684\u53CC\u65B9\u5171\u540C\u8BA4\u53EF\u7684\u534F\u8BAE\u6216\u5951\u7EA6\u3002</p></blockquote><ul><li>CPM\uFF1ACall Per Minute \u6BCF\u5206\u949F\u8C03\u7528\u6570\u3002\u53C8\u53EB &quot;Service Load&quot;</li><li>Latency: \u7B49\u5F85\u65F6\u957F</li></ul><h3 id="instance" tabindex="-1"><a class="header-anchor" href="#instance" aria-hidden="true">#</a> Instance</h3><ul><li><p>\u8FDB\u5165\uFF0C\u53EF\u4EE5\u67E5\u770B\u5B9E\u4F8B\u7684\u57FA\u672C\u4FE1\u606F\uFF0C\u5982\uFF1A\u8D1F\u8F7D\u3001\u54CD\u5E94\u65F6\u957F\u3001\u6570\u636E\u5E93\u8FDE\u63A5\u6C60\u4FE1\u606F\u3001\u94FE\u8DEF\u8FFD\u8E2A\u3001\u65E5\u5FD7\u548C JVM \u76F8\u5173\u4FE1\u606F\u3002</p></li><li><p>\u300C\u67E5\u770B\u300D\u53EF\u4EE5\u5FEB\u901F\u67E5\u770B\u542F\u52A8\u53C2\u6570\u7B49\u4FE1\u606F</p></li></ul><h3 id="\u62D3\u6251\u56FE" tabindex="-1"><a class="header-anchor" href="#\u62D3\u6251\u56FE" aria-hidden="true">#</a> \u62D3\u6251\u56FE</h3><p>\u62D3\u6251\u56FE\u662F\u6839\u636E\u63A2\u9488\u4E0A\u884C\u6570\u636E\u5206\u6790\u51FA\u7684\u6574\u4F53\u62D3\u6251\u7ED3\u6784\u3002</p><p><img src="'+u+'" alt="\u62D3\u6251\u793A\u610F\u56FE"></p><p>\u62D3\u6251\u56FE\u652F\u6301\u70B9\u51FB\u5C55\u73B0\u548C\u4E0B\u94BB\u5355\u4E2A\u670D\u52A1\u7684\u6027\u80FD\u7EDF\u8BA1\u3001trace\u3001\u544A\u8B66\uFF0C\u4E5F\u53EF\u4EE5\u901A\u8FC7\u70B9\u51FB\u62D3\u6251\u56FE\u4E2D\u7684\u5173\u7CFB\u7EBF\uFF0C\u5C55\u73B0\u670D\u52A1\u95F4\u3001\u670D\u52A1\u5B9E\u4F8B\u95F4\u7684\u6027\u80FD\u6307\u6807\u3002</p><p>\u62D3\u6251\u56FE\u8FDE\u7EBF\u4E0A\u7684\u70B9\u7684\u6570\u636E\u542B\u4E49</p><table><thead><tr><th>\u53C2\u6570</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td>\u4FA6\u67E5\u7AEF</td><td>\u8BBF\u95EE\u7C7B\u578B</td></tr><tr><td>Latency</td><td>\u7B49\u5F85\u65F6\u95F4</td></tr><tr><td>Load</td><td>\u8D1F\u8F7D (\u8BBF\u95EE\u9891\u7387)</td></tr></tbody></table><blockquote><p>\u4FA6\u67E5\u7AEF\uFF0C\u53EF\u9009\u503C\uFF1AClient/Server\u3002 \u5982\u679C\u8BBF\u95EE\u5916\u90E8\u670D\u52A1\u5219\u4E3A Client\uFF0C\u5982\u679C\u4E24\u4E2A\u53D7\u76D1\u63A7\u7684\u670D\u52A1\u76F8\u4E92\u8BBF\u95EE\uFF0C\u5219\u540C\u65F6\u4E3A Client + Server.</p></blockquote><p>\u7AD9\u5728\u5F53\u524D\u5FAE\u670D\u52A1\u7684\u89D2\u5EA6\uFF1A</p><ol><li>\u5982\u679C\u662F\u8BBF\u95EE\u522B\u7684\u5FAE\u670D\u52A1\uFF0C\u5F53\u524D\u7684\u5FAE\u670D\u52A1\u5C31\u662F\u5BA2\u6237\u7AEF Client\uFF0C\u5BF9\u5176\u4ED6\u670D\u52A1\u7684\u8C03\u7528\u7684\u6570\u636E\u662F\u7531\u5F53\u524D\u5FAE\u670D\u52A1\u4E0A\u62A5\u7ED9 OAP Server\u7684\uFF1B</li><li>\u5982\u679C\u5F53\u524D\u5FAE\u670D\u52A1\u88AB\u522B\u7684\u5FAE\u670D\u52A1\u8BBF\u95EE\u5230\u4E86\uFF0C\u5F53\u524D\u5FAE\u670D\u52A1\u5C31\u662F Server\uFF0C\u88AB\u5176\u4ED6\u5FAE\u670D\u52A1\u8C03\u7528\u7684\u6307\u6807\u6570\u636E\u7531\u5F53\u524D\u5FAE\u670D\u52A1\u4E0A\u62A5\u7ED9 OAP Server \u7684\uFF1B</li><li>\u5982\u679C\u5F53\u524D\u5FAE\u670D\u52A1\u548C\u8C03\u7528\u5F53\u524D\u5FAE\u670D\u52A1\u7684\u670D\u52A1\u90FD\u53D7\u5230 SkyWalking \u7684\u76D1\u63A7\uFF0C\u4ED6\u4EEC\u4E4B\u95F4\u7684\u8C03\u7528\u5728\u53CC\u65B9\u90FD\u6709\u8BB0\u5F55(\u76F4\u63A5\u8C03\u7528)\u7684\u65F6\u5019\uFF0C\u4ED6\u4EEC\u4E4B\u95F4\u7684\u8C03\u7528\u7EBF\u4E0A\u5C31\u4F1A\u540C\u65F6\u51FA\u73B0 Client \u548C Server\u3002</li><li>\u5982\u679C\u94FE\u8DEF\u4E0A\u53EA\u6709 Client \u6216\u8005 Server \u5F80\u5F80\u662F\u95F4\u63A5\u8C03\u7528\u3002</li></ol><blockquote><p>\u90A3\u4E48\u4EC0\u4E48\u65F6\u5019\u662F Server \u5462\uFF1F \u6309\u7167\u4E66\u4E0A\u8BF4\uFF0C\u300C\u5982\u679C\u8C03\u7528\u6570\u636E\u53EA\u6765\u6E90\u4E8E\u4E0A\u6E38\u670D\u52A1\uFF0C\u800C\u6CA1\u6709\u4E0B\u6E38\u670D\u52A1\u7684\u8BDD\uFF0C\u90A3\u4E48\u5728\u62D3\u6251\u56FE\u4E0A\u5C31\u5E2E\u5FD9\u751F\u6210\u4E00\u4E2A\u70B9\uFF0C\u7528\u6765\u8868\u793A\u6709\u7528\u6237\u8BBF\u95EE\u8BE5\u4E0A\u6E38\u670D\u52A1\u3002\u300D\uFF0C\u8FD9\u65F6\u5019\u662F Server\u3002\u5176\u4ED6\u65F6\u5019\u662F Client\u3002(\u4E2A\u4EBA\u89C9\u5F97\u7406\u89E3\u8FD9\u4E2A\u6CA1\u4EC0\u4E48\u7528)</p></blockquote><h3 id="\u901A\u8FC7-kibana-\u67E5\u770B\u65E5\u5FD7" tabindex="-1"><a class="header-anchor" href="#\u901A\u8FC7-kibana-\u67E5\u770B\u65E5\u5FD7" aria-hidden="true">#</a> \u901A\u8FC7 Kibana \u67E5\u770B\u65E5\u5FD7</h3><p>\u4F7F\u7528\u4E09\u65B9\u5DE5\u5177\u67E5\u8BE2\u65E5\u5FD7\uFF0C\u9700\u8981\u5C06\u914D\u7F6E\u6587\u4EF6 <code>application.yaml</code> \u7684\u914D\u7F6E\u9879 <code>core/default/activeExtraModelColumns</code> \u8BBE\u7F6E\u4E3A <code>true</code>.</p><blockquote><p>\u642D\u5EFA Kibana \u7565 ...</p></blockquote><h4 id="kibana-\u521D\u59CB\u5316\u8BBE\u7F6E" tabindex="-1"><a class="header-anchor" href="#kibana-\u521D\u59CB\u5316\u8BBE\u7F6E" aria-hidden="true">#</a> Kibana \u521D\u59CB\u5316\u8BBE\u7F6E</h4><blockquote><p>\u7BA1\u7406\u5458\u914D\u7F6E\u597D\u540E\uFF0C\u53EF\u4EE5\u76F4\u63A5\u4F7F\u7528\u4E86\uFF0C\u5E76\u4E0D\u662F\u6BCF\u4E2A\u4EBA\u90FD\u9700\u8981\u4E86\u89E3\u3002</p></blockquote><ol><li><p>Discovery &gt; Index Patterns &gt; Create index pattern</p></li><li><p>\u8F93\u5165\u53F3\u8FB9\u7684\u8868\uFF0C\u5EFA\u8BAE\u4F7F\u7528\u903B\u8F91\u8868</p></li></ol><h4 id="kibana-\u65E5\u5FD7\u641C\u7D22" tabindex="-1"><a class="header-anchor" href="#kibana-\u65E5\u5FD7\u641C\u7D22" aria-hidden="true">#</a> Kibana \u65E5\u5FD7\u641C\u7D22</h4><p>\u641C\u7D22\uFF1A</p><ol><li><p>\u76F4\u63A5\u8F93\u5165\u641C\u7D22\u6761\u4EF6\uFF0C\u53EF\u4EE5\u4F7F\u7528\u4EFB\u4F55\u5173\u952E\u5B57\u641C\u7D22\uFF0C\u4E5F\u53EF\u4EE5\u6DFB\u52A0 <code>*</code> \u6A21\u7CCA\u641C\u7D22\u3002\u5982\uFF1A<code>&quot;05-07 14:53&quot;</code>, <code>05-07 14:53*</code></p></li><li><p>\u6307\u5B9A\u5B57\u6BB5\u641C\u7D22\u683C\u5F0F\uFF1A <code>trace_id:&quot;3e0341e4bf754f298eef423b14728b6d.300.16517398356430009&quot;</code></p></li></ol><p>\u4EC5\u5C55\u793A\u90E8\u5206\u5217\uFF1A</p><ul><li>\u9ED8\u8BA4\u5C55\u793A\u6587\u6863(\u6570\u636E\u8868)\u7684\u6240\u6709\u5217</li><li>Available Fields \u5217\u8868\u4E0A\u7684\u4EFB\u4F55\u5B57\u6BB5\u540E\u9762\u70B9\u51FB &quot;+&quot; \u6309\u94AE</li><li>\u53BB\u6389\u4E0D\u60F3\u770B\u7684\uFF1A\u5728 Selected field \u5217\u8868\u7684\u5B57\u6BB5\u540E\u9762\u70B9\u51FB &quot;\xD7&quot; \u6309\u94AE</li></ul><blockquote><p>KQL \u8BED\u6CD5\uFF0C\u53EF\u4EE5\u7814\u7A76\u4E00\u4E0B</p></blockquote><h2 id="\u9884\u8B66\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u9884\u8B66\u914D\u7F6E" aria-hidden="true">#</a> \u9884\u8B66\u914D\u7F6E</h2>',28),M=s("\u5B98\u65B9\u6587\u6863\uFF1A"),j={href:"https://skywalking.apache.org/docs/main/latest/en/setup/backend/backend-alarm/",target:"_blank",rel:"noopener noreferrer"},A=s("https://skywalking.apache.org/docs/main/latest/en/setup/backend/backend-alarm/"),I=t(`<p>\u9884\u8B66\u914D\u7F6E\u5728 <code>$APM_HOME/config/alarm-settings.yml</code> \u4E2D\u3002</p><p>\u7CFB\u7EDF\u81EA\u5E26\u4E86\u51E0\u6761\u89C4\u5219\u4F5C\u4E3A\u53C2\u8003\uFF1A</p><ol><li>Service average response time over 1s in the last 3 minutes.</li></ol><p>\u6700\u8FD1\u4E09\u5206\u949F\u5E73\u5747\u54CD\u5E94\u65F6\u957F\u8D85\u8FC7 1S \u7684\u5FAE\u670D\u52A1\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">service_resp_time_rule</span><span class="token punctuation">:</span>
  <span class="token key atrule">metrics-name</span><span class="token punctuation">:</span> service_resp_time
  <span class="token key atrule">op</span><span class="token punctuation">:</span> <span class="token string">&quot;&gt;&quot;</span>
  <span class="token key atrule">threshold</span><span class="token punctuation">:</span> <span class="token number">1000</span>
  <span class="token key atrule">period</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">count</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">silence-period</span><span class="token punctuation">:</span> <span class="token number">5</span>
  <span class="token key atrule">message</span><span class="token punctuation">:</span> Response time of service <span class="token punctuation">{</span>name<span class="token punctuation">}</span> is more than 1000ms in 3 minutes of last 10 minutes.
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="2"><li>Service success rate lower than 80% in the last 2 minutes.</li></ol><p>\u6700\u8FD1\u4E24\u5206\u949F\u54CD\u5E94\u6210\u529F\u7387\u4F4E\u4E8E 80% \u7684\u5FAE\u670D\u52A1\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">service_sla_rule</span><span class="token punctuation">:</span>
  <span class="token comment"># Metrics value need to be long, double or int</span>
  <span class="token key atrule">metrics-name</span><span class="token punctuation">:</span> service_sla
  <span class="token key atrule">op</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;&quot;</span>
  <span class="token key atrule">threshold</span><span class="token punctuation">:</span> <span class="token number">8000</span>
  <span class="token comment"># The length of time to evaluate the metrics</span>
  <span class="token key atrule">period</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token comment"># How many times after the metrics match the condition, will trigger alarm</span>
  <span class="token key atrule">count</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token comment"># How many times of checks, the alarm keeps silence after alarm triggered, default as same as period.</span>
  <span class="token key atrule">silence-period</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">message</span><span class="token punctuation">:</span> Successful rate of service <span class="token punctuation">{</span>name<span class="token punctuation">}</span> is lower than 80% in 2 minutes of last 10 minutes
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="3"><li>Percentile of service response time over 1s in the last 3 minutes</li></ol><p>\u6700\u8FD1 3 \u5206\u949F\u54CD\u5E94\u7684\u300C\u767E\u5206\u4F4D\u6570\u300D\u8D85\u8FC7 1S \u7684\u5FAE\u670D\u52A1</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">service_resp_time_percentile_rule</span><span class="token punctuation">:</span>
  <span class="token comment"># Metrics value need to be long, double or int</span>
  <span class="token key atrule">metrics-name</span><span class="token punctuation">:</span> service_percentile
  <span class="token key atrule">op</span><span class="token punctuation">:</span> <span class="token string">&quot;&gt;&quot;</span>
  <span class="token key atrule">threshold</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">1000</span>
  <span class="token key atrule">period</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">count</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">silence-period</span><span class="token punctuation">:</span> <span class="token number">5</span>
  <span class="token key atrule">message</span><span class="token punctuation">:</span> Percentile response time of service <span class="token punctuation">{</span>name<span class="token punctuation">}</span> alarm in 3 minutes of last 10 minutes<span class="token punctuation">,</span> due to more than one condition of p50 <span class="token punctuation">&gt;</span> 1000<span class="token punctuation">,</span> p75 <span class="token punctuation">&gt;</span> 1000<span class="token punctuation">,</span> p90 <span class="token punctuation">&gt;</span> 1000<span class="token punctuation">,</span> p95 <span class="token punctuation">&gt;</span> 1000<span class="token punctuation">,</span> p99 <span class="token punctuation">&gt;</span> 1000
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="4"><li>Service Instance average response time over 1s in the last 2 minutes, and the instance name matches the regex.</li></ol><blockquote><p>\u4E0A\u9762\u662F\u5B98\u65B9\u6587\u6863\u539F\u8BDD\uFF0C\u5F88\u660E\u663E\u4ED6\u5728\u778E\u8BF4\u3002</p></blockquote><p>\u6700\u8FD1 2 \u5206\u949F\u7684\u5E73\u5747\u54CD\u5E94\u65F6\u957F\u8D85\u8FC7 1s \u7684\u5FAE\u670D\u52A1\u5B9E\u4F8B\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">service_instance_resp_time_rule</span><span class="token punctuation">:</span>
  <span class="token key atrule">metrics-name</span><span class="token punctuation">:</span> service_instance_resp_time
  <span class="token key atrule">op</span><span class="token punctuation">:</span> <span class="token string">&quot;&gt;&quot;</span>
  <span class="token key atrule">threshold</span><span class="token punctuation">:</span> <span class="token number">1000</span>
  <span class="token key atrule">period</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">count</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">silence-period</span><span class="token punctuation">:</span> <span class="token number">5</span>
  <span class="token key atrule">message</span><span class="token punctuation">:</span> Response time of service instance <span class="token punctuation">{</span>name<span class="token punctuation">}</span> is more than 1000ms in 2 minutes of last 10 minutes
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="5"><li>Endpoint average response time over 1s in the last 2 minutes.</li></ol><p>\u6700\u8FD1\u4E24\u5206\u949F\u5E73\u5747\u54CD\u5E94\u65F6\u957F\u8D85\u8FC7 1S \u7684\u7AEF\u70B9\u3002</p><blockquote><p>\u5E76\u6CA1\u6709\u8FD9\u4E2A\u89C4\u5219\uFF0C\u5B98\u65B9\u6587\u6863\u778E\u8BF4\u7684\u3002</p></blockquote><ol start="6"><li>Database access average response time over 1s in the last 2 minutes.</li></ol><p>\u6700\u8FD1\u4E24\u5206\u949F\u5E73\u5747\u54CD\u5E94\u65F6\u957F\u8D85\u8FC7 1s \u7684\u6570\u636E\u5E93</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">database_access_resp_time_rule</span><span class="token punctuation">:</span>
  <span class="token key atrule">metrics-name</span><span class="token punctuation">:</span> database_access_resp_time
  <span class="token key atrule">threshold</span><span class="token punctuation">:</span> <span class="token number">1000</span>
  <span class="token key atrule">op</span><span class="token punctuation">:</span> <span class="token string">&quot;&gt;&quot;</span>
  <span class="token key atrule">period</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">count</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">message</span><span class="token punctuation">:</span> Response time of database access <span class="token punctuation">{</span>name<span class="token punctuation">}</span> is more than 1000ms in 2 minutes of last 10 minutes
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="7"><li>Endpoint relation average response time over 1s in the last 2 minutes.</li></ol><p>\u6700\u8FD1\u4E24\u5206\u949F\u5173\u8054\u7AEF\u70B9\u54CD\u5E94\u65F6\u957F\u8D85\u8FC7 1s \u7684\u7AEF\u70B9\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">endpoint_relation_resp_time_rule</span><span class="token punctuation">:</span>
  <span class="token key atrule">metrics-name</span><span class="token punctuation">:</span> endpoint_relation_resp_time
  <span class="token key atrule">threshold</span><span class="token punctuation">:</span> <span class="token number">1000</span>
  <span class="token key atrule">op</span><span class="token punctuation">:</span> <span class="token string">&quot;&gt;&quot;</span>
  <span class="token key atrule">period</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">count</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">message</span><span class="token punctuation">:</span> Response time of endpoint relation <span class="token punctuation">{</span>name<span class="token punctuation">}</span> is more than 1000ms in 2 minutes of last 10 minutes
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="\u6982\u8FF0" tabindex="-1"><a class="header-anchor" href="#\u6982\u8FF0" aria-hidden="true">#</a> \u6982\u8FF0</h3><p>\u9996\u5148\u89E3\u91CA\u4E0B\u5404\u4E2A\u5B9E\u4F53\u7684\u5B9A\u4E49\uFF1A</p><ul><li>Service: \u5FAE\u670D\u52A1\u3002\u5982\uFF1A<code>zmn-erp-admin</code></li><li>Instance: \u5FAE\u670D\u52A1\u7684\u5177\u4F53\u7684\u5B9E\u4F8B\u3002\u5982\uFF1A<code>55c82440049f457588c50fd38ae3a353@172.17.0.1</code></li><li>Endpoint: \u7AEF\u70B9\u3002\u5982\uFF1A<code>POST:/rule/list.action</code>\uFF0C<code>com.zmn.base.price.dubbo.interfaces.tariff.TariffSkuPriceReferRemoteService.synchroRedisData(Integer,Integer)</code></li><li>Database: \u6570\u636E\u5E93\u3002\u5982\uFF1A<code>plat.db.ds.zmn.cn:7306</code></li></ul><p>\u544A\u8B66\u89C4\u5219\u6709\u4E24\u79CD\uFF1A\u72EC\u7ACB\u89C4\u5219\u548C\u590D\u5408\u89C4\u5219\u3002</p><h3 id="\u72EC\u7ACB\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#\u72EC\u7ACB\u89C4\u5219" aria-hidden="true">#</a> \u72EC\u7ACB\u89C4\u5219</h3><p>\u4E00\u6761\u72EC\u7ACB\u89C4\u5219\u4E3B\u8981\u7531\u4EE5\u4E0B\u51E0\u90E8\u5206\u7EC4\u6210\uFF1A</p>`,30),E=s("\u89C4\u5219\u540D\u79F0 "),P=s(" : \u89C4\u5219\u540D\u9700\u8981\u5168\u5C40\u552F\u4E00\uFF0C\u5E76\u4E14\u5FC5\u987B\u4EE5 "),V=n("code",null,"_rule",-1),T=s("\u7ED3\u5C3E\u3002"),C=n("code",null,"metrics-name",-1),L=s(),R=s(" : \u6307\u6807\uFF0C\u53EF\u7528\u7684\u6307\u6807\u5B9A\u4E49\u5728 "),J=n("code",null,"/config/oal/*.oal",-1),w=s(" \u4E2D\u3002\u8BE6\u60C5\u89C1\u4E0B\u8868\uFF1A\u53EF\u7528\u6307\u6807\u89C4\u5219\u8868\u3002"),D=t("<li><code>include-names</code>: \u89C4\u5219\u76D1\u63A7\u7684\u5B9E\u4F53\u5217\u8868\uFF0C\u5982\u679C\u4E0D\u586B\u9ED8\u8BA4\u76D1\u63A7\u6307\u6807\u5B9A\u4E49\u7684\u6240\u6709\u5B9E\u4F53\u3002</li><li><code>exclude-names</code>: \u6392\u9664\u76D1\u63A7\u7684\u5B9E\u4F53\u5217\u8868\uFF0C\u5982\u679C\u4E0D\u586B\u9ED8\u8BA4\u76D1\u63A7\u6307\u6807\u5B9A\u4E49\u7684\u6240\u6709\u5B9E\u4F53\u3002</li><li><code>include-names-regex</code>: \u63D0\u4F9B\u4E00\u4E2A\u6B63\u5219\u8868\u8FBE\u5F0F\u6765\u5339\u914D\u5B9E\u4F53\u540D\u79F0\u3002\u548C\u4E0A\u9762\u7684\u8BBE\u7F6E\u4E00\u540C\u751F\u6548\u3002</li><li><code>exclude-names-regex</code>: \u63D0\u4F9B\u4E00\u4E2A\u6B63\u5219\u8868\u8FBE\u5F0F\u6765\u6392\u9664\u5B9E\u4F53\u540D\u79F0\u3002\u548C\u4E0A\u9762\u7684\u8BBE\u7F6E\u4E00\u540C\u751F\u6548\u3002</li><li><code>include-labels</code>: \u5305\u542B\u7684\u6807\u7B7E\u5217\u8868</li><li><code>exclude-labels</code>: \u6392\u9664\u7684\u6807\u7B7E\u5217\u8868</li><li><code>include-labels-regex</code>: \u5305\u542B\u7684\u6807\u7B7E\u6B63\u5219\u3002\u548C\u4E0A\u9762\u7684\u8BBE\u7F6E\u4E00\u540C\u751F\u6548</li><li><code>exclude-labels-regex</code>: \u6392\u9664\u7684\u6807\u7B7E\u5217\u8868\u3002\u548C\u4E0A\u9762\u7684\u8BBE\u7F6E\u4E00\u540C\u751F\u6548\u3002</li><li><code>tags</code>: \u586B\u5199 Key=Value \u5BF9\uFF0C\u9ED8\u8BA4\u652F\u6301 <code>level</code></li>",9),N=n("code",null,"threshold",-1),O=s(),G=s(" : \u9608\u503C\u3002\u5982\u679C\u6307\u6807\u662F\u591A\u4E2A\u503C\uFF0C\u5219\u6B64\u5904\u586B\u6570\u7EC4\u3002\u5982\u767E\u5206\u4F4D\u6570\u8BBE\u7F6E\u4E3A "),W=n("code",null,"1000,1000,1000,1000,1000",-1),B=s("; \u5982\u679C\u5FFD\u7565\u90E8\u5206\u503C\uFF0C\u4F7F\u7528 "),H=n("code",null,"-",-1),F=s(", \u5982 "),U=n("code",null,"-,-,1000,1000,1000",-1),K=s(" \u8868\u793A\u4E0D\u5BF9 P50 \u548C P75 \u505A\u9884\u8B66\u3002"),z=n("code",null,"op",-1),Q=s(),$=s(" : \u6BD4\u8F83\u7B26\u3002\u652F\u6301 "),Z=n("code",null,">",-1),Y=s(", "),X=n("code",null,">=",-1),nn=s(", "),sn=n("code",null,"<",-1),an=s(", "),en=n("code",null,"<=",-1),tn=s(", "),pn=n("code",null,"==",-1),ln=n("code",null,"period",-1),on=s(),cn=s(" : \u89C4\u5219\u591A\u4E45\u6267\u884C\u4E00\u6B21\u3002\u5355\u4F4D\uFF1A\u5206\u949F\u3002"),rn=n("code",null,"count",-1),un=s(),dn=s(" : \u89C4\u5219\u6761\u4EF6\u5339\u914D\u4E86\uFF0C\u591A\u957F\u65F6\u95F4\u540E\u53D1\u9001\u9884\u8B66\u6D88\u606F\u3002\u5355\u4F4D\uFF1A\u5206\u949F\u3002"),mn=n("li",null,[n("code",null,"only-as-condition"),s(": true/false. \u662F\u5426\u4EC5\u4F5C\u4E3A\u7B26\u5408\u89C4\u5219\u7684\u6761\u4EF6\u3002")],-1),bn=n("code",null,"silence-period",-1),kn=s(),gn=s(" : \u9884\u8B66\u540E\uFF0C\u591A\u957F\u65F6\u95F4\u5185\u5F53\u524D\u89C4\u5219\u4E0D\u518D\u9884\u8B66\u3002\u5355\u4F4D\uFF1A\u5206\u949F\u3002"),vn=n("code",null,"message",-1),hn=s(),_n=s(" : \u6D88\u606F\u4F53\u3002(\u5982\u679C\u4EC5\u4F5C\u4E3A\u7B26\u5408\u89C4\u5219\u7684\u6761\u4EF6\uFF0C\u53EF\u4EE5\u4E0D\u586B)"),yn=t("<blockquote><p>\u5982\u679C\u60F3\u8981\u5728 SkyWalking UI \u4E0A\u9762\u4F7F\u7528 tag \u641C\u7D22\u7684\u8BDD\uFF0C\u9700\u8981\u5728\u7CFB\u7EDF\u53D8\u91CF <code>SW_SEARCHABLE_ALARM_TAG_KEYS</code> \u4E2D\u6DFB\u52A0 Key\uFF0C \u6216\u8005\u5728 <code>${SW_HOME}/config/application.yml</code> \u914D\u7F6E\u6587\u4EF6\u7684 <code>core.default.searchableAlarmTags</code> \u9879\u4E2D\u6DFB\u52A0 Key\u3002 \u9ED8\u8BA4\u4EC5\u652F\u6301 <code>level</code>\u3002</p></blockquote><p>\u53EF\u7528\u7CFB\u7EDF\u76D1\u63A7\u6307\u6807\u89C4\u5219\u8868\uFF1A</p><table><thead><tr><th>\u5206\u7C7B</th><th>\u8BF4\u660E</th><th>\u6307\u6807</th><th>OAL</th></tr></thead><tbody><tr><td>\u5FAE\u670D\u52A1\u76F8\u5173</td><td>\u670D\u52A1\u5E73\u5747\u54CD\u5E94\u65F6\u957F</td><td><code>service_resp_time</code></td><td><code>from(Service.latency).longAvg();</code></td></tr><tr><td>\u5FAE\u670D\u52A1\u76F8\u5173</td><td>\u670D\u52A1\u6210\u529F\u54CD\u5E94\u767E\u5206\u6570</td><td><code>service_sla</code></td><td><code>from(Service.*).percent(status == true);</code></td></tr><tr><td>\u5FAE\u670D\u52A1\u76F8\u5173</td><td>\u6BCF\u5206\u949F\u8BF7\u6C42\u6570</td><td><code>service_cpm</code></td><td><code>from(Service.*).cpm();</code></td></tr><tr><td>\u5FAE\u670D\u52A1\u76F8\u5173</td><td>\u670D\u52A1\u54CD\u5E94\u300C\u767E\u5206\u4F4D\u6570\u300D</td><td><code>service_percentile</code></td><td><code>from(Service.latency).percentile(10);</code> <br> // Multiple values including p50, p75, p90, p95, p99</td></tr><tr><td>\u5FAE\u670D\u52A1\u76F8\u5173</td><td>\u670D\u52A1 Apdex \u7B49\u7EA7\u5206\u6570</td><td><code>service_apdex</code></td><td><code>from(Service.latency).apdex(name, status);</code></td></tr><tr><td>\u5FAE\u670D\u52A1\u76F8\u5173</td><td>MQ \u6D88\u8D39\u6570\u91CF</td><td><code>service_mq_consume_count</code></td><td><code>from(Service.*).filter(type == RequestType.MQ).count();</code></td></tr><tr><td>\u5FAE\u670D\u52A1\u76F8\u5173</td><td>MQ \u6D88\u8D39\u7B49\u5F85\u65F6\u957F</td><td><code>service_mq_consume_latency</code></td><td><code>from((str-&gt;long)Service.tag[&quot;transmission.latency&quot;]).filter(type == RequestType.MQ).filter(tag[&quot;transmission.latency&quot;] != null).longAvg();</code></td></tr><tr><td>\u5173\u8054\u670D\u52A1\u76F8\u5173</td><td>\u5173\u8054\u670D\u52A1\u5BA2\u6237\u7AEF\u6BCF\u5206\u949F\u8BF7\u6C42\u6570</td><td><code>service_relation_client_cpm</code></td><td><code>from(ServiceRelation.*).filter(detectPoint == DetectPoint.CLIENT).cpm();</code></td></tr><tr><td>\u5173\u8054\u670D\u52A1\u76F8\u5173</td><td>\u5173\u8054\u670D\u52A1\u670D\u52A1\u7AEF\u6BCF\u5206\u949F\u8BF7\u6C42\u6570</td><td><code>service_relation_server_cpm</code></td><td><code>from(ServiceRelation.*).filter(detectPoint == DetectPoint.SERVER).cpm();</code></td></tr><tr><td>\u5173\u8054\u670D\u52A1\u76F8\u5173</td><td>\u5173\u8054\u670D\u52A1\u5BA2\u6237\u7AEF\u6210\u529F\u54CD\u5E94\u767E\u5206\u6570</td><td><code>service_relation_client_call_sla</code></td><td><code>from(ServiceRelation.*).filter(detectPoint == DetectPoint.CLIENT).percent(status == true);</code></td></tr><tr><td>\u5173\u8054\u670D\u52A1\u76F8\u5173</td><td>\u5173\u8054\u670D\u52A1\u670D\u52A1\u7AEF\u6210\u529F\u54CD\u5E94\u767E\u5206\u6570</td><td><code>service_relation_server_call_sla</code></td><td><code>from(ServiceRelation.*).filter(detectPoint == DetectPoint.SERVER).percent(status == true);</code></td></tr><tr><td>\u5173\u8054\u670D\u52A1\u76F8\u5173</td><td>\u5173\u8054\u670D\u52A1\u5BA2\u6237\u7AEF\u5E73\u5747\u54CD\u5E94\u65F6\u957F</td><td><code>service_relation_client_resp_time</code></td><td><code>from(ServiceRelation.latency).filter(detectPoint == DetectPoint.CLIENT).longAvg();</code></td></tr><tr><td>\u5173\u8054\u670D\u52A1\u76F8\u5173</td><td>\u5173\u8054\u670D\u52A1\u670D\u52A1\u7AEF\u5E73\u5747\u54CD\u5E94\u65F6\u957F</td><td><code>service_relation_server_resp_time</code></td><td><code>from(ServiceRelation.latency).filter(detectPoint == DetectPoint.SERVER).longAvg();</code></td></tr><tr><td>\u5173\u8054\u670D\u52A1\u76F8\u5173</td><td>\u5173\u8054\u670D\u52A1\u5BA2\u6237\u7AEF\u54CD\u5E94\u300C\u767E\u5206\u4F4D\u6570\u300D</td><td><code>service_relation_client_percentile</code></td><td><code>from(ServiceRelation.latency).filter(detectPoint == DetectPoint.CLIENT).percentile(10);</code> <br> // Multiple values including p50, p75, p90, p95, p99</td></tr><tr><td>\u5173\u8054\u670D\u52A1\u76F8\u5173</td><td>\u5173\u8054\u670D\u52A1\u670D\u52A1\u7AEF\u54CD\u5E94\u300C\u767E\u5206\u4F4D\u6570\u300D</td><td><code>service_relation_server_percentile</code></td><td><code>from(ServiceRelation.latency).filter(detectPoint == DetectPoint.SERVER).percentile(10);</code> <br> // Multiple values including p50, p75, p90, p95, p99</td></tr><tr><td>\u5173\u8054\u670D\u52A1\u5B9E\u4F8B\u76F8\u5173</td><td>\u5173\u8054\u670D\u52A1\u5B9E\u4F8B\u5BA2\u6237\u7AEF\u6BCF\u5206\u949F\u8BF7\u6C42\u6570</td><td><code>service_instance_relation_client_cpm</code></td><td><code>from(ServiceInstanceRelation.*).filter(detectPoint == DetectPoint.CLIENT).cpm();</code></td></tr><tr><td>\u5173\u8054\u670D\u52A1\u5B9E\u4F8B\u76F8\u5173</td><td>\u5173\u8054\u670D\u52A1\u5B9E\u4F8B\u5BA2\u6237\u7AEF\u670D\u52A1\u7AEF\u6BCF\u5206\u949F\u8BF7\u6C42\u6570</td><td><code>service_instance_relation_server_cpm</code></td><td><code>from(ServiceInstanceRelation.*).filter(detectPoint == DetectPoint.SERVER).cpm();</code></td></tr><tr><td>\u5173\u8054\u670D\u52A1\u5B9E\u4F8B\u76F8\u5173</td><td>\u5173\u8054\u670D\u52A1\u5B9E\u4F8B\u5BA2\u6237\u7AEF\u6210\u529F\u54CD\u5E94\u767E\u5206\u6570</td><td><code>service_instance_relation_client_call_sla</code></td><td><code>from(ServiceInstanceRelation.*).filter(detectPoint == DetectPoint.CLIENT).percent(status == true);</code></td></tr><tr><td>\u5173\u8054\u670D\u52A1\u5B9E\u4F8B\u76F8\u5173</td><td>\u5173\u8054\u670D\u52A1\u5B9E\u4F8B\u5BA2\u6237\u7AEF\u670D\u52A1\u7AEF\u6210\u529F\u54CD\u5E94\u767E\u5206\u6570</td><td><code>service_instance_relation_server_call_sla</code></td><td><code>from(ServiceInstanceRelation.*).filter(detectPoint == DetectPoint.SERVER).percent(status == true);</code></td></tr><tr><td>\u5173\u8054\u670D\u52A1\u5B9E\u4F8B\u76F8\u5173</td><td>\u5173\u8054\u670D\u52A1\u5B9E\u4F8B\u5BA2\u6237\u7AEF\u5E73\u5747\u54CD\u5E94\u65F6\u957F</td><td><code>service_instance_relation_client_resp_time</code></td><td><code>from(ServiceInstanceRelation.latency).filter(detectPoint == DetectPoint.CLIENT).longAvg();</code></td></tr><tr><td>\u5173\u8054\u670D\u52A1\u5B9E\u4F8B\u76F8\u5173</td><td>\u5173\u8054\u670D\u52A1\u5B9E\u4F8B\u5BA2\u6237\u7AEF\u670D\u52A1\u7AEF\u5E73\u5747\u54CD\u5E94\u65F6\u957F</td><td><code>service_instance_relation_server_resp_time</code></td><td><code>from(ServiceInstanceRelation.latency).filter(detectPoint == DetectPoint.SERVER).longAvg(); </code></td></tr><tr><td>\u5173\u8054\u670D\u52A1\u5B9E\u4F8B\u76F8\u5173</td><td>\u5173\u8054\u670D\u52A1\u5B9E\u4F8B\u5BA2\u6237\u7AEF\u54CD\u5E94\u300C\u767E\u5206\u4F4D\u6570\u300D</td><td><code>service_instance_relation_client_percentile</code></td><td><code>from(ServiceInstanceRelation.latency).filter(detectPoint == DetectPoint.CLIENT).percentile(10);</code> <br> // Multiple values including p50, p75, p90, p95, p99</td></tr><tr><td>\u5173\u8054\u670D\u52A1\u5B9E\u4F8B\u76F8\u5173</td><td>\u5173\u8054\u670D\u52A1\u5B9E\u4F8B\u5BA2\u6237\u7AEF\u670D\u52A1\u7AEF\u54CD\u5E94\u300C\u767E\u5206\u4F4D\u6570\u300D</td><td><code>service_instance_relation_server_percentile</code></td><td><code>from(ServiceInstanceRelation.latency).filter(detectPoint == DetectPoint.SERVER).percentile(10);</code> <br> // Multiple values including p50, p75, p90, p95, p99</td></tr><tr><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B\u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B\u6210\u529F\u54CD\u5E94\u767E\u5206\u6570</td><td><code>service_instance_sla</code></td><td><code> from(ServiceInstance.*).percent(status == true);</code></td></tr><tr><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B\u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B\u5E73\u5747\u54CD\u5E94\u65F6\u957F</td><td><code>service_instance_resp_time</code></td><td><code>from(ServiceInstance.latency).longAvg();</code></td></tr><tr><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B\u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B\u6BCF\u5206\u949F\u8BF7\u6C42\u6570</td><td><code>service_instance_cpm</code></td><td><code> from(ServiceInstance.*).cpm();</code></td></tr><tr><td>\u7AEF\u70B9\u76F8\u5173</td><td>\u7AEF\u70B9\u6BCF\u5206\u949F\u8BF7\u6C42\u6570</td><td><code>endpoint_cpm</code></td><td><code>from(Endpoint.*).cpm();</code></td></tr><tr><td>\u7AEF\u70B9\u76F8\u5173</td><td>\u7AEF\u70B9\u5E73\u5747\u54CD\u5E94\u65F6\u957F</td><td><code>endpoint_resp_time</code></td><td><code>from(Endpoint.latency).longAvg();</code></td></tr><tr><td>\u7AEF\u70B9\u76F8\u5173</td><td>\u7AEF\u70B9\u6210\u529F\u54CD\u5E94\u767E\u5206\u6570</td><td><code>endpoint_sla</code></td><td><code>from(Endpoint.*).percent(status == true);</code></td></tr><tr><td>\u7AEF\u70B9\u76F8\u5173</td><td>\u7AEF\u70B9\u54CD\u5E94\u300C\u767E\u5206\u4F4D\u6570\u300D</td><td><code>endpoint_percentile</code></td><td><code>from(Endpoint.latency).percentile(10);</code> <br> // Multiple values including p50, p75, p90, p95, p99</td></tr><tr><td>\u7AEF\u70B9\u76F8\u5173</td><td>\u7AEF\u70B9 MQ \u6D88\u8D39\u6570\u91CF</td><td><code>endpoint_mq_consume_count</code></td><td><code>from(Endpoint.*).filter(type == RequestType.MQ).count();</code></td></tr><tr><td>\u7AEF\u70B9\u76F8\u5173</td><td>\u7AEF\u70B9 MQ \u6D88\u8D39\u7B49\u5F85\u65F6\u957F</td><td><code>endpoint_mq_consume_latency</code></td><td><code>from((str-&gt;long)Endpoint.tag[&quot;transmission.latency&quot;]).filter(type == RequestType.MQ).filter(tag[&quot;transmission.latency&quot;] != null).longAvg();</code></td></tr><tr><td>\u5173\u8054\u7AEF\u70B9\u76F8\u5173</td><td>\u5173\u8054\u7AEF\u70B9\u6BCF\u5206\u949F\u8BF7\u6C42\u6570</td><td><code>endpoint_relation_cpm</code></td><td><code>from(EndpointRelation.*).filter(detectPoint == DetectPoint.SERVER).cpm();</code></td></tr><tr><td>\u5173\u8054\u7AEF\u70B9\u76F8\u5173</td><td>\u5173\u8054\u7AEF\u70B9\u5E73\u5747\u54CD\u5E94\u65F6\u957F</td><td><code>endpoint_relation_resp_time</code></td><td><code>from(EndpointRelation.rpcLatency).filter(detectPoint == DetectPoint.SERVER).longAvg();</code></td></tr><tr><td>\u5173\u8054\u7AEF\u70B9\u76F8\u5173</td><td>\u5173\u8054\u7AEF\u70B9\u6210\u529F\u54CD\u5E94\u767E\u5206\u6570</td><td><code>endpoint_relation_sla</code></td><td><code>from(EndpointRelation.*).filter(detectPoint == DetectPoint.SERVER).percent(status == true);</code></td></tr><tr><td>\u5173\u8054\u7AEF\u70B9\u76F8\u5173</td><td>\u5173\u8054\u7AEF\u70B9\u54CD\u5E94\u300C\u767E\u5206\u4F4D\u6570\u300D</td><td><code>endpoint_relation_percentile</code></td><td><code>from(EndpointRelation.rpcLatency).filter(detectPoint == DetectPoint.SERVER).percentile(10);</code> <br> // Multiple values including p50, p75, p90, p95, p99</td></tr><tr><td>\u6570\u636E\u5E93\u76F8\u5173</td><td>\u6570\u636E\u5E93\u5E73\u5747\u54CD\u5E94\u65F6\u957F</td><td><code>database_access_resp_time</code></td><td><code>from(DatabaseAccess.latency).longAvg();</code></td></tr><tr><td>\u6570\u636E\u5E93\u76F8\u5173</td><td>\u6570\u636E\u5E93\u6210\u529F\u54CD\u5E94\u767E\u5206\u6570</td><td><code>database_access_sla</code></td><td><code>from(DatabaseAccess.*).percent(status == true);</code></td></tr><tr><td>\u6570\u636E\u5E93\u76F8\u5173</td><td>\u6570\u636E\u5E93\u6BCF\u5206\u949F\u8BF7\u6C42\u6570</td><td><code>database_access_cpm</code></td><td><code>from(DatabaseAccess.*).cpm();</code></td></tr><tr><td>\u6570\u636E\u5E93\u76F8\u5173</td><td>\u6570\u636E\u5E93\u54CD\u5E94\u300C\u767E\u5206\u4F4D\u6570\u300D</td><td><code>database_access_percentile</code></td><td><code>from(DatabaseAccess.latency).percentile(10);</code></td></tr><tr><td>\u7CFB\u7EDF\u4E8B\u4EF6\u76F8\u5173</td><td>\u4E8B\u4EF6\u603B\u91CF</td><td><code>event_total</code></td><td><code>from(Event.*).count();</code></td></tr><tr><td>\u7CFB\u7EDF\u4E8B\u4EF6\u76F8\u5173</td><td>\u6B63\u5E38\u4E8B\u4EF6\u6570\u91CF</td><td><code>event_normal_count</code></td><td><code>from(Event.*).filter(type == &quot;Normal&quot;).count();</code></td></tr><tr><td>\u7CFB\u7EDF\u4E8B\u4EF6\u76F8\u5173</td><td>Error \u4E8B\u4EF6\u6570\u91CF</td><td><code>event_error_count</code></td><td><code>from(Event.*).filter(type == &quot;Error&quot;).count();</code></td></tr><tr><td>\u7CFB\u7EDF\u4E8B\u4EF6\u76F8\u5173</td><td>Start \u4E8B\u4EF6\u6570\u91CF</td><td><code>event_start_count</code></td><td><code>from(Event.*).filter(name == &quot;Start&quot;).count();</code></td></tr><tr><td>\u7CFB\u7EDF\u4E8B\u4EF6\u76F8\u5173</td><td>Shutdown \u4E8B\u4EF6\u6570\u91CF</td><td><code>event_shutdown_count</code></td><td><code>from(Event.*).filter(name == &quot;Shutdown&quot;).count();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM CPU \u4F7F\u7528\u7387</td><td><code>instance_jvm_cpu</code></td><td><code>from(ServiceInstanceJVMCPU.usePercent).doubleAvg();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM \u5806\u5185\u5B58</td><td><code>instance_jvm_memory_heap</code></td><td><code>from(ServiceInstanceJVMMemory.used).filter(heapStatus == true).longAvg();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM \u975E\u5806\u5185\u5B58</td><td><code>instance_jvm_memory_noheap</code></td><td><code>from(ServiceInstanceJVMMemory.used).filter(heapStatus == false).longAvg();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM \u6700\u5927\u5806\u5185\u5B58</td><td><code>instance_jvm_memory_heap_max</code></td><td><code>from(ServiceInstanceJVMMemory.max).filter(heapStatus == true).longAvg();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM \u6700\u5927\u975E\u5806\u5185\u5B58</td><td><code>instance_jvm_memory_noheap_max</code></td><td><code>from(ServiceInstanceJVMMemory.max).filter(heapStatus == false).longAvg();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM \u65B0\u751F\u4EE3\u56DE\u6536\u65F6\u95F4</td><td><code>instance_jvm_young_gc_time</code></td><td><code>from(ServiceInstanceJVMGC.time).filter(phase == GCPhase.NEW).sum();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM \u8001\u5E74\u4EE3\u56DE\u6536\u65F6\u95F4</td><td><code>instance_jvm_old_gc_time</code></td><td><code>from(ServiceInstanceJVMGC.time).filter(phase == GCPhase.OLD).sum();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM</td><td><code>instance_jvm_normal_gc_time</code></td><td><code>from(ServiceInstanceJVMGC.time).filter(phase == GCPhase.NORMAL).sum();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM \u65B0\u751F\u4EE3\u56DE\u6536\u6B21\u6570</td><td><code>instance_jvm_young_gc_count</code></td><td><code>from(ServiceInstanceJVMGC.count).filter(phase == GCPhase.NEW).sum();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM \u8001\u5E74\u4EE3\u56DE\u6536\u6B21\u6570</td><td><code>instance_jvm_old_gc_count</code></td><td><code>from(ServiceInstanceJVMGC.count).filter(phase == GCPhase.OLD).sum();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM</td><td><code>instance_jvm_normal_gc_count</code></td><td><code>from(ServiceInstanceJVMGC.count).filter(phase == GCPhase.NORMAL).sum();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM \u7EBF\u7A0B\u5B58\u6D3B\u6570</td><td><code>instance_jvm_thread_live_count</code></td><td><code>from(ServiceInstanceJVMThread.liveCount).longAvg();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM \u5B88\u62A4\u7EBF\u7A0B\u5B58\u6D3B\u6570</td><td><code>instance_jvm_thread_daemon_count</code></td><td><code>from(ServiceInstanceJVMThread.daemonCount).longAvg();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM \u5CF0\u503C\u7EBF\u7A0B\u6570</td><td><code>instance_jvm_thread_peak_count</code></td><td><code>from(ServiceInstanceJVMThread.peakCount).longAvg();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM RUNNABLE \u72B6\u6001\u7684\u7EBF\u7A0B\u6570</td><td><code>instance_jvm_thread_runnable_state_thread_count</code></td><td><code>from(ServiceInstanceJVMThread.runnableStateThreadCount).longAvg();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM BLOCKED \u72B6\u6001\u7684\u7EBF\u7A0B\u6570</td><td><code>instance_jvm_thread_blocked_state_thread_count</code></td><td><code>from(ServiceInstanceJVMThread.blockedStateThreadCount).longAvg();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM WAITING \u72B6\u6001\u7684\u7EBF\u7A0B\u6570</td><td><code>instance_jvm_thread_waiting_state_thread_count</code></td><td><code>from(ServiceInstanceJVMThread.waitingStateThreadCount).longAvg();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM TIMED_WAITING \u72B6\u6001\u7684\u7EBF\u7A0B\u6570</td><td><code>instance_jvm_thread_timed_waiting_state_thread_count</code></td><td><code>from(ServiceInstanceJVMThread.timedWaitingStateThreadCount).longAvg();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM \u7C7B\u52A0\u8F7D\u5668\u6570</td><td><code>instance_jvm_class_loaded_class_count</code></td><td><code>from(ServiceInstanceJVMClass.loadedClassCount).longAvg();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM</td><td><code>instance_jvm_class_total_unloaded_class_count</code></td><td><code>from(ServiceInstanceJVMClass.totalUnloadedClassCount).longAvg();</code></td></tr><tr><td>\u5FAE\u670D\u52A1 JVM \u76F8\u5173</td><td>\u5FAE\u670D\u52A1\u5B9E\u4F8B JVM</td><td><code>instance_jvm_class_total_loaded_class_count</code></td><td><code>from(ServiceInstanceJVMClass.totalLoadedClassCount).longAvg();</code></td></tr></tbody></table><p>\u5982\u679C\u9ED8\u8BA4\u63D0\u4F9B\u7684\u6307\u6807\u4E0D\u6EE1\u8DB3\uFF0C\u8FD8\u53EF\u4EE5\u6DFB\u52A0\u81EA\u5B9A\u4E49\u952E\u63A7\u6307\u6807\u3002\u9700\u8981\u4F7F\u7528 OAL \u8BED\u6CD5\u3002</p>",4),fn=s("OAL \u5165\u95E8\u53C2\u8003\uFF1A"),qn={href:"https://skywalking.apache.org/docs/main/v9.0.0/en/concepts-and-designs/oal/",target:"_blank",rel:"noopener noreferrer"},Sn=s("https://skywalking.apache.org/docs/main/v9.0.0/en/concepts-and-designs/oal/"),xn=n("h3",{id:"\u590D\u5408\u89C4\u5219",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u590D\u5408\u89C4\u5219","aria-hidden":"true"},"#"),s(" \u590D\u5408\u89C4\u5219")],-1),Mn=n("p",null,[s("\u590D\u5408\u89C4\u5219\u4EC5\u9002\u7528\u4E8E\u9488\u5BF9\u76F8\u540C\u5B9E\u4F53\u7EA7\u522B\u7684\u544A\u8B66\u89C4\u5219\uFF0C\u4F8B\u5982\u90FD\u662F\u670D\u52A1\u7EA7\u522B\u7684\u544A\u8B66\u89C4\u5219\uFF1A"),n("code",null,"service_percent_rule && service_resp_time_percentile_rule"),s("\u3002")],-1),jn=n("p",null,[s("\u4E0D\u53EF\u4EE5\u7F16\u5199\u4E0D\u540C\u5B9E\u4F53\u7EA7\u522B\u7684\u544A\u8B66\u89C4\u5219\uFF0C\u4F8B\u5982\u670D\u52A1\u7EA7\u522B\u7684\u4E00\u4E2A\u544A\u8B66\u89C4\u5219\u548C\u7AEF\u70B9\u7EA7\u522B\u7684\u4E00\u4E2A\u89C4\u5219\uFF1A"),n("code",null,"service_percent_rule && endpoint_percent_rule"),s("\u3002")],-1),An=n("p",null,"\u590D\u5408\u89C4\u5219\u4E3B\u8981\u7531\u4EE5\u4E0B\u51E0\u90E8\u5206\u6784\u6210\uFF1A",-1),In=s("\u89C4\u5219\u540D\u79F0 "),En=s(" \uFF1A\u5728\u544A\u8B66\u4FE1\u606F\u4E2D\u663E\u793A\u7684\u552F\u4E00\u540D\u79F0\uFF0C\u5FC5\u987B\u4EE5 "),Pn=n("code",null,"_rule",-1),Vn=s(" \u7ED3\u5C3E\u3002"),Tn=n("code",null,"expression",-1),Cn=s(),Ln=s(" \uFF1A\u89C4\u5219\u7EC4\u6210\u8868\u8FBE\u5F0F\uFF0C\u652F\u6301 "),Rn=n("code",null,"&&",-1),Jn=s(", "),wn=n("code",null,"||",-1),Dn=s(" \u548C "),Nn=n("code",null,"()",-1),On=s(" \u64CD\u4F5C\u7B26\u3002"),Gn=n("code",null,"message",-1),Wn=s(),Bn=s(" \uFF1A\u89C4\u5219\u89E6\u53D1\u65F6\uFF0C\u53D1\u9001\u7684\u901A\u77E5\u6D88\u606F\u3002"),Hn=n("code",null,"tags",-1),Fn=s(),Un=s(" : Key/Value \u5BF9\u7684\u5F62\u5F0F\uFF0C\u6807\u7B7E\u529F\u80FD\u3002\u9ED8\u8BA4\u652F\u6301 "),Kn=n("code",null,"level",-1),zn=s("\u3002"),Qn=t(`<div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token key atrule">service_percent_rule</span><span class="token punctuation">:</span>
    <span class="token key atrule">metrics-name</span><span class="token punctuation">:</span> service_percent
    <span class="token key atrule">include-names</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> service_a
      <span class="token punctuation">-</span> service_b
    <span class="token key atrule">exclude-names</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> service_c
    <span class="token key atrule">threshold</span><span class="token punctuation">:</span> <span class="token number">85</span>
    <span class="token key atrule">op</span><span class="token punctuation">:</span> &lt;
    <span class="token key atrule">period</span><span class="token punctuation">:</span> <span class="token number">10</span>
    <span class="token key atrule">count</span><span class="token punctuation">:</span> <span class="token number">4</span>
    <span class="token key atrule">only-as-condition</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">service_resp_time_percentile_rule</span><span class="token punctuation">:</span>
    <span class="token key atrule">metrics-name</span><span class="token punctuation">:</span> service_percentile
    <span class="token key atrule">op</span><span class="token punctuation">:</span> <span class="token string">&quot;&gt;&quot;</span>
    <span class="token key atrule">threshold</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">1000</span>
    <span class="token key atrule">period</span><span class="token punctuation">:</span> <span class="token number">10</span>
    <span class="token key atrule">count</span><span class="token punctuation">:</span> <span class="token number">3</span>
    <span class="token key atrule">silence-period</span><span class="token punctuation">:</span> <span class="token number">5</span>
    <span class="token key atrule">message</span><span class="token punctuation">:</span> Percentile response time of service <span class="token punctuation">{</span>name<span class="token punctuation">}</span> alarm in 3 minutes of last 10 minutes<span class="token punctuation">,</span> due to more than one condition of p50 <span class="token punctuation">&gt;</span> 1000<span class="token punctuation">,</span> p75 <span class="token punctuation">&gt;</span> 1000<span class="token punctuation">,</span> p90 <span class="token punctuation">&gt;</span> 1000<span class="token punctuation">,</span> p95 <span class="token punctuation">&gt;</span> 1000<span class="token punctuation">,</span> p99 <span class="token punctuation">&gt;</span> 1000
    <span class="token key atrule">only-as-condition</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token key atrule">composite-rules</span><span class="token punctuation">:</span>
  <span class="token key atrule">comp_rule</span><span class="token punctuation">:</span>
    <span class="token comment"># Must satisfied percent rule and resp time rule </span>
    <span class="token key atrule">expression</span><span class="token punctuation">:</span> service_percent_rule <span class="token important">&amp;&amp;</span> service_resp_time_percentile_rule
    <span class="token key atrule">message</span><span class="token punctuation">:</span> Service <span class="token punctuation">{</span>name<span class="token punctuation">}</span> successful rate is less than 80% and P50 of response time is over 1000ms
    <span class="token key atrule">tags</span><span class="token punctuation">:</span>
      <span class="token key atrule">level</span><span class="token punctuation">:</span> CRITICAL
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div></div><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="\u9884\u8B66\u6D88\u606F\u53D1\u9001" tabindex="-1"><a class="header-anchor" href="#\u9884\u8B66\u6D88\u606F\u53D1\u9001" aria-hidden="true">#</a> \u9884\u8B66\u6D88\u606F\u53D1\u9001</h3><p>\u9884\u8B66\u6D88\u606F\u53D1\u9001\u652F\u6301 WebHook \u7684\u65B9\u5F0F\uFF0C\u540C\u65F6\u8FD8\u652F\u6301 gRPCHook\u3001Slack Chat Hook\u3001WeChat Hook\u3001DingTalk Hook\u3001Feishu Hook\u3001WeLink Hook \u7B49\u3002</p><h4 id="webhook" tabindex="-1"><a class="header-anchor" href="#webhook" aria-hidden="true">#</a> WebHook</h4><p>WebHook \u7684\u65B9\u5F0F\uFF0C\u4F1A\u53D1\u9001 POST \u8BF7\u6C42\u5230\u914D\u7F6E\u7684 URL\u3002\u8BF7\u6C42\u7684 ContentType \u4E3A <code>application/json</code>\uFF0C\u6570\u636E\u7ED3\u6784\u662F <code>List&lt;org.apache.skywalking.oap.server.core.alarm.AlarmMessage&gt;</code></p><p>\u6570\u636E\u7ED3\u6784\u5177\u4F53\u5982\u4E0B\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token property">&quot;scopeId&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scope&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SERVICE&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;serviceA&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;id0&quot;</span><span class="token operator">:</span> <span class="token string">&quot;12&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;id1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;ruleName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;service_resp_time_rule&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;alarmMessage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;alarmMessage xxxx&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;startTime&quot;</span><span class="token operator">:</span> <span class="token number">1560524171000</span><span class="token punctuation">,</span>
  <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;level&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;WARNING&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;scopeId&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scope&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SERVICE&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;serviceB&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;id0&quot;</span><span class="token operator">:</span> <span class="token string">&quot;23&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;id1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;ruleName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;service_resp_time_rule&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;alarmMessage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;alarmMessage yyy&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;startTime&quot;</span><span class="token operator">:</span> <span class="token number">1560524171000</span><span class="token punctuation">,</span>
  <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;level&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CRITICAL&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h4 id="dingtalk-hook" tabindex="-1"><a class="header-anchor" href="#dingtalk-hook" aria-hidden="true">#</a> DingTalk Hook</h4><p>\u9664\u4E86\u53EF\u4EE5\u7528 WebHook \u5BF9\u63A5\u9884\u8B66\u7CFB\u7EDF\u53D1\u9001\u7CFB\u7EDF\u9884\u8B66\u6D88\u606F\u5916\uFF0C\u4E5F\u53EF\u4EE5\u76F4\u63A5\u901A\u8FC7\u6DFB\u52A0\u9489\u9489\u673A\u5668\u4EBA\u7684\u65B9\u5F0F\u3002</p><p>\u53EA\u9700\u8981\u5728 <code>\${SW_HOME}/config/alarm-settings.yml</code> \u672B\u5C3E\u6DFB\u52A0\u5982\u4E0B\u914D\u7F6E\u5373\u53EF\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">dingtalkHooks</span><span class="token punctuation">:</span>
  <span class="token key atrule">textTemplate</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
    <span class="token punctuation">{</span>
      <span class="token key atrule">&quot;msgtype&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
      <span class="token key atrule">&quot;text&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token key atrule">&quot;content&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Apache SkyWalking Alarm: \\n %s.&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token key atrule">webhooks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//oapi.dingtalk.com/robot/send<span class="token punctuation">?</span>access_token=05b4a0bed9fe137e7fd744556d82fe73826f3fd7754df073c4b600e2a786bfc3
      <span class="token key atrule">secret</span><span class="token punctuation">:</span> SEC7bdd0717d3000fe1dbef7fdbb538a9c1f78ed0b3f7c17ae8695c8ca31d6086c9
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="\u53EF\u80FD\u9047\u5230\u7684\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#\u53EF\u80FD\u9047\u5230\u7684\u95EE\u9898" aria-hidden="true">#</a> \u53EF\u80FD\u9047\u5230\u7684\u95EE\u9898</h2><h3 id="ui" tabindex="-1"><a class="header-anchor" href="#ui" aria-hidden="true">#</a> UI</h3><p>v 9.0.0 UI \u5B58\u5728\u7684 BUG</p><ol><li><code>Trace</code> -&gt; <code>View Logs</code> \u6309\u94AE\u67E5\u8BE2\u4E0D\u5230\u65E5\u5FD7\u3002(\u89E3\u51B3\uFF1A\u70B9\u51FB\u5177\u4F53\u7684\u94FE\u8DEF\u7136\u540E <code>Related Logs</code> \u67E5\u770B\u5173\u8054\u7684\u65E5\u5FD7)</li><li><code>Trace</code> \u7684 <code>Trace Id</code> \u65C1\u8FB9\u7684\u590D\u5236\u6309\u94AE\uFF0C\u70B9\u51FB\u540E\u4F1A\u6709 JS \u62A5\u9519\u5BFC\u81F4\u590D\u5236\u4E0D\u6210\u529F\u3002(\u70B9\u5F00\u624B\u52A8\u590D\u5236)</li></ol><blockquote><p>\u9700\u8981\u6CE8\u610F\uFF1A<code>Notice: Please press Enter after inputting a tag, key of content, exclude key of content(key=value).</code></p></blockquote><p>Log \u641C\u7D22\u754C\u9762\u7684\u8FD9\u51E0\u4E2A\u641C\u7D22\u6761\u4EF6\uFF0C\u8F93\u5165\u540E\uFF0C\u9700\u8981\u6309\u300C\u56DE\u8F66\u952E\u300D\uFF0C\u518D\u70B9\u51FB &quot;Search&quot; \u6309\u94AE\u67E5\u8BE2\u3002</p><p>\u5982\u679C\u4E0D\u6EE1\u610F\uFF0C\u53EF\u4EE5\u4F7F\u7528 Kibana \u67E5\u770B\u65E5\u5FD7\u3002</p><h3 id="oap-server" tabindex="-1"><a class="header-anchor" href="#oap-server" aria-hidden="true">#</a> OAP Server</h3><p>\u5E38\u89C1\u62A5\u9519\uFF1A</p><ol><li>Grpc server thread pool is full, rejecting the task</li></ol><p>\u8FD9\u4E2A\u9519\u8BEF\u662F\u56E0\u4E3A\u4F60\u7684oap\u670D\u52A1\u7684\u541E\u5410\u91CF\u592A\u5F31\uFF0C\u592A\u5F31\u8FD9\u91CC\u53EF\u4EE5\u7406\u89E3\u4E3A\uFF1A\u4F60\u7684\u5B58\u50A8\u6027\u80FD\u8DDF\u4E0D\u4E0A\uFF0C\u6216\u8005\u4F60\u7684oap server\u7684\u914D\u7F6E\u592A\u4F4E\u90FD\u6709\u53EF\u80FD\uFF0C \u4F46agent\u4E0A\u62A5\u53C8\u5FEB\uFF0C\u6700\u6709\u6548\u7684\u65B9\u6CD5\u662F\u589E\u52A0oap\u670D\u52A1\u6570\u91CF\uFF0C\u63D0\u9AD8\u5E95\u5C42\u5B58\u50A8\u914D\u7F6E\u3002\u5982\u679C\u6CA1\u6709\u6761\u4EF6\u770B\u4E0B\u9762\uFF1A</p><p>\u9ED8\u8BA4grpc server\u7684\u7EBF\u7A0B\u6C60\u5927\u5C0F\u662F4*cpu\u6570\uFF0C\u6392\u961F\u961F\u5217\u957F\u5EA6\u662F10000\uFF0C\u53EF\u4EE5\u8C03\u6574\u8FD9\u4E24\u4E2A\u53C2\u6570\u5927\u5C0F\uFF1A\u5B9A\u4F4D\u5230application.yml\u6587\u4EF6\u3002\u5728core\u7684default\u4E0B\u589E\u52A0</p><p>gRPCThreadPoolSize: \u9ED8\u8BA4\u662F4\u500D\u7684cpu\uFF0C\u8FD9\u91CC\u53EF\u4EE5\u8C03\u9AD8,\u4F8B\u59828\u6838\u9ED8\u8BA4\u662F4*8=32\uFF0C\u53EF\u4EE5\u8C03\u621040\u6216\u66F4\u591A</p><p>gRPCThreadPoolQueueSize\uFF1A\u9ED8\u8BA4\u662F10000\uFF0C\u53EF\u4EE5\u8C03\u9AD8</p><ol start="2"><li>Can&#39;t split service id into 2 parts, org.apache.skywalking.oap.server.core.UnexpectedException: Can&#39;t split service id into 2 parts,</li></ol><p>\u8FD9\u79CD\u60C5\u51B5\u4E00\u822C\u90FD\u662F\u5728 SkyWalking \u8001\u7248\u672C\u5347\u7EA7\u5230 8.x \u7248\u672C\uFF0C\u56E0\u4E3A\u5B58\u50A8\u6CA1\u6709\u6E05\u7406\u5E72\u51C0\u5BFC\u81F4\u7684\u95EE\u9898\uFF0C\u8BF7\u5220\u9664\u65E7\u7248\u672C\u7D22\u5F15\uFF0C\u518D\u8BD5\u8BD5\u3002</p><p>v9.0.0 \u5DF2\u77E5 BUG\uFF0C\u9884\u8BA1 v9.1.0 \u4FEE\u590D</p><h3 id="\u65E5\u5FD7\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#\u65E5\u5FD7\u5206\u6790" aria-hidden="true">#</a> \u65E5\u5FD7\u5206\u6790</h3><p>application.yaml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">log-analyzer</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_LOG_ANALYZER<span class="token punctuation">:</span>default<span class="token punctuation">}</span>
  <span class="token key atrule">default</span><span class="token punctuation">:</span>
    <span class="token key atrule">lalFiles</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_LOG_LAL_FILES<span class="token punctuation">:</span>my<span class="token punctuation">-</span>lal<span class="token punctuation">-</span>config<span class="token punctuation">}</span>
    <span class="token key atrule">malFiles</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_LOG_MAL_FILES<span class="token punctuation">:</span><span class="token string">&quot;my-lal-mal-config&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>lal/my-lal-config.yml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> example
    <span class="token key atrule">dsl</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      filter {
        if (log.service == &quot;TestService&quot;) {
          abort {}
        }
        text {
          if (!regexp($/(?s)(?&lt;timestamp&gt;\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}.\\d{3}) \\[TID:(?&lt;tid&gt;.+?)] \\[(?&lt;thread&gt;.+?)] (?&lt;level&gt;\\w{4,}) (?&lt;logger&gt;.{1,36}) - (?&lt;msg&gt;.+)/$)) {
            abort {}
          }
        }
        extractor {
          metrics {
            timestamp log.timestamp as Long
            labels level: parsed.level, service: log.service, instance: log.serviceInstance
            name &quot;log_count&quot;
            layer &#39;GENERAL&#39;
            value 1
          }
        }
        sink {
          sampler {
            if (log.service == &quot;ImportantApp&quot;) {
              rateLimit(&quot;ImportantAppSampler&quot;) {
                rpm 18000
              }
            } else {
              rateLimit(&quot;OtherSampler&quot;) {
                rpm 1800
              }
            }
          }
        }
      }</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>log-mal-rules/my-lal-mal-config.yaml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">expSuffix</span><span class="token punctuation">:</span> instance(<span class="token punctuation">[</span><span class="token string">&#39;service&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;instance&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Layer.GENERAL)
<span class="token key atrule">metricPrefix</span><span class="token punctuation">:</span> log
<span class="token key atrule">metricsRules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> count_info
    <span class="token key atrule">exp</span><span class="token punctuation">:</span> log_count.tagEqual(&#39;level&#39;<span class="token punctuation">,</span> &#39;INFO&#39;).sum(<span class="token punctuation">[</span><span class="token string">&#39;service&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;instance&#39;</span><span class="token punctuation">]</span>)
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> count_error
    <span class="token key atrule">exp</span><span class="token punctuation">:</span> log_count.tagEqual(&#39;level&#39;<span class="token punctuation">,</span> &#39;ERROR&#39;).sum(<span class="token punctuation">[</span><span class="token string">&#39;service&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;instance&#39;</span><span class="token punctuation">]</span>)
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u91CD\u542F</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /opt/zmn/servers/

./apm/bin/oapService.sh
./apm2/bin/oapService.sh


<span class="token function">tail</span> -fn <span class="token number">200</span> apm/logs/skywalking-oap-server.log
<span class="token function">tail</span> -fn <span class="token number">200</span> apm2/logs/skywalking-oap-server.log
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u6DFB\u52A0 Dashboard \u7136\u540E\u6DFB\u52A0 log_count_info log_count_error \u6CA1\u6709\u6570\u636E\u3002</p><p>ES \u4E5F\u6CA1\u6709\u65B0\u7684\u7D22\u5F15\u6DFB\u52A0\u3002</p><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>GET _cat/indices?s=index:asc&amp;v=true
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u7ED3\u679C\u4ECD\u7136\u53EA\u6709 84 \u884C\uFF0C\u548C\u6DFB\u52A0\u524D lal \u4E4B\u524D\u4E00\u6837\u3002</p><p>sw_log-20220720 \u7D22\u5F15\u6301\u7EED\u6709\u6587\u6863\u6570\u7684\u589E\u52A0\u3002(\u4E5F\u5C31\u662F\u4E00\u76F4\u662F\u6709\u65B0\u7684\u65E5\u5FD7\u4EA7\u751F\u7684)</p><h4 id="\u65B0\u7684\u5C1D\u8BD5" tabindex="-1"><a class="header-anchor" href="#\u65B0\u7684\u5C1D\u8BD5" aria-hidden="true">#</a> \u65B0\u7684\u5C1D\u8BD5</h4><p>Extractor</p><p>\u5C06\u5173\u952E\u5B57 log (\u5B89\u88C5\u5305\u4E2D\u7684 example \u6587\u4EF6\u8FD9\u6837\u5199\u7684) \u6539\u4E3A\u6587\u6863\u4E0A\u5199\u7684 parsed</p><blockquote><p>\u5B98\u65B9\u6587\u6863\u548C\u6837\u4F8B\u914D\u7F6E\u6587\u4EF6\uFF0C\u6CA1\u6709\u4E00\u4E2A\u662F\u5B8C\u5168\u6B63\u786E\u7684\u3002\u5F00\u6E90\u8F6F\u4EF6\u7684\u8D28\u91CF\u53EF\u89C1\u4E00\u6591\u3002</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>extractor {
  metrics {
    timestamp parsed.timestamp as Long
    labels level: parsed.level, service: parsed.service, instance: parsed.serviceInstance
    name &quot;log_count&quot;
    layer &#39;GENERAL&#39;
    value 1
  }
}
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u670D\u52A1\u80FD\u591F\u6B63\u5E38\u542F\u52A8\u3002</p><p>\u89C2\u5BDF\u6307\u6807\u6CA1\u6709\u6570\u636E\uFF0C\u540C\u65F6\u65E5\u5FD7\u7D22\u5F15\u6587\u6863\u6570(21562)\u6CA1\u6709\u53D8\u5316\u3002</p><h4 id="\u67E5\u770B\u65E5\u5FD7\u683C\u5F0F\u662F\u5426\u5339\u914D" tabindex="-1"><a class="header-anchor" href="#\u67E5\u770B\u65E5\u5FD7\u683C\u5F0F\u662F\u5426\u5339\u914D" aria-hidden="true">#</a> \u67E5\u770B\u65E5\u5FD7\u683C\u5F0F\u662F\u5426\u5339\u914D</h4><p>\u65E5\u5FD7\u6837\u4F8B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>2022-07-20 00:06:48.544 [TID:51d7b6f78ba64a97998c413c32ad15a4.118.16582468083835363] [http-nio-19513-exec-5] INFO  ShardingSphere-SQL -SQLStatement: SelectStatement(super=DQLStatement(super=io.shardingsphere.core.parsing.parser.sql.dql.select.SelectStatement@1141c704), containStar=false, firstSelectItemStartPosition=18, selectListLastPosition=20, groupByLastPosition=0, items=[CommonSelectItem(expression=1, alias=Optional.absent())], groupByItems=[], orderByItems=[], limit=null, subQueryStatement=null, subQueryStatements=[], subQueryConditions=[])
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>\u65E5\u5FD7\u683C\u5F0F\u4E0D\u6B63\u786E\uFF0C\u53D1\u73B0\u662F framework-apm-boot-starter \u6A21\u5757\u683C\u5F0F\u6709\u8BEF\u3002</p></blockquote><p>TODO \u4FEE\u6B63\u65E5\u5FD7\u683C\u5F0F\u3002</p><p>\u6B63\u5219</p><div class="language-regexp ext-regexp line-numbers-mode"><pre class="language-regexp"><code>$/(?s)(?&lt;timestamp&gt;\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}.\\d{3}) \\[TID:(?&lt;tid&gt;.+?)] \\[(?&lt;thread&gt;.+?)] (?&lt;level&gt;\\w{4,}) (?&lt;logger&gt;.{1,36}) - (?&lt;msg&gt;.+)/$
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u53D1\u73B0 - \u7B26\u5408\u540E\u9762\u591A\u4E86\u4E00\u4E2A\u7A7A\u683C\uFF0C\u4FEE\u6539\u4E3A\u5982\u4E0B\uFF1A</p><div class="language-regexp ext-regexp line-numbers-mode"><pre class="language-regexp"><code>$/(?s)(?&lt;timestamp&gt;\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}.\\d{3}) \\[TID:(?&lt;tid&gt;.+?)] \\[(?&lt;thread&gt;.+?)] (?&lt;level&gt;\\w{4,}) (?&lt;logger&gt;.{1,36}) -(?&lt;msg&gt;.+)/$
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u670D\u52A1\u6B63\u5E38\u91CD\u542F\u3002ES\u4E0A\u67E5\u770B\u65E5\u5FD7\u7D22\u5F15\uFF0C\u6CA1\u6709\u6587\u6863\u6570\u589E\u52A0\u3002ES\u6CA1\u6709\u7D22\u5F15\u6570\u6DFB\u52A0\u3002(\u4E1A\u52A1\u5E94\u7528\u6CA1\u6709\u65E5\u5FD7\u4EA7\u751F\uFF0C\u4E1A\u52A1\u5E94\u7528\u6B63\u5E38\u4EA7\u751F\u65E5\u4E4B\u540E\u518D\u505A\u6D4B\u8BD5)</p><h4 id="\u65E5\u5FD7\u9519\u8BEF" tabindex="-1"><a class="header-anchor" href="#\u65E5\u5FD7\u9519\u8BEF" aria-hidden="true">#</a> \u65E5\u5FD7\u9519\u8BEF</h4><p>21 18:21 \u5220\u9664 application.yml \u4E2D\u7684 mal \u914D\u7F6E\u91CD\u542F\u3002</p><p>\u65E5\u5FD7\u6062\u590D\u3002</p><p>\u53EF\u4EE5\u65AD\u5B9A\uFF1A\u6B63\u5219\u548C\u5B9E\u9645\u7684\u65E5\u5FD7\u4E0D\u5339\u914D\uFF0C\u56E0\u6B64\u88AB\u4E22\u5F03\u3002</p><p>22 09:35 \u5220\u9664 <code>abort {}</code> \u8BED\u6CD5</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>text {
  abortOnFailure true
  regexp &quot;(?&lt;timestamp&gt;\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}.\\d{3}) \\[TID:(?&lt;tid&gt;.+?)] \\[(?&lt;thread&gt;.+?)] (?&lt;level&gt;\\w{4,}) (?&lt;logger&gt;.{1,36}) -(?&lt;msg&gt;.+)&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u91CD\u65B0\u542F\u52A8, \u62A5\u544A\u8BED\u6CD5\u9519\u8BEF\u3002</p><p>\u5C1D\u8BD5\u5C06\u6B63\u5219\u5185\u5BB9\u5168\u90E8\u8F6C\u4E49</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>regexp &quot;(?&lt;timestamp&gt;\\\\d\\{4\\}-\\\\d\\{2\\}-\\\\d\\{2\\} \\\\d\\{2\\}:\\d{2\\}:\\\\d\\{2\\}.\\\\d\\{3\\}) \\[TID:(?&lt;tid&gt;.+?)\\] \\[(?&lt;thread&gt;.+?)\\] (?&lt;level&gt;\\\\w\\{4,\\}) (?&lt;logger&gt;.\\{1,36\\}) -(?&lt;msg&gt;.+)&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u4ECD\u7136\u62A5\u544A\u8BED\u6CD5\u9519\u8BEF\u3002</p><p>\u5C1D\u8BD5\u5220\u9664\u6B63\u5219\uFF0C\u80FD\u591F\u6B63\u5E38\u542F\u52A8\uFF0C\u4F46\u662F\u62A5\u5982\u4E0B\u9519\u8BEF\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>org.codehaus.groovy.runtime.typehandling.GroovyCastException: Cannot cast object &#39;OtherSampler&#39; with class &#39;java.lang.String&#39; to class &#39;groovy.lang.GString&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u4ECE\u6587\u6863\u4E0A\u770B\uFF0C\u4E5F\u662F\u9700\u8981\u901A\u8FC7\u6307\u5B9A\u6B63\u5219\u5339\u914D\u65E5\u5FD7\u3002</p>`,72),$n={href:"https://skywalking.apache.org/docs/main/v9.1.0/en/concepts-and-designs/lal/#text",target:"_blank",rel:"noopener noreferrer"},Zn=s("https://skywalking.apache.org/docs/main/v9.1.0/en/concepts-and-designs/lal/#text"),Yn=t(`<blockquote><p>\u800C\u4E14\u4ECE\u4F7F\u7528\u4E0A\u770B\uFF0C\u80FD\u591F\u4F5C\u4E3A\u6307\u6807\u7EDF\u8BA1\u7684\uFF0C\u53EA\u80FD\u662F\u56FA\u5B9A\u7684\u51E0\u4E2A Tag\uFF0C\u5F88\u96BE\u5BF9\u65E5\u5FD7\u6D88\u606F\u505A\u5168\u6587\u89E3\u6790\u7136\u540E\u5206\u6790\u51FA\u60F3\u8981\u7684\u5F02\u5E38\u7C7B\u578B\u3002</p></blockquote><p>22 11:10 \u5220\u9664 lal \u76F8\u5173\u914D\u7F6E\u91CD\u542F\u5E94\u7528\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">log-analyzer</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_LOG_ANALYZER<span class="token punctuation">:</span>default<span class="token punctuation">}</span>
  <span class="token key atrule">default</span><span class="token punctuation">:</span>
    <span class="token key atrule">lalFiles</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_LOG_LAL_FILES<span class="token punctuation">:</span>default<span class="token punctuation">}</span>
    <span class="token key atrule">malFiles</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_LOG_MAL_FILES<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u518D\u6B21\u5C1D\u8BD5\u8F6C\u4E49, \u53C2\u7167\u5B98\u7F51\u6587\u6863\uFF0C\u5728\u8F6C\u4E49\u5B57\u6BCD\u524D\u52A0\u4E24\u4E2A \\</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>(?&lt;timestamp&gt;\\\\d{4}-\\\\d{2}-\\\\d{2} \\\\d{2}:\\\\d{2}:\\\\d{2}.\\\\d{3}) \\\\\\[TID:(?&lt;tid&gt;.+?)] \\\\\\[(?&lt;thread&gt;.+?)] (?&lt;level&gt;\\\\w{4,}) (?&lt;logger&gt;.{1,36}) -(?&lt;msg&gt;.+)
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u542F\u52A8\u4ECD\u7136\u62A5\u9519\u3002\u5168\u90E8\u8F6C\u4E49\uFF0C\u7136\u540E\u5C0F\u62EC\u53F7\u548C\u5173\u952E\u5B57\u6309\u7167\u5B98\u7F51\u7684\u5B9E\u4F8B\u65B9\u5F0F\u4E66\u5199\uFF0C\u518D\u6B21\u5C1D\u8BD5\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>(?&lt;timestamp&gt;\\\\d\\{4\\}\\-\\\\d\\{2\\}\\-\\\\d\\{2\\} \\\\d\\{2\\}:\\\\d\\{2\\}:\\\\d\\{2\\}\\.\\\\d\\{3\\}) \\\\\\[TID:(?&lt;tid&gt;.+?)\\] \\\\\\[(?&lt;thread&gt;.+?)\\] (?&lt;level&gt;\\\\w\\{4,\\}) (?&lt;logger&gt;.\\{1,36\\}\\) \\-\\(?&lt;msg&gt;.+)
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u4ECD\u7136\u62A5\u9519\u3002\u5B8C\u5168\u8F6C\u4E49\uFF0C\u5C1D\u8BD5\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\\(\\?&lt;timestamp&gt;\\\\d\\{4\\}\\-\\\\d\\{2\\}\\-\\\\d\\{2\\} \\\\d\\{2\\}:\\\\d\\{2\\}:\\\\d\\{2\\}\\.\\\\d\\{3\\}\\) \\\\\\[TID:\\(\\?&lt;tid&gt;\\.\\+\\?\\)\\] \\\\\\[\\(\\?&lt;thread&gt;\\.\\+\\?\\)\\] \\(\\?&lt;level&gt;\\\\w\\{4,\\}\\) \\(\\?&lt;logger&gt;\\.\\{1,36\\}\\) \\-\\(\\?&lt;msg&gt;\\.\\+\\)
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u5B57\u7B26\u4E32\u6539 &#39;&#39; \u5355\u5F15\u53F7\u4E3A &quot;&quot; \u53CC\u5F15\u53F7\uFF0C\u4ECD\u7136\u62A5\u9519\u3002</p><p>\u67E5\u770B\u6E90\u4EE3\u7801\u53D1\u73B0\uFF1A\u6B64\u5904\u4F7F\u7528\u7684\u662F Groovy \u7684 DSL\u3002\u67E5\u770B\u6E90\u4EE3\u7801\u7684\u5355\u5143\u6D4B\u8BD5\uFF0C\u4FEE\u6539\u4E3A\u5982\u4E0B\u683C\u5F0F\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>regexp $/(?s)(?&lt;timestamp&gt;\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}.\\d{3}) \\[TID:(?&lt;tid&gt;.+?)] \\[(?&lt;thread&gt;.+?)] (?&lt;level&gt;\\w{4,}) (?&lt;logger&gt;.{1,36}) -(?&lt;msg&gt;.+)/$
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u6B63\u5E38\u91CD\u542F\u3002\u8FD0\u884C\u65F6\u62A5\uFF1A<code>java.lang.NumberFormatException: For input string: &quot;2022-07-22 14:40:02.565&quot;</code></p><p>\u6000\u7591\u662F parsed \u8981\u5C06\u5B57\u7B26\u4E32\u8F6C\u4E3A long\uFF0C\u4FEE\u6539 metrics \u90E8\u5206\u7684\u914D\u7F6E</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>extractor {
  metrics {
    timestamp parsed.timestamp as String
    labels level: parsed.level as String, service: log.service as String, instance: log.serviceInstance as String
    name &quot;log_count&quot;
    value 1
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u91CD\u542F\u6B63\u5E38\u3002\u8FD0\u884C\u65F6\u62A5 <code>Cannot cast object &#39;OtherSampler&#39; with class &#39;java.lang.String&#39; to class &#39;groovy.lang.GString&#39;</code> \u5F02\u5E38\u3002</p><p>\u67E5\u770B OtherSampler \u5728\u6E90\u4EE3\u7801\u4E2D\u7684\u4F4D\u7F6E\u3002\u5220\u9664 sampler \u7684\u914D\u7F6E\u5185\u5BB9\u3002</p><p>22 14:51 \u91CD\u65B0\u542F\u52A8\u3002\u80FD\u591F\u6B63\u5E38\u542F\u52A8\u3002\u672A\u89C1\u5F02\u5E38\u3002\u4F46\u662F\u4ECD\u7136\u672A\u89C1\u6307\u6807\u6570\u636E\u3002</p><p>\u5C1D\u8BD5\u5168\u90E8\u6DFB\u52A0\u5F3A\u5236\u4FDD\u5B58\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sink {
  enforcer {
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>22 15:02 \u91CD\u65B0\u542F\u52A8\u6B63\u5E38\u3002\u9875\u9762\u4E0A\u6CA1\u6709\u6307\u6807\u6570\u636E\u3002ES \u6CA1\u6709\u65B0\u589E\u7D22\u5F15\u3002</p><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>POST /sw_metrics-sum-20220722/_search
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>POST /sw_metrics-count-20220722/_search
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;metric_types&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;metric_table&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u65E5\u5FD7\u4E00\u76F4\u6709\u589E\u957F\uFF0C\u4F46\u662F\u8FD9\u4E24\u4E2A\u7D22\u5F15\u6CA1\u6709 <code>log_count</code> \u76F8\u5173\u7684\u6570\u636E\u3002</p><h3 id="\u6DFB\u52A0\u9519\u8BEF\u7AEF\u70B9\u7EDF\u8BA1" tabindex="-1"><a class="header-anchor" href="#\u6DFB\u52A0\u9519\u8BEF\u7AEF\u70B9\u7EDF\u8BA1" aria-hidden="true">#</a> \u6DFB\u52A0\u9519\u8BEF\u7AEF\u70B9\u7EDF\u8BA1</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># \u7AEF\u70B9\u5F02\u5E38\u91CF
endpoint_error_count = from(Endpoint.*).filter(status == false).count();
# \u5FAE\u670D\u52A1\u5F02\u5E38\u603B\u91CF
service_error_count = from(Service.*).filter(status == false).count();

# JVM \u5185\u5B58\u4F7F\u7528\u767E\u5206\u6BD4
instance_jvm_memory_used_percent = from(ServiceInstanceJVMMemory.*).rate(used, max); // error
instance_jvm_memory_heap_used_percent = from(ServiceInstanceJVMMemory.*).filter(heapStatus == true).rate(used &gt; 0l, max &gt; 0l); // \u6052\u7B49\u4E8E 100


# JVM \u5806\u5185\u5B58\u4F7F\u7528\u767E\u5206\u6BD4
instance_jvm_memory_heap_used_percent = from(ServiceInstanceJVMMemory.used).percent(heapStatus == true); // \u6052\u7B49\u4E8E 50
instance_jvm_memory_noheap_used_percent = from(ServiceInstanceJVMMemory.used).percent(heapStatus == false); // \u6052\u7B49\u4E8E 50

instance_jvm_memory_heap_used_percent = instance_jvm_memory_heap / instance_jvm_memory_heap_max;        // java.lang.IllegalArgumentException: Can&#39;t find metrics, null
instance_jvm_memory_noheap_used_percent = instance_jvm_memory_noheap / instance_jvm_memory_noheap_max;  // java.lang.IllegalArgumentException: Can&#39;t find metrics, null


instance_jvm_memory_used_percent = from(ServiceInstanceJVMMemory.used).percent(); //  argument can&#39;t find funcParamExpression.
instance_jvm_memory_heap_used_percent = from(ServiceInstanceJVMMemory.used).filter(heapStatus == true).percent();   //  argument can&#39;t find funcParamExpression.
instance_jvm_memory_noheap_used_percent = from(ServiceInstanceJVMMemory.used).filter(heapStatus == false).percent();//  argument can&#39;t find funcParamExpression.


instance_jvm_memory_heap_used_percent = from(ServiceInstanceJVMMemory.*).percent(heapStatus == true);       // \u6052\u7B49\u4E8E 50
instance_jvm_memory_noheap_used_percent = from(ServiceInstanceJVMMemory.used).percent(heapStatus == false); // \u6052\u7B49\u4E8E 50

# \u4FEE\u6539\u6E90\u4EE3\u7801\u540E
instance_jvm_memory_heap_used_percent = from(ServiceInstanceJVMMemory.heapUsage).doubleAvg();
instance_jvm_memory_noheap_used_percent = from(ServiceInstanceJVMMemory.noHeapUsage).doubleAvg(); // \u6570\u503C\u4E3A\u771F\u5B9E\u503C\u7684\u4E00\u534A

# \u7EC8\u6781\u65B9\u6848
instance_jvm_memory_heap_used_percent = from(ServiceInstanceJVMMemory.usage).filter(heapStatus == true).doubleAvg();
instance_jvm_memory_noheap_used_percent = from(ServiceInstanceJVMMemory.usage).filter(heapStatus == false).doubleAvg();
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>\u7136\u540E\u5728 Service \u7684 Dashboard \u548C Endpoint \u7684 Dashboard \u6DFB\u52A0\u9762\u677F\u5C55\u793A\u8FD9\u4E24\u4E2A\u6307\u6807\u3002</p><h3 id="log4j-appender" tabindex="-1"><a class="header-anchor" href="#log4j-appender" aria-hidden="true">#</a> Log4J Appender</h3><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">log4j.rootLogger</span><span class="token punctuation">=</span><span class="token value attr-value">WARN,loghub</span>

<span class="token key attr-name">log4j.appender.loghub</span><span class="token punctuation">=</span><span class="token value attr-value">com.aliyun.openservices.log.log4j.LoghubAppender</span>

<span class="token comment">#\u65E5\u5FD7\u670D\u52A1\u7684project\u540D\uFF0C\u5FC5\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghub.project</span><span class="token punctuation">=</span><span class="token value attr-value">[your project]</span>
<span class="token comment">#\u65E5\u5FD7\u670D\u52A1\u7684logstore\u540D\uFF0C\u5FC5\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghub.logStore</span><span class="token punctuation">=</span><span class="token value attr-value">[your logStore]</span>
<span class="token comment">#\u65E5\u5FD7\u670D\u52A1\u7684http\u5730\u5740\uFF0C\u5FC5\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghub.endpoint</span><span class="token punctuation">=</span><span class="token value attr-value">[your project endpoint]</span>
<span class="token comment">#\u7528\u6237\u8EAB\u4EFD\u6807\u8BC6\uFF0C\u5FC5\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghub.accessKeyId</span><span class="token punctuation">=</span><span class="token value attr-value">[your accesskey id]</span>
<span class="token key attr-name">log4j.appender.loghub.accessKeySecret</span><span class="token punctuation">=</span><span class="token value attr-value">[your accessKeySecret]</span>

<span class="token comment">#\u8BBE\u7F6E log \u5B57\u6BB5\u683C\u5F0F\uFF0C\u5FC5\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghub.layout</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.log4j.PatternLayout</span>
<span class="token key attr-name">log4j.appender.loghub.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token value attr-value">%-4r [%t] %-5p %c %x - %m%n</span>

<span class="token comment">#\u5355\u4E2A producer \u5B9E\u4F8B\u80FD\u7F13\u5B58\u7684\u65E5\u5FD7\u5927\u5C0F\u4E0A\u9650\uFF0C\u9ED8\u8BA4\u4E3A 100MB\u3002</span>
<span class="token key attr-name">log4j.appender.loghub.totalSizeInBytes</span><span class="token punctuation">=</span><span class="token value attr-value">104857600</span>
<span class="token comment">#\u5982\u679C producer \u53EF\u7528\u7A7A\u95F4\u4E0D\u8DB3\uFF0C\u8C03\u7528\u8005\u5728 send \u65B9\u6CD5\u4E0A\u7684\u6700\u5927\u963B\u585E\u65F6\u95F4\uFF0C\u9ED8\u8BA4\u4E3A 60 \u79D2\u3002\u4E3A\u4E86\u4E0D\u963B\u585E\u6253\u5370\u65E5\u5FD7\u7684\u7EBF\u7A0B\uFF0C\u5F3A\u70C8\u5EFA\u8BAE\u5C06\u8BE5\u503C\u8BBE\u7F6E\u6210 0\u3002</span>
<span class="token key attr-name">log4j.appender.loghub.maxBlockMs</span><span class="token punctuation">=</span><span class="token value attr-value">0</span>
<span class="token comment">#\u6267\u884C\u65E5\u5FD7\u53D1\u9001\u4EFB\u52A1\u7684\u7EBF\u7A0B\u6C60\u5927\u5C0F\uFF0C\u9ED8\u8BA4\u4E3A\u53EF\u7528\u5904\u7406\u5668\u4E2A\u6570\u3002</span>
<span class="token key attr-name">log4j.appender.loghub.ioThreadCount</span><span class="token punctuation">=</span><span class="token value attr-value">8</span>
<span class="token comment">#\u5F53\u4E00\u4E2A ProducerBatch \u4E2D\u7F13\u5B58\u7684\u65E5\u5FD7\u5927\u5C0F\u5927\u4E8E\u7B49\u4E8E batchSizeThresholdInBytes \u65F6\uFF0C\u8BE5 batch \u5C06\u88AB\u53D1\u9001\uFF0C\u9ED8\u8BA4\u4E3A 512 KB\uFF0C\u6700\u5927\u53EF\u8BBE\u7F6E\u6210 5MB\u3002</span>
<span class="token key attr-name">log4j.appender.loghub.batchSizeThresholdInBytes</span><span class="token punctuation">=</span><span class="token value attr-value">524288</span>
<span class="token comment">#\u5F53\u4E00\u4E2A ProducerBatch \u4E2D\u7F13\u5B58\u7684\u65E5\u5FD7\u6761\u6570\u5927\u4E8E\u7B49\u4E8E batchCountThreshold \u65F6\uFF0C\u8BE5 batch \u5C06\u88AB\u53D1\u9001\uFF0C\u9ED8\u8BA4\u4E3A 4096\uFF0C\u6700\u5927\u53EF\u8BBE\u7F6E\u6210 40960\u3002</span>
<span class="token key attr-name">log4j.appender.loghub.batchCountThreshold</span><span class="token punctuation">=</span><span class="token value attr-value">4096</span>
<span class="token comment">#\u4E00\u4E2A ProducerBatch \u4ECE\u521B\u5EFA\u5230\u53EF\u53D1\u9001\u7684\u9017\u7559\u65F6\u95F4\uFF0C\u9ED8\u8BA4\u4E3A 2 \u79D2\uFF0C\u6700\u5C0F\u53EF\u8BBE\u7F6E\u6210 100 \u6BEB\u79D2\u3002</span>
<span class="token key attr-name">log4j.appender.loghub.lingerMs</span><span class="token punctuation">=</span><span class="token value attr-value">2000</span>
<span class="token comment">#\u5982\u679C\u67D0\u4E2A ProducerBatch \u9996\u6B21\u53D1\u9001\u5931\u8D25\uFF0C\u80FD\u591F\u5BF9\u5176\u91CD\u8BD5\u7684\u6B21\u6570\uFF0C\u9ED8\u8BA4\u4E3A 10 \u6B21\u3002</span>
<span class="token comment">#\u5982\u679C retries \u5C0F\u4E8E\u7B49\u4E8E 0\uFF0C\u8BE5 ProducerBatch \u9996\u6B21\u53D1\u9001\u5931\u8D25\u540E\u5C06\u76F4\u63A5\u8FDB\u5165\u5931\u8D25\u961F\u5217\u3002</span>
<span class="token key attr-name">log4j.appender.loghub.retries</span><span class="token punctuation">=</span><span class="token value attr-value">10</span>
<span class="token comment">#\u8BE5\u53C2\u6570\u8D8A\u5927\u80FD\u8BA9\u60A8\u8FFD\u6EAF\u66F4\u591A\u7684\u4FE1\u606F\uFF0C\u4F46\u540C\u65F6\u4E5F\u4F1A\u6D88\u8017\u66F4\u591A\u7684\u5185\u5B58\u3002</span>
<span class="token key attr-name">log4j.appender.loghub.maxReservedAttempts</span><span class="token punctuation">=</span><span class="token value attr-value">11</span>
<span class="token comment">#\u9996\u6B21\u91CD\u8BD5\u7684\u9000\u907F\u65F6\u95F4\uFF0C\u9ED8\u8BA4\u4E3A 100 \u6BEB\u79D2\u3002</span>
<span class="token comment">#Producer \u91C7\u6837\u6307\u6570\u9000\u907F\u7B97\u6CD5\uFF0C\u7B2C N \u6B21\u91CD\u8BD5\u7684\u8BA1\u5212\u7B49\u5F85\u65F6\u95F4\u4E3A baseRetryBackoffMs * 2^(N-1)\u3002</span>
<span class="token key attr-name">log4j.appender.loghub.baseRetryBackoffMs</span><span class="token punctuation">=</span><span class="token value attr-value">100</span>
<span class="token comment">#\u91CD\u8BD5\u7684\u6700\u5927\u9000\u907F\u65F6\u95F4\uFF0C\u9ED8\u8BA4\u4E3A 50 \u79D2\u3002</span>
<span class="token key attr-name">log4j.appender.loghub.maxRetryBackoffMs</span><span class="token punctuation">=</span><span class="token value attr-value">50000</span>

<span class="token comment">#\u6307\u5B9A\u65E5\u5FD7\u4E3B\u9898\uFF0C\u9ED8\u8BA4\u4E3A &quot;&quot;\uFF0C\u53EF\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghub.topic</span> <span class="token punctuation">=</span> <span class="token value attr-value">[your topic]</span>

<span class="token comment">#\u6307\u7684\u65E5\u5FD7\u6765\u6E90\uFF0C\u9ED8\u8BA4\u4E3A\u5E94\u7528\u7A0B\u5E8F\u6240\u5728\u5BBF\u4E3B\u673A\u7684 IP\uFF0C\u53EF\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghub.source</span> <span class="token punctuation">=</span> <span class="token value attr-value">[your source]</span>

<span class="token comment">#\u8BBE\u7F6E\u65F6\u95F4\u683C\u5F0F\uFF0C\u9ED8\u8BA4\u4E3A yyyy-MM-dd&#39;T&#39;HH:mm:ssZ\uFF0C\u53EF\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghub.timeFormat</span><span class="token punctuation">=</span><span class="token value attr-value">yyyy-MM-dd&#39;T&#39;HH:mm:ssZ</span>
<span class="token comment">#\u8BBE\u7F6E\u65F6\u533A\uFF0C\u9ED8\u8BA4\u4E3A UTC\uFF0C\u53EF\u9009\u53C2\u6570\uFF08\u5982\u679C\u5E0C\u671B time \u5B57\u6BB5\u7684\u65F6\u533A\u4E3A\u4E1C\u516B\u533A\uFF0C\u53EF\u5C06\u8BE5\u503C\u8BBE\u5B9A\u4E3A Asia/Shanghai\uFF09</span>
<span class="token key attr-name">log4j.appender.loghub.timeZone</span><span class="token punctuation">=</span><span class="token value attr-value">UTC</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>\u793A\u4F8B</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">log4j.rootLogger</span><span class="token punctuation">=</span><span class="token value attr-value">DEBUG,loghubAppender1, loghubAppender2, STDOUT</span>

<span class="token comment">#loghubAppender1</span>
<span class="token key attr-name">log4j.appender.loghubAppender1</span><span class="token punctuation">=</span><span class="token value attr-value">com.aliyun.openservices.log.log4j.LoghubAppender</span>
<span class="token comment">#\u65E5\u5FD7\u670D\u52A1\u7684project\u540D\uFF0C\u5FC5\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender1.project</span><span class="token punctuation">=</span><span class="token value attr-value">test-proj</span>
<span class="token comment">#\u65E5\u5FD7\u670D\u52A1\u7684logstore\u540D\uFF0C\u5FC5\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender1.logStore</span><span class="token punctuation">=</span><span class="token value attr-value">store1</span>
<span class="token comment">#\u65E5\u5FD7\u670D\u52A1\u7684http\u5730\u5740\uFF0C\u5FC5\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender1.endpoint</span><span class="token punctuation">=</span>
<span class="token comment">#\u7528\u6237\u8EAB\u4EFD\u6807\u8BC6\uFF0C\u5FC5\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender1.accessKeyId</span><span class="token punctuation">=</span>
<span class="token key attr-name">log4j.appender.loghubAppender1.accessKeySecret</span><span class="token punctuation">=</span>
<span class="token comment">#\u8BBE\u7F6Elog\u5B57\u6BB5\u7684\u683C\u5F0F\uFF0C\u5FC5\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender1.layout</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.log4j.PatternLayout</span>
<span class="token key attr-name">log4j.appender.loghubAppender1.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token value attr-value">%-4r [%t] %-5p %c %x - %m%n</span>
<span class="token comment">#\u6307\u5B9A\u65E5\u5FD7\u4E3B\u9898\uFF0C\u53EF\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender1.topic</span> <span class="token punctuation">=</span> <span class="token value attr-value">topic1</span>
<span class="token comment">#\u6307\u5B9A\u65E5\u5FD7\u6765\u6E90\uFF0C\u53EF\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender1.source</span> <span class="token punctuation">=</span> <span class="token value attr-value">source1</span>
<span class="token comment">#\u8BBE\u7F6E\u65F6\u95F4\u683C\u5F0F\uFF0C\u53EF\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender1.timeFormat</span><span class="token punctuation">=</span><span class="token value attr-value">yyyy-MM-dd&#39;T&#39;HH:mm:ssZ</span>
<span class="token comment">#\u8BBE\u7F6E\u65F6\u533A\uFF0C\u53EF\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender1.timeZone</span><span class="token punctuation">=</span><span class="token value attr-value">UTC</span>
<span class="token comment">#\u8F93\u51FAWARN\u7EA7\u522B\u53CA\u4EE5\u4E0A\u7684\u6D88\u606F</span>
<span class="token key attr-name">log4j.appender.loghubAppender1.Threshold</span><span class="token punctuation">=</span><span class="token value attr-value">WARN</span>

<span class="token comment">#loghubAppender2</span>
<span class="token key attr-name">log4j.appender.loghubAppender2</span><span class="token punctuation">=</span><span class="token value attr-value">com.aliyun.openservices.log.log4j.LoghubAppender</span>
<span class="token comment">#\u65E5\u5FD7\u670D\u52A1\u7684project\u540D\uFF0C\u5FC5\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender2.project</span><span class="token punctuation">=</span><span class="token value attr-value">test-proj</span>
<span class="token comment">#\u65E5\u5FD7\u670D\u52A1\u7684logstore\u540D\uFF0C\u5FC5\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender2.logStore</span><span class="token punctuation">=</span><span class="token value attr-value">store2</span>
<span class="token comment">#\u65E5\u5FD7\u670D\u52A1\u7684http\u5730\u5740\uFF0C\u5FC5\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender2.endpoint</span><span class="token punctuation">=</span>
<span class="token comment">#\u7528\u6237\u8EAB\u4EFD\u6807\u8BC6\uFF0C\u5FC5\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender2.accessKeyId</span><span class="token punctuation">=</span>
<span class="token key attr-name">log4j.appender.loghubAppender2.accessKeySecret</span><span class="token punctuation">=</span>
<span class="token comment">#\u8BBE\u7F6Elog\u5B57\u6BB5\u7684\u683C\u5F0F\uFF0C\u5FC5\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender2.layout</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.log4j.PatternLayout</span>
<span class="token key attr-name">log4j.appender.loghubAppender2.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token value attr-value">%-4r [%t] %-5p %c %x - %m%n</span>
<span class="token comment">#\u6307\u5B9A\u65E5\u5FD7\u4E3B\u9898\uFF0C\u53EF\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender2.topic</span> <span class="token punctuation">=</span> <span class="token value attr-value">topic2</span>
<span class="token comment">#\u6307\u5B9A\u65E5\u5FD7\u6765\u6E90\uFF0C\u53EF\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender2.source</span> <span class="token punctuation">=</span> <span class="token value attr-value">source2</span>
<span class="token comment">#\u8BBE\u7F6E\u65F6\u95F4\u683C\u5F0F\uFF0C\u53EF\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender2.timeFormat</span><span class="token punctuation">=</span><span class="token value attr-value">yyyy-MM-dd&#39;T&#39;HH:mm:ssZ</span>
<span class="token comment">#\u8BBE\u7F6E\u65F6\u533A\u4E3A\u4E1C\u516B\u533A\uFF0C\u53EF\u9009\u53C2\u6570</span>
<span class="token key attr-name">log4j.appender.loghubAppender2.timeZone</span><span class="token punctuation">=</span><span class="token value attr-value">Asia/Shanghai</span>
<span class="token comment">#\u8F93\u51FAINFO\u7EA7\u522B\u53CA\u4EE5\u4E0A\u7684\u6D88\u606F</span>
<span class="token key attr-name">log4j.appender.loghubAppender2.Threshold</span><span class="token punctuation">=</span><span class="token value attr-value">INFO</span>

<span class="token comment">#STDOUT</span>
<span class="token key attr-name">log4j.appender.STDOUT</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.log4j.ConsoleAppender</span>
<span class="token key attr-name">log4j.appender.STDOUT.layout</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.log4j.PatternLayout</span>
<span class="token key attr-name">log4j.appender.STDOUT.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token value attr-value">%-4r [%t] %-5p %c %x - %m%n</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h2 id="kibana-\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#kibana-\u4F7F\u7528" aria-hidden="true">#</a> Kibana \u4F7F\u7528</h2><p>\u7EDF\u8BA1\u6307\u6807</p><div class="language-http ext-http line-numbers-mode"><pre class="language-http"><code>POST /sw_metrics-longavg-20220722/_search
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;metric_types&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;metric_table&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>2022-08-02 16:36 Devops GitLab Token : glpat-9hbRQcEQockDsnM3FNnh</p>`,37);function Xn(ns,ss){const p=l("ExternalLinkIcon"),e=l("Badge");return c(),r(i,null,[m,b,n("blockquote",null,[n("p",null,[k,n("a",g,[v,a(p)])])]),n("p",null,[h,a(e,{type:"tip",text:"\u63A8\u8350",vertical:"top"})]),_,n("blockquote",null,[y,n("p",null,[f,n("a",q,[S,a(p)])])]),x,n("blockquote",null,[n("p",null,[M,n("a",j,[A,a(p)])])]),I,n("ul",null,[n("li",null,[E,a(e,{type:"warning",text:"\u5FC5\u987B",vertical:"top"}),P,V,T]),n("li",null,[C,L,a(e,{type:"warning",text:"\u5FC5\u987B",vertical:"top"}),R,J,w]),D,n("li",null,[N,O,a(e,{type:"warning",text:"\u5FC5\u987B",vertical:"top"}),G,W,B,H,F,U,K]),n("li",null,[z,Q,a(e,{type:"warning",text:"\u5FC5\u987B",vertical:"top"}),$,Z,Y,X,nn,sn,an,en,tn,pn]),n("li",null,[ln,on,a(e,{type:"warning",text:"\u5FC5\u987B",vertical:"top"}),cn]),n("li",null,[rn,un,a(e,{type:"warning",text:"\u5FC5\u987B",vertical:"top"}),dn]),mn,n("li",null,[bn,kn,a(e,{type:"warning",text:"\u5FC5\u987B",vertical:"top"}),gn]),n("li",null,[vn,hn,a(e,{type:"warning",text:"\u5FC5\u987B",vertical:"top"}),_n])]),yn,n("blockquote",null,[n("p",null,[fn,n("a",qn,[Sn,a(p)])])]),xn,Mn,jn,An,n("ul",null,[n("li",null,[In,a(e,{type:"warning",text:"\u5FC5\u987B",vertical:"top"}),En,Pn,Vn]),n("li",null,[Tn,Cn,a(e,{type:"warning",text:"\u5FC5\u987B",vertical:"top"}),Ln,Rn,Jn,wn,Dn,Nn,On]),n("li",null,[Gn,Wn,a(e,{type:"warning",text:"\u5FC5\u987B",vertical:"top"}),Bn]),n("li",null,[Hn,Fn,a(e,{type:"warning",text:"\u5FC5\u987B",vertical:"top"}),Un,Kn,zn])]),Qn,n("p",null,[n("a",$n,[Zn,a(p)])]),Yn],64)}var es=o(d,[["render",Xn],["__file","index.html.vue"]]);export{es as default};
