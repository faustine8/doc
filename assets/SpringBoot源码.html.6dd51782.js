import{_ as n,c as s}from"./app.40df414d.js";var a="/doc/assets/SpringBoot\u6E90\u7801-1620734840144.ec04a090.png",t="/doc/assets/SpringBoot\u6E90\u7801-1620908591718.cb9578cc.png",p="/doc/assets/SpringBoot\u6E90\u7801-1620909494125.6de1c6ea.png";const e={},o=s(`<h1 id="spring-boot-\u6E90\u7801\u5256\u6790" tabindex="-1"><a class="header-anchor" href="#spring-boot-\u6E90\u7801\u5256\u6790" aria-hidden="true">#</a> Spring Boot \u6E90\u7801\u5256\u6790</h1><p>\u6E90\u7801\u5BFC\u5165\u9700\u8981\u6CE8\u610F\u4E24\u70B9\uFF1A</p><ol><li>2.2.x \u4EE5\u540E\u90FD\u662F\u4F7F\u7528\u7684 Gradle \u6784\u5EFA</li><li>\u9700\u8981\u5728 pom.xml \u6587\u4EF6\u4E2D\u6DFB\u52A0 <code>&lt;disable.checks&gt;true&lt;/disable.checks&gt;</code> \u5173\u95ED maven \u4EE3\u7801\u68C0\u67E5</li></ol><h2 id="\u4F9D\u8D56\u7BA1\u7406" tabindex="-1"><a class="header-anchor" href="#\u4F9D\u8D56\u7BA1\u7406" aria-hidden="true">#</a> \u4F9D\u8D56\u7BA1\u7406</h2><blockquote><p>\u95EE\u9898\u4E00: \u4E3A\u4EC0\u4E48\u5BFC\u5165dependency\u65F6\u4E0D\u9700\u8981\u6307\u5B9A\u7248\u672C?</p></blockquote><p>\u5728Spring Boot\u5165\u95E8\u7A0B\u5E8F\u4E2D\uFF0C\u9879\u76EE<code>pom.xml</code>\u6587\u4EF6\u6709\u4E24\u4E2A\u6838\u5FC3\u4F9D\u8D56\uFF0C\u5206\u522B\u662F <code>spring-boot-starter-parent</code> \u548C<code>spring-boot-starter-web</code>\uFF0C\u5173\u4E8E\u8FD9\u4E24\u4E2A\u4F9D\u8D56\u7684\u76F8\u5173\u4ECB\u7ECD\u5177\u4F53\u5982\u4E0B</p><h3 id="spring-boot-starter-parent" tabindex="-1"><a class="header-anchor" href="#spring-boot-starter-parent" aria-hidden="true">#</a> spring-boot-starter-parent</h3><p>\u627E\u5230<code>spring-boot-starter-parent</code>\u4F9D\u8D56\uFF0C\u4EE3\u7801\u5982\u4E0B:</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.13.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span> <span class="token comment">&lt;!-- lookup parent from repository --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u4E2D\uFF0C\u5C06<code>spring-boot-starter-parent</code>\u4F9D\u8D56\u4F5C\u4E3A Spring Boot \u9879\u76EE\u7684\u7EDF\u4E00\u7236\u9879\u76EE\u4F9D\u8D56\u7BA1\u7406\uFF0C\u5E76\u5C06\u9879\u76EE\u7248\u672C\u53F7\u7EDF\u4E00\u4E3A<code>2.2.13.RELEASE</code>\uFF0C \u8BE5\u7248\u672C\u53F7\u6839\u636E\u5B9E\u9645\u5F00\u53D1\u9700\u6C42\u662F\u53EF\u4EE5\u4FEE\u6539\u7684\u3002</p><p>\u8FDB\u5165\u5E76\u67E5\u770B<code>spring-boot-starter-parent</code>\u5E95\u5C42\u6E90\u6587\u4EF6\uFF0C\u5148\u770B spring-boot-starter-parent\u505A\u4E86\u54EA\u4E9B\u4E8B\u3002</p><p>\u9996\u5148\u770B<code>spring-boot-starter-parent</code>\u7684<code>properties</code>\u8282\u70B9</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main.basedir</span><span class="token punctuation">&gt;</span></span>\${basedir}/../../..<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main.basedir</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource.delimiter</span><span class="token punctuation">&gt;</span></span>@<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource.delimiter</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- delimiter that doesn&#39;t clash with Spring \${} placeholders --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>\${java.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>\${java.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p><code>spring-boot-starter-parent</code>\u5728\u6B64\u5B9A\u4E49\u4E86:</p><ul><li>\u5DE5\u7A0B\u7684Java\u7248\u672C\u4E3A 1.8</li><li>\u5DE5\u7A0B\u4EE3\u7801\u7684\u7F16\u8BD1\u6E90\u6587\u4EF6\u7F16\u7801\u683C\u5F0F\u4E3A UTF-8</li><li>\u5DE5\u7A0B\u7F16\u8BD1\u540E\u7684\u6587\u4EF6\u7F16\u7801\u683C\u5F0F\u4E3A UTF-8</li><li>Maven\u6253\u5305\u7F16\u8BD1\u7684\u7248\u672C</li></ul></blockquote><p>\u518D\u770B<code>spring-boot-starter-parent</code>\u7684 build \u8282\u70B9\uFF0C\u5728\u6B64\u8282\u70B9\u5206\u522B\u5B9A\u4E49\u4E86<code>resources</code>\u8D44\u6E90\u548C<code>pluginManagement</code></p><p>\u6211\u4EEC\u8BE6\u7EC6\u770B\u4E00\u4E0B<code>resources</code>\u8282\u70B9\uFF0C\u91CC\u9762\u5B9A\u4E49\u4E86\u8D44\u6E90\u8FC7\u6EE4\uFF0C\u9488\u5BF9<code>application</code>\u7684<code>yml</code>\u3001<code>properties</code>\u683C\u5F0F\u8FDB\u884C\u4E86\u8FC7\u6EE4\uFF0C\u53EF\u4EE5\u652F\u6301\u4E0D\u540C\u73AF\u5883\u7684\u914D\u7F6E\u3002 \u6BD4\u5982 <code>application-dev.yml</code>\u3001<code>application-test.yml</code>\u3001<code>application-dev.properties</code>\u7B49\u7B49\u3002</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>\${basedir}/src/main/resources<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filtering</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filtering</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/application*.yml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/application*.yaml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/application*.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>\${basedir}/src/main/resources<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>excludes</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>**/application*.yml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>**/application*.yaml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>**/application*.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>excludes</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><blockquote><p>\u800C <code>pluginManagement</code> \u5219\u662F\u5F15\u5165\u4E86\u76F8\u5E94\u7684\u63D2\u4EF6\u548C\u5BF9\u5E94\u7684\u7248\u672C\u4F9D\u8D56\uFF0C\u5728\u6B64\u4E0D\u505A\u8FC7\u591A\u5C55\u793A</p></blockquote><p>\u6700\u540E\u6765\u770B<code>spring-boot-starter-parent</code>\u7684\u7236\u4F9D\u8D56<code>spring-boot-dependencies</code></p><p><code>spring-boot-dependencies</code>\u7684<code>properties</code>\u8282\u70B9:</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main.basedir</span><span class="token punctuation">&gt;</span></span>\${basedir}/../..<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main.basedir</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- Dependency versions --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activemq.version</span><span class="token punctuation">&gt;</span></span>5.15.14<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activemq.version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>antlr2.version</span><span class="token punctuation">&gt;</span></span>2.7.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>antlr2.version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appengine-sdk.version</span><span class="token punctuation">&gt;</span></span>1.9.84<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appengine-sdk.version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artemis.version</span><span class="token punctuation">&gt;</span></span>2.10.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artemis.version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>aspectj.version</span><span class="token punctuation">&gt;</span></span>1.9.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>aspectj.version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assertj.version</span><span class="token punctuation">&gt;</span></span>3.13.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>assertj.version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>atomikos.version</span><span class="token punctuation">&gt;</span></span>4.0.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>atomikos.version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>awaitility.version</span><span class="token punctuation">&gt;</span></span>4.0.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>awaitility.version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bitronix.version</span><span class="token punctuation">&gt;</span></span>2.1.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bitronix.version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>byte-buddy.version</span><span class="token punctuation">&gt;</span></span>1.10.19<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>byte-buddy.version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>caffeine.version</span><span class="token punctuation">&gt;</span></span>2.8.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>caffeine.version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cassandra-driver.version</span><span class="token punctuation">&gt;</span></span>3.7.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cassandra-driver.version</span><span class="token punctuation">&gt;</span></span>
	......
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>\u8FD9\u4E2A\u624D\u662F SpringBoot \u9879\u76EE\u7684\u771F\u6B63\u7BA1\u7406\u4F9D\u8D56\u7684\u9879\u76EE\uFF0C\u91CC\u9762\u5B9A\u4E49\u4E86\u4E0A\u767E\u4E2ASpringBoot\u76F8\u5173\u7684\u7248\u672C</p><p><code>spring-boot-dependencies</code>\u7684<code>dependencyManagement</code>\u8282\u70B9\u5728\u5176\u5B50\u8282\u70B9<code>dependencies</code>\u4E2D\u5B9A\u4E49\u4E86SpringBoot\u7248\u672C\u7684\u4F9D\u8D56\u7684\u7EC4\u4EF6\u4EE5\u53CA\u76F8\u5E94\u7248\u672C</p><p>\u6240\u4EE5\u5F97\u51FA\u7ED3\u8BBA\uFF1A</p><p><code>spring-boot-starter-parent</code>\u901A\u8FC7<em>\u7EE7\u627F</em><code>spring-boot-dependencies</code>\u4ECE\u800C\u5B9E\u73B0\u4E86SpringBoot\u7684\u7248\u672C\u4F9D\u8D56\u7BA1\u7406\uFF0C \u6240\u4EE5\u6211\u4EEC\u7684 SpringBoot \u5DE5\u7A0B\u7EE7\u627F<code>spring-boot-starter-parent</code>\u540E\u5DF2\u7ECF\u5177\u5907\u7248\u672C\u9501\u5B9A\u7B49\u914D\u7F6E\u4E86, \u8FD9\u5C31\u662F\u5728 SpringBoot \u9879\u76EE\u4E2D<em>\u90E8\u5206\u4F9D\u8D56</em>\u4E0D\u9700\u8981\u5199\u7248\u672C\u53F7\u7684\u539F\u56E0</p><hr><blockquote><p>\u95EE\u9898\u4E8C : <code>spring-boot-starter-parent</code> \u7236\u4F9D\u8D56\u542F\u52A8\u5668\u7684\u4E3B\u8981\u4F5C\u7528\u662F\u8FDB\u884C\u7248\u672C\u7EDF\u4E00\u7BA1\u7406\uFF0C\u90A3\u4E48\u9879\u76EE\u8FD0\u884C\u4F9D\u8D56\u7684JAR\u5305\u662F\u4ECE\u4F55\u800C\u6765\u7684?</p></blockquote><h3 id="spring-boot-starter-web" tabindex="-1"><a class="header-anchor" href="#spring-boot-starter-web" aria-hidden="true">#</a> spring-boot-starter-web</h3><p>\u67E5\u770B<code>spring-boot-starter-web</code>\u4F9D\u8D56\u6587\u4EF6\u6E90\u7801\uFF0C\u6838\u5FC3\u4EE3\u7801\u5177\u4F53\u5982\u4E0B</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-json<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-tomcat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-validation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.tomcat.embed<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>tomcat-embed-el<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-webmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>\u4ECE\u4E0A\u8FF0\u4EE3\u7801\u53EF\u4EE5\u53D1\u73B0\uFF0C<code>spring-boot-starter-web</code>\u4F9D\u8D56\u542F\u52A8\u5668\u7684\u4E3B\u8981\u4F5C\u7528\u662F: \u6253\u5305\u4E86Web\u5F00\u53D1\u573A\u666F\u6240\u9700\u7684\u5E95\u5C42\u6240\u6709\u4F9D\u8D56(\u57FA\u4E8E\u4F9D\u8D56\u4F20\u9012\uFF0C\u5F53\u524D\u9879\u76EE\u4E5F\u5B58\u5728\u5BF9\u5E94\u7684\u4F9D\u8D56jar\u5305)</p><p>\u6B63\u56E0\u5982\u6B64\uFF0C\u5728<code>pom.xml</code>\u4E2D\u5F15\u5165<code>spring-boot-starter-web</code>\u4F9D\u8D56\u542F\u52A8\u5668\u65F6\uFF0C\u5C31\u53EF\u4EE5\u5B9E\u73B0Web\u573A\u666F\u5F00\u53D1\uFF0C\u800C\u4E0D\u9700\u8981\u989D\u5916\u5BFC\u5165Tomcat\u670D\u52A1\u5668\u4EE5\u53CA\u5176\u4ED6Web\u4F9D\u8D56\u6587\u4EF6\u7B49\u3002 \u5F53\u7136\uFF0C\u8FD9\u4E9B\u5F15\u5165\u7684\u4F9D\u8D56\u6587\u4EF6\u7684\u7248\u672C\u53F7\u8FD8\u662F\u7531spring-boot-starter-parent\u7236\u4F9D\u8D56\u8FDB\u884C\u7684\u7EDF\u4E00\u7BA1\u7406\u3002</p><blockquote><p>Spring Boot\u9664\u4E86\u63D0\u4F9B\u6709\u4E0A\u9762\u4ECB\u7ECD\u7684Web\u4F9D\u8D56\u542F\u52A8\u5668\u5916\uFF0C\u8FD8\u63D0\u4F9B\u4E86\u5176\u4ED6\u8BB8\u591A\u5F00\u53D1\u573A\u666F\u7684\u76F8\u5173\u4F9D\u8D56\uFF0C\u6211\u4EEC\u53EF\u4EE5\u6253\u5F00Spring Boot\u5B98\u65B9\u6587\u6863\uFF0C\u641C\u7D22\u201CStarters\u201D\u5173\u952E\u5B57\u67E5\u8BE2\u573A\u666F\u4F9D\u8D56\u542F\u52A8\u5668</p><p>\u8FD9\u4E9B\u4F9D\u8D56\u542F\u52A8\u5668\u9002\u7528\u4E8E\u4E0D\u540C\u7684\u573A\u666F\u5F00\u53D1\uFF0C\u4F7F\u7528\u65F6\u53EA\u9700\u8981\u5728<code>pom.xml</code>\u6587\u4EF6\u4E2D\u5BFC\u5165\u5BF9\u5E94\u7684\u4F9D\u8D56\u542F\u52A8\u5668\u5373\u53EF\u3002</p></blockquote><p>\u9700\u8981\u8BF4\u660E\u7684\u662F\uFF0CSpring Boot\u5B98\u65B9\u5E76\u4E0D\u662F\u9488\u5BF9\u6240\u6709\u573A\u666F\u5F00\u53D1\u7684\u6280\u672F\u6846\u67B6\u90FD\u63D0\u4F9B\u4E86\u573A\u666F\u542F\u52A8\u5668\uFF0C\u4F8B\u5982\u963F\u91CC\u5DF4\u5DF4\u7684Druid\u6570\u636E\u6E90\u7B49\uFF0CSpring Boot\u5B98\u65B9\u5C31\u6CA1\u6709\u63D0\u4F9B\u5BF9\u5E94\u7684\u4F9D\u8D56\u542F\u52A8\u5668\u3002</p><p>\u4E3A\u4E86\u5145\u5206\u5229\u7528 SpringBoot \u6846\u67B6\u7684\u4F18\u52BF\uFF0C\u5728 SpringBoot \u5B98\u65B9\u6CA1\u6709\u6574\u5408\u8FD9\u4E9B\u6280\u672F\u6846\u67B6\u7684\u60C5\u51B5\u4E0B\uFF0CDruid \u7B49\u6280\u672F\u6846\u67B6\u6240\u5728\u7684\u5F00\u53D1\u56E2\u961F\u4E3B\u52A8\u4E0E SpringBoot \u6846\u67B6\u8FDB\u884C\u4E86\u6574\u5408\uFF0C \u5B9E\u73B0\u4E86\u5404\u81EA\u7684\u4F9D\u8D56\u542F\u52A8\u5668\uFF0C\u4F8B\u5982druid-spring-boot-starter\u7B49\u3002(\u6211\u4EEC\u5728<code>pom.xml</code>\u6587\u4EF6\u4E2D\u5F15\u5165\u8FD9\u4E9B\u7B2C\u4E09\u65B9\u7684\u4F9D\u8D56\u542F\u52A8\u5668\u65F6\uFF0C\u5207\u8BB0\u8981\u624B\u52A8\u914D\u7F6E\u5BF9\u5E94\u7684\u7248\u672C\u53F7)</p><blockquote><p>\u547D\u540D\u89C4\u8303\uFF1A</p><p>\u5B98\u65B9\uFF1A spring-boot-starter-xxx \u81EA\u5B9A\u4E49\uFF1Axxx-spring-boot-starter</p></blockquote><h2 id="\u81EA\u52A8\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u81EA\u52A8\u914D\u7F6E" aria-hidden="true">#</a> \u81EA\u52A8\u914D\u7F6E</h2><blockquote><p>\u81EA\u52A8\u914D\u7F6E: \u6839\u636E\u6211\u4EEC\u6DFB\u52A0\u7684jar\u5305\u4F9D\u8D56\uFF0C\u4F1A\u81EA\u52A8\u5C06\u4E00\u4E9B\u914D\u7F6E\u7C7B\u7684 Bean \u6CE8\u518C\u8FDB IoC \u5BB9\u5668\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5728\u9700\u8981\u7684\u5730\u65B9\u4F7F\u7528<code>@Autowired</code>\u7B49\u6CE8\u89E3\u6765\u4F7F\u7528\u5B83\u3002</p></blockquote><p><strong>\u95EE\u9898:Spring Boot\u5230\u5E95\u662F\u5982\u4F55\u8FDB\u884C\u81EA\u52A8\u914D\u7F6E\u7684\uFF0C\u90FD\u628A\u54EA\u4E9B\u7EC4\u4EF6\u8FDB\u884C\u4E86\u81EA\u52A8\u914D\u7F6E?</strong></p><p>\u5DF2\u77E5 SpringBoot \u5E94\u7528\u7684\u542F\u52A8\u5165\u53E3\u662F<code>@SpringBootApplication</code>\u6CE8\u89E3\u6807\u6CE8\u7C7B\u4E2D\u7684<code>main()</code>\u65B9\u6CD5\uFF0C\u6211\u4EEC\u9996\u5148\u6765\u770B\u8FD9\u4E2A\u6CE8\u89E3</p><h3 id="springbootapplication" tabindex="-1"><a class="header-anchor" href="#springbootapplication" aria-hidden="true">#</a> @SpringBootApplication</h3><p>\u6838\u5FC3\u4EE3\u7801\u5982\u4E0B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u6CE8\u89E3\u7684\u9002\u7528\u8303\u56F4,Type\u8868\u793A\u6CE8\u89E3\u53EF\u4EE5\u63CF\u8FF0\u5728\u7C7B\u3001\u63A5\u53E3\u3001\u6CE8\u89E3\u6216\u679A\u4E3E\u4E2D</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">)</span>
<span class="token comment">//\u8868\u793A\u6CE8\u89E3\u7684\u751F\u547D\u5468\u671F\uFF0CRuntime\u8868\u793A\u8FD0\u884C\u65F6</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token comment">//\u8868\u793A\u6CE8\u89E3\u53EF\u4EE5\u8BB0\u5F55\u5728 javaDoc \u4E2D</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token comment">// \u8868\u793A\u53EF\u4EE5\u88AB\u5B50\u7C7B\u7EE7\u627F\u8BE5\u6CE8\u89E3</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token comment">// \u6807\u660E\u8BE5\u7C7B\u4E3A\u914D\u7F6E\u7C7B</span>
<span class="token annotation punctuation">@SpringBootConfiguration</span>
<span class="token comment">// \u542F\u52A8\u81EA\u52A8\u914D\u7F6E\u529F\u80FD</span>
<span class="token annotation punctuation">@EnableAutoConfiguration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>CUSTOM<span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">TypeExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>CUSTOM<span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">AutoConfigurationExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">SpringBootApplication</span> <span class="token punctuation">{</span>
	<span class="token comment">// \u6839\u636Eclass\u6765\u6392\u9664\u7279\u5B9A\u7684\u7C7B\uFF0C\u4F7F\u5176\u4E0D\u80FD\u52A0\u5165spring\u5BB9\u5668\uFF0C\u4F20\u5165\u53C2\u6570value\u7C7B\u578B\u662Fclass\u7C7B\u578B\u3002</span>
	<span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span>annotation <span class="token operator">=</span> <span class="token class-name">EnableAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">exclude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment">// \u6839\u636Eclassname \u6765\u6392\u9664\u7279\u5B9A\u7684\u7C7B\uFF0C\u4F7F\u5176\u4E0D\u80FD\u52A0\u5165spring\u5BB9\u5668\uFF0C\u4F20\u5165\u53C2\u6570value\u7C7B\u578B\u662Fclass\u7684\u5168\u7C7B\u540D\u5B57\u7B26\u4E32\u6570\u7EC4\u3002</span>
	<span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span>annotation <span class="token operator">=</span> <span class="token class-name">EnableAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">excludeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment">// \u6307\u5B9A\u626B\u63CF\u5305\uFF0C\u53C2\u6570\u662F\u5305\u540D\u7684\u5B57\u7B26\u4E32\u6570\u7EC4\u3002</span>
	<span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span>annotation <span class="token operator">=</span> <span class="token class-name">ComponentScan</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> attribute <span class="token operator">=</span> <span class="token string">&quot;basePackages&quot;</span><span class="token punctuation">)</span>
	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">scanBasePackages</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment">// \u626B\u63CF\u7279\u5B9A\u7684\u5305\uFF0C\u53C2\u6570\u7C7B\u4F3C\u662FClass\u7C7B\u578B\u6570\u7EC4\u3002</span>
	<span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span>annotation <span class="token operator">=</span> <span class="token class-name">ComponentScan</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> attribute <span class="token operator">=</span> <span class="token string">&quot;basePackageClasses&quot;</span><span class="token punctuation">)</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">scanBasePackageClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span>annotation <span class="token operator">=</span> <span class="token class-name">Configuration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token keyword">boolean</span> <span class="token function">proxyBeanMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>\u4ECE\u6E90\u7801\u53EF\u4EE5\u770B\u51FA\uFF0C<code>@SpringBootApplication</code>\u6CE8\u89E3\u662F\u4E00\u4E2A\u7EC4\u5408\u6CE8\u89E3\uFF0C\u524D\u9762 4 \u4E2A\u662F\u6CE8\u89E3\u7684\u5143\u6570\u636E\u4FE1\u606F\uFF0C \u6211\u4EEC\u4E3B\u8981\u770B\u540E\u9762 3 \u4E2A\u6CE8\u89E3: <code>@SpringBootConfiguration</code>\u3001<code>@EnableAutoConfiguration</code>\u3001 <code>@ComponentScan</code> \u4E09\u4E2A\u6838\u5FC3\u6CE8\u89E3\uFF0C\u5173\u4E8E\u8FD9\u4E09\u4E2A\u6838\u5FC3\u6CE8\u89E3\u7684\u76F8\u5173\u8BF4\u660E\u5177\u4F53\u5982\u4E0B</p><h3 id="springbootconfiguration" tabindex="-1"><a class="header-anchor" href="#springbootconfiguration" aria-hidden="true">#</a> @SpringBootConfiguration</h3><blockquote><p><code>@SpringBootConfiguration</code>: SpringBoot \u7684\u914D\u7F6E\u7C7B\uFF0C\u6807\u6CE8\u5728\u67D0\u4E2A\u7C7B\u4E0A\uFF0C\u8868\u793A\u8FD9\u662F\u4E00\u4E2A SpringBoot \u7684\u914D\u7F6E\u7C7B\u3002</p></blockquote><p>\u67E5\u770B<code>@SpringBootConfiguration</code>\u6CE8\u89E3\u6E90\u7801\uFF0C\u6838\u5FC3\u4EE3\u7801\u5982\u4E0B:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">SpringBootConfiguration</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span>annotation <span class="token operator">=</span> <span class="token class-name">Configuration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
	<span class="token keyword">boolean</span> <span class="token function">proxyBeanMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u4ECE\u4E0A\u8FF0\u6E90\u7801\u53EF\u4EE5\u770B\u51FA\uFF0C<code>@SpringBootConfiguration</code>\u6CE8\u89E3\u5185\u90E8\u6709\u4E00\u4E2A\u6838\u5FC3\u6CE8\u89E3<code>@Configuration</code>\uFF0C \u8BE5\u6CE8\u89E3 \u662FSpring\u6846\u67B6\u63D0\u4F9B\u7684\uFF0C\u8868\u793A\u5F53\u524D\u7C7B\u4E3A\u4E00\u4E2A\u914D\u7F6E\u7C7B(XML\u914D\u7F6E\u6587\u4EF6\u7684\u6CE8\u89E3\u8868\u73B0\u5F62\u5F0F)\uFF0C\u5E76\u53EF\u4EE5\u88AB\u7EC4\u4EF6\u626B\u63CF\u5668\u626B\u63CF\u3002</p><p>\u7531\u6B64\u53EF\u89C1\uFF0C<code>@SpringBootConfiguration</code>\u6CE8\u89E3\u7684\u4F5C\u7528\u4E0E<code>@Configuration</code>\u6CE8\u89E3\u76F8\u540C\uFF0C\u90FD\u662F\u6807\u8BC6\u4E00\u4E2A\u53EF\u4EE5\u88AB\u7EC4\u4EF6\u626B\u63CF\u5668\u626B\u63CF\u7684\u914D\u7F6E\u7C7B\uFF0C \u53EA\u4E0D\u8FC7<code>@SpringBootConfiguration</code>\u662F\u88AB SpringBoot \u8FDB\u884C\u4E86\u91CD\u65B0\u5C01\u88C5\u547D\u540D\u800C\u5DF2\u3002</p><h3 id="enableautoconfiguration" tabindex="-1"><a class="header-anchor" href="#enableautoconfiguration" aria-hidden="true">#</a> @EnableAutoConfiguration</h3><blockquote><p>\u542F\u52A8\u81EA\u52A8\u914D\u7F6E\u529F\u80FD</p></blockquote><p>\u6838\u5FC3\u6E90\u7801\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u81EA\u52A8\u914D\u7F6E\u5305</span>
<span class="token annotation punctuation">@AutoConfigurationPackage</span>
<span class="token comment">// Spring\u7684\u5E95\u5C42\u6CE8\u89E3@Import\uFF0C\u7ED9\u5BB9\u5668\u4E2D\u5BFC\u5165\u4E00\u4E2A\u7EC4\u4EF6;</span>
<span class="token comment">// \u5BFC\u5165\u7684\u7EC4\u4EF6\u662FAutoConfigurationPackages.Registrar.class</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token comment">// \u544A\u8BC9SpringBoot\u5F00\u542F\u81EA\u52A8\u914D\u7F6E\u529F\u80FD\uFF0C\u8FD9\u6837\u81EA\u52A8\u914D\u7F6E\u624D\u80FD\u751F\u6548\u3002</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableAutoConfiguration</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * Environment property that can be used to override when auto-configuration is
     * enabled.
     */</span>
    <span class="token class-name">String</span> ENABLED_OVERRIDE_PROPERTY <span class="token operator">=</span> <span class="token string">&quot;spring.boot.enableautoconfiguration&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// \u8FD4\u56DE\u4E0D\u4F1A\u88AB\u5BFC\u5165\u5230 Spring \u5BB9\u5668\u4E2D\u7684\u7C7B</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">exclude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// \u8FD4\u56DE\u4E0D\u4F1A\u88AB\u5BFC\u5165\u5230 Spring \u5BB9\u5668\u4E2D\u7684\u7C7B\u540D</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">excludeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><code>@EnableAutoConfiguration</code>\u5C31\u662F\u501F\u52A9<code>@Import</code>\u6765\u6536\u96C6\u6240\u6709\u7B26\u5408\u81EA\u52A8\u914D\u7F6E\u6761\u4EF6\u7684 Bean \u5B9A\u4E49\uFF0C\u5E76\u52A0\u8F7D\u5230 IoC \u5BB9\u5668\u4E2D\u3002</p><blockquote><p>Spring \u4E2D\u6709\u5F88\u591A\u4EE5<code>Enable</code>\u5F00\u5934\u7684\u6CE8\u89E3\uFF0C\u5176\u4F5C\u7528\u5C31\u662F\u501F\u52A9<code>@Import</code>\u6765\u6536\u96C6\u5E76\u6CE8\u518C\u7279\u5B9A\u573A\u666F\u76F8\u5173\u7684 Bean \uFF0C\u5E76\u52A0\u8F7D\u5230 IOC \u5BB9\u5668\u4E2D\u3002</p></blockquote><h4 id="autoconfigurationpackage" tabindex="-1"><a class="header-anchor" href="#autoconfigurationpackage" aria-hidden="true">#</a> @AutoConfigurationPackage</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Spring\u7684\u5E95\u5C42\u6CE8\u89E3@Import\uFF0C\u7ED9\u5BB9\u5668\u4E2D\u5BFC\u5165\u4E00\u4E2A\u7EC4\u4EF6;</span>
<span class="token comment">// \u5BFC\u5165\u7684\u7EC4\u4EF6\u662FAutoConfigurationPackages.Registrar.class</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationPackages<span class="token punctuation">.</span>Registrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">AutoConfigurationPackage</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u8FDB\u5165\u88AB\u5BFC\u5165\u7684 <code>Registrar</code> \u7C7B\u5F53\u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Registrar</span> <span class="token keyword">implements</span> <span class="token class-name">ImportBeanDefinitionRegistrar</span><span class="token punctuation">,</span> <span class="token class-name">DeterminableImports</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// \u5C06\u6CE8\u89E3\u6807\u6CE8\u7684\u5143\u4FE1\u606F\u4F20\u5165\uFF0C\u83B7\u53D6\u5230\u76F8\u5E94\u7684\u5305\u540D</span>
		<span class="token function">register</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PackageImport</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">determineImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singleton</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PackageImport</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>\u5E94\u7528\u542F\u52A8\u65F6\uFF0C\u4F1A\u8FDB\u5165\u5230<code>Registrar</code>\u7684<code>register</code>\u65B9\u6CD5\u5F53\u4E2D\uFF0C\u8BE5\u65B9\u6CD5\u6709\u4E24\u4E2A\u53C2\u6570\uFF1A</p><ul><li>Bean\u5B9A\u4E49\u7684\u6CE8\u518C\u4E2D\u5FC3</li><li>\u6839\u636E\u6CE8\u89E3\u5143\u6570\u636E\u83B7\u53D6\u7684\u5305\u540D\uFF08\u4E5F\u5C31\u662F\u4F7F\u7528<code>@AutoConfigurationPackage</code>\u6CE8\u89E3\u7684\u7C7B, \u4E5F\u5C31\u662F\u6838\u5FC3\u542F\u52A8\u7C7B\u6240\u5728\u7684\u5305\uFF09</li></ul><p>\u7EE7\u7EED\u8FDB\u5165\u5230 <code>register</code> \u65B9\u6CD5\u5F53\u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> packageNames<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// \u8FD9\u91CC\u53C2\u6570 packageNames \u9ED8\u8BA4\u60C5\u51B5\u4E0B\u5C31\u662F\u4E00\u4E2A\u5B57\u7B26\u4E32\uFF0C\u662F\u4F7F\u7528\u4E86\u6CE8\u89E3 @SpringBootApplication \u7684 SpringBoot \u5E94\u7528\u7A0B\u5E8F\u5165\u53E3\u7C7B\u6240\u5728\u7684\u5305</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span>BEAN<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// \u5982\u679C\u8BE5 BeanDefinition \u5DF2\u7ECF\u6CE8\u518C\uFF0C\u5219\u5C06\u8981\u6CE8\u518C\u5305\u540D\u79F0\u6DFB\u52A0\u8FDB\u53BB</span>
		<span class="token class-name">BeanDefinition</span> beanDefinition <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">getBeanDefinition</span><span class="token punctuation">(</span>BEAN<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">ConstructorArgumentValues</span> constructorArguments <span class="token operator">=</span> beanDefinition<span class="token punctuation">.</span><span class="token function">getConstructorArgumentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		constructorArguments<span class="token punctuation">.</span><span class="token function">addIndexedArgumentValue</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">addBasePackages</span><span class="token punctuation">(</span>constructorArguments<span class="token punctuation">,</span> packageNames<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token comment">// \u5982\u679C\u8BE5 Bean \u5C1A\u672A\u6CE8\u518C\uFF0C\u5219\u5C06\u53C2\u6570\u4E2D\u63D0\u4F9B\u7684\u5305\u540D\u8BBE\u7F6E\u5230 BeanDefinition \u4E2D\uFF0C\u7136\u540E\u6CE8\u518C\u8BE5 BeanDefinition\uFF0C</span>
		<span class="token class-name">GenericBeanDefinition</span> beanDefinition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		beanDefinition<span class="token punctuation">.</span><span class="token function">setBeanClass</span><span class="token punctuation">(</span><span class="token class-name">BasePackages</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		beanDefinition<span class="token punctuation">.</span><span class="token function">getConstructorArgumentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addIndexedArgumentValue</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> packageNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
		beanDefinition<span class="token punctuation">.</span><span class="token function">setRole</span><span class="token punctuation">(</span><span class="token class-name">BeanDefinition</span><span class="token punctuation">.</span>ROLE_INFRASTRUCTURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		registry<span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span>BEAN<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>\u5176\u4E2D BEAN \u7684\u5B9A\u4E49\u4E3A \uFF1A <code>private static final String BEAN = AutoConfigurationPackages.class.getName();</code></p><p>\u7531\u6B64\u53EF\u89C1\uFF1A <code>Registrar</code> \u4E3B\u8981\u5C31\u5E72\u4E86\u4E00\u4EF6\u4E8B \u2014\u2014 \u6CE8\u518C\u4E86 BasePackages \u7C7B\u3002</p><p>BasePackages \u6709\u4E00\u4E2A\u53C2\u6570\uFF1A\u4F7F\u7528\u4E86 @AutoConfigurationPackage \u8FD9\u4E2A\u6CE8\u89E3\u7684\u7C7B\u6240\u5728\u7684\u5305\u8DEF\u5F84\u3002 \u4F5C\u7528\u662F\u4F9B\u4EE5\u540E\u4F7F\u7528\uFF0C\u6BD4\u5982\u7ED9 JPA entity \u626B\u63CF\u5668\uFF0C\u7528\u6765\u626B\u63CF\u5F00\u53D1\u4EBA\u5458\u901A\u8FC7\u6CE8\u89E3 @Entity \u5B9A\u4E49\u7684 entity \u7C7B\u3002</p><h4 id="import-autoconfigurationimportselector-class" tabindex="-1"><a class="header-anchor" href="#import-autoconfigurationimportselector-class" aria-hidden="true">#</a> @Import(AutoConfigurationImportSelector.class)</h4><p><code>@Import({AutoConfigurationImportSelector.class})</code>: \u5C06<code>AutoConfigurationImportSelector</code>\u8FD9\u4E2A\u7C7B\u5BFC\u5165\u5230 Spring \u5BB9\u5668\u4E2D\uFF0C <code>AutoConfigurationImportSelector</code>\u53EF\u4EE5\u5E2E\u52A9 Springboot \u5E94\u7528\u5C06\u6240\u6709\u7B26\u5408\u6761\u4EF6\u7684 <code>@Configuration</code> \u914D\u7F6E\u90FD\u52A0\u8F7D\u5230\u5F53\u524D SpringBoot \u521B\u5EFA\u548C\u4F7F\u7528\u7684 IoC \u5BB9\u5668( ApplicationContext )\u4E2D\u3002</p><p><img src="`+a+`" alt="AutoConfigurationImportSelector.png"></p><p>\u53EF\u4EE5\u770B\u51FA <code>AutoConfigurationImportSelector</code> \u5B9E\u73B0\u4E86 <code>DeferredImportSelector</code> \u63A5\u53E3\u548C\u5404\u79CD Aware \u63A5\u53E3\u3002 \u800C <code>DeferredImportSelector</code> \u63A5\u53E3\u53C8\u7EE7\u627F\u4E86 <code>ImportSelector</code> \u63A5\u53E3\u3002</p><p>\u5F88\u591A\u5176\u5B83\u7684 Aware \u63A5\u53E3\uFF0C\u5206\u522B\u8868\u793A\u5728\u67D0\u4E2A\u65F6\u673A\u4F1A\u88AB\u56DE\u8C03\u3002\u5728\u8BE5\u7C7B\u7684\u5185\u90E8\u6709\u5982\u4E0B\u53D8\u91CF\u58F0\u660E\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">Environment</span> environment<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">ClassLoader</span> beanClassLoader<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">ResourceLoader</span> resourceLoader<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u5C31\u662F\u5728\u5176\u58F0\u660E\u7684\u5404\u4E2A <code>Aware</code> \u63A5\u53E3\u7684\u8282\u70B9\u8FDB\u884C\u8D4B\u503C\u7684\u3002</p><p><strong>\u786E\u5B9A\u81EA\u52A8\u914D\u7F6E\u5B9E\u73B0\u903B\u8F91\u7684\u5165\u53E3\u65B9\u6CD5</strong></p><p>\u5B9E\u73B0\u4E86<code>DeferredImportSelector</code>\u63A5\u53E3\uFF0C\u5728 SpringBoot \u542F\u52A8\u8FC7\u7A0B\u4E2D\u5C31\u4F1A\u6267\u884C <code>DeferredImportSelectorGrouping</code> \u7C7B\u7684 <code>getImports</code> \u65B9\u6CD5\u3002 \u800C\u8DDF\u81EA\u52A8\u914D\u7F6E\u903B\u8F91\u76F8\u5173\u7684\u5165\u53E3\u65B9\u6CD5\u5C31\u5728 <code>DeferredImportSelectorGrouping</code> \u7C7B\u7684 <code>getImports</code> \u65B9\u6CD5\u5904\uFF0C \u56E0\u6B64\u6211\u4EEC\u5C31\u4ECE\u65B9\u6CD5\u6765\u5F00\u59CB\u5206\u6790SpringBoot\u7684\u81EA\u52A8\u914D\u7F6E\u6E90\u7801</p><p>\u5148\u770B\u4E00\u4E0B getImports \u65B9\u6CD5\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Group<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&gt;</span></span> <span class="token function">getImports</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">DeferredImportSelectorHolder</span> deferredImport <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deferredImports<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>group<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>deferredImport<span class="token punctuation">.</span><span class="token function">getConfigurationClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				deferredImport<span class="token punctuation">.</span><span class="token function">getImportSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>group<span class="token punctuation">.</span><span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>\u6B64\u5904\u7684 <code>this.group</code> \u662F <code>DeferredImportSelector.Group</code>, \u53EF\u89C1\u5B9E\u9645\u4E0A\u662F <code>DeferredImportSelector</code> \u7684\u5185\u90E8\u63A5\u53E3\u3002</p></blockquote><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u518D\u9010\u4E00\u5206\u6790 <code>getImports</code> \u4E2D\u8C03\u7528\u7684\u4E24\u4E2A\u65B9\u6CD5\uFF1A <code>DeferredImportSelector.Group#process</code> \u548C <code>DeferredImportSelector.Group#selectImports</code>\u3002</p><p>\u6211\u4EEC\u9996\u5148\u6765\u770B <code>DeferredImportSelector.Group#process</code> \u65B9\u6CD5\uFF1A</p><p>\u9996\u5148\u770B\u8FD9\u4E2A\u65B9\u6CD5\u7684\u4E24\u4E2A\u53C2\u6570\uFF0C\u4E00\u4E2A\u662F\u5143\u6570\u636E\u4FE1\u606F\uFF0C\u53E6\u4E00\u4E2A\u662F\u6B63\u662F <code>AutoConfigurationImportSelector</code>\uFF0C\u800C\u81EA\u52A8\u914D\u7F6E\u7684\u903B\u8F91\u6B63\u662F\u7531\u6B64\u7EC4\u4EF6\u7C7B\u5B8C\u6210\uFF0C\u5177\u4F53\u7684\u5904\u7406\u903B\u8F91\u5C31\u5728 <code>process</code> \u65B9\u6CD5\u5F53\u4E2D</p><p>\u8FDB\u5165\u5230\u5177\u4F53\u7684\u5B9E\u73B0 <code>AutoConfigurationImportSelector.AutoConfigurationGroup#process</code> \u65B9\u6CD5\u5F53\u4E2D\uFF08\u7ED5\u4E86\u4E00\u5708\uFF0C\u6700\u7EC8\u53C8\u56DE\u5230\u4E86<code>AutoConfigurationImportSelector</code>\u5F53\u4E2D\uFF09</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> annotationMetadata<span class="token punctuation">,</span> <span class="token class-name">DeferredImportSelector</span> deferredImportSelector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ... \u65AD\u8A00 ...</span>
	<span class="token comment">// 1\u3001\u8C03\u7528 getAutoConfigurationEntry \u65B9\u6CD5\u83B7\u53D6\u81EA\u52A8\u914D\u7F6E\u7C7B\uFF0C\u5B58\u5165\u53D8\u91CF autoConfigurationEntry \u4E2D</span>
	<span class="token class-name">AutoConfigurationEntry</span> autoConfigurationEntry <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">)</span> deferredImportSelector<span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">getAutoConfigurationEntry</span><span class="token punctuation">(</span><span class="token function">getAutoConfigurationMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u6211\u4EEC\u7EE7\u7EED\u8FDB\u5165\u5230 <code>AutoConfigurationImportSelector#getAutoConfigurationEntry</code> \u7684\u65B9\u6CD5\u5F53\u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">AutoConfigurationEntry</span> <span class="token function">getAutoConfigurationEntry</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationMetadata</span> autoConfigurationMetadata<span class="token punctuation">,</span>
		<span class="token class-name">AnnotationMetadata</span> annotationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isEnabled</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> EMPTY_ENTRY<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token class-name">AnnotationAttributes</span> attributes <span class="token operator">=</span> <span class="token function">getAttributes</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 1\u3001\u83B7\u53D6 META-INF/spring.factories \u6587\u4EF6\u4E2D key \u4E3A org.springframework.boot.autoconfigure.EnableAutoConfiguration \u7684\u81EA\u52A8\u914D\u7F6E\u7C7B\u5168\u8DEF\u5F84\u5217\u5217\u8868</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> configurations <span class="token operator">=</span> <span class="token function">getCandidateConfigurations</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">,</span> attributes<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u901A\u8FC7 LinkedHashSet \u7684\u7279\u6027\u5220\u9664\u91CD\u590D\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B</span>
	configurations <span class="token operator">=</span> <span class="token function">removeDuplicates</span><span class="token punctuation">(</span>configurations<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u83B7\u53D6\u9700\u8981\u6392\u9664\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B\u7684\u5168\u8DEF\u5F84\u7C7B\u540D\u5217\u8868\uFF0C\u6BD4\u5982\u6CE8\u89E3\u5C5E\u6027exclude\u7684\u914D\u7F6E\u7C7B</span>
	<span class="token comment">// \u6BD4\u5982: @SpringBootApplication(exclude = FreeMarkerAutoConfiguration.class)</span>
	<span class="token comment">// \u5C06\u4F1A\u83B7\u53D6\u5230exclude = FreeMarkerAutoConfiguration.class\u7684\u6CE8\u89E3\u6570\u636E</span>
	<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> exclusions <span class="token operator">=</span> <span class="token function">getExclusions</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">,</span> attributes<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u68C0\u67E5\u8981\u88AB\u6392\u9664\u7684\u914D\u7F6E\u7C7B\uFF0C\u5982\u679C\u6709\u975E\u81EA\u52A8\u914D\u7F6E\u7C7B\uFF0C\u8981\u629B\u51FA\u5F02\u5E38</span>
	<span class="token function">checkExcludedClasses</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 2\u3001\u5C06\u9700\u8981\u6392\u9664\u7684\u914D\u7F6E\u7C7B\u79FB\u9664</span>
	configurations<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span>exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 3\u3001\u56E0\u4E3A\u4ECEspring.factories\u6587\u4EF6\u83B7\u53D6\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B\u592A\u591A\uFF0C\u5982\u679C\u6709\u4E9B\u4E0D\u5FC5\u8981\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B\u90FD\u52A0\u8F7D\u8FDB\u5185\u5B58\uFF0C\u4F1A\u9020\u6210\u5185\u5B58\u6D6A\u8D39\uFF0C\u56E0\u6B64\u8FD9\u91CC\u9700\u8981\u8FDB\u884C\u8FC7\u6EE4</span>
	<span class="token comment">// \u6CE8\u610F\u8FD9\u91CC\u4F1A\u8C03\u7528AutoConfigurationImportFilter\u7684match\u65B9\u6CD5\u6765\u5224\u65AD\u662F\u5426\u7B26\u5408 @ConditionalOnBean, @ConditionalOnClass \u6216 @ConditionalOnWebApplication</span>
	<span class="token comment">// \u8FD9\u662F\u5F88\u806A\u660E\u7684\u4E00\u79CD\u7B56\u7565\uFF0C\u5982\u679C classpath \u4E0B\u53C8\u76F8\u5E94\u7684 jar \u5305\u624D\u81EA\u52A8\u914D\u7F6E\u548C\u6DFB\u52A0\u8FDB IoC \u5BB9\u5668\u4E2D \u{1F44D}\u{1F3FB}</span>
	configurations <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> autoConfigurationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token comment">// 4\u3001\u83B7\u53D6\u4E86\u7B26\u5408\u6761\u4EF6\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B\u540E\uFF0C\u6B64\u65F6\u89E6\u53D1AutoConfigurationImportEvent\u4E8B\u4EF6\uFF0C</span>
	<span class="token comment">// \u76EE\u7684\u662F\u544A\u8BC9 ConditionEvaluationReport \u6761\u4EF6\u8BC4\u4F30\u62A5\u544A\u5668\u5BF9\u8C61\u6765\u8BB0\u5F55\u7B26\u5408\u6761\u4EF6\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B [\u5176\u5B9E\u8FD9\u91CC\u65E0\u8DB3\u8F7B\u91CD]</span>
	<span class="token comment">// \u8BE5\u4E8B\u4EF6\u4EC0\u4E48\u65F6\u5019\u4F1A\u88AB\u89E6\u53D1?--&gt; \u5728\u5237\u65B0\u5BB9\u5668\u65F6\u8C03\u7528invokeBeanFactoryPostProcessors\u540E\u7F6E\u5904\u7406\u5668\u65F6\u89E6\u53D1</span>
	<span class="token function">fireAutoConfigurationImportEvents</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 5\u3001\u5C06\u7B26\u5408\u6761\u4EF6\u548C\u8981\u6392\u9664\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B\u5C01\u88C5\u8FDB AutoConfigurationEntry \u5BF9\u8C61\uFF0C\u5E76\u8FD4\u56DE</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AutoConfigurationEntry</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>\u65B9\u6CD5\u8FD4\u56DE\u7684\u5BF9\u8C61\u4E2D\u5305\u542B\u4E86\u9700\u8981\u81EA\u52A8\u914D\u7F6E\u7684\u7C7B\u96C6\u5408 + \u9700\u8981\u6392\u9664\u7684\u7C7B\u96C6\u5408\u3002\u6211\u4EEC\u518D\u6B21\u56DE\u5230\u65B9\u6CD5\u7684\u8C03\u7528\u5904\uFF1A<code>AutoConfigurationImportSelector.AutoConfigurationGroup#process</code> \u65B9\u6CD5\u5F53\u4E2D</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> annotationMetadata<span class="token punctuation">,</span> <span class="token class-name">DeferredImportSelector</span> deferredImportSelector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span>deferredImportSelector <span class="token keyword">instanceof</span> <span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">,</span>
			<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Only %s implementations are supported, got %s&quot;</span><span class="token punctuation">,</span>
					<span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
					deferredImportSelector<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 1\u3001\u8C03\u7528 getAutoConfigurationEntry \u65B9\u6CD5\u83B7\u53D6\u81EA\u52A8\u914D\u7F6E\u7C7B\uFF0C\u5B58\u5165\u53D8\u91CF autoConfigurationEntry \u4E2D</span>
	<span class="token class-name">AutoConfigurationEntry</span> autoConfigurationEntry <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">)</span> deferredImportSelector<span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">getAutoConfigurationEntry</span><span class="token punctuation">(</span><span class="token function">getAutoConfigurationMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 2\u3001\u5C06\u5C01\u88C5\u4E86\u81EA\u52A8\u914D\u7F6E\u7C7B\u7684 autoConfigurationEntry \u5BF9\u8C61\u6DFB\u52A0\u5230 autoConfigurationEntries \u96C6\u5408\u4E2D</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>autoConfigurationEntries<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>autoConfigurationEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 3\u3001\u904D\u5386\u521A\u83B7\u53D6\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> importClassName <span class="token operator">:</span> autoConfigurationEntry<span class="token punctuation">.</span><span class="token function">getConfigurations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// \u8FD9\u91CC\u7B26\u5408\u6761\u4EF6\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B\u4F5C\u4E3Akey\uFF0CannotationMetadata\u4F5C\u4E3A\u503C\u653E\u8FDBentries\u96C6\u5408</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>entries<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>importClassName<span class="token punctuation">,</span> annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>\u53EF\u4EE5\u770B\u5230\u5176\u5B9E\u6B64\u5904\u6CA1\u6709\u518D\u505A\u66F4\u591A\u7684\u64CD\u4F5C\u3002 \u518D\u56DE\u5230\u65B9\u6CD5\u7684\u8C03\u7528\u5904\uFF1A getImports \u65B9\u6CD5\u5F53\u4E2D\u3002</p><p>\u63A5\u4E0B\u6765\u8FDB\u5165\u5230\u4EE3\u7801 <code>return this.group.selectImports();</code> \u7684\u5B9E\u73B0 <code>AutoConfigurationImportSelector.AutoConfigurationGroup#selectImports</code> \u5F53\u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Entry</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>autoConfigurationEntries<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// \u83B7\u53D6\u6240\u6709\u8981\u6392\u9664\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B\u7684set\u96C6\u5408</span>
	<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> allExclusions <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>autoConfigurationEntries<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationEntry</span><span class="token operator">::</span><span class="token function">getExclusions</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token operator">::</span><span class="token function">stream</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u83B7\u53D6\u7ECF\u8FC7\u6EE4\u540E\u6240\u6709\u7B26\u5408\u6761\u4EF6\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B\u7684set\u96C6\u5408</span>
	<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> processedConfigurations <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>autoConfigurationEntries<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationEntry</span><span class="token operator">::</span><span class="token function">getConfigurations</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token operator">::</span><span class="token function">stream</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toCollection</span><span class="token punctuation">(</span><span class="token class-name">LinkedHashSet</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u518D\u6B21\u79FB\u9664\u6389\u8981\u6392\u9664\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B</span>
	processedConfigurations<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span>allExclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u5BF9\u6807\u6CE8\u6709@Order\u6CE8\u89E3\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B\u8FDB\u884C\u6392\u5E8F</span>
	<span class="token keyword">return</span> <span class="token function">sortAutoConfigurations</span><span class="token punctuation">(</span>processedConfigurations<span class="token punctuation">,</span> <span class="token function">getAutoConfigurationMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>importClassName<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>entries<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>importClassName<span class="token punctuation">)</span><span class="token punctuation">,</span> importClassName<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>\u53EF\u4EE5\u770B\u5230<code>selectImports</code> \u65B9\u6CD5\uFF0C\u4E3B\u8981\u662F\u5BF9\u7ECF\u8FC7exclude\u5C5E\u6027\u6392\u9664\u6389\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B\u548C\u901A\u8FC7<code>AutoConfigurationImportFilter</code>\u63A5\u53E3\u8FC7\u6EE4\u540E\u7684\u6EE1\u8DB3\u6761\u4EF6\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B, \u518D\u8FDB\u4E00\u6B65\u6392\u9664\uFF0C\u7136\u540E\u518D\u6392\u5E8F\u3002</p><blockquote><p>\u5E76\u6CA1\u6709\u505A\u4EC0\u4E48\u5B9E\u8D28\u6027\u7684\u64CD\u4F5C\uFF0C\u8FD9\u662F\u56E0\u4E3A\u5B9E\u8D28\u6027\u7684\u64CD\u4F5C\uFF0C\u6BD4\u5982\u52A0\u8F7D FactoryBean \u5230\u5BB9\u5668\u4E2D\uFF0C\u90FD\u662F\u4EA4\u7ED9\u4E86\u81EA\u52A8\u914D\u7F6E\u7C7B\u4F7F\u7528 @Bean \u6CE8\u89E3\uFF0C\u901A\u8FC7 Spring \u6765\u5B9E\u73B0\u7684</p></blockquote><p><strong>\u603B\u7ED3</strong></p><p>\u6700\u540E\uFF0C\u6211\u4EEC\u518D\u603B\u7ED3\u4E0B SpringBoot \u81EA\u52A8\u914D\u7F6E\u7684\u539F\u7406\uFF0C\u4E3B\u8981\u505A\u4E86\u4EE5\u4E0B\u4E8B\u60C5:</p><ol><li>\u4ECE<code>spring.factories</code>\u914D\u7F6E\u6587\u4EF6\u4E2D\u52A0\u8F7D\u81EA\u52A8\u914D\u7F6E\u7C7B;</li><li>\u52A0\u8F7D\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B\u4E2D\u6392\u9664\u6389<code>@EnabelAutoConfiguration</code>\u6CE8\u89E3\u7684<code>exclude</code>\u5C5E\u6027\u6307\u5B9A\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B;</li><li>\u7136\u540E\u518D\u7528<code>AutoConfigurationImportFilter</code>\u63A5\u53E3\u53BB\u8FC7\u6EE4\u81EA\u52A8\u914D\u7F6E\u7C7B\uFF0C\u770B\u662F\u5426\u7B26\u5408\u5176\u6807\u6CE8\u6CE8\u89E3(\u82E5\u6709\u6807\u6CE8\u7684\u8BDD)<code>ConditionOnXxx</code>\u7684\u6761\u4EF6\uFF0C\u82E5\u90FD\u7B26\u5408\u7684\u8BDD\u5219\u8FD4\u56DE\u5339\u914D\u7ED3\u679C;</li><li>\u7136\u540E\u89E6\u53D1<code>AutoConfigurationImportEvent</code>\u4E8B\u4EF6\uFF0C\u544A\u8BC9\u6761\u4EF6\u8BC4\u4F30\u62A5\u544A\u5668\u5BF9\u8C61\u6765\u5206\u522B\u8BB0\u5F55\u7B26\u5408\u6761\u4EF6\u7684\u548Cexclude\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B\u3002</li><li>\u6700\u540E Spring \u518D\u5C06\u6700\u540E\u7B5B\u9009\u540E\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B\u5BFC\u5165IOC\u5BB9\u5668\u4E2D\u3002</li></ol><h4 id="conditional" tabindex="-1"><a class="header-anchor" href="#conditional" aria-hidden="true">#</a> @Conditional</h4><p><code>@Conditional</code>\u662F Spring4 \u65B0\u63D0\u4F9B\u7684\u6CE8\u89E3\uFF0C\u5B83\u7684\u4F5C\u7528\u662F\u6309\u7167\u4E00\u5B9A\u7684\u6761\u4EF6\u8FDB\u884C\u5224\u65AD\uFF0C\u6EE1\u8DB3\u6761\u4EF6\u5219\u5BB9\u5668\u6CE8\u518C Bean\u3002</p><ul><li>@ConditionalOnBean:\u4EC5\u4EC5\u5728\u5F53\u524D\u4E0A\u4E0B\u6587\u4E2D\u5B58\u5728\u67D0\u4E2A\u5BF9\u8C61\u65F6\uFF0C\u624D\u4F1A\u5B9E\u4F8B\u5316\u4E00\u4E2ABean\u3002</li><li>@ConditionalOnClass:\u67D0\u4E2Aclass\u4F4D\u4E8E\u7C7B\u8DEF\u5F84\u4E0A\uFF0C\u624D\u4F1A\u5B9E\u4F8B\u5316\u4E00\u4E2ABean\u3002</li><li>@ConditionalOnExpression:\u5F53\u8868\u8FBE\u5F0F\u4E3Atrue\u7684\u65F6\u5019\uFF0C\u624D\u4F1A\u5B9E\u4F8B\u5316\u4E00\u4E2ABean\u3002\u57FA\u4E8ESpEL\u8868\u8FBE\u5F0F \u7684\u6761\u4EF6\u5224\u65AD\u3002</li><li>@ConditionalOnMissingBean:\u4EC5\u4EC5\u5728\u5F53\u524D\u4E0A\u4E0B\u6587\u4E2D\u4E0D\u5B58\u5728\u67D0\u4E2A\u5BF9\u8C61\u65F6\uFF0C\u624D\u4F1A\u5B9E\u4F8B\u5316\u4E00\u4E2ABean\u3002</li><li>@ConditionalOnMissingClass:\u67D0\u4E2Aclass\u7C7B\u8DEF\u5F84\u4E0A\u4E0D\u5B58\u5728\u7684\u65F6\u5019\uFF0C\u624D\u4F1A\u5B9E\u4F8B\u5316\u4E00\u4E2ABean\u3002</li><li>@ConditionalOnNotWebApplication:\u4E0D\u662Fweb\u5E94\u7528\uFF0C\u624D\u4F1A\u5B9E\u4F8B\u5316\u4E00\u4E2ABean\u3002</li><li>@ConditionalOnWebApplication:\u5F53\u9879\u76EE\u662F\u4E00\u4E2AWeb\u9879\u76EE\u65F6\u8FDB\u884C\u5B9E\u4F8B\u5316\u3002</li><li>@ConditionalOnNotWebApplication:\u5F53\u9879\u76EE\u4E0D\u662F\u4E00\u4E2AWeb\u9879\u76EE\u65F6\u8FDB\u884C\u5B9E\u4F8B\u5316\u3002</li><li>@ConditionalOnProperty:\u5F53\u6307\u5B9A\u7684\u5C5E\u6027\u6709\u6307\u5B9A\u7684\u503C\u65F6\u8FDB\u884C\u5B9E\u4F8B\u5316\u3002</li><li>@ConditionalOnJava:\u5F53JVM\u7248\u672C\u4E3A\u6307\u5B9A\u7684\u7248\u672C\u8303\u56F4\u65F6\u89E6\u53D1\u5B9E\u4F8B\u5316\u3002</li><li>@ConditionalOnResource:\u5F53\u7C7B\u8DEF\u5F84\u4E0B\u6709\u6307\u5B9A\u7684\u8D44\u6E90\u65F6\u89E6\u53D1\u5B9E\u4F8B\u5316\u3002</li><li>@ConditionalOnJndi:\u5728JNDI\u5B58\u5728\u7684\u6761\u4EF6\u4E0B\u89E6\u53D1\u5B9E\u4F8B\u5316\u3002</li><li>@ConditionalOnSingleCandidate:\u5F53\u6307\u5B9A\u7684Bean\u5728\u5BB9\u5668\u4E2D\u53EA\u6709\u4E00\u4E2A\uFF0C\u6216\u8005\u6709\u591A\u4E2A\u4F46\u662F\u6307\u5B9A\u4E86\u9996 \u9009\u7684Bean\u65F6\u89E6\u53D1\u5B9E\u4F8B\u5316\u3002</li></ul><h4 id="\u81EA\u52A8\u914D\u7F6E\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#\u81EA\u52A8\u914D\u7F6E\u4F7F\u7528" aria-hidden="true">#</a> \u81EA\u52A8\u914D\u7F6E\u4F7F\u7528</h4><p>\u5728 SpringMVC \u9879\u76EE\u4E2D\uFF0C\u901A\u5E38\u9664\u4E86\u914D\u7F6E\u524D\u7AEF\u63A7\u5236\u5668\u5916\u8FD8\u9700\u8981\u914D\u7F6E\u5B57\u7B26\u7F16\u7801\u8FC7\u6EE4\u5668 characterEncodingFilter\u3002\u4EE5\u6B64\u4E3A\u4F8B\uFF0C\u770B\u770B\u5728 SpringBoot \u4E2D\u5982\u4F55\u5B9E\u73B0\u81EA\u52A8\u914D\u7F6E\u7684\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token comment">// 1\u3001\u542F\u52A8\u6307\u5B9A\u7C7B\u7684ConfigurationProperties\u6279\u91CF\u914D\u7F6E\u529F\u80FD; 2\u3001\u5C06\u914D\u7F6E\u6587\u4EF6\u4E2D\u5BF9\u5E94\u7684\u503C\u548C HttpProperties \u7ED1\u5B9A\u8D77\u6765;</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">HttpProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token comment">// \u5224\u65AD\u5F53\u524D\u5E94\u7528\u662F\u5426\u662Fweb\u5E94\u7528\uFF0C\u5982\u679C\u662F\u5219\u5F53\u524D\u914D\u7F6E\u7C7B\u751F\u6548\uFF0C\u5E76\u628A HttpProperties \u52A0\u5165\u5230 IoC \u5BB9\u5668\u4E2D</span>
<span class="token annotation punctuation">@ConditionalOnWebApplication</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">ConditionalOnWebApplication<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span>SERVLET<span class="token punctuation">)</span>
<span class="token comment">// \u5224\u65AD\u5F53\u524D\u9879\u76EE\u6709\u6CA1\u6709\u8FD9\u4E2ACharacterEncodingFilter(SpringMVC\u4E2D\u8FDB\u884C\u4E71\u7801\u89E3\u51B3\u7684\u8FC7\u6EE4\u5668)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">CharacterEncodingFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token comment">// \u5224\u65AD\u914D\u7F6E\u6587\u4EF6\u4E2D\u662F\u5426\u5B58\u5728\u67D0\u4E2A\u914D\u7F6E spring.http.encoding.enabled</span>
<span class="token comment">// \u5982\u679C\u4E0D\u5B58\u5728\uFF0C\u5224\u65AD\u4E5F\u662F\u6210\u7ACB\u7684, matchIfMissing = true \u8868\u793A\u5373\u4F7F\u6211\u4EEC\u914D\u7F6E\u6587\u4EF6\u4E2D\u4E0D\u914D\u7F6E\u5219\u9ED8\u8BA4\u4E3A\uFF1A spring.http.encoding.enabled=true</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.http.encoding&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;enabled&quot;</span><span class="token punctuation">,</span> matchIfMissing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HttpEncodingAutoConfiguration</span> <span class="token punctuation">{</span>

	<span class="token comment">// \u5B83\u5DF2\u7ECF\u548CSpringBoot\u914D\u7F6E\u6587\u4EF6\u4E2D\u7684\u503C\u8FDB\u884C\u6620\u5C04\u4E86</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">HttpProperties<span class="token punctuation">.</span>Encoding</span> properties<span class="token punctuation">;</span>

	<span class="token comment">// \u53EA\u6709\u4E00\u4E2A\u6709\u53C2\u6784\u9020\u5668\u7684\u60C5\u51B5\u4E0B\uFF0C\u53C2\u6570\u7684\u503C\u5C31\u4F1A\u4ECE\u5BB9\u5668\u4E2D\u62FF</span>
	<span class="token keyword">public</span> <span class="token class-name">HttpEncodingAutoConfiguration</span><span class="token punctuation">(</span><span class="token class-name">HttpProperties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>properties <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Bean</span>
    <span class="token comment">// \u5982\u679C\u5F53\u524D\u5BB9\u5668\u4E2D\u6CA1\u6709\u5B57\u7B26\u7F16\u7801\u8FC7\u6EE4\u5668\u624D\u6DFB\u52A0</span>
	<span class="token annotation punctuation">@ConditionalOnMissingBean</span>
	<span class="token keyword">public</span> <span class="token class-name">CharacterEncodingFilter</span> <span class="token function">characterEncodingFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">CharacterEncodingFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderedCharacterEncodingFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		filter<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">getCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		filter<span class="token punctuation">.</span><span class="token function">setForceRequestEncoding</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">shouldForce</span><span class="token punctuation">(</span><span class="token class-name">Type</span><span class="token punctuation">.</span>REQUEST<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		filter<span class="token punctuation">.</span><span class="token function">setForceResponseEncoding</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">shouldForce</span><span class="token punctuation">(</span><span class="token class-name">Type</span><span class="token punctuation">.</span>RESPONSE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> filter<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">LocaleCharsetMappingsCustomizer</span> <span class="token function">localeCharsetMappingsCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LocaleCharsetMappingsCustomizer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h4 id="\u7CBE\u9AD3" tabindex="-1"><a class="header-anchor" href="#\u7CBE\u9AD3" aria-hidden="true">#</a> \u7CBE\u9AD3</h4><ol><li>SpringBoot \u542F\u52A8\u4F1A\u52A0\u8F7D\u5927\u91CF\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B</li><li>\u6211\u4EEC\u770B\u6211\u4EEC\u9700\u8981\u5B9E\u73B0\u7684\u529F\u80FD\u6709\u6CA1\u6709 SpringBoot \u9ED8\u8BA4\u5199\u597D\u7684\u81EA\u52A8\u914D\u7F6E\u7C7B</li><li>\u6211\u4EEC\u518D\u6765\u770B\u8FD9\u4E2A\u81EA\u52A8\u914D\u7F6E\u7C7B\u4E2D\u5230\u5E95\u914D\u7F6E\u4E86\u54EA\u4E9B\u7EC4\u4EF6;(\u53EA\u8981\u6211\u4EEC\u6709\u6211\u4EEC\u8981\u7528\u7684\u7EC4\u4EF6\uFF0C\u6211\u4EEC\u5C31\u4E0D\u9700\u8981\u518D\u914D\u7F6E\u4E86)</li><li>\u7ED9\u5BB9\u5668\u4E2D\u81EA\u52A8\u914D\u7F6E\u7C7B\u6DFB\u52A0\u7EC4\u4EF6\u7684\u65F6\u5019\uFF0C\u4F1A\u4ECE properties \u7C7B\u4E2D\u83B7\u53D6\u67D0\u4E9B\u5C5E\u6027\uFF0C\u6211\u4EEC\u5C31\u53EF\u4EE5\u5728\u914D\u7F6E\u6587\u4EF6\u4E2D\u6307\u5B9A\u8FD9\u4E9B\u5C5E\u6027\u7684\u503C\u3002</li></ol><ul><li>xxxAutoConfiguration :\u81EA\u52A8\u914D\u7F6E\u7C7B\uFF0C\u7528\u4E8E\u7ED9\u5BB9\u5668\u4E2D\u6DFB\u52A0\u7EC4\u4EF6\u4ECE\u800C\u4EE3\u66FF\u4E4B\u524D\u6211\u4EEC\u624B\u52A8\u5B8C\u6210\u5927\u91CF\u7E41\u7410\u7684\u914D\u7F6E\u3002</li><li>xxxProperties : \u5C01\u88C5\u4E86\u5BF9\u5E94\u81EA\u52A8\u914D\u7F6E\u7C7B\u7684\u9ED8\u8BA4\u5C5E\u6027\u503C\uFF0C\u5982\u679C\u6211\u4EEC\u9700\u8981\u81EA\u5B9A\u4E49\u5C5E\u6027\u503C\uFF0C\u53EA\u9700\u8981\u6839\u636E xxxProperties \u5BFB\u627E\u76F8\u5173\u5C5E\u6027\u5728\u914D\u7F6E\u6587\u4EF6\u8BBE\u503C\u5373\u53EF\u3002</li></ul><h3 id="componentscan" tabindex="-1"><a class="header-anchor" href="#componentscan" aria-hidden="true">#</a> @ComponentScan</h3><p>\u4E3B\u8981\u662F\u4ECE\u5B9A\u4E49\u7684\u626B\u63CF\u8DEF\u5F84\u4E2D\uFF0C\u627E\u51FA\u6807\u8BC6\u4E86\u9700\u8981\u88C5\u914D\u7684\u7C7B\u81EA\u52A8\u88C5\u914D\u5230 Spring \u7684 Bean \u5BB9\u5668\u4E2D\u3002</p><p>\u5E38\u7528\u5C5E\u6027\u5982\u4E0B:</p><ul><li>basePackages\u3001value: \u6307\u5B9A\u626B\u63CF\u8DEF\u5F84\uFF0C\u5982\u679C\u4E3A\u7A7A\u5219\u4EE5@ComponentScan\u6CE8\u89E3\u7684\u7C7B\u6240\u5728\u7684\u5305\u4E3A\u57FA \u672C\u7684\u626B\u63CF\u8DEF\u5F84</li><li>basePackageClasses: \u6307\u5B9A\u5177\u4F53\u626B\u63CF\u7684\u7C7B</li><li>includeFilters: \u52A0\u8F7D\u6307\u5B9A Filter \u6761\u4EF6\u7684\u7C7B</li><li>excludeFilters: \u6392\u9664\u6307\u5B9A Filter \u6761\u4EF6\u7684\u7C7B</li></ul><p>@ComponentScan\u7684\u914D\u7F6E\u5982\u4E0B:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>CUSTOM<span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">TypeExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>CUSTOM<span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">AutoConfigurationExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>\u501F\u52A9<code>excludeFilters</code>\u5C06 <code>TypeExcludeFilter</code> \u53CA <code>AutoConfigurationExcludeFilter</code> \u8FD9\u4E24\u4E2A\u7C7B\u8FDB\u884C\u6392\u9664</p></blockquote><p>\u5F53\u524D<code>@ComponentScan</code>\u6CE8\u89E3\u6CA1\u6709\u6807\u6CE8 <code>basePackages</code> \u53CA <code>value</code>\uFF0C\u6240\u4EE5\u626B\u63CF\u8DEF\u5F84\u9ED8\u8BA4\u4E3A<code>@ComponentScan</code>\u6CE8\u89E3\u7684\u7C7B\u6240\u5728\u7684\u5305\u4E3A\u57FA\u672C\u626B\u63CF\u8DEF\u5F84 (\u4E5F\u5C31\u662F\u6807\u6CE8\u4E86<code>@SpringBootApplication</code>\u6CE8\u89E3\u7684\u9879\u76EE\u542F\u52A8\u7C7B\u6240\u5728\u7684\u8DEF\u5F84)</p><hr><h2 id="run\u65B9\u6CD5\u6267\u884C\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#run\u65B9\u6CD5\u6267\u884C\u6D41\u7A0B" aria-hidden="true">#</a> Run\u65B9\u6CD5\u6267\u884C\u6D41\u7A0B</h2><blockquote><p>\u95EE\u9898\u4E09: <code>@EnableAutoConfiguration</code>\u6CE8\u89E3\u662F\u901A\u8FC7<code>@Import</code>\u6CE8\u89E3\u52A0\u8F7D\u4E86\u81EA\u52A8\u914D\u7F6E\u7684 Bean, <code>@ComponentScan</code>\u6CE8\u89E3\u8FDB\u884C\u6CE8\u89E3\u626B\u63CF;</p><p>\u90A3\u4E48\u771F\u6B63\u6839\u636E\u5305\u626B\u63CF\uFF0C\u628A\u7EC4\u4EF6\u7C7B\u751F\u6210\u5B9E\u4F8B\u5BF9\u8C61\u5B58\u5230IOC\u5BB9\u5668\u4E2D\u662F\u5982\u4F55\u5B9E\u73B0\u7684?</p></blockquote><p>SpringBoot \u9879\u76EE\u7684<code>main</code>\u65B9\u6CD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u6807\u6CE8\u4E00\u4E2A\u4E3B\u7A0B\u5E8F\u7C7B\uFF0C\u8BF4\u660E\u8FD9\u662F\u4E00\u4E2A SpringBoot \u5E94\u7528</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBootTest2Application</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SpringBootTest2Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u8FDB\u5165 run \u65B9\u6CD5\u5F53\u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> primarySource<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> primarySource <span class="token punctuation">}</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

<span class="token comment">// \u7EE7\u7EED\u8FDB\u5165\u91CD\u8F7D\u65B9\u6CD5</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> primarySources<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 1\u3001\u521D\u59CB\u5316SpringApplication\uFF0C2\u3001\u6267\u884Crun\u65B9\u6CD5</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">(</span>primarySources<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="springapplication" tabindex="-1"><a class="header-anchor" href="#springapplication" aria-hidden="true">#</a> SpringApplication()</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> primarySources<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> primarySources<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u7EE7\u7EED\u8FDB\u5165 this \u65B9\u6CD5\u5F53\u4E2D</span>

<span class="token keyword">public</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">(</span><span class="token class-name">ResourceLoader</span> resourceLoader<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> primarySources<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// \u8BBE\u7F6E\u8D44\u6E90\u52A0\u8F7D\u5668\u4E3A null</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader <span class="token operator">=</span> resourceLoader<span class="token punctuation">;</span>
	<span class="token comment">// \u65AD\u8A00\u52A0\u8F7D\u8D44\u6E90\u7C7B\u4E0D\u80FD\u4E3Anull\uFF08\u6B64\u65F6\u7684\u8D44\u6E90\u7C7B\u5B9E\u9645\u4E0A\u5C31\u662F\u6838\u5FC3\u542F\u52A8\u7C7B\u7684 Class\uFF09</span>
	<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>primarySources<span class="token punctuation">,</span> <span class="token string">&quot;PrimarySources must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//\u5C06primarySources\u6570\u7EC4\u8F6C\u6362\u4E3AList\uFF0C\u6700\u540E\u653E\u5230LinkedHashSet\u96C6\u5408\u4E2D</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>primarySources <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>primarySources<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//\u30101.1 \u901A\u8FC7\u7C7B\u8DEF\u5F84\u4E0B\u7684 class \u63A8\u65AD\u5E94\u7528\u7C7B\u578B\uFF0C\u540E\u9762\u4F1A\u6839\u636E\u7C7B\u578B\u521D\u59CB\u5316\u5BF9\u5E94\u7684\u73AF\u5883\u3002\u5E38\u7528\u7684\u4E00\u822C\u90FD\u662Fservlet\u73AF\u5883 \u3011</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>webApplicationType <span class="token operator">=</span> <span class="token class-name">WebApplicationType</span><span class="token punctuation">.</span><span class="token function">deduceFromClasspath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//\u30101.2 \u521D\u59CB\u5316 classpath/META-INF/spring.factories \u4E2D\u5DF2\u914D\u7F6E\u7684 ApplicationContextInitializer \u3011</span>
	<span class="token function">setInitializers</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token punctuation">)</span> <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContextInitializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//\u30101.3 \u521D\u59CB\u5316classpath\u4E0B\u6240\u6709\u5DF2\u914D\u7F6E\u7684 ApplicationListener \u3011</span>
	<span class="token function">setListeners</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token punctuation">)</span> <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">ApplicationListener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//\u30101.4 \u6839\u636E\u8C03\u7528\u6808\uFF0C\u63A8\u65AD\u51FA main \u65B9\u6CD5\u6240\u5728\u7C7B\u7684\u7C7B\u540D \u3011</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>mainApplicationClass <span class="token operator">=</span> <span class="token function">deduceMainApplicationClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>\u63A5\u4E0B\u6765\u4F9D\u6B21\u6765\u770B\u6838\u5FC3\u7684\u56DB\u4E2A\u65B9\u6CD5</p><p><strong>deduceFromClasspath</strong></p><blockquote><p>\u6839\u636E\u7C7B\u8DEF\u5F84\u4E0B\u7684 Class \u63A8\u65AD\u662F\u666E\u901A MVC \u5E94\u7528\u8FD8\u662F Reactive \u5E94\u7528</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token class-name">WebApplicationType</span> <span class="token function">deduceFromClasspath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// classpath\u4E0B\u5FC5\u987B\u5B58\u5728 org.springframework.web.reactive.DispatcherHandler</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span>WEBFLUX_INDICATOR_CLASS<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span>WEBMVC_INDICATOR_CLASS<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
			<span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span>JERSEY_INDICATOR_CLASS<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token class-name">WebApplicationType</span><span class="token punctuation">.</span>REACTIVE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> className <span class="token operator">:</span> SERVLET_INDICATOR_CLASSES<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token class-name">WebApplicationType</span><span class="token punctuation">.</span>NONE<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// classpath\u73AF\u5883\u4E0B\u5B58\u5728 javax.servlet.Servlet \u6216\u8005 org.springframework.web.context.ConfigurableWebApplicationContext</span>
	<span class="token keyword">return</span> <span class="token class-name">WebApplicationType</span><span class="token punctuation">.</span>SERVLET<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>getSpringFactoriesInstances</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// Use names and ensure unique to protect against duplicates</span>
	<span class="token comment">// \u901A\u8FC7\u6307\u5B9A\u7684classLoader\u4ECE META-INF/spring.factories \u7684\u8D44\u6E90\u6587\u4EF6\u4E2D\u83B7\u53D6\u6240\u6709\u7684key\u662F type \u7684\u7C7B\u7684\u5168\u8DEF\u5F84\u5217\u8868</span>
	<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> names <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">SpringFactoriesLoader</span><span class="token punctuation">.</span><span class="token function">loadFactoryNames</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u901A\u8FC7\u53CD\u5C04\u7ED9 Set \u4E2D\u6240\u6709\u7684\u7C7B\u751F\u6210\u5B9E\u4F8B\u5316\u5BF9\u8C61</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> instances <span class="token operator">=</span> <span class="token function">createSpringFactoriesInstances</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> parameterTypes<span class="token punctuation">,</span> classLoader<span class="token punctuation">,</span> args<span class="token punctuation">,</span> names<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u5BF9Spring\u5DE5\u5382\u5B9E\u4F8B\u6392\u5E8F(org.springframework.core.annotation.Order\u6CE8\u89E3\u6307\u5B9A\u7684\u987A\u5E8F)</span>
	<span class="token class-name">AnnotationAwareOrderComparator</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>instances<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u8FD4\u56DE\u5B9E\u4F8B\u5316\u5BF9\u8C61\u96C6\u5408</span>
	<span class="token keyword">return</span> instances<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p>\u7B2C\u4E8C\u6B65\u548C\u7B2C\u4E09\u6B65\u90FD\u662F\u8C03\u7528\u4E86\u8FD9\u4E2A\u65B9\u6CD5\uFF0C\u83B7\u53D6\u5230\u4E86\u5728\u914D\u7F6E\u6587\u4EF6<code>spring.factories</code>\u4E2D\u914D\u7F6E\u7684<code>ApplicationListener</code>\u548C<code>ApplicationContextInitializer</code>\u7684\u5B9E\u4F8B\u5316\u5BF9\u8C61\u96C6\u5408</p></blockquote><blockquote><p><code>ApplicationContextInitializer</code>\u662FSpring\u6846\u67B6\u7684\u7C7B, \u8FD9\u4E2A\u7C7B\u7684\u4E3B\u8981\u76EE\u7684\u5C31\u662F\u5728<code>ConfigurableApplicationContext</code>\u8C03\u7528<code>refresh()</code>\u65B9\u6CD5\u4E4B\u524D\uFF0C \u56DE\u8C03\u8FD9\u4E2A\u7C7B\u7684<code>initialize</code>\u65B9\u6CD5\u3002</p></blockquote><p><strong>\u603B\u7ED3</strong></p><p>\u5173\u4E8E<code>SpringApplication</code>\u7C7B\u7684\u6784\u9020\u8FC7\u7A0B\uFF0C\u5230\u8FD9\u91CC\u6211\u4EEC\u5C31\u68B3\u7406\u5B8C\u4E86\u3002\u7EB5\u89C2<code>SpringApplication</code>\u7C7B\u7684\u5B9E\u4F8B\u5316\u8FC7\u7A0B\uFF0C\u6211\u4EEC\u53EF\u4EE5\u770B\u5230\uFF0C \u5408\u7406\u7684\u5229\u7528\u8BE5\u7C7B\uFF0C\u6211\u4EEC\u80FD\u5728<code>Spring</code>\u5BB9\u5668\u521B\u5EFA\u4E4B\u524D\u505A\u4E00\u4E9B\u9884\u5907\u5DE5\u4F5C\uFF0C\u548C\u5B9A\u5236\u5316\u7684\u9700\u6C42\u3002</p><h3 id="run-args" tabindex="-1"><a class="header-anchor" href="#run-args" aria-hidden="true">#</a> run(args)</h3><p>\u4E0A\u4E00\u8282\u6211\u4EEC\u67E5\u770B\u4E86 SpringApplication \u7C7B\u7684\u5B9E\u4F8B\u5316\u8FC7\u7A0B\uFF0C\u8FD9\u4E00\u8282\u603B\u7ED3SpringBoot\u542F\u52A8\u6D41\u7A0B\u6700\u91CD\u8981\u7684\u90E8\u5206 \u2014\u2014 <code>run</code>\u65B9\u6CD5\u3002 \u901A\u8FC7run\u65B9\u6CD5\u68B3\u7406\u51FASpringBoot\u542F\u52A8\u7684\u6D41\u7A0B\u3002</p><blockquote><p>\u7ECF\u8FC7\u6DF1\u5165\u5206\u6790\u540E\uFF0C\u5927\u5BB6\u4F1A\u53D1\u73B0 SpringBoot \u4E5F\u5C31\u662F\u7ED9 Spring \u5305\u4E86\u4E00\u5C42\u76AE\uFF0C\u4E8B\u5148\u66FF\u6211\u4EEC\u51C6\u5907\u597D Spring \u6240\u9700\u8981\u7684\u73AF\u5883\u53CA\u4E00\u4E9B\u57FA\u7840\u3002</p></blockquote><p>\u8FDB\u5165 <code>run</code> \u65B9\u6CD5\u5F53\u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// \u8BB0\u5F55\u7A0B\u5E8F\u8FD0\u884C\u65F6\u95F4</span>
	<span class="token class-name">StopWatch</span> stopWatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StopWatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	stopWatch<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// ConfigurableApplicationContext \u662F ApplicationContext \u63A5\u53E3\u7684\u5B50\u63A5\u53E3\u3002\u5728ApplicationContext \u57FA\u7840\u4E0A\u589E\u52A0\u4E86\u914D\u7F6E\u4E0A\u4E0B\u6587\u7684\u5DE5\u5177\u3002</span>
	<span class="token comment">// ConfigurableApplicationContext \u662F\u5BB9\u5668\u7684\u9AD8\u7EA7\u63A5\u53E3\u3002</span>
	<span class="token class-name">ConfigurableApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpringBootExceptionReporter</span><span class="token punctuation">&gt;</span></span> exceptionReporters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">configureHeadlessProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 1\u3001\u83B7\u53D6\u5E76\u542F\u52A8\u76D1\u542C\u5668</span>
	<span class="token class-name">SpringApplicationRunListeners</span> listeners <span class="token operator">=</span> <span class="token function">getRunListeners</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	listeners<span class="token punctuation">.</span><span class="token function">starting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token class-name">ApplicationArguments</span> applicationArguments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultApplicationArguments</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 2\u3001\u6784\u9020\u5E94\u7528\u4E0A\u4E0B\u6587\u73AF\u5883</span>
		<span class="token class-name">ConfigurableEnvironment</span> environment <span class="token operator">=</span> <span class="token function">prepareEnvironment</span><span class="token punctuation">(</span>listeners<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// \u5904\u7406\u9700\u8981\u5FFD\u7565\u7684 Bean</span>
		<span class="token function">configureIgnoreBeanInfo</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// \u6253\u5370banner</span>
		<span class="token class-name">Banner</span> printedBanner <span class="token operator">=</span> <span class="token function">printBanner</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 3\u3001\u521D\u59CB\u5316\u5E94\u7528\u4E0A\u4E0B\u6587</span>
		context <span class="token operator">=</span> <span class="token function">createApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// \u5B9E\u4F8B\u5316 SpringBootExceptionReporter\u7C7B\uFF0C\u7528\u6765\u652F\u6301\u62A5\u544A\u5173\u4E8E\u542F\u52A8\u7684\u9519\u8BEF</span>
		exceptionReporters <span class="token operator">=</span> <span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">SpringBootExceptionReporter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
				<span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 4\u3001\u5237\u65B0\u5E94\u7528\u4E0A\u4E0B\u6587\u524D\u7684\u51C6\u5907\u9636\u6BB5</span>
		<span class="token function">prepareContext</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> environment<span class="token punctuation">,</span> listeners<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">,</span> printedBanner<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 5\u3001\u5237\u65B0\u5E94\u7528\u4E0A\u4E0B\u6587</span>
		<span class="token function">refreshContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// \u5237\u65B0\u5E94\u7528\u4E0A\u4E0B\u6587\u540E\u7684\u6269\u5C55\u63A5\u53E3</span>
		<span class="token function">afterRefresh</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// \u65F6\u95F4\u8BB0\u5F55\u505C\u6B62</span>
		stopWatch<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>logStartupInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">new</span> <span class="token class-name">StartupInfoLogger</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mainApplicationClass<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logStarted</span><span class="token punctuation">(</span><span class="token function">getApplicationLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stopWatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// \u53D1\u5E03\u5BB9\u5668\u542F\u52A8\u5B8C\u6210\u4E8B\u4EF6</span>
		listeners<span class="token punctuation">.</span><span class="token function">started</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">callRunners</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// catch * n ...</span>
	<span class="token keyword">return</span> context<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><blockquote><p>\u5728\u4EE5\u4E0A\u7684\u4EE3\u7801\u4E2D\uFF0C\u542F\u52A8\u8FC7\u7A0B\u4E2D\u7684\u91CD\u8981\u6B65\u9AA4\u5171\u5206\u4E3A\u516D\u6B65</p><p>\u7B2C\u4E00\u6B65:\u83B7\u53D6\u5E76\u542F\u52A8\u76D1\u542C\u5668</p><p>\u7B2C\u4E8C\u6B65:\u6784\u9020\u5E94\u7528\u4E0A\u4E0B\u6587\u73AF\u5883</p><p>\u7B2C\u4E09\u6B65:\u521D\u59CB\u5316\u5E94\u7528\u4E0A\u4E0B\u6587</p><p>\u7B2C\u56DB\u6B65:\u5237\u65B0\u5E94\u7528\u4E0A\u4E0B\u6587\u524D\u7684\u51C6\u5907\u9636\u6BB5 \u3010\u91CD\u8981\u3011</p><p>\u7B2C\u4E94\u6B65:\u5237\u65B0\u5E94\u7528\u4E0A\u4E0B\u6587 \u3010\u91CD\u8981\u3011</p><p>\u7B2C\u516D\u6B65:\u5237\u65B0\u5E94\u7528\u4E0A\u4E0B\u6587\u540E\u7684\u6269\u5C55\u63A5\u53E3</p></blockquote><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u5C06\u6839\u636E\u8FD96\u5927\u6B65\u9AA4\u8FDB\u884C\u8BE6\u7EC6\u89E3\u8BFB\u3002\u5176\u4E2D\u6700\u91CD\u8981\u7684\u662F\u7B2C\u56DB\u3001\u4E94\u6B65\uFF0C\u6211\u4EEC\u4F1A\u7740\u91CD\u7684\u5206\u6790\u3002</p><h4 id="\u7B2C\u4E00\u6B65-\u83B7\u53D6\u5E76\u542F\u52A8\u76D1\u542C\u5668" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E00\u6B65-\u83B7\u53D6\u5E76\u542F\u52A8\u76D1\u542C\u5668" aria-hidden="true">#</a> \u7B2C\u4E00\u6B65:\u83B7\u53D6\u5E76\u542F\u52A8\u76D1\u542C\u5668</h4><p><strong>\u83B7\u53D6\u76D1\u542C\u5668</strong></p><p>\u8FDB\u5165\u7B2C\u4E00\u6B65\u7684\u4EE3\u7801\u5F53\u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">SpringApplicationRunListeners</span> <span class="token function">getRunListeners</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> types <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment">// SpringApplicationRunListeners \u8D1F\u8D23\u5728 SpringBoot \u542F\u52A8\u7684\u4E0D\u540C\u9636\u6BB5\u5E7F\u64AD\u4E0D\u540C\u7684\u6D88\u606F\uFF0C\u4F20\u9012\u7ED9 ApplicationListener \u76D1\u542C\u5668\u5B9E\u73B0\u7C7B</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SpringApplicationRunListeners</span><span class="token punctuation">(</span>logger<span class="token punctuation">,</span>
			<span class="token comment">// \u4ECE META-INF/spring.factories \u7684\u8D44\u6E90\u6587\u4EF6\u4E2D\u83B7\u53D6\u6240\u6709\u7684key\u662F SpringApplicationRunListener \u7684\u7C7B\u5E76\u751F\u6210\u5B9E\u4F8B\u5316\u5BF9\u8C61</span>
			<span class="token function">getSpringFactoriesInstances</span><span class="token punctuation">(</span><span class="token class-name">SpringApplicationRunListener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> types<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u901A\u8FC7 <code>getSpringFactoriesInstances</code> \u65B9\u6CD5\u83B7\u53D6\u5230\u914D\u7F6E\u6587\u4EF6\u4E2Dkey\u662F<code>SpringApplicationRunListener</code>\u7684\u6240\u6709\u5B9E\u4F8B\u5316\u5BF9\u8C61\u3002 \u6211\u4EEC\u7EE7\u7EED\u8FDB\u5165 SpringApplicationRunListeners \u7684\u6709\u53C2\u6784\u9020\u65B9\u6CD5\u5F53\u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">SpringApplicationRunListeners</span><span class="token punctuation">(</span><span class="token class-name">Log</span> log<span class="token punctuation">,</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">SpringApplicationRunListener</span><span class="token punctuation">&gt;</span></span> listeners<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>log <span class="token operator">=</span> log<span class="token punctuation">;</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>listeners <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>listeners<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u6B64\u5904\u7684\u4EE3\u7801\u5341\u5206\u7B80\u5355\uFF0C\u65E0\u975E\u5C31\u662F\u628A log \u5DE5\u5177\u548C\u521A\u521A\u83B7\u53D6\u5230\u7684 Listener \u5B9E\u4F8B\u5BF9\u8C61\u96C6\u5408\u8D4B\u503C\u7ED9\u5BF9\u8C61</p><p><strong>\u542F\u52A8\u76D1\u542C\u5668</strong></p><p>\u83B7\u53D6\u5B8C\u76D1\u542C\u5668\uFF0C\u6211\u4EEC\u7EE7\u7EED\u8FDB\u5165\u542F\u52A8\u76D1\u542C\u5668\u7684\u65B9\u6CD5\u5F53\u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">starting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SpringApplicationRunListener</span> listener <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listeners<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		listener<span class="token punctuation">.</span><span class="token function">starting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u8FD9\u91CC\u66F4\u52A0\u7B80\u5355\uFF0C\u5C31\u662F\u5C06\u83B7\u53D6\u5230\u7684 Listener \u5B9E\u4F8B\u5316\u5BF9\u8C61\u96C6\u5408\u4F9D\u6B21\u8C03\u7528<code>starting</code>\u65B9\u6CD5\u542F\u52A8\u3002</p><p><strong>\u603B\u7ED3</strong></p><p>\u4E8B\u4EF6\u673A\u5236\u5728Spring\u662F\u5F88\u91CD\u8981\u7684\u4E00\u90E8\u5206\u5185\u5BB9\uFF0C\u901A\u8FC7\u4E8B\u4EF6\u673A\u5236\u6211\u4EEC\u53EF\u4EE5\u76D1\u542CSpring\u5BB9\u5668\u4E2D\u6B63\u5728\u53D1\u751F\u7684\u4E00\u4E9B\u4E8B\u4EF6\uFF0C\u540C\u6837\u4E5F\u53EF\u4EE5\u81EA\u5B9A\u4E49\u76D1\u542C\u4E8B\u4EF6\u3002</p><p>Spring\u7684\u4E8B\u4EF6\u4E3ABean\u548CBean\u4E4B\u95F4\u7684\u6D88\u606F\u4F20\u9012\u63D0\u4F9B\u652F\u6301\u3002</p><p>\u5F53\u4E00\u4E2A\u5BF9\u8C61\u5904\u7406\u5B8C\u67D0\u79CD\u4EFB\u52A1\u540E\uFF0C\u901A\u77E5\u53E6\u5916\u7684\u5BF9\u8C61\u8FDB\u884C\u67D0\u4E9B\u5904\u7406\uFF0C\u5E38\u7528\u7684\u573A\u666F\u6709\u8FDB\u884C\u67D0\u4E9B\u64CD\u4F5C\u540E\u53D1\u9001\u901A\u77E5\uFF0C\u6D88\u606F\u3001\u90AE\u4EF6\u7B49\u60C5\u51B5\u3002</p><h4 id="\u7B2C\u4E8C\u6B65-\u6784\u9020\u5E94\u7528\u4E0A\u4E0B\u6587\u73AF\u5883" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E8C\u6B65-\u6784\u9020\u5E94\u7528\u4E0A\u4E0B\u6587\u73AF\u5883" aria-hidden="true">#</a> \u7B2C\u4E8C\u6B65:\u6784\u9020\u5E94\u7528\u4E0A\u4E0B\u6587\u73AF\u5883</h4><blockquote><p>\u5E94\u7528\u4E0A\u4E0B\u6587\u73AF\u5883\u5305\u62EC\u4EC0\u4E48\u5462?</p><p>\u5305\u62EC\u8BA1\u7B97\u673A\u7684\u73AF\u5883\uFF0CJava\u73AF\u5883\uFF0CSpring\u7684\u8FD0\u884C\u73AF\u5883\uFF0CSpring\u9879\u76EE\u7684\u914D\u7F6E(\u5728SpringBoot\u4E2D\u5C31\u662F\u90A3\u4E2A\u719F\u6089\u7684application.properties/yml)\u7B49\u7B49\u3002</p></blockquote><p>\u660E\u786E\u4E86\u5E94\u7528\u4E0A\u4E0B\u6587\u73AF\u5883\u7684\u5B9A\u4E49\u540E\uFF0C\u6211\u4EEC\u8FDB\u5165\u6784\u9020\u5E94\u7528\u4E0A\u4E0B\u6587\u73AF\u5883\u7684\u65B9\u6CD5\u5F53\u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">ConfigurableEnvironment</span> <span class="token function">prepareEnvironment</span><span class="token punctuation">(</span><span class="token class-name">SpringApplicationRunListeners</span> listeners<span class="token punctuation">,</span>
		<span class="token class-name">ApplicationArguments</span> applicationArguments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// Create and configure the environment</span>
	<span class="token comment">// \u521B\u5EFA\u5E76\u914D\u7F6E\u76F8\u5E94\u7684\u73AF\u5883</span>
	<span class="token class-name">ConfigurableEnvironment</span> environment <span class="token operator">=</span> <span class="token function">getOrCreateEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u6839\u636E\u7528\u6237\u914D\u7F6E\uFF0C\u914D\u7F6E environment\u7CFB\u7EDF\u73AF\u5883</span>
	<span class="token function">configureEnvironment</span><span class="token punctuation">(</span>environment<span class="token punctuation">,</span> applicationArguments<span class="token punctuation">.</span><span class="token function">getSourceArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">ConfigurationPropertySources</span><span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u542F\u52A8\u76F8\u5E94\u7684\u76D1\u542C\u5668\uFF0C\u5176\u4E2D\u4E00\u4E2A\u91CD\u8981\u7684\u76D1\u542C\u5668 ConfigFileApplicationListener \u5C31\u662F\u52A0\u8F7D\u9879\u76EE\u914D\u7F6E\u6587\u4EF6\u7684\u76D1\u542C\u5668\u3002</span>
	listeners<span class="token punctuation">.</span><span class="token function">environmentPrepared</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">bindToSpringApplication</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isCustomEnvironment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		environment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EnvironmentConverter</span><span class="token punctuation">(</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">convertEnvironmentIfNecessary</span><span class="token punctuation">(</span>environment<span class="token punctuation">,</span>
				<span class="token function">deduceEnvironmentClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token class-name">ConfigurationPropertySources</span><span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> environment<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>\u53EF\u89C1\u4E3B\u8981\u5B8C\u6210\u4E86\u4E09\u4EF6\u4E8B\uFF1A</p><ol><li>\u521B\u5EFA\u5E76\u914D\u7F6E\u76F8\u5E94\u7684\u73AF\u5883</li><li>\u6839\u636E\u7528\u6237\u914D\u7F6E\uFF0C\u914D\u7F6E environment\u7CFB\u7EDF\u73AF\u5883</li><li>\u542F\u52A8\u76F8\u5E94\u7684\u76D1\u542C\u5668</li></ol><p><strong>\u521B\u5EFA\u5E76\u914D\u7F6E\u76F8\u5E94\u7684\u73AF\u5883</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">ConfigurableEnvironment</span> <span class="token function">getOrCreateEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>environment <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>environment<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//\u5982\u679C\u5E94\u7528\u7C7B\u578B\u662F SERVLET \u5219\u5B9E\u4F8B\u5316 StandardServletEnvironment</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>webApplicationType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">case</span> SERVLET<span class="token operator">:</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StandardServletEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> REACTIVE<span class="token operator">:</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StandardReactiveWebEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">default</span><span class="token operator">:</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StandardEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>\u6839\u636E webApplicationType \u521B\u5EFA\u4E0D\u540C\u7684\u73AF\u5883\u5BF9\u8C61\u3002</p><blockquote><p>\u90A3\u4E48 webApplicationType \u662F\u600E\u4E48\u6765\u7684\u5462\uFF1F</p><p>\u662F\u5728\u6267\u884C SpringApplication \u7684\u6709\u53C2\u6784\u9020\u7684\u65F6\u5019\uFF0C\u6839\u636E classpath \u4E0B\u7684 Class \u6765\u63A8\u65AD\u662F\u666E\u901A MVC \u5E94\u7528\u8FD8\u662F Reactive \u5E94\u7528</p></blockquote><p><strong>\u6839\u636E\u7528\u6237\u914D\u7F6E\uFF0C\u914D\u7F6E environment\u7CFB\u7EDF\u73AF\u5883</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configureEnvironment</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableEnvironment</span> environment<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>addConversionService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">ConversionService</span> conversionService <span class="token operator">=</span> <span class="token class-name">ApplicationConversionService</span><span class="token punctuation">.</span><span class="token function">getSharedInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		environment<span class="token punctuation">.</span><span class="token function">setConversionService</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableConversionService</span><span class="token punctuation">)</span> conversionService<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// \u5C06 main \u65B9\u6CD5\u7684 args \u5C01\u88C5\u6210 SimpleCommandLinePropertySource \u52A0\u5165\u73AF\u5883\u4E2D</span>
	<span class="token function">configurePropertySources</span><span class="token punctuation">(</span>environment<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u6FC0\u6D3B\u76F8\u5E94\u7684\u914D\u7F6E\u6587\u4EF6</span>
	<span class="token function">configureProfiles</span><span class="token punctuation">(</span>environment<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>\u542F\u52A8\u76F8\u5E94\u7684\u76D1\u542C\u5668</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">environmentPrepared</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableEnvironment</span> environment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SpringApplicationRunListener</span> listener <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listeners<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		listener<span class="token punctuation">.</span><span class="token function">environmentPrepared</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u7EE7\u7EED\u8FDB\u5165</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">environmentPrepared</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableEnvironment</span> environment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>initialMulticaster
			<span class="token punctuation">.</span><span class="token function">multicastEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ApplicationEnvironmentPreparedEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>application<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>args<span class="token punctuation">,</span> environment<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u8FDB\u5165\u6700\u7EC8\u5B9E\u73B0</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">multicastEvent</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">ApplicationEvent</span> event<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ResolvableType</span> eventType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">ResolvableType</span> type <span class="token operator">=</span> <span class="token punctuation">(</span>eventType <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> eventType <span class="token operator">:</span> <span class="token function">resolveDefaultEventType</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Executor</span> executor <span class="token operator">=</span> <span class="token function">getTaskExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> listener <span class="token operator">:</span> <span class="token function">getApplicationListeners</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">invokeListener</span><span class="token punctuation">(</span>listener<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token function">invokeListener</span><span class="token punctuation">(</span>listener<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u6B64\u5904\u7684 Listener \u96C6\u5408\u4E2D\u6709\u4E00\u4E2A\u5173\u952E\u7684 Listener \uFF1A ConfigFileApplicationListener\u3002 \u8FDB\u5165\u5230\u8FD9\u4E2A Listener \u5F53\u4E2D\uFF0C\u6709\u8BF4\u660E\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">EnvironmentPostProcessor</span></span><span class="token punctuation">}</span> that configures the context environment by loading
 * properties from well known file locations. By default properties will be loaded from
 * &#39;application.properties&#39; and/or &#39;application.yml&#39; files in the following locations:
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>file:./config/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>file:./<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>classpath:config/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>classpath:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>prepareEnvironment</code>\u65B9\u6CD5\u6267\u884C\u7ED3\u675F\u65F6\uFF0C<code>environment</code>\u5BF9\u8C61\u4E2D\u5DF2\u7ECF\u5305\u542B\u4E86\u6240\u6709\u7684\u73AF\u5883\u4FE1\u606F\uFF0C\u65E0\u8BBA\u662F\u914D\u7F6E\u6587\u4EF6\u4E2D\u7684\u8FD8\u662F\u542F\u52A8\u547D\u4EE4\u4E0A\u7684\u3002</p><h4 id="\u7B2C\u4E09\u6B65-\u521D\u59CB\u5316\u5E94\u7528\u4E0A\u4E0B\u6587" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E09\u6B65-\u521D\u59CB\u5316\u5E94\u7528\u4E0A\u4E0B\u6587" aria-hidden="true">#</a> \u7B2C\u4E09\u6B65:\u521D\u59CB\u5316\u5E94\u7528\u4E0A\u4E0B\u6587</h4><blockquote><p>\u6240\u8C13\u5E94\u7528\u4E0A\u4E0B\u6587\uFF0C\u5C31\u662F\u5F53\u524D\u73AF\u5883\u3001\u5F53\u524D\u8303\u56F4\u7684<em>\u5C5E\u6027\u96C6\u5408</em>\u3002</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 3\u3001\u521D\u59CB\u5316\u5E94\u7528\u4E0A\u4E0B\u6587</span>
context <span class="token operator">=</span> <span class="token function">createApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u521B\u5EFA\u7684\u5B9E\u4F8B\u5316\u5BF9\u8C61\u6700\u7EC8\u8D4B\u503C\u7ED9\u4E86<code>context</code>\u8FD9\u4E2A\u53D8\u91CF\u3002\u800C\u8FD9\u4E2A\u53D8\u91CF\u7684\u58F0\u660E\u662F\u4E00\u4E2A\u63A5\u53E3\u7C7B\u578B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// ConfigurableApplicationContext \u662F ApplicationContext \u63A5\u53E3\u7684\u5B50\u63A5\u53E3\u3002\u5728ApplicationContext \u57FA\u7840\u4E0A\u589E\u52A0\u4E86\u914D\u7F6E\u4E0A\u4E0B\u6587\u7684\u5DE5\u5177\u3002</span>
<span class="token comment">// ConfigurableApplicationContext \u662F\u5BB9\u5668\u7684\u9AD8\u7EA7\u63A5\u53E3\u3002</span>
<span class="token class-name">ConfigurableApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u6211\u4EEC\u53EF\u4EE5\u7B80\u5355\u770B\u4E00\u4E0B\u6B64\u63A5\u53E3\u7684\u7EE7\u627F\u4F53\u7CFB</p><p><img src="`+t+`" alt="ConfigurableApplicationContext\u7EE7\u627F\u4F53\u7CFB.png"></p><p>\u6211\u4EEC\u7EE7\u7EED\u8FDB\u5165\u521B\u5EFA\u5177\u4F53\u5B9E\u73B0</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">ConfigurableApplicationContext</span> <span class="token function">createApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> contextClass <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>applicationContextClass<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>contextClass <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>webApplicationType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">case</span> SERVLET<span class="token operator">:</span>
				contextClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>DEFAULT_SERVLET_WEB_CONTEXT_CLASS<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> REACTIVE<span class="token operator">:</span>
				contextClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>DEFAULT_REACTIVE_WEB_CONTEXT_CLASS<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">default</span><span class="token operator">:</span>
				contextClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>DEFAULT_CONTEXT_CLASS<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>
					<span class="token string">&quot;Unable create a default ApplicationContext, please specify an ApplicationContextClass&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">)</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">instantiateClass</span><span class="token punctuation">(</span>contextClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>SpringBoot \u9879\u76EE\u6709\u4E09\u79CD\u5BF9\u5E94\u7684\u5E94\u7528\u4E0A\u4E0B\u6587\uFF0C\u6211\u4EEC\u4EE5web\u5DE5\u7A0B\u4E3A\u4F8B\uFF0C\u5176\u4E0A\u4E0B\u6587\u4E3A<code>AnnotationConfigServletWebServerApplicationContext</code>\u3002</p><p>\u6211\u4EEC\u5148\u770B\u4E00\u4E0BAnnotationConfigServletWebServerApplicationContext\u7684\u8BBE\u8BA1</p><p><img src="`+p+`" alt="AnnotationConfigServletWebServerApplicationContext.png"></p><p>\u5173\u4E8E\u8FD9\u4E2A\u7C7B\u7684\u8BBE\u8BA1\u6709\u4E24\u70B9\u9700\u8981\u6CE8\u610F\uFF1A</p><ol><li>\u4ED6\u6709\u4E00\u4E2A\u7236\u7C7B\uFF1A<code>GenericWebApplicationContext</code></li><li>\u540C\u65F6\u4ED6\u8FD8\u662F<code>ConfigurableApplicationContext</code>\u63A5\u53E3\u7684\u5B9E\u73B0\uFF0C\u56E0\u6B64\u53EF\u4EE5\u7528\u6B64\u63A5\u53E3\u63A5\u6536\u8FD9\u4E2A\u7C7B\u7684\u5B9E\u4F8B\u5BF9\u8C61</li></ol><p>\u5728\u4E0A\u9762<code>createApplicationContext()</code>\u65B9\u6CD5\u4E2D\u7684\uFF0C<code>BeanUtils.instantiateClass(contextClass)</code>\u8FD9\u4E2A\u65B9\u6CD5\u4E2D\uFF0C \u4E0D\u4F46\u521D\u59CB\u5316\u4E86<code>AnnotationConfigServletWebServerApplicationContext</code>\u7C7B\uFF0C\u4E5F\u5C31\u662F\u6211\u4EEC\u7684\u4E0A\u4E0B\u6587context\uFF0C \u7531\u4E8E\u7EE7\u627F\u4E86<code>GenericWebApplicationContext</code>\u7C7B\uFF0C\u56E0\u6B64\u540C\u6837\u4E5F\u89E6\u53D1\u4E86<code>GenericApplicationContext</code>\u7C7B\u7684\u6784\u9020\u51FD\u6570\uFF0C\u4ECE\u800CIoC\u5BB9\u5668\u4E5F\u521B\u5EFA\u4E86\u3002</p><p>\u4ED4\u7EC6\u770B\u4ED6\u7684\u6784\u9020\u51FD\u6570\uFF0C\u53D1\u73B0\u4E00\u4E2A\u5F88\u719F\u6089\u7684\u7C7B<code>DefaultListableBeanFactory</code>\uFF0C\u6CA1\u9519\uFF0C DefaultListableBeanFactory\u5C31\u662FIoC\u5BB9\u5668\u771F\u5B9E\u9762\u76EE\u4E86\u3002</p><blockquote><p>Ioc \u5BB9\u5668\u4EE5\u5C5E\u6027\u7684\u5F62\u5F0F\u5B58\u5728\u4E8E context \u5F53\u4E2D\uFF0C\u5177\u4F53\u6765\u8BF4\u5C31\u662F context \u4E2D\u7684 beanFactory \u5C5E\u6027\u3002</p></blockquote><p>\u5728\u540E\u9762\u7684<code>refresh()</code>\u65B9\u6CD5\u5206\u6790\u4E2D\uFF0C<code>DefaultListableBeanFactory</code>\u5C06\u662F\u65E0\u5904\u4E0D\u5728\u3002</p><blockquote><p>\u7EC6\u7EC6\u611F\u53D7\u4E0B\u4E0A\u4E0B\u6587\u548C\u5BB9\u5668\u7684\u8054\u7CFB\u548C\u533A\u522B\uFF0C\u5BF9\u4E8E\u6211\u4EEC\u7406\u89E3\u6E90\u7801\u6709\u5F88\u5927\u7684\u5E2E\u52A9\u3002\u5728\u6211\u4EEC\u5B66\u4E60\u8FC7\u7A0B\u4E2D\uFF0C\u6211\u4EEC\u4E5F\u662F\u5C06\u4E0A\u4E0B\u6587\u548C\u5BB9\u5668\u4E25\u683C\u533A\u5206\u5F00\u6765\u7684\u3002</p></blockquote><h4 id="\u7B2C\u56DB\u6B65-\u5237\u65B0\u5E94\u7528\u4E0A\u4E0B\u6587\u524D\u7684\u51C6\u5907\u9636\u6BB5-\u3010\u91CD\u8981\u3011" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u56DB\u6B65-\u5237\u65B0\u5E94\u7528\u4E0A\u4E0B\u6587\u524D\u7684\u51C6\u5907\u9636\u6BB5-\u3010\u91CD\u8981\u3011" aria-hidden="true">#</a> \u7B2C\u56DB\u6B65:\u5237\u65B0\u5E94\u7528\u4E0A\u4E0B\u6587\u524D\u7684\u51C6\u5907\u9636\u6BB5 \u3010\u91CD\u8981\u3011</h4><blockquote><p>\u6211\u4EEC\u5DF2\u77E5\u6240\u8C13\u7684\u5E94\u7528\u4E0A\u4E0B\u6587\uFF0C\u5C31\u662F\u5F53\u524D\u8303\u56F4\u7684\u5C5E\u6027\u96C6\u5408\u3002\u6240\u8C13\u7684\u73AF\u5883\u51C6\u5907\uFF0C\u4E5F\u5C31\u662F\u5411\u96C6\u5408\u4E2D\u5B8C\u6210\u5C5E\u6027\u7684\u8BBE\u7F6E\u548C\u4E00\u4E9B Bean \u5BF9\u8C61\u7684\u521B\u5EFA\u3002</p></blockquote><p>\u524D\u9762\u6211\u4EEC\u4ECB\u7ECD\u4E86 SpringBoot \u542F\u52A8\u6D41\u7A0B<code>run()</code>\u65B9\u6CD5\u7684\u524D\u4E09\u6B65\uFF0C\u63A5\u4E0B\u6765\u518D\u6765\u4ECB\u7ECD\u7B2C\u56DB\u6B65: \u5237\u65B0\u5E94\u7528\u4E0A\u4E0B\u6587\u524D\u7684\u51C6\u5907\u9636\u6BB5\u3002\u4E5F\u5C31\u662F<code>prepareContext()</code>\u65B9\u6CD5\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">prepareContext</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableApplicationContext</span> context<span class="token punctuation">,</span> <span class="token class-name">ConfigurableEnvironment</span> environment<span class="token punctuation">,</span>
		<span class="token class-name">SpringApplicationRunListeners</span> listeners<span class="token punctuation">,</span> <span class="token class-name">ApplicationArguments</span> applicationArguments<span class="token punctuation">,</span> <span class="token class-name">Banner</span> printedBanner<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u8BBE\u7F6E\u5BB9\u5668\u73AF\u5883\uFF08\u5C06\u4E4B\u524D\u6784\u5EFA\u7684\u73AF\u5883\u5BF9\u8C61\uFF0C\u8BBE\u7F6E\u5230 context \u4E2D\uFF09</span>
	context<span class="token punctuation">.</span><span class="token function">setEnvironment</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u6267\u884C\u5BB9\u5668\u540E\u7F6E\u5904\u7406</span>
	<span class="token function">postProcessApplicationContext</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//\u6267\u884C\u5BB9\u5668\u4E2D\u7684 ApplicationContextInitializer \u5305\u62EC spring.factories \u548C\u901A\u8FC7\u4E09\u79CD\u65B9\u5F0F\u81EA\u5B9A\u4E49\u914D\u7F6E\u7684</span>
	<span class="token function">applyInitializers</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u5411\u5404\u4E2A\u76D1\u542C\u5668\u53D1\u9001\u5BB9\u5668\u5DF2\u7ECF\u51C6\u5907\u597D\u7684\u4E8B\u4EF6</span>
	listeners<span class="token punctuation">.</span><span class="token function">contextPrepared</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>logStartupInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">logStartupInfo</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">logStartupProfileInfo</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// Add boot specific singleton beans</span>
	<span class="token comment">// \u5C06 main \u65B9\u6CD5\u4E2D\u7684 args \u53C2\u6570\u5C01\u88C5\u6210\u5355\u4F8BBean\uFF0C\u6CE8\u518C\u8FDB\u5BB9\u5668</span>
	<span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	beanFactory<span class="token punctuation">.</span><span class="token function">registerSingleton</span><span class="token punctuation">(</span><span class="token string">&quot;springApplicationArguments&quot;</span><span class="token punctuation">,</span> applicationArguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u5C06 printedBanner \u4E5F\u5C01\u88C5\u6210\u5355\u4F8B\uFF0C\u6CE8\u518C\u8FDB\u5BB9\u5668</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>printedBanner <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		beanFactory<span class="token punctuation">.</span><span class="token function">registerSingleton</span><span class="token punctuation">(</span><span class="token string">&quot;springBootBanner&quot;</span><span class="token punctuation">,</span> printedBanner<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>beanFactory <span class="token keyword">instanceof</span> <span class="token class-name">DefaultListableBeanFactory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">DefaultListableBeanFactory</span><span class="token punctuation">)</span> beanFactory<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">setAllowBeanDefinitionOverriding</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>allowBeanDefinitionOverriding<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lazyInitialization<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		context<span class="token punctuation">.</span><span class="token function">addBeanFactoryPostProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LazyInitializationBeanFactoryPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// Load the sources</span>
	<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> sources <span class="token operator">=</span> <span class="token function">getAllSources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notEmpty</span><span class="token punctuation">(</span>sources<span class="token punctuation">,</span> <span class="token string">&quot;Sources must not be empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u52A0\u8F7D\u6211\u4EEC\u7684\u542F\u52A8\u7C7B\uFF0C\u5C06\u542F\u52A8\u7C7B\u6CE8\u5165\u5BB9\u5668</span>
	<span class="token function">load</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> sources<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u53D1\u5E03\u5BB9\u5668\u5DF2\u52A0\u8F7D\u4E8B\u4EF6</span>
	listeners<span class="token punctuation">.</span><span class="token function">contextLoaded</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>\u9996\u5148\u770B\u8FD9\u884C<code>Set sources = getAllSources();</code>\uFF0C\u901A\u8FC7Debug\u53EF\u4EE5\u770B\u5230\u5728<code>getAllSources()</code>\u4E2D\u62FF\u5230\u4E86\u6211\u4EEC\u7684\u542F\u52A8\u7C7B\u3002</p><p>\u7EE7\u7EED\u8FDB\u5165<code>load(context, sources.toArray(new Object[0]));</code>\u65B9\u6CD5\u5F53\u4E2D</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> context<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sources<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Loading source &quot;</span> <span class="token operator">+</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">arrayToCommaDelimitedString</span><span class="token punctuation">(</span>sources<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// \u521B\u5EFABeanDefinitionLoader</span>
	<span class="token class-name">BeanDefinitionLoader</span> loader <span class="token operator">=</span> <span class="token function">createBeanDefinitionLoader</span><span class="token punctuation">(</span><span class="token function">getBeanDefinitionRegistry</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">,</span> sources<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanNameGenerator <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		loader<span class="token punctuation">.</span><span class="token function">setBeanNameGenerator</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanNameGenerator<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		loader<span class="token punctuation">.</span><span class="token function">setResourceLoader</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>environment <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		loader<span class="token punctuation">.</span><span class="token function">setEnvironment</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>\u521B\u5EFA<code>BeanDefinitionLoader</code>\u7684\u8FD9\u4E00\u884C\u4EE3\u7801\u5F53\u4E2D\uFF0C\u7B2C\u4E8C\u4E2A\u53C2\u6570\u5C31\u662F\u6211\u4EEC\u7684\u6838\u5FC3\u542F\u52A8\u7C7B\u6CA1\u4EC0\u4E48\u53EF\u8BF4\u7684\uFF0C\u6211\u4EEC\u8FDB\u5165\u7B2C\u4E00\u4E2A\u53C2\u6570\u7684\u65B9<code>getBeanDefinitionRegistry</code>\u6CD5\u5F53\u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">BeanDefinitionRegistry</span> <span class="token function">getBeanDefinitionRegistry</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token keyword">instanceof</span> <span class="token class-name">BeanDefinitionRegistry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinitionRegistry</span><span class="token punctuation">)</span> context<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token keyword">instanceof</span> <span class="token class-name">AbstractApplicationContext</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinitionRegistry</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">AbstractApplicationContext</span><span class="token punctuation">)</span> context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;Could not locate BeanDefinitionRegistry&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u8FD9\u91CC\u5C06\u6211\u4EEC\u524D\u6587\u521B\u5EFA\u7684\u4E0A\u4E0B\u6587\u5F3A\u8F6C\u4E3A<code>BeanDefinitionRegistry</code>\uFF0C\u4ED6\u4EEC\u4E4B\u95F4\u662F\u6709\u7EE7\u627F\u5173\u7CFB\u7684\u3002 <code>BeanDefinitionRegistry</code>\u5B9A\u4E49\u4E86\u5F88\u91CD\u8981\u7684\u65B9\u6CD5\uFF0C\u5176\u4E2D\u6709\u4E00\u4E2A<code>registerBeanDefinition()</code>\uFF0C\u8BE5\u65B9\u6CD5\u5C06<code>BeanDefinition</code>\u6CE8\u518C\u8FDB<code>DefaultListableBeanFactory</code>\u5BB9\u5668\u7684<code>beanDefinitionMap</code>\u4E2D\u3002</p><blockquote><p>\u6269\u5C55\u56DE\u987E\uFF1ASpring \u5BB9\u5668\u5728\u542F\u52A8\u7684\u65F6\u5019\uFF0C\u4F1A\u5C06\u7C7B\u89E3\u6790\u6210\u7684<code>BeanDefinition</code>\u5BF9\u8C61\u5E76\u5B58\u50A8\u5230<code>DefaultListableBeanFactory</code>\u5BB9\u5668\u7684<code>beanDefinitionMap</code>\u4E2D\u3002</p></blockquote><p>\u83B7\u53D6\u5230\u4E24\u4E2A\u53C2\u6570\u540E\uFF0C\u6211\u4EEC\u7EE7\u7EED\u8FDB\u5165\u9700\u8981\u6267\u884C\u7684\u65B9\u6CD5<code>createBeanDefinitionLoader</code>\u5F53\u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">BeanDefinitionLoader</span> <span class="token function">createBeanDefinitionLoader</span><span class="token punctuation">(</span><span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sources<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionLoader</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> sources<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u6211\u4EEC\u7EE7\u7EED\u8FDB\u5165\u8FD9\u4E2A\u6709\u53C2\u7684\u6784\u9020\u65B9\u6CD5\u5F53\u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">BeanDefinitionLoader</span><span class="token punctuation">(</span><span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> sources<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token string">&quot;Registry must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notEmpty</span><span class="token punctuation">(</span>sources<span class="token punctuation">,</span> <span class="token string">&quot;Sources must not be empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u6838\u5FC3\u542F\u52A8\u7C7B</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>sources <span class="token operator">=</span> sources<span class="token punctuation">;</span>
	<span class="token comment">// \u6CE8\u89E3\u5F62\u5F0F\u7684Bean\u5B9A\u4E49\u8BFB\u53D6\u5668\u3002\u6BD4\u5982:@Configuration @Bean @Component @Controller @Service\u7B49\u7B49</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>annotatedReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotatedBeanDefinitionReader</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// XML\u5F62\u5F0F\u7684Bean\u5B9A\u4E49\u8BFB\u53D6\u5668</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>xmlReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlBeanDefinitionReader</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isGroovyPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>groovyReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GroovyBeanDefinitionReader</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// \u7C7B\u8DEF\u5F84\u626B\u63CF\u5668</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathBeanDefinitionScanner</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u626B\u63CF\u5668\u6DFB\u52A0\u6392\u9664\u8FC7\u6EE4\u5668</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>scanner<span class="token punctuation">.</span><span class="token function">addExcludeFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassExcludeFilter</span><span class="token punctuation">(</span>sources<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>\u65B9\u6CD5\u8F83\u4E3A\u7B80\u5355\uFF0C\u4E3B\u8981\u5C31\u662F\u5B8C\u6210\u4E86\u8D4B\u503C\u5DE5\u4F5C\u3002 \u6210\u529F\u521B\u5EFA\u5B8C<code>loader</code>\u4E4B\u540E\uFF0C\u8C03\u7528\u4E86\u5176<code>load()</code>\u65B9\u6CD5\uFF0C\u6211\u4EEC\u7EE7\u7EED\u8DDF\u8FDB\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">int</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> source <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sources<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		count <span class="token operator">+=</span> <span class="token function">load</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> count<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u7EE7\u7EED\u8FDB\u5165</span>
<span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">Object</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token string">&quot;Source must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// \u4ECE Class \u52A0\u8F7D</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// \u4ECE Resource \u52A0\u8F7D</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Resource</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Resource</span><span class="token punctuation">)</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// \u4ECE Package \u52A0\u8F7D</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Package</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Package</span><span class="token punctuation">)</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">CharSequence</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span><span class="token punctuation">)</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid source type &quot;</span> <span class="token operator">+</span> source<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u7EE7\u7EED\u8FDB\u5165</span>
<span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isGroovyPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">GroovyBeanDefinitionSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Any GroovyLoaders added in beans{} DSL can contribute beans here</span>
		<span class="token class-name">GroovyBeanDefinitionSource</span> loader <span class="token operator">=</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">instantiateClass</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token class-name">GroovyBeanDefinitionSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">load</span><span class="token punctuation">(</span>loader<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// \u6838\u5FC3\u542F\u52A8\u7C7B\u4E0A\u662F\u5426\u6DFB\u52A0\u6709 @Component \u6CE8\u89E3</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isComponent</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// \u5C06\u6838\u5FC3\u542F\u52A8\u7C7B\u7684BeanDefinition\u6CE8\u518C\u8FDBbeanDefinitionMap\u4E2D</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>annotatedReader<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>\u6211\u4EEC\u7EE7\u7EED\u8DDF\u8FDB<code>this.annotatedReader.register(source)</code>\u65B9\u6CD5\uFF0C\u6700\u7EC8\u8FDB\u5165\u5230<code>AnnotatedBeanDefinitionReader#doRegisterBean</code>\u65B9\u6CD5\u5F53\u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">doRegisterBean</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> beanClass<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span>
		<span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> qualifiers<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> supplier<span class="token punctuation">,</span>
		<span class="token annotation punctuation">@Nullable</span> <span class="token class-name">BeanDefinitionCustomizer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> customizers<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// \u5C06\u6307\u5B9A\u7684\u7C7B\u5C01\u88C5\u4E3A AnnotatedGenericBeanDefinition</span>
	<span class="token class-name">AnnotatedGenericBeanDefinition</span> abd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotatedGenericBeanDefinition</span><span class="token punctuation">(</span>beanClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>conditionEvaluator<span class="token punctuation">.</span><span class="token function">shouldSkip</span><span class="token punctuation">(</span>abd<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	abd<span class="token punctuation">.</span><span class="token function">setInstanceSupplier</span><span class="token punctuation">(</span>supplier<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u83B7\u53D6\u8BE5\u7C7B\u7684 scope \u5C5E\u6027</span>
	<span class="token class-name">ScopeMetadata</span> scopeMetadata <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scopeMetadataResolver<span class="token punctuation">.</span><span class="token function">resolveScopeMetadata</span><span class="token punctuation">(</span>abd<span class="token punctuation">)</span><span class="token punctuation">;</span>
	abd<span class="token punctuation">.</span><span class="token function">setScope</span><span class="token punctuation">(</span>scopeMetadata<span class="token punctuation">.</span><span class="token function">getScopeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> beanName <span class="token operator">=</span> <span class="token punctuation">(</span>name <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> name <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanNameGenerator<span class="token punctuation">.</span><span class="token function">generateBeanName</span><span class="token punctuation">(</span>abd<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>registry<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">AnnotationConfigUtils</span><span class="token punctuation">.</span><span class="token function">processCommonDefinitionAnnotations</span><span class="token punctuation">(</span>abd<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>qualifiers <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token punctuation">&gt;</span></span> qualifier <span class="token operator">:</span> qualifiers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Primary</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> qualifier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				abd<span class="token punctuation">.</span><span class="token function">setPrimary</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Lazy</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">==</span> qualifier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				abd<span class="token punctuation">.</span><span class="token function">setLazyInit</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token punctuation">{</span>
				abd<span class="token punctuation">.</span><span class="token function">addQualifier</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AutowireCandidateQualifier</span><span class="token punctuation">(</span>qualifier<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>customizers <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinitionCustomizer</span> customizer <span class="token operator">:</span> customizers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			customizer<span class="token punctuation">.</span><span class="token function">customize</span><span class="token punctuation">(</span>abd<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// BeanDefinitionHolder \u5BF9\u8C61\u6301\u6709\u4E86 BeanDefinition</span>
	<span class="token class-name">BeanDefinitionHolder</span> definitionHolder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionHolder</span><span class="token punctuation">(</span>abd<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	definitionHolder <span class="token operator">=</span> <span class="token class-name">AnnotationConfigUtils</span><span class="token punctuation">.</span><span class="token function">applyScopedProxyMode</span><span class="token punctuation">(</span>scopeMetadata<span class="token punctuation">,</span> definitionHolder<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u5C06\u8BE5BeanDefinition\u6CE8\u518C\u5230 IoC \u5BB9\u5668\u7684beanDefinitionMap\u4E2D</span>
	<span class="token class-name">BeanDefinitionReaderUtils</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span>definitionHolder<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>\u7EE7\u7EED\u8FDB\u5165\u6CE8\u518C\u65B9\u6CD5\u5F53\u4E2D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span>
		<span class="token class-name">BeanDefinitionHolder</span> definitionHolder<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span>
		<span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>

	<span class="token comment">// Register bean definition under primary name.</span>
    <span class="token comment">// \u6CE8\u518C Bean \uFF08primary name \u5C31\u662F\u6211\u4EEC\u901A\u5E38\u6240\u8BF4\u7684BeanId\uFF09    </span>
	<span class="token class-name">String</span> beanName <span class="token operator">=</span> definitionHolder<span class="token punctuation">.</span><span class="token function">getBeanName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	registry<span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> definitionHolder<span class="token punctuation">.</span><span class="token function">getBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Register aliases for bean name, if any.</span>
    <span class="token comment">// \u6CE8\u518C\u522B\u540D</span>
	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> aliases <span class="token operator">=</span> definitionHolder<span class="token punctuation">.</span><span class="token function">getAliases</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>aliases <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> alias <span class="token operator">:</span> aliases<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			registry<span class="token punctuation">.</span><span class="token function">registerAlias</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> alias<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>\u7EE7\u7EED\u8FDB\u5165\u6CE8\u518CBean\u7684\u65B9\u6CD5\u5F53\u4E2D\uFF0C\u6700\u7EC8\u6765\u5230<code>DefaultListableBeanFactory#registerBeanDefinition</code>\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">)</span>
		<span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// ...</span>

	<span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionNames<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">removeManualSingletonName</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// ...</span>
		
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>\u5B8C\u6210Bean\u6CE8\u518C\u3002</p><p>\u81F3\u6B64\uFF0C\u5E94\u7528\u4E0A\u4E0B\u6587\u5237\u65B0\u7684\u51C6\u5907\u5DE5\u4F5C\u5C31\u5B8C\u6210\u4E86\u3002\u56DE\u987E\u8FC7\u7A0B\uFF0C\u4E3B\u8981\u5C31\u662F\u5B8C\u6210\u4E86\u73AF\u5883\u4E2D\u4E00\u4E9B\u5C5E\u6027\u7684\u8BBE\u7F6E\u548C\u5C06\u4E00\u4E9B\u7C7B(\u5982\u6838\u5FC3\u542F\u52A8\u7C7B)\u751F\u6210\u5B9E\u4F8B\u5316\u5BF9\u8C61\uFF0C\u5E76\u5B58\u50A8\u5230\u5BB9\u5668\u4E2D\u3002</p><h4 id="\u7B2C\u4E94\u6B65-\u5237\u65B0\u5E94\u7528\u4E0A\u4E0B\u6587-\u3010\u91CD\u8981\u3011" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E94\u6B65-\u5237\u65B0\u5E94\u7528\u4E0A\u4E0B\u6587-\u3010\u91CD\u8981\u3011" aria-hidden="true">#</a> \u7B2C\u4E94\u6B65:\u5237\u65B0\u5E94\u7528\u4E0A\u4E0B\u6587 \u3010\u91CD\u8981\u3011</h4><p>\u9996\u5148\u6211\u4EEC\u8981\u77E5\u9053\u5230IoC\u5BB9\u5668\u7684\u521D\u59CB\u5316\u8FC7\u7A0B\uFF0C\u4E3B\u8981\u5206\u4E0B\u9762\u4E09\u6B65:</p><ol><li>BeanDefinition\u7684Resource\u5B9A\u4F4D</li><li>BeanDefinition\u7684\u8F7D\u5165</li><li>\u5411IoC\u5BB9\u5668\u6CE8\u518CBeanDefinition</li></ol><p>\u524D\u9762\u4ECB\u7ECD\u4E86<code>prepareContext()</code>\u65B9\u6CD5\uFF0C\u5728\u51C6\u5907\u5237\u65B0\u9636\u6BB5\u505A\u4E86\u4EC0\u4E48\u5DE5\u4F5C\u3002</p><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u4E3B\u8981\u4ECE<code>refresh()</code>\u65B9\u6CD5\u4E2D\u603B\u7ED3IoC\u5BB9\u5668\u7684\u521D\u59CB\u5316\u8FC7\u7A0B\u3002</p><p>\u4ECE<code>run</code>\u65B9\u6CD5\u7684<code>refreshContext()</code>\u65B9\u6CD5\u4E00\u8DEF\u8DDF\u4E0B\u53BB\uFF0C\u6700\u7EC8\u6765\u5230<code>AbstractApplicationContext#refresh</code>\u65B9\u6CD5\u3002</p><blockquote><p>\u6B64\u5904\u662F Spring \u7684\u6E90\u7801\u90E8\u5206\u4E86\uFF0C\u56E0\u6B64\u5728\u6B64\u53EA\u662F\u91CD\u70B9\u5206\u6790\u548C\u81EA\u52A8\u914D\u7F6E\u76F8\u5173\u7684\u4EE3\u7801\uFF0C\u5982\uFF1A<code>invokeBeanFactoryPostProcessors(beanFactory);</code></p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalStateException</span> <span class="token punctuation">{</span>
	<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>startupShutdownMonitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Prepare this context for refreshing.</span>
		<span class="token function">prepareRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Tell the subclass to refresh the internal bean factory.</span>
        <span class="token comment">// \u83B7\u53D6\u4E4B\u524D\u521B\u5EFA\u7684 BeanFactory \u5BF9\u8C61</span>
		<span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token function">obtainFreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Prepare the bean factory for use in this context.</span>
		<span class="token function">prepareBeanFactory</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token comment">// Allows post-processing of the bean factory in context subclasses.</span>
			<span class="token function">postProcessBeanFactory</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// Invoke factory processors registered as beans in the context.</span>
			<span class="token function">invokeBeanFactoryPostProcessors</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// Register bean processors that intercept bean creation.</span>
			<span class="token function">registerBeanPostProcessors</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// Initialize message source for this context.</span>
			<span class="token function">initMessageSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// Initialize event multicaster for this context.</span>
			<span class="token function">initApplicationEventMulticaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// Initialize other special beans in specific context subclasses.</span>
			<span class="token function">onRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// Check for listener beans and register them.</span>
			<span class="token function">registerListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// Instantiate all remaining (non-lazy-init) singletons.</span>
			<span class="token function">finishBeanFactoryInitialization</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// Last step: publish corresponding event.</span>
			<span class="token function">finishRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeansException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isWarnEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;Exception encountered during context initialization - &quot;</span> <span class="token operator">+</span>
						<span class="token string">&quot;cancelling refresh attempt: &quot;</span> <span class="token operator">+</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// Destroy already created singletons to avoid dangling resources.</span>
			<span class="token function">destroyBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// Reset &#39;active&#39; flag.</span>
			<span class="token function">cancelRefresh</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// Propagate exception to caller.</span>
			<span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">finally</span> <span class="token punctuation">{</span>
			<span class="token comment">// Reset common introspection caches in Spring&#39;s core, since we</span>
			<span class="token comment">// might not ever need metadata for singleton beans anymore...</span>
			<span class="token function">resetCommonCaches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><p><strong>invokeBeanFactoryPostProcessors(beanFactory)</strong></p><p>IoC\u5BB9\u5668\u7684\u521D\u59CB\u5316\u8FC7\u7A0B\u5305\u62EC\u4E09\u4E2A\u6B65\u9AA4\uFF0C\u5728invokeBeanFactoryPostProcessors()\u65B9\u6CD5\u4E2D\u5B8C\u6210\u4E86IoC\u5BB9\u5668\u521D\u59CB\u5316\u8FC7\u7A0B\u7684\u4E09\u4E2A\u6B65\u9AA4\u3002</p><ol><li>\u7B2C\u4E00\u6B65:Resource\u5B9A\u4F4D</li></ol><p>\u5728 SpringBoot \u4E2D\uFF0C\u6211\u4EEC\u90FD\u77E5\u9053\u4ED6\u7684\u5305\u626B\u63CF\u662F\u4ECE\u4E3B\u7C7B\u6240\u5728\u7684\u5305\u5F00\u59CB\u626B\u63CF\u7684\uFF0C<code>prepareContext()</code>\u65B9\u6CD5\u4E2D\uFF0C\u4F1A\u5148\u5C06\u4E3B\u7C7B\u89E3\u6790\u6210 BeanDefinition\uFF0C \u7136\u540E\u5728<code>refresh()</code>\u65B9\u6CD5\u7684<code>invokeBeanFactoryPostProcessors()</code>\u65B9\u6CD5\u4E2D\u89E3\u6790\u4E3B\u7C7B\u7684BeanDefinition\u83B7\u53D6basePackage\u7684\u8DEF\u5F84\u3002\u8FD9\u6837\u5C31\u5B8C\u6210\u4E86\u5B9A\u4F4D\u7684\u8FC7\u7A0B\u3002 \u5176\u6B21 SpringBoot \u7684\u5404\u79CDstarter\u662F\u901A\u8FC7SPI\u6269\u5C55\u673A\u5236\u5B9E\u73B0\u7684\u81EA\u52A8\u88C5\u914D\uFF0CSpringBoot\u7684\u81EA\u52A8\u88C5\u914D\u540C\u6837\u4E5F\u662F\u5728<code>invokeBeanFactoryPostProcessors()</code>\u65B9\u6CD5\u4E2D\u5B9E\u73B0\u7684\u3002 \u8FD8\u6709\u4E00\u79CD\u60C5\u51B5\uFF0C\u5728 SpringBoot \u4E2D\u6709\u5F88\u591A\u7684@EnableXXX\u6CE8\u89E3\uFF0C\u7EC6\u5FC3\u70B9\u8FDB\u53BB\u770B\u7684\u5E94\u8BE5\u5C31\u77E5\u9053\u5176\u5E95\u5C42\u662F<code>@Import</code>\u6CE8\u89E3\uFF0C\u5728<code>invokeBeanFactoryPostProcessors()</code>\u65B9\u6CD5\u4E2D\u4E5F\u5B9E\u73B0\u4E86\u5BF9\u8BE5\u6CE8\u89E3\u6307\u5B9A\u7684\u914D\u7F6E\u7C7B\u7684\u5B9A\u4F4D\u52A0\u8F7D\u3002</p><p>\u5E38\u89C4\u7684\u5728 SpringBoot \u4E2D\u6709\u4E09\u79CD\u5B9E\u73B0\u5B9A\u4F4D\uFF0C\u7B2C\u4E00\u4E2A\u662F\u4E3B\u7C7B\u6240\u5728\u5305\u7684\uFF0C\u7B2C\u4E8C\u4E2A\u662FSPI\u6269\u5C55\u673A\u5236\u5B9E\u73B0\u7684\u81EA\u52A8\u88C5\u914D(\u6BD4\u5982\u5404\u79CDstarter)\uFF0C\u7B2C\u4E09\u79CD\u5C31\u662F@Import\u6CE8\u89E3\u6307\u5B9A\u7684\u7C7B\u3002(\u5BF9\u4E8E\u975E\u5E38\u89C4\u7684\u4E0D\u8BF4\u4E86)</p><ol start="2"><li>\u7B2C\u4E8C\u6B65:BeanDefinition\u7684\u8F7D\u5165</li></ol><p>\u5728\u7B2C\u4E00\u6B65\u4E2D\u8BF4\u4E86\u4E09\u79CDResource\u7684\u5B9A\u4F4D\u60C5\u51B5\uFF0C\u5B9A\u4F4D\u540E\u7D27\u63A5\u7740\u5C31\u662F<code>BeanDefinition</code>\u7684\u5206\u522B\u8F7D\u5165\u3002 \u6240\u8C13\u7684\u8F7D\u5165\u5C31\u662F\u901A\u8FC7\u4E0A\u9762\u7684\u5B9A\u4F4D\u5F97\u5230\u7684basePackage\uFF0C SpringBoot \u4F1A\u5C06\u8BE5\u8DEF\u5F84\u62FC\u63A5\u6210:<code>classpath:com/mujunlin/**/.class</code>\u8FD9\u6837\u7684\u5F62\u5F0F\uFF0C\u7136\u540E\u4E00\u4E2A\u53EB\u505A<code>xPathMatchingResourcePatternResolver</code>\u7684\u7C7B\u4F1A\u5C06\u8BE5\u8DEF\u5F84\u4E0B\u6240\u6709\u7684<code>.class</code>\u6587\u4EF6\u90FD\u52A0\u8F7D\u8FDB\u6765\uFF0C \u7136\u540E\u904D\u5386\u5224\u65AD\u662F\u4E0D\u662F\u6709<code>@Component</code>\u6CE8\u89E3\uFF0C\u5982\u679C\u6709\u7684\u8BDD\uFF0C\u5C31\u662F\u6211\u4EEC\u8981\u88C5\u8F7D\u7684BeanDefinition\u3002\u5927\u81F4\u8FC7\u7A0B\u5C31\u662F\u8FD9\u6837\u7684\u4E86\u3002</p><blockquote><p>@Configuration\uFF0C@Controller\uFF0C@Service\u7B49\u6CE8\u89E3\u5E95\u5C42\u90FD\u662F@Component\u6CE8\u89E3\uFF0C\u53EA\u4E0D\u8FC7\u5305\u88C5\u4E86\u4E00\u5C42\u7F62\u4E86\u3002</p></blockquote><ol start="3"><li>\u7B2C\u4E09\u6B65:\u6CE8\u518CBeanDefinition</li></ol><p>\u901A\u8FC7\u8C03\u7528\u4E0A\u6587\u63D0\u5230\u7684<code>BeanDefinitionRegister</code>\u63A5\u53E3\u7684\u5B9E\u73B0\u6765\u5B8C\u6210\u3002\u8FD9\u4E2A\u6CE8\u518C\u8FC7\u7A0B\u628A\u8F7D\u5165\u8FC7\u7A0B\u4E2D\u89E3\u6790\u5F97\u5230\u7684<code>BeanDefinition</code>\u5411 IoC \u5BB9\u5668\u8FDB\u884C\u6CE8\u518C\u3002 \u901A\u8FC7\u4E0A\u6587\u7684\u5206\u6790\uFF0C\u6211\u4EEC\u53EF\u4EE5\u770B\u5230\uFF0C\u5728IoC\u5BB9\u5668\u4E2D\u5C06<code>BeanDefinition</code>\u6CE8\u5165\u5230\u4E00\u4E2AConcurrentHashMap\u4E2D\uFF0CIoC\u5BB9\u5668\u5C31\u662F\u901A\u8FC7\u8FD9\u4E2AHashMap\u6765\u6301\u6709\u8FD9\u4E9BBeanDefinition\u6570\u636E\u7684\u3002 \u6BD4\u5982<code>DefaultListableBeanFactory</code>\u4E2D\u7684beanDefinitionMap\u5C5E\u6027\u3002</p><p>OK\uFF0C\u603B\u7ED3\u5B8C\u4E86\uFF0C\u63A5\u4E0B\u6765\u6211\u4EEC\u901A\u8FC7\u4EE3\u7801\u770B\u770B\u5177\u4F53\u662F\u600E\u4E48\u5B9E\u73B0\u7684\u3002</p><h4 id="\u7B2C\u516D\u6B65-\u5237\u65B0\u5E94\u7528\u4E0A\u4E0B\u6587\u540E\u7684\u6269\u5C55\u63A5\u53E3" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u516D\u6B65-\u5237\u65B0\u5E94\u7528\u4E0A\u4E0B\u6587\u540E\u7684\u6269\u5C55\u63A5\u53E3" aria-hidden="true">#</a> \u7B2C\u516D\u6B65:\u5237\u65B0\u5E94\u7528\u4E0A\u4E0B\u6587\u540E\u7684\u6269\u5C55\u63A5\u53E3</h4>`,239);function c(l,u){return o}var r=n(e,[["render",c],["__file","SpringBoot\u6E90\u7801.html.vue"]]);export{r as default};
