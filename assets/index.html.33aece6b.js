import{_ as n,c as s}from"./app.40df414d.js";var a="/doc/assets/README-1640264888987.cb261ed8.png",p="/doc/assets/README-1640520164460.27a80ebf.png",t="/doc/assets/README-1640832324570.77a80fa8.png",e="/doc/assets/README-1640835956054.0524901f.png";const c={},o=s('<h1 id="_6-mapreduce-\u7F16\u7A0B\u6846\u67B6" tabindex="-1"><a class="header-anchor" href="#_6-mapreduce-\u7F16\u7A0B\u6846\u67B6" aria-hidden="true">#</a> 6. MapReduce \u7F16\u7A0B\u6846\u67B6</h1><h2 id="_6-1-mapreduce-\u601D\u60F3" tabindex="-1"><a class="header-anchor" href="#_6-1-mapreduce-\u601D\u60F3" aria-hidden="true">#</a> 6.1 MapReduce \u601D\u60F3</h2><p>MapReduce \u601D\u60F3\u5728\u751F\u6D3B\u4E2D\u5904\u5904\u53EF\u89C1\u3002\u6211\u4EEC\u6216\u591A\u6216\u5C11\u90FD\u66FE\u63A5\u89E6\u8FC7\u8FD9\u79CD\u601D\u60F3\u3002</p><p>MapReduce\u7684\u601D\u60F3\u6838\u5FC3\u662F<strong>\u5206\u800C\u6CBB\u4E4B</strong>\uFF0C\u5145\u5206\u5229\u7528\u4E86\u5E76\u884C\u5904\u7406\u7684\u4F18\u52BF\u3002</p><blockquote><p>\u5373\u4F7F\u662F\u53D1\u5E03\u8FC7\u8BBA\u6587\u5B9E\u73B0\u5206\u5E03\u5F0F\u8BA1\u7B97\u7684\u8C37\u6B4C\u4E5F\u53EA\u662F\u5B9E\u73B0\u4E86\u8FD9\u79CD\u601D\u60F3\uFF0C\u800C\u4E0D\u662F\u81EA\u5DF1\u539F\u521B\u3002</p></blockquote><p>MapReduce\u4EFB\u52A1\u8FC7\u7A0B\u662F\u5206\u4E3A\u4E24\u4E2A\u5904\u7406\u9636\u6BB5:</p><ul><li>Map\u9636\u6BB5: Map\u9636\u6BB5\u7684\u4E3B\u8981\u4F5C\u7528\u662F\u300E\u5206\u300F\uFF0C\u5373\u628A\u590D\u6742\u7684\u4EFB\u52A1\u5206\u89E3\u4E3A\u82E5\u5E72\u4E2A\u300E\u7B80\u5355\u7684\u4EFB\u52A1\u300F\u6765\u5E76\u884C\u5904\u7406\u3002Map\u9636\u6BB5\u7684\u8FD9\u4E9B\u4EFB\u52A1\u53EF\u4EE5\u5E76\u884C\u8BA1\u7B97\uFF0C\u5F7C\u6B64\u95F4\u6CA1\u6709\u4F9D\u8D56\u5173\u7CFB\u3002</li><li>Reduce\u9636\u6BB5: Reduce\u9636\u6BB5\u7684\u4E3B\u8981\u4F5C\u7528\u662F\u300E\u5408\u300F\uFF0C\u5373\u5BF9map\u9636\u6BB5\u7684\u7ED3\u679C\u8FDB\u884C\u5168\u5C40\u6C47\u603B\u3002</li></ul><p>\u518D\u6B21\u7406\u89E3MapReduce\u7684\u601D\u60F3</p><p><img src="'+a+`" alt="MapReduce\u6846\u67B6"></p><h2 id="_6-2-wordcount-\u6E90\u7801\u89E3\u6790" tabindex="-1"><a class="header-anchor" href="#_6-2-wordcount-\u6E90\u7801\u89E3\u6790" aria-hidden="true">#</a> 6.2 WordCount \u6E90\u7801\u89E3\u6790</h2><p>WordCount \u6E90\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WordCount</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">WordCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> otherArgs <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericOptionsParser</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRemainingArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>otherArgs<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Usage: wordcount &lt;in&gt; [&lt;in&gt;...] &lt;out&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u6784\u5EFAJob\u5BF9\u8C61</span>
        <span class="token class-name">Job</span> job <span class="token operator">=</span> <span class="token class-name">Job</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span> <span class="token string">&quot;word count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">WordCount</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setMapperClass</span><span class="token punctuation">(</span><span class="token class-name">WordCount<span class="token punctuation">.</span>TokenizerMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setCombinerClass</span><span class="token punctuation">(</span><span class="token class-name">WordCount<span class="token punctuation">.</span>IntSumReducer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setReducerClass</span><span class="token punctuation">(</span><span class="token class-name">WordCount<span class="token punctuation">.</span>IntSumReducer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">IntWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6E\u5F53\u524D\u4EFB\u52A1\u7684\u8F93\u5165\u548C\u8F93\u51FA\u6570\u636E\u7684\u8DEF\u5F84</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> otherArgs<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">FileInputFormat</span><span class="token punctuation">.</span><span class="token function">addInputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>otherArgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">FileOutputFormat</span><span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>otherArgs<span class="token punctuation">[</span>otherArgs<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u63D0\u4EA4\u4EFB\u52A1</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">IntSumReducer</span> <span class="token keyword">extends</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">IntWritable</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">IntSumReducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Reduce \u9636\u6BB5\u7684\u4E1A\u52A1\u903B\u8F91</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Text</span> key<span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntWritable</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">,</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
            <span class="token comment">// key: map \u9636\u6BB5\u8F93\u51FA\u7684key(\u5355\u8BCD,\u56E0\u4E3Amap\u9636\u6BB5\u8F93\u51FA\u7684\u662F&lt;\u5355\u8BCD,1&gt;\u8FD9\u79CD\u7ED3\u6784)\uFF1B </span>
            <span class="token comment">// value: \u8FED\u4EE3\u5668\uFF0C\u6570\u636E\u5728 map \u9636\u6BB5\u7ED3\u675F\u540E\uFF0CMR \u6846\u67B6\u8FDB\u884C\u4E86 shuffle \u64CD\u4F5C; value \u662F\u4E00\u7EC4\u76F8\u540Ckey\u7684value(map\u9636\u6BB5\u8F93\u51FA\u7684value)\u7684\u96C6\u5408\u3002</span>
            <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token class-name">IntWritable</span> val<span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Iterator</span> i$ <span class="token operator">=</span> values<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i$<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> sum <span class="token operator">+=</span> val<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                val <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">IntWritable</span><span class="token punctuation">)</span> i$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
            context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u6CE8\u610F\uFF1A\u6B64\u5904\u7684 Mapper \u7684\u6CDB\u578B\u3002\u524D\u4E24\u4E2A\u7C7B\u578B\u662F\u8F93\u5165\u7684 &lt;k,v&gt; \u7684\u7C7B\u578B\uFF0C\u540E\u4E24\u4E2A\u662F\u8F93\u51FA\u7684 &lt;k, v&gt; \u7684\u7C7B\u578B\u3002</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">TokenizerMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">IntWritable</span> one <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntWritable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Text</span> word <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">TokenizerMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Map \u9636\u6BB5\u4EFB\u52A1\u7684\u4E1A\u52A1\u903B\u8F91\u5B9A\u4E49\u5728\u6B64\u65B9\u6CD5\u4E2D</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">,</span> <span class="token class-name">Text</span> value<span class="token punctuation">,</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
            <span class="token comment">// key:\u4E00\u884C\u6587\u672C\u7684\u504F\u79FB\u91CF\uFF1Bvalue:\u4E00\u884C\u6587\u672C</span>
            <span class="token class-name">StringTokenizer</span> itr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringTokenizer</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// map \u63A5\u6536\u5230\u4E00\u884C\u6587\u672C\u6570\u636E\uFF0C\u628A\u6587\u672C\u6309\u7167\u6307\u5B9A\u5206\u9694\u7B26\u5207\u5206\uFF0C\u7136\u540E\u5F97\u5230\u5355\u8BCD\u3002map\u6700\u7EC8\u8F93\u51FA&lt;\u5355\u8BCD, 1&gt;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>itr<span class="token punctuation">.</span><span class="token function">hasMoreTokens</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>word<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>itr<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>word<span class="token punctuation">,</span> one<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><p>\u7ECF\u8FC7\u67E5\u770B\u5206\u6790\u5B98\u65B9WordCount\u6848\u4F8B\u6E90\u7801\u6211\u4EEC\u53D1\u73B0\u4E00\u4E2A\u7EDF\u8BA1\u5355\u8BCD\u6570\u91CF\u7684 MapReduce \u7A0B\u5E8F\u7684\u4EE3\u7801\u7531\u4E09\u4E2A\u90E8\u5206\u7EC4\u6210\uFF0C</p><ul><li>Mapper\u7C7B</li><li>Reducer\u7C7B</li><li>\u8FD0\u884C\u4F5C\u4E1A\u7684\u4EE3\u7801(Driver)</li></ul><p>Mapper \u7C7B\u7EE7\u627F\u4E86 <code>org.apache.hadoop.mapreduce.Mapper</code> \u7C7B\u91CD\u5199\u4E86\u5176\u4E2D\u7684 <code>map</code> \u65B9\u6CD5\uFF0C Reducer\u7C7B\u7EE7\u627F\u4E86 <code>org.apache.hadoop.mapreduce.Reducer</code> \u7C7B\u91CD\u5199\u4E86\u5176\u4E2D\u7684 <code>reduce</code> \u65B9\u6CD5\u3002</p><ul><li>\u91CD\u5199\u7684Map\u65B9\u6CD5\u4F5C\u7528: map\u65B9\u6CD5\u5176\u4E2D\u7684\u903B\u8F91\u5C31\u662F\u7528\u6237\u5E0C\u671Bmr\u7A0B\u5E8Fmap\u9636\u6BB5\u5982\u4F55\u5904\u7406\u7684\u903B\u8F91;</li><li>\u91CD\u5199\u7684Reduce\u65B9\u6CD5\u4F5C\u7528: reduce\u65B9\u6CD5\u5176\u4E2D\u7684\u903B\u8F91\u662F\u7528\u6237\u5E0C\u671Bmr\u7A0B\u5E8Freduce\u9636\u6BB5\u5982\u4F55\u5904\u7406\u7684\u903B\u8F91;</li></ul><h3 id="_6-2-1-hadoop\u5E8F\u5217\u5316" tabindex="-1"><a class="header-anchor" href="#_6-2-1-hadoop\u5E8F\u5217\u5316" aria-hidden="true">#</a> 6.2.1 Hadoop\u5E8F\u5217\u5316</h3><p>\u4E3A\u4EC0\u4E48\u8FDB\u884C\u5E8F\u5217\u5316?</p><p>\u5E8F\u5217\u5316\u4E3B\u8981\u662F\u6211\u4EEC\u901A\u8FC7\u7F51\u7EDC\u901A\u4FE1\u4F20\u8F93\u6570\u636E\u65F6\u6216\u8005\u628A\u5BF9\u8C61\u6301\u4E45\u5316\u5230\u6587\u4EF6\uFF0C\u9700\u8981\u628A\u5BF9\u8C61\u5E8F\u5217\u5316\u6210\u4E8C\u8FDB\u5236\u7684\u7ED3\u6784\u3002</p><p>\u89C2\u5BDF\u6E90\u7801\u65F6\u53D1\u73B0\u81EA\u5B9A\u4E49 Mapper \u7C7B\u4E0E\u81EA\u5B9A\u4E49 Reducer \u7C7B\u90FD\u6709\u6CDB\u578B\u7C7B\u578B\u7EA6\u675F\uFF0C\u6BD4\u5982\u81EA\u5B9A\u4E49 Mapper \u6709\u56DB\u4E2A\u5F62\u53C2\u7C7B\u578B\uFF0C\u4F46\u662F\u5F62\u53C2\u7C7B\u578B\u5E76\u4E0D\u662F\u5E38\u89C1\u7684java\u57FA\u672C\u7C7B\u578B\u3002</p><p>\u4E3A\u4EC0\u4E48 Hadoop \u8981\u9009\u62E9\u5EFA\u7ACB\u81EA\u5DF1\u7684\u5E8F\u5217\u5316\u683C\u5F0F\u800C\u4E0D\u4F7F\u7528 Java \u81EA\u5E26 serializable?</p><p>\u5E8F\u5217\u5316\u5728\u5206\u5E03\u5F0F\u7A0B\u5E8F\u4E2D\u975E\u5E38\u91CD\u8981\u3002\u5728 Hadoop \u4E2D\uFF0C\u96C6\u7FA4\u4E2D\u591A\u4E2A\u8282\u70B9\u7684\u8FDB\u7A0B\u95F4\u7684\u901A\u4FE1\u662F\u901A\u8FC7RPC(\u8FDC\u7A0B\u8FC7\u7A0B\u8C03\u7528: Remote Procedure Call)\u5B9E\u73B0; RPC \u5C06\u6D88\u606F\u5E8F\u5217\u5316\u6210\u4E8C\u8FDB\u5236\u6D41\u53D1\u9001\u5230\u8FDC\u7A0B\u8282\u70B9\uFF0C\u8FDC\u7A0B\u8282\u70B9\u518D\u5C06\u63A5\u6536\u5230\u7684\u4E8C\u8FDB\u5236\u6570\u636E\u53CD\u5E8F\u5217\u5316\u4E3A\u539F\u59CB\u7684\u6D88\u606F\uFF0C\u56E0\u6B64 RPC \u5F80\u5F80\u8FFD\u6C42\u5982\u4E0B\u7279\u70B9:</p><ul><li>\u7D27\u51D1: \u6570\u636E\u66F4\u7D27\u51D1\uFF0C\u80FD\u5145\u5206\u5229\u7528\u7F51\u7EDC\u5E26\u5BBD\u8D44\u6E90</li><li>\u5FEB\u901F: \u5E8F\u5217\u5316\u548C\u53CD\u5E8F\u5217\u5316\u7684\u6027\u80FD\u5F00\u9500\u66F4\u4F4E</li></ul><p>Hadoop \u4F7F\u7528\u7684\u662F\u81EA\u5DF1\u7684\u5E8F\u5217\u5316\u683C\u5F0F Writable,\u5B83\u6BD4 Java \u7684\u5E8F\u5217\u5316 serialization \u66F4\u7D27\u51D1\u901F\u5EA6\u66F4\u5FEB\u3002</p><p>\u4E00\u4E2A\u5BF9\u8C61\u4F7F\u7528 Serializable \u5E8F\u5217\u5316\u540E\uFF0C\u4F1A\u643A\u5E26\u5F88\u591A\u989D\u5916\u4FE1\u606F\u6BD4\u5982\uFF1A\u6821\u9A8C\u4FE1\u606F\uFF0CHeader\uFF0C\u7EE7\u627F\u4F53\u7CFB\u7B49\u3002</p><p>Java \u57FA\u672C\u7C7B\u578B\u4E0E Hadoop \u5E38\u7528\u5E8F\u5217\u5316\u7C7B\u578B</p><table><thead><tr><th>Java \u57FA\u672C\u7C7B\u578B</th><th>Hadoop Writable \u7C7B\u578B</th></tr></thead><tbody><tr><td>boolean</td><td>BooleanWritable</td></tr><tr><td>byte</td><td>ByteWritable</td></tr><tr><td>int</td><td>IntWritable</td></tr><tr><td>float</td><td>FloatWritable</td></tr><tr><td>long</td><td>LongWritable</td></tr><tr><td>double</td><td>DoubleWritable</td></tr><tr><td>String</td><td>Text</td></tr><tr><td>map</td><td>MapWritable</td></tr><tr><td>array</td><td>ArrayWritable</td></tr></tbody></table><h2 id="_6-3-mapreduce\u7F16\u7A0B\u89C4\u8303\u53CA\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-3-mapreduce\u7F16\u7A0B\u89C4\u8303\u53CA\u793A\u4F8B" aria-hidden="true">#</a> 6.3 MapReduce\u7F16\u7A0B\u89C4\u8303\u53CA\u793A\u4F8B</h2><h3 id="_6-3-1-mapper\u7C7B" tabindex="-1"><a class="header-anchor" href="#_6-3-1-mapper\u7C7B" aria-hidden="true">#</a> 6.3.1 Mapper\u7C7B</h3><ul><li>\u7528\u6237\u81EA\u5B9A\u4E49\u4E00\u4E2A Mapper \u7C7B\u7EE7\u627F Hadoop \u7684 Mapper \u7C7B</li><li>Mapper\u7684\u8F93\u5165\u6570\u636E\u662FKV\u5BF9\u7684\u5F62\u5F0F(\u7C7B\u578B\u53EF\u4EE5\u81EA\u5B9A\u4E49)</li><li>Map\u9636\u6BB5\u7684\u4E1A\u52A1\u903B\u8F91\u5B9A\u4E49\u5728 <code>map()</code> \u65B9\u6CD5\u4E2D</li><li>Mapper\u7684\u8F93\u51FA\u6570\u636E\u662FKV\u5BF9\u7684\u5F62\u5F0F(\u7C7B\u578B\u53EF\u4EE5\u81EA\u5B9A\u4E49)</li></ul><blockquote><p>\u6CE8\u610F: <code>map()</code> \u65B9\u6CD5\u5BF9\u8F93\u5165\u7684\u6BCF\u4E2AKV\u5BF9\u90FD\u4F1A\u8C03\u7528\u4E00\u6B21!!</p></blockquote><h3 id="_6-3-2-reducer\u7C7B" tabindex="-1"><a class="header-anchor" href="#_6-3-2-reducer\u7C7B" aria-hidden="true">#</a> 6.3.2 Reducer\u7C7B</h3><ul><li>\u7528\u6237\u81EA\u5B9A\u4E49 Reducer \u7C7B\u8981\u7EE7\u627F Hadoop \u7684 Reducer \u7C7B</li><li>Reducer \u7684\u8F93\u5165\u6570\u636E\u7C7B\u578B\u5BF9\u5E94 Mapper \u7684\u8F93\u51FA\u6570\u636E\u7C7B\u578B(KV \u5BF9)</li><li>Reducer \u7684\u4E1A\u52A1\u903B\u8F91\u5199\u5728 <code>reduce()</code> \u65B9\u6CD5\u4E2D</li><li><code>reduce()</code> \u65B9\u6CD5\u5BF9\u76F8\u540CK\u7684\u4E00\u7EC4KV\u8C03\u7528\u6267\u884C\u4E00\u6B21</li></ul><h3 id="_6-3-3-driver\u9636\u6BB5" tabindex="-1"><a class="header-anchor" href="#_6-3-3-driver\u9636\u6BB5" aria-hidden="true">#</a> 6.3.3 Driver\u9636\u6BB5</h3><p>\u521B\u5EFA\u63D0\u4EA4 YARN \u96C6\u7FA4\u8FD0\u884C\u7684 Job \u5BF9\u8C61\uFF0C\u5176\u4E2D\u5C01\u88C5\u4E86 MapReduce \u7A0B\u5E8F\u8FD0\u884C\u6240\u9700\u8981\u7684\u76F8\u5173\u53C2\u6570\u5165\u6570\u636E\u8DEF\u5F84\uFF0C\u8F93\u51FA\u6570\u636E\u8DEF\u5F84\u7B49\uFF0C \u4E5F\u76F8\u5F53\u4E8E\u662F\u4E00\u4E2AYARN\u96C6\u7FA4\u7684\u5BA2\u6237\u7AEF\uFF0C\u4E3B\u8981\u4F5C\u7528\u5C31\u662F\u63D0\u4EA4\u6211\u4EEC MapReduce \u7A0B\u5E8F\u8FD0\u884C\u3002</p><h3 id="_6-3-4-wordcount-\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_6-3-4-wordcount-\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 6.3.4 WordCount \u4EE3\u7801\u5B9E\u73B0</h3><h4 id="_6-3-4-1-\u9700\u6C42" tabindex="-1"><a class="header-anchor" href="#_6-3-4-1-\u9700\u6C42" aria-hidden="true">#</a> 6.3.4.1 \u9700\u6C42</h4><p>\u5728\u7ED9\u5B9A\u7684\u6587\u672C\u6587\u4EF6\u4E2D\u7EDF\u8BA1\u8F93\u51FA\u6BCF\u4E00\u4E2A\u5355\u8BCD\u51FA\u73B0\u7684\u603B\u6B21\u6570</p><p>\u8F93\u5165\u6570\u636E: wc.txt;</p><p>\u8F93\u51FA\u6570\u636E:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>apache  2
clickhouse  2
hadoop  1
mapreduce   1
spark   2
xiaoming    1
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_6-3-4-2-\u5177\u4F53\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#_6-3-4-2-\u5177\u4F53\u6B65\u9AA4" aria-hidden="true">#</a> 6.3.4.2 \u5177\u4F53\u6B65\u9AA4</h4><p>\u6309\u7167 MapReduce \u7F16\u7A0B\u89C4\u8303\uFF0C\u5206\u522B\u7F16\u5199 <code>Mapper</code>\uFF0C<code>Reducer</code>\uFF0C<code>Driver</code>\u3002</p><h5 id="_1-\u65B0\u5EFAmaven\u5DE5\u7A0B" tabindex="-1"><a class="header-anchor" href="#_1-\u65B0\u5EFAmaven\u5DE5\u7A0B" aria-hidden="true">#</a> 1. \u65B0\u5EFAmaven\u5DE5\u7A0B</h5><ol><li>\u5BFC\u5165 <code>hadoop</code> \u4F9D\u8D56\u548C maven \u6253\u5305\u63D2\u4EF6</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--maven\u6253\u5305\u63D2\u4EF6 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-assembly-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptorRefs</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptorRef</span><span class="token punctuation">&gt;</span></span>jar-with-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptorRef</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptorRefs</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>make-assembly<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>single<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><ol start="2"><li>\u6DFB\u52A0log4j.properties</li></ol><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">log4j.rootLogger</span><span class="token punctuation">=</span><span class="token value attr-value">INFO, stdout</span>
<span class="token key attr-name">log4j.appender.stdout</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.log4j.ConsoleAppender</span>
<span class="token key attr-name">log4j.appender.stdout.layout</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.log4j.PatternLayout</span>
<span class="token key attr-name">log4j.appender.stdout.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token value attr-value">%d %p [%c] - %m%n</span>
<span class="token key attr-name">log4j.appender.logfile</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.log4j.FileAppender</span>
<span class="token key attr-name">log4j.appender.logfile.File</span><span class="token punctuation">=</span><span class="token value attr-value">target/spring.log</span>
<span class="token key attr-name">log4j.appender.logfile.layout</span><span class="token punctuation">=</span><span class="token value attr-value">org.apache.log4j.PatternLayout</span>
<span class="token key attr-name">log4j.appender.logfile.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token value attr-value">%d %p [%c] - %m%n</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="_2-\u6574\u4F53\u601D\u8DEF\u68B3\u7406-\u4EFF\u7167\u6E90\u7801" tabindex="-1"><a class="header-anchor" href="#_2-\u6574\u4F53\u601D\u8DEF\u68B3\u7406-\u4EFF\u7167\u6E90\u7801" aria-hidden="true">#</a> 2. \u6574\u4F53\u601D\u8DEF\u68B3\u7406(\u4EFF\u7167\u6E90\u7801)</h5><p>Map\u9636\u6BB5</p><ol><li><code>map()</code> \u65B9\u6CD5\u4E2D\u628A\u4F20\u5165\u7684\u6570\u636E\u8F6C\u4E3AString\u7C7B\u578B</li><li>\u6839\u636E\u7A7A\u683C\u5207\u5206\u51FA\u5355\u8BCD</li><li>\u8F93\u51FA <code>&lt;\u5355\u8BCD\uFF0C1&gt;</code></li></ol><p>Reduce\u9636\u6BB5</p><ol><li>\u6C47\u603B\u5404\u4E2A key(\u5355\u8BCD)\u7684\u4E2A\u6570\uFF0C\u904D\u5386 value \u6570\u636E\u8FDB\u884C\u7D2F\u52A0</li><li>\u8F93\u51FA key \u7684\u603B\u6570</li></ol><p>Driver</p><ol><li>\u83B7\u53D6\u914D\u7F6E\u6587\u4EF6\u5BF9\u8C61\uFF0C\u83B7\u53D6 job \u5BF9\u8C61\u5B9E\u4F8B</li><li>\u6307\u5B9A\u7A0B\u5E8F jar \u7684\u672C\u5730\u8DEF\u5F84</li><li>\u6307\u5B9A Mapper / Reducer \u7C7B</li><li>\u6307\u5B9A Mapper \u8F93\u51FA\u7684 kv \u6570\u636E\u7C7B\u578B</li><li>\u6307\u5B9A\u6700\u7EC8\u8F93\u51FA\u7684 kv \u6570\u636E\u7C7B\u578B</li><li>\u6307\u5B9A job \u5904\u7406\u7684\u539F\u59CB\u6570\u636E\u8DEF\u5F84</li><li>\u6307\u5B9A job \u8F93\u51FA\u7ED3\u679C\u8DEF\u5F84</li><li>\u63D0\u4EA4\u4F5C\u4E1A</li></ol><h5 id="_3-\u7F16\u5199-mapper-\u7C7B" tabindex="-1"><a class="header-anchor" href="#_3-\u7F16\u5199-mapper-\u7C7B" aria-hidden="true">#</a> 3. \u7F16\u5199 Mapper \u7C7B</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 1.\u7EE7\u627F Mapper \u7C7B</span>
<span class="token comment">// 2.Mapper \u7C7B\u7684\u6CDB\u578B\u53C2\u6570\u5171\u56DB\u4E2A\uFF0C\u4E24\u5BF9KV\u3002</span>
<span class="token comment">// 2.1.\u7B2C\u4E00\u5BF9KV\u662F map \u8F93\u5165\u53C2\u6570\u7C7B\u578B (\u6587\u672C\u504F\u79FB\u91CF\uFF0C\u4E00\u884C\u6587\u672C\u5185\u5BB9)</span>
<span class="token comment">// 2.2.\u7B2C\u4E8C\u5BF9KV\u662F map \u8F93\u51FA\u53C2\u6570\u7C7B\u578B (\u5355\u8BCD\uFF0C1)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WordCountMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">Text</span> word <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IntWritable</span> one <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntWritable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">LongWritable</span> key<span class="token punctuation">,</span> <span class="token class-name">Text</span> value<span class="token punctuation">,</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u4E3B\u8981\u4E1A\u52A1\u903B\u8F91\uFF1A</span>
        <span class="token comment">// 1.\u63A5\u6536\u5230\u6587\u672C\u5185\u5BB9\uFF0C\u8F6C\u6362\u4E3A string \u7C7B\u578B</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.\u6309\u7167\u7A7A\u683C\u8FDB\u884C\u5207\u5206</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> words <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.\u8F93\u51FA &lt;\u5355\u8BCD\uFF0C1&gt;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> s <span class="token operator">:</span> words<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            word<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
            context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> one<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h5 id="_4-\u7F16\u5199-reducer-\u7C7B" tabindex="-1"><a class="header-anchor" href="#_4-\u7F16\u5199-reducer-\u7C7B" aria-hidden="true">#</a> 4. \u7F16\u5199 Reducer \u7C7B</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u7EE7\u627F\u7684 Reducer \u7C7B\u6709\u56DB\u4E2A\u6CDB\u578B\u53C2\u6570</span>
<span class="token comment">// \u4E24\u5BF9KV\uFF1A\u7B2C\u4E00\u5BF9\u7C7B\u578B\u8981\u4E0E Mapper \u8F93\u51FA\u7C7B\u578B\u4FDD\u6301\u4E00\u81F4\uFF1B\u7B2C\u4E8C\u5BF9KV\u81EA\u5DF1\u8BBE\u8BA1\u7684\u8F93\u51FA\u7ED3\u679C\u6570\u636E</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WordCountReducer</span> <span class="token keyword">extends</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token class-name">IntWritable</span> total <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// key: map \u65B9\u6CD5\u8F93\u51FA\u7684 key\uFF0C\u672C\u6848\u4F8B\u4E2D\u662F\u5355\u8BCD</span>
    <span class="token comment">// values: \u4E00\u7EC4key\u76F8\u540C\u7684value\uFF0C\u7EC4\u6210\u7684\u96C6\u5408</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Text</span> key<span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntWritable</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">,</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u904D\u5386 values\uFF0C\u7D2F\u52A0\u7ED3\u679C</span>
        <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">IntWritable</span> value <span class="token operator">:</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> val <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sum <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u76F4\u63A5\u8F93\u51FA\u5F53\u524D key \u5BF9\u5E94\u7684 sum \u503C\uFF0C\u7ED3\u679C\u5C31\u662F\u5355\u8BCD\u51FA\u73B0\u7684\u603B\u6B21\u6570</span>
        total<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h5 id="_5-\u7F16\u5199-driver-\u7C7B" tabindex="-1"><a class="header-anchor" href="#_5-\u7F16\u5199-driver-\u7C7B" aria-hidden="true">#</a> 5. \u7F16\u5199 Driver \u7C7B</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u5C01\u88C5\u4EFB\u52A1\u5E76\u63D0\u4EA4\u8FD0\u884C</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WordCountDriver</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. \u83B7\u53D6\u914D\u7F6E\u6587\u4EF6\u5BF9\u8C61\uFF0C\u83B7\u53D6job\u5BF9\u8C61\u5B9E\u4F8B</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Job</span> job <span class="token operator">=</span> <span class="token class-name">Job</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span> <span class="token string">&quot;WordCountDriver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. \u6307\u5B9A\u7A0B\u5E8Fjar\u7684\u672C\u5730\u8DEF\u5F84</span>
        job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">WordCountDriver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. \u6307\u5B9AMapper/Reducer\u7C7B</span>
        job<span class="token punctuation">.</span><span class="token function">setMapperClass</span><span class="token punctuation">(</span><span class="token class-name">WordCountMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setReducerClass</span><span class="token punctuation">(</span><span class="token class-name">WordCountReducer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. \u6307\u5B9AMapper\u8F93\u51FA\u7684kv\u6570\u636E\u7C7B\u578B</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">IntWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. \u6307\u5B9A\u6700\u7EC8\u8F93\u51FA\u7684kv\u6570\u636E\u7C7B\u578B</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">IntWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 6. \u6307\u5B9Ajob\u5904\u7406\u7684\u539F\u59CB\u6570\u636E\u8DEF\u5F84</span>
        <span class="token class-name">FileInputFormat</span><span class="token punctuation">.</span><span class="token function">setInputPaths</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 7. \u6307\u5B9Ajob\u8F93\u51FA\u7ED3\u679C\u8DEF\u5F84</span>
        <span class="token class-name">FileOutputFormat</span><span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 8. \u63D0\u4EA4\u4F5C\u4E1A</span>
        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// JVM \u9000\u51FA\uFF1A0\u6B63\u5E38\u9000\u51FA\uFF1B\u975E0\u9519\u8BEF\u9000\u51FA</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>flag <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h5 id="_6-\u8FD0\u884C\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#_6-\u8FD0\u884C\u4EFB\u52A1" aria-hidden="true">#</a> 6. \u8FD0\u884C\u4EFB\u52A1</h5><ol><li>\u672C\u5730\u6A21\u5F0F</li></ol><p>\u8BBE\u7F6E\u7A0B\u5E8F\u5B9E\u9645\u53C2\u6570\uFF0C\u53C2\u6570\u95F4\u4F7F\u7528\u7A7A\u683C\u5206\u5272</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>/Users/faustine/Downloads/wc.txt /Users/faustine/Downloads/output
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>\u6CE8\u610F\uFF1A\u672C\u5730idea\u8FD0\u884Cmr\u4EFB\u52A1\u4E0E\u96C6\u7FA4\u6CA1\u6709\u4EFB\u4F55\u5173\u7CFB\uFF0C\u6CA1\u6709\u63D0\u4EA4\u4EFB\u52A1\u5230yarn\u96C6\u7FA4\uFF0C\u662F\u5728\u672C\u5730\u4F7F\u7528\u591A\u7EBF\u7A0B\u7684\u65B9\u5F0F\u6A21\u62DF\u7684mr\u7684\u8FD0\u884C\u3002</p></blockquote><p>\u67E5\u770B\u8F93\u51FA\u7ED3\u679C</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">ls</span> -al

total <span class="token number">24</span>
drwxr-xr-x@  <span class="token number">6</span> faustine  staff  <span class="token number">192</span> <span class="token number">12</span> <span class="token number">26</span> <span class="token number">19</span>:37 <span class="token builtin class-name">.</span>
drwx------@ <span class="token number">18</span> faustine  staff  <span class="token number">576</span> <span class="token number">12</span> <span class="token number">26</span> <span class="token number">19</span>:37 <span class="token punctuation">..</span>
-rw-r--r--   <span class="token number">1</span> faustine  staff    <span class="token number">8</span> <span class="token number">12</span> <span class="token number">26</span> <span class="token number">19</span>:37 ._SUCCESS.crc
-rw-r--r--   <span class="token number">1</span> faustine  staff   <span class="token number">12</span> <span class="token number">12</span> <span class="token number">26</span> <span class="token number">19</span>:37 .part-r-00000.crc
-rw-r--r--   <span class="token number">1</span> faustine  staff    <span class="token number">0</span> <span class="token number">12</span> <span class="token number">26</span> <span class="token number">19</span>:37 _SUCCESS
-rw-r--r--   <span class="token number">1</span> faustine  staff   <span class="token number">46</span> <span class="token number">12</span> <span class="token number">26</span> <span class="token number">19</span>:37 part-r-00000
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="2"><li>YARN \u96C6\u7FA4\u6A21\u5F0F</li></ol><ul><li>\u628A\u7A0B\u5E8F\u6253\u6210 jar \u5305\uFF0C\u6539\u540D\u4E3A <code>wc.jar</code>\uFF0C\u4E0A\u4F20\u5230Hadoop\u96C6\u7FA4</li><li>\u542F\u52A8 Hadoop \u96C6\u7FA4(Hdfs, Yarn)</li><li>\u4F7F\u7528 Hadoop \u547D\u4EE4\u63D0\u4EA4\u4EFB\u52A1\u8FD0\u884C</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>hadoop jar wc.jar com.faustine.mr.wc.WordCountDriver /wcinput /wcoutput
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>\u51C6\u5907\u7684\u539F\u59CB\u6570\u636E\u6587\u4EF6\uFF0C\u9700\u8981\u4E0A\u4F20\u5230HDFS\u7684\u8DEF\u5F84\uFF0C\u4E0D\u80FD\u662F\u672C\u5730\u8DEF\u5F84\uFF0C\u56E0\u4E3A\u8DE8\u8282\u70B9\u8FD0\u884C\u65E0\u6CD5\u83B7\u53D6\u6570\u636E!!</p></blockquote><p>\u6267\u884C\u7ED3\u679C</p><p><img src="`+p+`" alt="YARN\u96C6\u7FA4\u6267\u884C\u7ED3\u679C"></p><h2 id="_6-4-\u5E8F\u5217\u5316writable\u63A5\u53E3" tabindex="-1"><a class="header-anchor" href="#_6-4-\u5E8F\u5217\u5316writable\u63A5\u53E3" aria-hidden="true">#</a> 6.4 \u5E8F\u5217\u5316Writable\u63A5\u53E3</h2><p>\u57FA\u672C\u5E8F\u5217\u5316\u7C7B\u578B\u5F80\u5F80\u4E0D\u80FD\u6EE1\u8DB3\u6240\u6709\u9700\u6C42\uFF0C\u6BD4\u5982\u5728 Hadoop \u6846\u67B6\u5185\u90E8\u4F20\u9012\u4E00\u4E2A\u81EA\u5B9A\u4E49bean\u5BF9\u8C61\uFF0C\u90A3\u4E48\u8BE5\u5BF9\u8C61\u5C31\u9700\u8981\u5B9E\u73B0 <code>Writable</code> \u5E8F\u5217\u5316\u63A5\u53E3\u3002</p><h3 id="_6-4-1-\u5B9E\u73B0-writable-\u5E8F\u5217\u5316\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#_6-4-1-\u5B9E\u73B0-writable-\u5E8F\u5217\u5316\u6B65\u9AA4" aria-hidden="true">#</a> 6.4.1 \u5B9E\u73B0 Writable \u5E8F\u5217\u5316\u6B65\u9AA4</h3><ol><li>\u5FC5\u987B\u5B9E\u73B0 <code>Writable</code> \u63A5\u53E3</li><li>\u53CD\u5E8F\u5217\u5316\u65F6\uFF0C\u9700\u8981\u53CD\u5C04\u8C03\u7528\u7A7A\u53C2\u6784\u9020\u51FD\u6570\uFF0C\u6240\u4EE5\u5FC5\u987B\u6709\u7A7A\u53C2\u6784\u9020</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CustomBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="3"><li>\u91CD\u5199\u5E8F\u5217\u5316\u65B9\u6CD5</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">DataOutput</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="4"><li>\u91CD\u5199\u53CD\u5E8F\u5217\u5316\u65B9\u6CD5</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readFields</span><span class="token punctuation">(</span><span class="token class-name">DataInput</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="5"><li>\u53CD\u5E8F\u5217\u5316\u7684\u5B57\u6BB5\u987A\u5E8F\u548C\u5E8F\u5217\u5316\u5B57\u6BB5\u7684\u987A\u5E8F\u5FC5\u987B\u5B8C\u5168\u4E00\u81F4</li><li>\u65B9\u4FBF\u5C55\u793A\u7ED3\u679C\u6570\u636E\uFF0C\u9700\u8981\u91CD\u5199 Bean \u5BF9\u8C61\u7684 <code>toString()</code> \u65B9\u6CD5\uFF0C\u53EF\u4EE5\u81EA\u5B9A\u4E49\u5206\u9694\u7B26</li><li>\u5982\u679C\u81EA\u5B9A\u4E49 Bean \u5BF9\u8C61\u9700\u8981\u653E\u5728 Mapper \u8F93\u51FAKV\u4E2D\u7684K, \u5219\u8BE5\u5BF9\u8C61\u8FD8\u9700\u5B9E\u73B0 <code>Comparable</code> \u63A5\u53E3\uFF0C\u56E0\u4E3A\u56E0\u4E3A MapReduce \u6846\u4E2D\u7684 Shuffle \u8FC7\u7A0B\u8981\u6C42key\u5FC5\u987B\u80FD\u6392\u5E8F!!</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">CustomBean</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u81EA\u5B9A\u4E49\u6392\u5E8F\u89C4\u5219</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">&gt;</span> o<span class="token punctuation">.</span><span class="token function">getNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>\u6392\u5E8F\u5185\u5BB9\u4E13\u95E8\u6848\u4F8B\u8BB2\u89E3!!</p></blockquote><h3 id="_6-4-2-writable-\u63A5\u53E3\u6848\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-4-2-writable-\u63A5\u53E3\u6848\u4F8B" aria-hidden="true">#</a> 6.4.2 Writable \u63A5\u53E3\u6848\u4F8B</h3><ol><li>\u9700\u6C42</li></ol><p>\u7EDF\u8BA1\u6BCF\u53F0\u667A\u80FD\u97F3\u7BB1\u8BBE\u5907\u5185\u5BB9\u64AD\u653E\u65F6\u957F</p><p>\u539F\u59CB\u65E5\u5FD7\u683C\u5F0F</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>001     001577c3        kar_890809              120.196.100.99          1116                954                      200
\u65E5\u5FD7ID    \u8BBE\u5907ID        appkey(\u5408\u4F5C\u786C\u4EF6\u5382\u5546)          \u7F51\u7EDCIP             \u81EA\u7531\u5185\u5BB9\u65F6\u957F(\u79D2)      \u7B2C\u4E09\u65B9\u5185\u5BB9\u65F6\u957F(\u79D2)      \u7F51\u7EDC\u72B6\u6001\u7801
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u8F93\u51FA\u7ED3\u679C</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>001577c3            11160               9540                     20700
\u8BBE\u5907ID            \u81EA\u6709\u5185\u5BB9\u65F6\u957F(\u79D2)       \u7B2C\u4E09\u65B9\u5185\u5BB9\u65F6\u957F(\u79D2)          \u603B\u65F6\u957F      
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>map()</code> \u65B9\u6CD5\u8F93\u51FA\u7684kv\u4EE5\u53CA\u5177\u4F53\u7C7B\u578B\u5982\u4F55\u786E\u5B9A\uFF1F</p><p>mr \u4E2D <code>map()</code> \u65B9\u6CD5\u8F93\u51FA\u7684 kv \u4E2D\u7684 k\uFF0C\u5982\u679C\u662F\u76F8\u540C key, \u5219\u4F1A\u53BB\u5F80\u540C\u4E00\u4E2A reducer \u8C03\u7528 <code>reduce()</code> \u65B9\u6CD5</p><p><code>reduce()</code> \u65B9\u6CD5\u4E2D\uFF0C\u8F93\u5165\u53C2\u6570 key: <code>map()</code> \u65B9\u6CD5\u8F93\u51FA\u7684\u67D0\u4E2A key; value: \u662F\u4E00\u4E2A\u96C6\u5408\uFF0C\u8FD9\u4E2A\u96C6\u5408\u4E2D\u7684\u6570\u636E\u90FD\u6765\u81EA <code>map()</code> \u8F93\u51FA\u7684 key/value\uFF0C\u800C\u4E14\u662F key \u76F8\u540C\u7684\u6240\u6709 KV \u5BF9\u7684 value \u96C6\u5408\u3002</p><p>\u6574\u4F53\u601D\u8DEF\u5206\u6790\uFF1A</p><p>Map \u9636\u6BB5\uFF1A</p><ul><li>\u8BFB\u53D6\u4E00\u884C\u6587\u672C\u6570\u636E\uFF0C\u6309\u7167\u5236\u8868\u7B26\u5207\u5206\u51FA\u8BBE\u5907ID</li><li>\u62BD\u53D6\u51FA\u81EA\u6709\u5185\u5BB9\u65F6\u957F\u3001\u7B2C\u4E09\u65B9\u5185\u5BB9\u65F6\u957F\u3001\u8BBE\u5907ID</li><li>\u8F93\u51FA\u6570\u636E\uFF08Key -&gt; \u8BBE\u5907ID; value -&gt; \u5C01\u88C5\u4E00\u4E2A Bean \u5BF9\u8C61, \u7531 Bean \u5BF9\u8C61\u643A\u5E26\u81EA\u6709\u65F6\u957F\u3001\u7B2C\u4E09\u65B9\u5185\u5BB9\u65F6\u957F\u3001\u8BBE\u5907ID\uFF09</li><li>\u81EA\u5B9A\u4E49 Bean \u5BF9\u8C61\u4F5C\u4E3A Value \u8F93\u51FA\uFF0C\u9700\u8981\u5B9E\u73B0 Writable \u5E8F\u5217\u5316\u63A5\u53E3</li></ul><p>Reduce \u9636\u6BB5\uFF1A</p><ul><li>\u5728 <code>reduce()</code> \u65B9\u6CD5\u4E2D\u76F4\u63A5\u904D\u5386\u8FED\u4EE3\u5668\uFF0C\u7D2F\u52A0\u65F6\u957F\u7136\u540E\u8F93\u51FA\u5373\u53EF</li></ul><ol start="2"><li>\u7F16\u5199 MapReduce \u7A0B\u5E8F</li></ol><p>\u521B\u5EFASpeakBean\u5BF9\u8C61</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u8FD9\u4E2A\u7C7B\u578B\u662F map \u8F93\u51FA\u7684 KV \u4E2D\u7684 Value \u7684\u7C7B\u578B\uFF0C\u9700\u8981\u5B9E\u73B0 Writable \u5E8F\u5217\u5316\u63A5\u53E3
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpeakBean</span> <span class="token keyword">implements</span> <span class="token class-name">Writable</span> <span class="token punctuation">{</span>

    <span class="token comment">// \u5B9A\u4E49\u5C5E\u6027</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> selfDuration<span class="token punctuation">;</span> <span class="token comment">// \u81EA\u6709\u5185\u5BB9\u65F6\u957F</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> thirdPartDuration<span class="token punctuation">;</span> <span class="token comment">// \u7B2C\u4E09\u65B9\u5185\u5BB9\u65F6\u957F</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> deviceId<span class="token punctuation">;</span> <span class="token comment">// \u8BBE\u5907ID</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> sumDuration<span class="token punctuation">;</span> <span class="token comment">// \u603B\u65F6\u957F</span>

    <span class="token keyword">public</span> <span class="token class-name">SpeakBean</span><span class="token punctuation">(</span><span class="token class-name">Long</span> selfDuration<span class="token punctuation">,</span> <span class="token class-name">Long</span> thirdPartDuration<span class="token punctuation">,</span> <span class="token class-name">String</span> deviceId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>selfDuration <span class="token operator">=</span> selfDuration<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>thirdPartDuration <span class="token operator">=</span> thirdPartDuration<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>deviceId <span class="token operator">=</span> deviceId<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sumDuration <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selfDuration <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>thirdPartDuration<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u5E8F\u5217\u5316\u65B9\u6CD5: \u5C31\u662F\u628A\u5185\u5BB9\u8F93\u51FA\u5230\u7F51\u7EDC\u6216\u6587\u672C\u4E2D</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">DataOutput</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        out<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>selfDuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>thirdPartDuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>deviceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>sumDuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u53CD\u5E8F\u5217\u5316\u65B9\u6CD5</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readFields</span><span class="token punctuation">(</span><span class="token class-name">DataInput</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>selfDuration <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u81EA\u6709\u65F6\u957F</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>thirdPartDuration <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u7B2C\u4E09\u65B9\u65F6\u957F</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>deviceId <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u8BBE\u5907ID</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sumDuration <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u603B\u65F6\u957F</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>\u7F16\u5199Mapper\u7C7B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u56DB\u4E2A\u53C2\u6570\u5206\u4E3A\u4E24\u5BF9 KV</span>
<span class="token comment">// \u7B2C\u4E00\u5BF9\uFF1Amap \u8F93\u5165\u53C2\u6570\u7684 KV \u7C7B\u578B\u3002K -&gt; \u4E00\u884C\u6587\u672C\u504F\u79FB\u91CF; V -&gt; \u4E00\u884C\u6587\u672C\u5185\u5BB9</span>
<span class="token comment">// \u7B2C\u4E8C\u5BF9\uFF1Amap \u8F93\u51FA\u53C2\u6570\u7C7B\u578B\u3002K -&gt; map \u8F93\u51FA\u7684 key \u7C7B\u578B; V -&gt; map \u8F93\u51FA\u7684 value \u7C7B\u578B</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpeakMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">SpeakBean</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token class-name">Text</span> device_id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">LongWritable</span> key<span class="token punctuation">,</span> <span class="token class-name">Text</span> value<span class="token punctuation">,</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">SpeakBean</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. \u8F6C\u6362\u63A5\u6536\u5230\u7684 Text \u6570\u636E\u4E3A String \u7C7B\u578B</span>
        <span class="token class-name">String</span> line <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. \u6309\u7167\u5236\u8868\u7B26\u8FDB\u884C\u5207\u5206\uFF0C\u5F97\u5230\u81EA\u6709\u5185\u5BB9\u65F6\u957F\u3001\u7B2C\u4E09\u65B9\u5185\u5BB9\u65F6\u957F\u3001\u8BBE\u5907ID\u5E76\u5C01\u88C5\u4E3A SpeakBean</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> selfDuration <span class="token operator">=</span> fields<span class="token punctuation">[</span>fields<span class="token punctuation">.</span>length <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> thirdPartDuration <span class="token operator">=</span> fields<span class="token punctuation">[</span>fields<span class="token punctuation">.</span>length <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> deviceId <span class="token operator">=</span> fields<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">SpeakBean</span> speakBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeakBean</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>selfDuration<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>thirdPartDuration<span class="token punctuation">)</span><span class="token punctuation">,</span> deviceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. \u76F4\u63A5\u8F93\u51FA (K -&gt; \u8BBE\u5907ID, V -&gt; SpeakBean)</span>
        device_id<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>deviceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>device_id<span class="token punctuation">,</span> speakBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>\u7F16\u5199 Reducer \u7C7B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpeakReducer</span> <span class="token keyword">extends</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">SpeakBean</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">SpeakBean</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Text</span> key<span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpeakBean</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">,</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">SpeakBean</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">SpeakBean</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5B9A\u4E49\u65F6\u957F\u7D2F\u52A0\u7684\u521D\u59CB\u503C</span>
        <span class="token class-name">Long</span> self_duration <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>
        <span class="token class-name">Long</span> third_duration <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>

        <span class="token comment">// reduce() \u65B9\u6CD5\u7684 key -&gt; map \u8F93\u51FA\u7684\u67D0\u4E00\u4E2A key; value -&gt; map \u8F93\u51FA\u7684 KV \u5BF9\u4E2D\u76F8\u540Ckey\u7EC4\u6210\u7684\u4E00\u4E2A\u96C6\u5408</span>
        <span class="token comment">// \u904D\u5386\u8FED\u4EE3\u5668\uFF0C\u7D2F\u52A0\u65F6\u957F\u5373\u53EF</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SpeakBean</span> bean <span class="token operator">:</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Long</span> selfDuration <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getSelfDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Long</span> thirdPartDuration <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getThirdPartDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            self_duration <span class="token operator">+=</span> selfDuration<span class="token punctuation">;</span>
            third_duration <span class="token operator">+=</span> thirdPartDuration<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u5C01\u88C5\u6210\u4E00\u4E2ABean\u5BF9\u8C61\u8F93\u51FA</span>
        <span class="token class-name">SpeakBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeakBean</span><span class="token punctuation">(</span>self_duration<span class="token punctuation">,</span> third_duration<span class="token punctuation">,</span> key<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>\u7F16\u5199\u9A71\u52A8</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpeakDriver</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Job</span> job <span class="token operator">=</span> <span class="token class-name">Job</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span> <span class="token string">&quot;speakDriver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6E Jar \u5305\u672C\u5730\u8DEF\u5F84</span>
        job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">SpeakDriver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u4F7F\u7528\u7684 Mapper \u548C Reducer</span>
        job<span class="token punctuation">.</span><span class="token function">setMapperClass</span><span class="token punctuation">(</span><span class="token class-name">SpeakMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setReducerClass</span><span class="token punctuation">(</span><span class="token class-name">SpeakReducer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6E Map \u7684\u8F93\u51FA KV \u7C7B\u578B</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">SpeakBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6E Reduce \u8F93\u51FA</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">SpeakBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BFB\u53D6\u6570\u636E\u7684\u8DEF\u5F84</span>
        <span class="token class-name">FileInputFormat</span><span class="token punctuation">.</span><span class="token function">setInputPaths</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileOutputFormat</span><span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u63D0\u4EA4\u4EFB\u52A1</span>
        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>flag <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>\u603B\u7ED3</p><ul><li>\u7ED3\u5408\u4E1A\u52A1\u8BBE\u8BA1 Map \u8F93\u51FA\u7684 Key \u548C Value\uFF0C\u5229\u7528 Key \u76F8\u540C\u5219\u53BB\u5F80\u540C\u4E00\u4E2A Reduce \u7684\u7279\u70B9\uFF01</li><li><code>map()</code> \u65B9\u6CD5\u4E2D\u83B7\u53D6\u5230\u7684\u53EA\u662F\u4E00\u884C\u6587\u672C\uFF0C\u5C3D\u91CF\u4E0D\u505A\u805A\u5408\u8FD0\u7B97</li><li><code>reduce()</code> \u65B9\u6CD5\u4E2D\u7684\u53C2\u6570\u8981\u6E05\u695A\u542B\u4E49</li></ul><h2 id="_6-5-mapreduce\u539F\u7406\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_6-5-mapreduce\u539F\u7406\u5206\u6790" aria-hidden="true">#</a> 6.5 MapReduce\u539F\u7406\u5206\u6790</h2><h3 id="_6-5-1-maptask\u8FD0\u884C\u673A\u5236\u8BE6\u89E3" tabindex="-1"><a class="header-anchor" href="#_6-5-1-maptask\u8FD0\u884C\u673A\u5236\u8BE6\u89E3" aria-hidden="true">#</a> 6.5.1 MapTask\u8FD0\u884C\u673A\u5236\u8BE6\u89E3</h3><p>MapTask\u6D41\u7A0B</p><p><img src="`+t+'" alt="MapTask\u6D41\u7A0B\u56FE"></p><p>\u8BE6\u7EC6\u6B65\u9AA4:</p><ol><li>\u9996\u5148\uFF0C\u8BFB\u53D6\u6570\u636E\u7EC4\u4EF6 InputFormat(\u9ED8\u8BA4TextInputFormat)\u4F1A\u901A\u8FC7 <code>getSplits()</code> \u65B9\u6CD5\u5BF9\u8F93\u5165\u76EE\u5F55\u4E2D\u7684\u6587\u4EF6\u8FDB\u884C<em>\u903B\u8F91\u5207\u7247</em>\u89C4\u5212\u5F97\u5230splits\uFF0C\u6709\u591A\u5C11\u4E2Asplit\u5C31\u5BF9\u5E94\u542F\u52A8\u591A\u5C11\u4E2AMapTask\u3002split\u4E0Eblock\u7684\u5BF9\u5E94\u5173\u7CFB\u9ED8\u8BA4\u662F\u4E00\u5BF9\u4E00\u3002</li><li>\u5C06\u8F93\u5165\u6587\u4EF6\u5207\u5206\u4E3Asplits\u4E4B\u540E\uFF0C\u7531 RecordReader \u5BF9\u8C61(\u9ED8\u8BA4LineRecordReader)\u8FDB\u884C\u8BFB\u53D6\uFF0C\u4EE5 &quot;\\n&quot; \u4F5C\u4E3A\u5206\u9694\u7B26\uFF0C\u8BFB\u53D6\u4E00\u884C\u6570\u636E\uFF0C\u8FD4\u56DE&lt;key\uFF0Cvalue&gt;\u3002Key\u8868\u793A\u6BCF\u884C\u9996\u5B57\u7B26\u504F\u79FB\u503C\uFF0Cvalue\u8868\u793A\u8FD9\u4E00\u884C\u6587\u672C\u5185\u5BB9\u3002</li><li>\u8BFB\u53D6split\u8FD4\u56DE\u7684&lt;key,value&gt;\uFF0C\u8FDB\u5165\u7528\u6237\u81EA\u5DF1\u7EE7\u627F\u7684 Mapper \u7C7B\u4E2D\uFF0C\u6267\u884C\u7528\u6237\u91CD\u5199\u7684 <code>map</code> \u65B9\u6CD5\u3002RecordReader \u6BCF\u8BFB\u53D6\u4E00\u884C\u8FD9\u91CC\u5C31\u8C03\u7528\u4E00\u6B21\u3002</li><li><code>map</code> \u903B\u8F91\u5B8C\u4E4B\u540E\uFF0C\u5C06map\u7684\u6BCF\u6761\u7ED3\u679C\u901A\u8FC7 <code>context.write</code> \u8FDB\u884Ccollect\u6570\u636E\u6536\u96C6\u3002\u5728collect\u4E2D\uFF0C\u4F1A\u5148\u5BF9\u5176\u8FDB\u884C\u5206\u533A\u5904\u7406\uFF0C\u9ED8\u8BA4\u4F7F\u7528 <code>HashPartitioner</code>\u3002</li></ol><blockquote><p>MapReduce\u63D0\u4F9BPartitioner\u63A5\u53E3\uFF0C\u5B83\u7684\u4F5C\u7528\u5C31\u662F\u6839\u636Ekey\u6216value\u53CAreduce\u7684\u6570\u91CF\u6765\u51B3\u5B9A\u5F53\u524D\u7684\u8FD9\u5BF9\u8F93\u51FA\u6570\u636E\u6700\u7EC8\u5E94\u8BE5\u4EA4\u7531\u54EA\u4E2Areduce task\u5904\u7406\u3002 \u9ED8\u8BA4\u5BF9key\u8FDB\u884Chash\u540E\u518D\u4EE5reduce task\u6570\u91CF\u53D6\u6A21\u3002\u9ED8\u8BA4\u7684\u53D6\u6A21\u65B9\u5F0F\u53EA\u662F\u4E3A\u4E86\u5E73\u5747reduce\u7684\u5904\u7406\u80FD\u529B\uFF0C\u5982\u679C\u7528\u6237\u81EA\u5DF1\u5BF9Partitioner\u6709\u9700\u6C42\uFF0C\u53EF\u4EE5\u8BA2\u5236\u5E76\u8BBE\u7F6E\u5230job\u4E0A\u3002</p></blockquote><ol start="5"><li>\u63A5\u4E0B\u6765\uFF0C\u4F1A\u5C06\u6570\u636E\u5199\u5165\u5185\u5B58\uFF0C\u5185\u5B58\u4E2D\u8FD9\u7247\u533A\u57DF\u53EB\u505A\u73AF\u5F62\u7F13\u51B2\u533A\uFF0C\u7F13\u51B2\u533A\u7684\u4F5C\u7528\u662F\u6279\u91CF\u6536\u96C6map\u7ED3\u679C\uFF0C\u51CF\u5C11\u78C1\u76D8IO\u7684\u5F71\u54CD\u3002\u6211\u4EEC\u7684 key/value \u5BF9\u4EE5\u53CAPartition\u7684\u7ED3\u679C\u90FD\u4F1A\u88AB\u5199\u5165\u7F13\u51B2\u533A\u3002\u5F53\u7136\u5199\u5165\u4E4B\u524D\uFF0Ckey\u4E0Evalue\u503C\u90FD\u4F1A\u88AB\u5E8F\u5217\u5316\u6210\u5B57\u8282\u6570\u7EC4\u3002</li></ol><blockquote><p>\u73AF\u5F62\u7F13\u51B2\u533A\u5176\u5B9E\u662F\u4E00\u4E2A\u6570\u7EC4\uFF0C\u6570\u7EC4\u4E2D\u5B58\u653E\u7740key/value\u7684\u5E8F\u5217\u5316\u6570\u636E\u548Ckey/value\u7684\u5143\u6570\u636E\u4FE1\u606F\uFF0C\u5305\u62ECpartition\u3001key\u7684\u8D77\u59CB\u4F4D\u7F6E\u3001value\u7684\u8D77\u59CB\u4F4D\u7F6E\u4EE5\u53CAvalue\u7684\u957F\u5EA6\u3002\u73AF\u5F62\u7ED3\u6784\u662F\u4E00\u4E2A\u62BD\u8C61\u6982\u5FF5\u3002</p></blockquote><blockquote><p>\u7F13\u51B2\u533A\u662F\u6709\u5927\u5C0F\u9650\u5236\uFF0C\u9ED8\u8BA4\u662F100MB\u3002\u5F53map task\u7684\u8F93\u51FA\u7ED3\u679C\u5F88\u591A\u65F6\uFF0C\u5C31\u53EF\u80FD\u4F1A\u6491\u7206\u5185\u5B58\uFF0C\u6240\u4EE5\u9700\u8981\u5728\u4E00\u5B9A\u6761\u4EF6\u4E0B\u5C06\u7F13\u51B2\u533A\u4E2D\u7684\u6570\u636E\u4E34\u65F6\u5199\u5165\u78C1\u76D8\uFF0C\u7136\u540E\u91CD\u65B0\u5229\u7528\u8FD9\u5757\u7F13\u51B2\u533A\u3002 \u8FD9\u4E2A\u4ECE\u5185\u5B58\u5F80\u78C1\u76D8\u5199\u6570\u636E\u7684\u8FC7\u7A0B\u88AB\u79F0\u4E3ASpill\uFF0C\u4E2D\u6587\u53EF\u8BD1\u4E3A\u6EA2\u5199\u3002\u8FD9\u4E2A\u6EA2\u5199\u662F\u7531\u5355\u72EC\u7EBF\u7A0B\u6765\u5B8C\u6210\uFF0C\u4E0D\u5F71\u54CD\u5F80\u7F13\u51B2\u533A\u5199map\u7ED3\u679C\u7684\u7EBF\u7A0B\u3002 \u6EA2\u5199\u7EBF\u7A0B\u542F\u52A8\u65F6\u4E0D\u5E94\u8BE5\u963B\u6B62map\u7684\u7ED3\u679C\u8F93\u51FA\uFF0C\u6240\u4EE5\u6574\u4E2A\u7F13\u51B2\u533A\u6709\u4E2A\u6EA2\u5199\u7684\u6BD4\u4F8B <code>spill.percent</code>\u3002\u8FD9\u4E2A\u6BD4\u4F8B\u9ED8\u8BA4\u662F0.8\uFF0C\u4E5F\u5C31\u662F\u5F53\u7F13\u51B2\u533A\u7684\u6570\u636E\u5DF2\u7ECF\u8FBE\u5230\u9608\u503C(buffer size * spill percent = 100MB * 0.8 = 80MB)\uFF0C\u6EA2\u5199\u7EBF\u7A0B\u542F\u52A8\uFF0C\u9501\u5B9A\u8FD980MB\u7684\u5185\u5B58\uFF0C\u6267\u884C\u6EA2\u5199\u8FC7\u7A0B\u3002 Map task\u7684\u8F93\u51FA\u7ED3\u679C\u8FD8\u53EF\u4EE5\u5F80\u5269\u4E0B\u768420MB\u5185\u5B58\u4E2D\u5199\uFF0C\u4E92\u4E0D\u5F71\u54CD\u3002</p></blockquote><ol start="6"><li>\u5F53\u6EA2\u5199\u7EBF\u7A0B\u542F\u52A8\u540E\uFF0C\u9700\u8981\u5BF9\u8FD980MB\u7A7A\u95F4\u5185\u7684key\u505A\u6392\u5E8F(Sort)\u3002\u6392\u5E8F\u662FMapReduce\u6A21\u578B\u9ED8\u8BA4\u7684\u884C\u4E3A!</li></ol><blockquote><p>\u5982\u679Cjob\u8BBE\u7F6E\u8FC7Combiner\uFF0C\u90A3\u4E48\u73B0\u5728\u5C31\u662F\u4F7F\u7528Combiner\u7684\u65F6\u5019\u4E86\u3002\u5C06\u6709\u76F8\u540Ckey\u7684key/value\u5BF9\u7684 value\u52A0\u8D77\u6765\uFF0C\u51CF\u5C11\u6EA2\u5199\u5230\u78C1\u76D8\u7684\u6570\u636E\u91CF\u3002Combiner\u4F1A\u4F18\u5316MapReduce\u7684\u4E2D\u95F4\u7ED3\u679C\uFF0C\u6240\u4EE5\u5B83\u5728\u6574\u4E2A\u6A21\u578B\u4E2D\u4F1A\u591A\u6B21\u4F7F\u7528\u3002</p></blockquote><blockquote><p>\u54EA\u4E9B\u573A\u666F\u624D\u80FD\u4F7F\u7528Combiner\u5462?</p><p>\u4ECE\u8FD9\u91CC\u5206\u6790\uFF0CCombiner\u7684\u8F93\u51FA\u662FReducer\u7684\u8F93\u5165\uFF0CCombiner\u7EDD\u4E0D\u80FD\u6539\u53D8\u6700\u7EC8\u7684\u8BA1\u7B97\u7ED3\u679C\u3002Combiner\u53EA\u5E94\u8BE5\u7528\u4E8E\u90A3\u79CDReduce\u7684\u8F93\u5165key/value\u4E0E\u8F93\u51FAkey/value\u7C7B\u578B\u5B8C\u5168\u4E00\u81F4\uFF0C\u4E14\u4E0D\u5F71\u54CD\u6700\u7EC8\u7ED3\u679C\u7684\u573A\u666F\u3002\u6BD4\u5982\u7D2F\u52A0\uFF0C\u6700\u5927\u503C\u7B49\u3002 Combiner\u7684\u4F7F\u7528\u4E00\u5B9A\u5F97\u614E\u91CD\uFF0C\u5982\u679C\u7528\u597D\uFF0C\u5B83\u5BF9job\u6267\u884C\u6548\u7387\u6709\u5E2E\u52A9\uFF0C\u53CD\u4E4B\u4F1A\u5F71\u54CDreduce\u7684\u6700\u7EC8\u7ED3\u679C\u3002</p></blockquote><ol start="7"><li>\u5408\u5E76\u6EA2\u5199\u6587\u4EF6:\u6BCF\u6B21\u6EA2\u5199\u4F1A\u5728\u78C1\u76D8\u4E0A\u751F\u6210\u4E00\u4E2A\u4E34\u65F6\u6587\u4EF6(\u5199\u4E4B\u524D\u5224\u65AD\u662F\u5426\u6709combiner)\uFF0C\u5982\u679Cmap\u7684\u8F93\u51FA\u7ED3\u679C\u771F\u7684\u5F88\u5927\uFF0C\u6709\u591A\u6B21\u8FD9\u6837\u7684\u6EA2\u5199\u53D1\u751F\uFF0C\u78C1\u76D8\u4E0A\u76F8\u5E94\u7684\u5C31\u4F1A\u6709\u591A\u4E2A\u4E34\u65F6\u6587\u4EF6\u5B58\u5728\u3002 \u5F53\u6574\u4E2A\u6570\u636E\u5904\u7406\u7ED3\u675F\u4E4B\u540E\u5F00\u59CB\u5BF9\u78C1\u76D8\u4E2D\u7684\u4E34\u65F6\u6587\u4EF6\u8FDB\u884Cmerge\u5408\u5E76\uFF0C\u56E0\u4E3A\u6700\u7EC8\u7684\u6587\u4EF6\u53EA\u6709\u4E00\u4E2A\u5199\u5165\u78C1\u76D8\uFF0C\u5E76\u4E14\u4E3A\u8FD9\u4E2A\u6587\u4EF6\u63D0\u4F9B\u4E86\u4E00\u4E2A\u7D22\u5F15\u6587\u4EF6\uFF0C\u4EE5\u8BB0\u5F55\u6BCF\u4E2Areduce\u5BF9\u5E94\u6570\u636E\u7684\u504F\u79FB\u91CF\u3002</li></ol><p>\u81F3\u6B64map\u6574\u4E2A\u9636\u6BB5\u7ED3\u675F!!</p><blockquote><p>Map \u9636\u6BB5\u6240\u6709\u7684\u6392\u5E8F\uFF0C\u90FD\u662F\u9488\u5BF9 map \u8F93\u51FA\u7684 key/value \u7684 key \u8FDB\u884C\u7684\u6392\u5E8F\u3002</p></blockquote><h3 id="_6-5-2-maptask-\u7684\u5E76\u884C\u5EA6" tabindex="-1"><a class="header-anchor" href="#_6-5-2-maptask-\u7684\u5E76\u884C\u5EA6" aria-hidden="true">#</a> 6.5.2 MapTask \u7684\u5E76\u884C\u5EA6</h3><blockquote><p>\u5E76\u884C\u5EA6\u5C31\u662F\u6307 MapTask \u7684\u6570\u91CF</p></blockquote><ol><li>MapTask\u5E76\u884C\u5EA6\u601D\u8003</li></ol><p>MapTask\u7684\u5E76\u884C\u5EA6\u51B3\u5B9AMap\u9636\u6BB5\u7684\u4EFB\u52A1\u5904\u7406\u5E76\u53D1\u5EA6\uFF0C\u4ECE\u800C\u5F71\u54CD\u5230\u6574\u4E2AJob\u7684\u5904\u7406\u901F\u5EA6\u3002</p><blockquote><p>\u601D\u8003: MapTask\u5E76\u884C\u4EFB\u52A1\u662F\u5426\u8D8A\u591A\u8D8A\u597D\u5462?\u54EA\u4E9B\u56E0\u7D20\u5F71\u54CD\u4E86MapTask\u5E76\u884C\u5EA6?</p></blockquote><ol start="2"><li>MapTask\u5E76\u884C\u5EA6\u51B3\u5B9A\u673A\u5236</li></ol><ul><li>\u6570\u636E\u5757: Block\u662FHDFS\u7269\u7406\u4E0A\u628A\u6570\u636E\u5206\u6210\u4E00\u5757\u4E00\u5757\u3002</li><li>\u5207\u7247: \u6570\u636E\u5207\u7247\u53EA\u662F\u5728\u903B\u8F91\u4E0A\u5BF9\u8F93\u5165\u8FDB\u884C\u5206\u7247\uFF0C\u5E76\u4E0D\u4F1A\u5728\u78C1\u76D8\u4E0A\u5C06\u5176\u5207\u5206\u6210\u7247\u8FDB\u884C\u5B58\u50A8\u3002</li></ul><blockquote><p>\u5206\u7247\u5927\u5C0F\u4E0E Block \u5927\u5C0F\u7684\u5173\u7CFB\uFF1F \u9ED8\u8BA4\u5C31\u662F Block \u7684\u5927\u5C0F\uFF01</p></blockquote><p>\u95EE\u9898\uFF1A</p><p>A \u6587\u4EF6 300M, B \u6587\u4EF6 100M, \u4E24\u4E2A\u6587\u4EF6\u90FD\u5B58\u5165 HDFS \u5E76\u4F5C\u4E3A\u67D0\u4E2A MR \u4EFB\u52A1\u7684\u8F93\u5165\u6570\u636E\uFF0C\u90A3\u4E48\u5F53\u524D\u8FD9\u4E2A MR \u4EFB\u52A1\u7684 split \u4EE5\u53CA MapTask \u7684\u5E76\u884C\u5EA6\u662F\u591A\u5C11\u5462\uFF1F</p><p>\u5207\u7247\u7684\u8BA1\u7B97\u65B9\u5F0F\uFF1A\u6309\u6587\u4EF6\u9010\u4E2A\u8BA1\u7B97\u3002</p><ul><li>A \u6587\u4EF6\uFF1A0 ~ 128, 128 ~ 256, 256 ~ 300 =&gt; 3 \u4E2A\u5207\u7247</li><li>B \u6587\u4EF6\uFF1A0 ~ 100 =&gt; 1 \u4E2A\u5207\u7247</li></ul><p>\u603B\u5171\u662F4\u4E2A split, MapTask \u7684\u5E76\u884C\u5EA6\u4E3A 4\u3002</p><blockquote><p>\u5728\u5927\u6570\u636E\u5206\u5E03\u5F0F\u8BA1\u7B97\u6846\u67B6\u4E2D\uFF0C\u79FB\u52A8\u8BA1\u7B97\u4E0D\u8981\u79FB\u52A8\u6570\u636E\u3002\u79FB\u52A8\u6570\u636E\u7684\u6210\u672C\u5F88\u9AD8\uFF0C\u79FB\u52A8\u8BA1\u7B97\u6BD4\u8F83\u7B80\u5355\uFF01</p></blockquote><h4 id="_6-5-2-1-\u5207\u7247\u673A\u5236\u6E90\u7801\u9605\u8BFB" tabindex="-1"><a class="header-anchor" href="#_6-5-2-1-\u5207\u7247\u673A\u5236\u6E90\u7801\u9605\u8BFB" aria-hidden="true">#</a> 6.5.2.1 \u5207\u7247\u673A\u5236\u6E90\u7801\u9605\u8BFB</h4><p>MapTask\u5E76\u884C\u5EA6\u662F\u4E0D\u662F\u8D8A\u591A\u8D8A\u597D\u5462?</p><p>\u7B54\u6848: \u4E0D\u662F\u3002 \u5982\u679C\u4E00\u4E2A\u6587\u4EF6\u4EC5\u4EC5\u6BD4128M\u5927\u4E00\u70B9\u70B9(10%)\u4E5F\u88AB\u5F53\u6210\u4E00\u4E2Asplit\u6765\u5BF9\u5F85\uFF0C\u800C\u4E0D\u662F\u591A\u4E2Asplit.</p><p>MR\u6846\u67B6\u5728\u5E76\u884C\u8FD0\u7B97\u7684\u540C\u65F6\u4E5F\u4F1A\u6D88\u8017\u66F4\u591A\u8D44\u6E90\uFF0C\u5E76\u884C\u5EA6\u8D8A\u9AD8\u8D44\u6E90\u6D88\u8017\u4E5F\u8D8A\u9AD8\uFF0C\u5047\u8BBE129M\u6587\u4EF6\u5206\u4E3A\u4E24\u4E2A\u5206\u7247\uFF0C\u4E00\u4E2A\u662F128M\uFF0C\u4E00\u4E2A\u662F1M;</p><p>\u5BF9\u4E8E1M\u7684\u5207\u7247\u7684 MapTask \u6765\u8BF4\uFF0C\u592A\u6D6A\u8D39\u8D44\u6E90\u3002</p><blockquote><p>129M \u7684\u6587\u4EF6\u5728 Hdfs \u5B58\u50A8\u7684\u65F6\u5019\u4F1A\u4E0D\u4F1A\u5207\u6210\u4E24\u5757?</p></blockquote><h3 id="_6-5-3-reducetask-\u5DE5\u4F5C\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#_6-5-3-reducetask-\u5DE5\u4F5C\u673A\u5236" aria-hidden="true">#</a> 6.5.3 ReduceTask \u5DE5\u4F5C\u673A\u5236</h3><p><img src="'+e+`" alt="ReduceTask\u5DE5\u4F5C\u673A\u5236"></p><p>Reduce\u5927\u81F4\u5206\u4E3Acopy\u3001sort\u3001reduce\u4E09\u4E2A\u9636\u6BB5\uFF0C\u91CD\u70B9\u5728\u524D\u4E24\u4E2A\u9636\u6BB5\u3002</p><p>copy\u9636\u6BB5\u5305\u542B\u4E00\u4E2A eventFetcher \u6765\u83B7\u53D6\u5DF2\u5B8C\u6210\u7684map\u5217\u8868\uFF0C\u7531Fetcher\u7EBF\u7A0B\u53BBcopy\u6570\u636E\uFF0C\u5728\u6B64\u8FC7\u7A0B\u4E2D\u4F1A\u542F\u52A8\u4E24\u4E2Amerge\u7EBF\u7A0B\uFF0C\u5206\u522B\u4E3AinMemoryMerger\u548ConDiskMerger\uFF0C\u5206\u522B\u5C06\u5185\u5B58\u4E2D\u7684\u6570\u636Emerge\u5230\u78C1\u76D8\u548C\u5C06\u78C1\u76D8\u4E2D\u7684\u6570\u636E\u8FDB\u884Cmerge\u3002</p><p>\u5F85\u6570\u636Ecopy\u5B8C\u6210\u4E4B\u540E\uFF0Ccopy\u9636\u6BB5\u5C31\u5B8C\u6210\u4E86\uFF0C\u5F00\u59CB\u8FDB\u884Csort\u9636\u6BB5\uFF0Csort\u9636\u6BB5\u4E3B\u8981\u662F\u6267\u884CfinalMerge\u64CD\u4F5C\uFF0C\u7EAF\u7CB9\u7684sort\u9636\u6BB5\uFF0C\u5B8C\u6210\u4E4B\u540E\u5C31\u662Freduce\u9636\u6BB5\uFF0C\u8C03\u7528\u7528\u6237\u5B9A\u4E49\u7684reduce\u51FD\u6570\u8FDB\u884C\u5904\u7406\u3002</p><p>\u8BE6\u7EC6\u6B65\u9AA4</p><ul><li>Copy\u9636\u6BB5\uFF0C\u7B80\u5355\u5730\u62C9\u53D6\u6570\u636E\u3002</li></ul><p>Reduce\u8FDB\u7A0B\u542F\u52A8\u4E00\u4E9B\u6570\u636Ecopy\u7EBF\u7A0B(Fetcher)\uFF0C\u901A\u8FC7HTTP\u65B9\u5F0F\u8BF7\u6C42 mapTask \u83B7\u53D6\u5C5E\u4E8E\u81EA\u5DF1\u7684\u6587\u4EF6\u3002</p><ul><li>Merge\u9636\u6BB5\u3002</li></ul><p>\u8FD9\u91CC\u7684merge\u5982map\u7AEF\u7684merge\u52A8\u4F5C\uFF0C\u53EA\u662F\u6570\u7EC4\u4E2D\u5B58\u653E\u7684\u662F\u4E0D\u540Cmap\u7AEFcopy\u6765\u7684\u6570\u503C\u3002</p><p>Copy\u8FC7\u6765\u7684\u6570\u636E\u4F1A\u5148\u653E\u5165\u5185\u5B58\u7F13\u51B2\u533A\u4E2D\uFF0C\u8FD9\u91CC\u7684\u7F13\u51B2\u533A\u5927\u5C0F\u8981\u6BD4map\u7AEF\u7684\u66F4\u4E3A\u7075\u6D3B\u3002merge \u6709\u4E09\u79CD\u5F62\u5F0F:\u5185\u5B58\u5230\u5185\u5B58;\u5185\u5B58\u5230\u78C1\u76D8;\u78C1\u76D8\u5230\u78C1\u76D8\u3002\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u7B2C\u4E00\u79CD\u5F62\u5F0F\u4E0D\u542F\u7528\u3002 \u5F53\u5185\u5B58\u4E2D\u7684\u6570\u636E\u91CF\u5230\u8FBE\u4E00\u5B9A\u9608\u503C\uFF0C\u5C31\u542F\u52A8\u5185\u5B58\u5230\u78C1\u76D8\u7684merge\u3002\u4E0Emap \u7AEF\u7C7B\u4F3C\uFF0C\u8FD9\u4E5F\u662F\u6EA2\u5199\u7684\u8FC7\u7A0B\uFF0C\u8FD9\u4E2A\u8FC7\u7A0B\u4E2D\u5982\u679C\u4F60\u8BBE\u7F6E\u6709Combiner\uFF0C\u4E5F\u662F\u4F1A\u542F\u7528\u7684\uFF0C\u7136\u540E\u5728\u78C1\u76D8\u4E2D\u751F\u6210\u4E86\u4F17\u591A\u7684\u6EA2\u5199\u6587\u4EF6\u3002 \u7B2C\u4E8C\u79CDmerge\u65B9\u5F0F\u4E00\u76F4\u5728\u8FD0\u884C\uFF0C\u76F4\u5230\u6CA1\u6709map\u7AEF\u7684\u6570\u636E\u65F6\u624D\u7ED3\u675F\uFF0C\u7136\u540E\u542F\u52A8\u7B2C\u4E09\u79CD\u78C1\u76D8\u5230\u78C1\u76D8\u7684merge\u65B9\u5F0F\u751F\u6210\u6700\u7EC8\u7684\u6587\u4EF6\u3002</p><ul><li>\u5408\u5E76\u6392\u5E8F\u3002</li></ul><p>\u628A\u5206\u6563\u7684\u6570\u636E\u5408\u5E76\u6210\u4E00\u4E2A\u5927\u7684\u6570\u636E\u540E\uFF0C\u8FD8\u4F1A\u518D\u5BF9\u5408\u5E76\u540E\u7684\u6570\u636E\u6392\u5E8F\u3002</p><ul><li>\u5BF9\u6392\u5E8F\u540E\u7684\u952E\u503C\u5BF9\u8C03\u7528reduce\u65B9\u6CD5\uFF0C\u952E\u76F8\u7B49\u7684\u952E\u503C\u5BF9\u8C03\u7528\u4E00\u6B21reduce\u65B9\u6CD5\uFF0C\u6BCF\u6B21\u8C03\u7528\u4F1A\u4EA7\u751F\u96F6\u4E2A\u6216\u8005\u591A\u4E2A\u952E\u503C\u5BF9\uFF0C\u6700\u540E\u628A\u8FD9\u4E9B\u8F93\u51FA\u7684\u952E\u503C\u5BF9\u5199\u5165\u5230HDFS\u6587\u4EF6\u4E2D\u3002</li></ul><h3 id="_6-5-4-reducetask\u5E76\u884C\u5EA6" tabindex="-1"><a class="header-anchor" href="#_6-5-4-reducetask\u5E76\u884C\u5EA6" aria-hidden="true">#</a> 6.5.4 ReduceTask\u5E76\u884C\u5EA6</h3><blockquote><p>MapTask \u5E76\u884C\u5EA6\u53D6\u51B3\u4E8E split \u7684\u6570\u91CF\uFF0C\u800C split \u5927\u5C0F\u9ED8\u8BA4\u662F blockSize\uFF0C\u6240\u4EE5 block \u7684\u6570\u91CF\u7EA6\u7B49\u4E8E\u5206\u7247\u6570\u91CF\u3002</p></blockquote><p>ReduceTask \u7684\u5E76\u884C\u5EA6\u540C\u6837\u5F71\u54CD\u6574\u4E2AJob\u7684\u6267\u884C\u5E76\u53D1\u5EA6\u548C\u6267\u884C\u6548\u7387\uFF0C\u4F46\u4E0EMapTask\u7684\u5E76\u53D1\u6570\u7531\u5207\u7247\u6570\u51B3\u5B9A\u4E0D\u540C\uFF0CReduceTask\u6570\u91CF\u7684\u51B3\u5B9A\u662F\u53EF\u4EE5\u76F4\u63A5\u624B\u52A8\u8BBE\u7F6E:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u9ED8\u8BA4\u503C\u662F1\uFF0C\u624B\u52A8\u8BBE\u7F6E\u4E3A4 </span>
job<span class="token punctuation">.</span><span class="token function">setNumReduceTasks</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u6CE8\u610F\u4E8B\u9879</p><ol><li>ReduceTask=0\uFF0C\u8868\u793A\u6CA1\u6709Reduce\u9636\u6BB5\uFF0C\u8F93\u51FA\u6587\u4EF6\u6570\u548CMapTask\u6570\u91CF\u4FDD\u6301\u4E00\u81F4;</li><li>ReduceTask\u6570\u91CF\u4E0D\u8BBE\u7F6E\u9ED8\u8BA4\u5C31\u662F\u4E00\u4E2A\uFF0C\u8F93\u51FA\u6587\u4EF6\u6570\u91CF\u4E3A1\u4E2A;</li><li>\u5982\u679C\u6570\u636E\u5206\u5E03\u4E0D\u5747\u5300\uFF0C\u53EF\u80FD\u5728Reduce\u9636\u6BB5\u4EA7\u751F\u6570\u636E\u503E\u659C;</li></ol><blockquote><p>\u6570\u636E\u503E\u659C\u5C31\u662F\u67D0\u4E2A ReduceTask \u5904\u7406\u7684\u6570\u636E\u91CF\u8FDC\u8FDC\u5927\u8FC7\u5176\u4ED6\u8282\u70B9\u3002\u6570\u636E\u5206\u914D\u4E0D\u5747\u5300\u5BFC\u81F4\u7684\u3002</p></blockquote><h3 id="_6-5-5-shuffle-\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#_6-5-5-shuffle-\u673A\u5236" aria-hidden="true">#</a> 6.5.5 Shuffle \u673A\u5236</h3><p>map\u9636\u6BB5\u5904\u7406\u7684\u6570\u636E\u5982\u4F55\u4F20\u9012\u7ED9reduce\u9636\u6BB5\uFF0C\u662FMapReduce\u6846\u67B6\u4E2D\u6700\u5173\u952E\u7684\u4E00\u4E2A\u6D41\u7A0B\uFF0C\u8FD9\u4E2A\u6D41\u7A0B\u5C31\u53EBshuffle\u3002</p><blockquote><p>MapTask \u7684 <code>map()</code> \u65B9\u6CD5\u4E4B\u540E\uFF0CReduceTask \u7684 <code>reduce()</code> \u65B9\u6CD5\u4E4B\u524D\uFF0C\u8FD9\u6BB5\u6570\u636E\u7684\u5904\u7406\u8FC7\u7A0B\u5C31\u79F0\u4E3A Shuffle\u3002 \u8FD9\u4E2A\u8FC7\u7A0B\u975E\u5E38\u5173\u952E\uFF0C\u662F MR \u7684\u6838\u5FC3\u9636\u6BB5\u3002</p></blockquote><h4 id="_6-5-5-1-mapreduce\u7684\u5206\u533A\u4E0Ereducetask\u7684\u6570\u91CF" tabindex="-1"><a class="header-anchor" href="#_6-5-5-1-mapreduce\u7684\u5206\u533A\u4E0Ereducetask\u7684\u6570\u91CF" aria-hidden="true">#</a> 6.5.5.1 MapReduce\u7684\u5206\u533A\u4E0EreduceTask\u7684\u6570\u91CF</h4><p>\u5728MapReduce\u4E2D\uFF0C\u901A\u8FC7\u6211\u4EEC\u6307\u5B9A\u5206\u533A\uFF0C\u4F1A\u5C06\u540C\u4E00\u4E2A\u5206\u533A\u7684\u6570\u636E\u53D1\u9001\u5230\u540C\u4E00\u4E2Areduce\u5F53\u4E2D\u8FDB\u884C\u5904\u7406(\u9ED8\u8BA4\u662Fkey\u76F8\u540C\u53BB\u5F80\u540C\u4E2A\u5206\u533A\uFF0C\u540C\u4E00\u4E2A\u5206\u533A\u6700\u7EC8\u4F1A\u53BB\u5F80\u540C\u4E00\u4E2AreduceTask)</p><p>\u4F8B\u5982: \u6211\u4EEC\u4E3A\u4E86\u6570\u636E\u7684\u7EDF\u8BA1\uFF0C\u6211\u4EEC\u53EF\u4EE5\u628A\u4E00\u6279\u7C7B\u4F3C\u7684\u6570\u636E\u53D1\u9001\u5230\u540C\u4E00\u4E2Areduce\u5F53\u4E2D\u53BB\uFF0C\u5728\u540C\u4E00\u4E2Areduce\u5F53\u4E2D\u7EDF\u8BA1\u76F8\u540C\u7C7B\u578B\u7684\u6570\u636E\uFF0C</p><p>\u5982\u4F55\u624D\u80FD\u4FDD\u8BC1\u76F8\u540Ckey\u7684\u6570\u636E\u53BB\u5F80\u540C\u4E2Areduce\u5462? \u53EA\u9700\u8981\u4FDD\u8BC1\u76F8\u540Ckey\u7684\u6570\u636E\u5206\u53D1\u5230\u540C\u4E2A\u5206\u533A\u5373\u53EF\u3002</p><p>\u7ED3\u5408\u4EE5\u4E0A\u539F\u7406\u5206\u6790\u6211\u4EEC\u77E5\u9053MR\u7A0B\u5E8Fshuffle\u673A\u5236\u9ED8\u8BA4\u5C31\u662F\u8FD9\u79CD\u89C4\u5219 \uFF01\uFF01</p><h5 id="_1-\u5206\u533A\u6E90\u7801" tabindex="-1"><a class="header-anchor" href="#_1-\u5206\u533A\u6E90\u7801" aria-hidden="true">#</a> 1. \u5206\u533A\u6E90\u7801</h5><p>\u7FFB\u9605\u6E90\u7801\u9A8C\u8BC1\u4EE5\u4E0A\u89C4\u5219\uFF0CMR\u7A0B\u5E8F\u9ED8\u8BA4\u4F7F\u7528\u7684HashPartitioner\uFF0C\u4FDD\u8BC1\u4E86\u76F8\u540C\u7684key\u53BB\u5F80\u540C\u4E2A\u5206\u533A!!</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JobContextImpl</span> <span class="token keyword">implements</span> <span class="token class-name">JobContext</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Partitioner</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPartitionerClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Partitioner</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span>
              conf<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span>PARTITIONER_CLASS_ATTR<span class="token punctuation">,</span> <span class="token class-name">HashPartitioner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HashPartitioner</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Partitioner</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/** Use <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Object</span><span class="token punctuation">#</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> to partition. */</span>
  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPartition</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span>
                          <span class="token keyword">int</span> numReduceTasks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">)</span> <span class="token operator">%</span> numReduceTasks<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>getPartition()</code> \u65B9\u6CD5\u51B3\u5B9A\u4E86\u6BCF\u6761\u6570\u636E\u8FDB\u5165\u54EA\u4E2A\u5206\u533A\uFF1B<code>numReduceTasks</code> \u5C31\u662F ReduceTask \u7684\u6570\u91CF\uFF1B</p><h5 id="_2-\u81EA\u5B9A\u4E49\u5206\u533A" tabindex="-1"><a class="header-anchor" href="#_2-\u81EA\u5B9A\u4E49\u5206\u533A" aria-hidden="true">#</a> 2. \u81EA\u5B9A\u4E49\u5206\u533A</h5><p>\u5B9E\u9645\u751F\u4EA7\u4E2D\u9700\u6C42\u53D8\u5316\u591A\u7AEF\uFF0C\u9ED8\u8BA4\u5206\u533A\u89C4\u5219\u5F80\u5F80\u4E0D\u80FD\u6EE1\u8DB3\u9700\u6C42\uFF0C\u9700\u8981\u7ED3\u5408\u4E1A\u52A1\u903B\u8F91\u6765\u7075\u6D3B\u63A7\u5236\u5206\u533A\u89C4\u5219\u4EE5\u53CA\u5206\u533A\u6570\u91CF!!</p><p>\u5982\u4F55\u5236\u5B9A\u81EA\u5DF1\u9700\u8981\u7684\u5206\u533A\u89C4\u5219?</p><p><strong>\u5177\u4F53\u6B65\u9AA4</strong></p><ol><li>\u81EA\u5B9A\u4E49\u7C7B\u7EE7\u627FPartitioner\uFF0C\u91CD\u5199 <code>getPartition()</code> \u65B9\u6CD5</li><li>\u5728Driver\u9A71\u52A8\u4E2D\uFF0C\u6307\u5B9A\u4F7F\u7528\u81EA\u5B9A\u4E49Partitioner</li><li>\u5728Driver\u9A71\u52A8\u4E2D\uFF0C\u8981\u6839\u636E\u81EA\u5B9A\u4E49Partitioner\u7684\u903B\u8F91\u8BBE\u7F6E\u76F8\u5E94\u6570\u91CF\u7684ReduceTask\u6570\u91CF\u3002</li></ol><p><strong>\u6D4B\u8BD5\u6848\u4F8B</strong></p><p>\u9700\u6C42: \u6309\u7167\u4E0D\u540C\u7684 appkey \u628A\u8BB0\u5F55\u8F93\u51FA\u5230\u4E0D\u540C\u7684\u5206\u533A\u4E2D\u3002</p><p>\u539F\u59CB\u65E5\u5FD7\u683C\u5F0F</p><table><thead><tr><th>001</th><th>001577c3</th><th>kar_890809</th><th>120.196.100.99</th><th>1116</th><th>954</th><th>200</th></tr></thead><tbody><tr><td>\u65E5\u5FD7id</td><td>\u8BBE\u5907id</td><td>appkey(\u5408\u4F5C\u786C\u4EF6\u5382\u5546)</td><td>\u7F51\u7EDCip</td><td>\u81EA\u6709\u5185\u5BB9\u65F6\u957F(\u79D2)</td><td>\u7B2C\u4E09\u65B9\u5185\u5BB9\u65F6\u957F(\u79D2)</td><td>\u7F51\u7EDC\u72B6\u6001\u7801</td></tr></tbody></table><p>\u8F93\u51FA\u7ED3\u679C</p><p>\u6839\u636Eappkey\u628A\u4E0D\u540C\u5382\u5546\u7684\u65E5\u5FD7\u6570\u636E\u5206\u522B\u8F93\u51FA\u5230\u4E0D\u540C\u7684\u6587\u4EF6\u4E2D</p><p><strong>\u9700\u6C42\u5206\u6790</strong></p><p>\u9762\u5BF9\u4E1A\u52A1\u9700\u6C42\uFF0C\u7ED3\u5408mr\u7684\u7279\u70B9\uFF0C\u6765\u8BBE\u8BA1map\u8F93\u51FA\u7684kv,\u4EE5\u53CAreduce\u8F93\u51FA\u7684kv\u6570\u636E\u3002</p><p>\u4E00\u4E2AReduceTask\u5BF9\u5E94\u4E00\u4E2A\u8F93\u51FA\u6587\u4EF6\uFF0C\u56E0\u4E3A\u5728shuffle\u673A\u5236\u4E2D\u6BCF\u4E2AreduceTask\u62C9\u53D6\u7684\u90FD\u662F\u67D0\u4E00\u4E2A\u5206\u533A\u7684\u6570\u636E\uFF0C\u4E00\u4E2A\u5206\u533A\u5BF9\u5E94\u4E00\u4E2A\u8F93\u51FA\u6587\u4EF6\u3002</p><p>\u7ED3\u5408 appkey \u7684\u524D\u7F00\u76F8\u540C\u7684\u7279\u70B9\uFF0C\u4E0D\u80FD\u4F7F\u7528\u9ED8\u8BA4\u5206\u533A\u89C4\u5219\uFF0C\u800C\u4F7F\u7528\u81EA\u5B9A\u4E49\u5206\u533A\u5668\uFF0C\u53EA\u8981 appkey \u524D\u7F00\u76F8\u540C\u5219\u6570\u636E\u8FDB\u5165\u540C\u4E2A\u5206\u533A\u3002</p><p><strong>\u6574\u4F53\u601D\u8DEF</strong></p><p>Mapper</p><ol><li>\u8BFB\u53D6\u4E00\u884C\u6587\u672C\uFF0C\u6309\u7167\u5236\u8868\u7B26\u5207\u5206</li><li>\u89E3\u6790\u51FAappkey\u5B57\u6BB5\uFF0C\u5176\u4F59\u6570\u636E\u5C01\u88C5\u4E3APartitionBean\u5BF9\u8C61(\u5B9E\u73B0\u5E8F\u5217\u5316Writable\u63A5\u53E3)</li><li>\u8BBE\u8BA1 <code>map()</code> \u8F93\u51FA\u7684kv\u3002key -&gt; appkey(\u4F9D\u9760\u8BE5\u5B57\u6BB5\u5B8C\u6210\u5206\u533A)\uFF0Cvalue -&gt; PartitionBean\u5BF9\u8C61</li></ol><p>Partition</p><p>\u81EA\u5B9A\u4E49\u5206\u533A\u5668\uFF0C\u5B9E\u73B0\u6309\u7167appkey\u5B57\u6BB5\u7684\u524D\u7F00\u6765\u533A\u5206\u6240\u5C5E\u5206\u533A</p><p>Reduce</p><p><code>reduce()</code> \u6B63\u5E38\u8F93\u51FA\u5373\u53EF\uFF0C\u65E0\u9700\u8FDB\u884C\u805A\u5408\u64CD\u4F5C</p><p>Driver</p><ol><li>\u5728\u539F\u5148\u8BBE\u7F6Ejob\u5C5E\u6027\u7684\u540C\u65F6\u589E\u52A0\u8BBE\u7F6E\u4F7F\u7528\u81EA\u5B9A\u4E49\u5206\u533A\u5668</li><li>\u6CE8\u610F\u8BBE\u7F6EReduceTask\u7684\u6570\u91CF(\u4E0E\u5206\u533A\u6570\u91CF\u4FDD\u6301\u4E00\u81F4)</li></ol><p><strong>\u4EE3\u7801\u5B9E\u73B0</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PartitionBean</span> <span class="token keyword">implements</span> <span class="token class-name">Writable</span> <span class="token punctuation">{</span>

    <span class="token comment">// \u65E5\u5FD7ID</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token comment">// \u8BBE\u5907ID</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> deviceId<span class="token punctuation">;</span>
    <span class="token comment">// \u5382\u5546ID</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> appKey<span class="token punctuation">;</span>
    <span class="token comment">// IP \u5730\u5740</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> ip<span class="token punctuation">;</span>
    <span class="token comment">// \u81EA\u6709\u5185\u5BB9\u64AD\u653E\u65F6\u957F</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> selfDuration<span class="token punctuation">;</span>
    <span class="token comment">// \u4E09\u65B9\u5185\u5BB9\u64AD\u653E\u65F6\u957F</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> thirdPartDuration<span class="token punctuation">;</span>
    <span class="token comment">// \u72B6\u6001\u7801</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">DataOutput</span> dataOutput<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        dataOutput<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataOutput<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>deviceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataOutput<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>appKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataOutput<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataOutput<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>selfDuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataOutput<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>thirdPartDuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataOutput<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readFields</span><span class="token punctuation">(</span><span class="token class-name">DataInput</span> dataInput<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> dataInput<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>deviceId <span class="token operator">=</span> dataInput<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>appKey <span class="token operator">=</span> dataInput<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ip <span class="token operator">=</span> dataInput<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>selfDuration <span class="token operator">=</span> dataInput<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>thirdPartDuration <span class="token operator">=</span> dataInput<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> dataInput<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> id <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> deviceId <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> appKey <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> ip <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> selfDuration <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> thirdPartDuration <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> status<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Partitioner \u5206\u533A\u5668\u7684\u6CDB\u578B\u662F map \u8F93\u51FA\u7684 kv \u7C7B\u578B</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomPartitioner</span> <span class="token keyword">extends</span> <span class="token class-name">Partitioner</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">PartitionBean</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPartition</span><span class="token punctuation">(</span><span class="token class-name">Text</span> text<span class="token punctuation">,</span> <span class="token class-name">PartitionBean</span> partitionBean<span class="token punctuation">,</span> <span class="token keyword">int</span> numPartitions<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">int</span> partition <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">&quot;kar&quot;</span><span class="token operator">:</span>
                <span class="token comment">// \u53EA\u9700\u8981\u4FDD\u8BC1\u6EE1\u8DB3\u6B64\u6761\u4EF6\u7684\u6570\u636E\u83B7\u5F97\u76F8\u540C\u7684\u5206\u533A\u7F16\u53F7\u5373\u53EF</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">&quot;pandora&quot;</span><span class="token operator">:</span>
                partition <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                partition <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> partition<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PartitionMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">PartitionBean</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token class-name">PartitionBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PartitionBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Text</span> k <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">LongWritable</span> key<span class="token punctuation">,</span> <span class="token class-name">Text</span> value<span class="token punctuation">,</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">PartitionBean</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> appKey <span class="token operator">=</span> fields<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setDeviceId</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setAppKey</span><span class="token punctuation">(</span>appKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setIp</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setSelfDuration</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setThirdPartDuration</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        k<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>appKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// shuffle \u5F00\u59CB\u65F6\uFF0C\u4F1A\u6839\u636E k \u7684hashCode \u503C\u8FDB\u884C\u5206\u533A\uFF0C\u4F46\u662F\u6211\u4EEC\u7684\u4E1A\u52A1\u9ED8\u8BA4hash\u5206\u533A\u65B9\u5F0F\u4E0D\u80FD\u6EE1\u8DB3</span>
        context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// reduce \u8F93\u5165\u7C7B\u578B\u548C map \u7684\u8F93\u51FA\u7C7B\u578B\u4E00\u81F4</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PartitionReducer</span> <span class="token keyword">extends</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">PartitionBean</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">PartitionBean</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Text</span> key<span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PartitionBean</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">,</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">PartitionBean</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">PartitionBean</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u65E0\u9700\u805A\u5408\u8FD0\u7B97\uFF0C\u53EA\u9700\u8981\u8FDB\u884C\u8F93\u51FA\u5373\u53EF</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">PartitionBean</span> bean <span class="token operator">:</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PartitionDriver</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.\u83B7\u53D6\u914D\u7F6E\u6587\u4EF6</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.\u83B7\u53D6 Job \u5B9E\u4F8B</span>
        <span class="token class-name">Job</span> job <span class="token operator">=</span> <span class="token class-name">Job</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.\u8BBE\u7F6E\u4EFB\u52A1\u76F8\u5173\u53C2\u6570</span>
        job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">PartitionDriver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setMapperClass</span><span class="token punctuation">(</span><span class="token class-name">PartitionMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setReducerClass</span><span class="token punctuation">(</span><span class="token class-name">PartitionReducer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        job<span class="token punctuation">.</span><span class="token function">setMapOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">PartitionBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        job<span class="token punctuation">.</span><span class="token function">setOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">PartitionBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4.\u8BBE\u7F6E\u4F7F\u7528\u81EA\u5B9A\u4E49\u5206\u533A\u5668</span>
        job<span class="token punctuation">.</span><span class="token function">setPartitionerClass</span><span class="token punctuation">(</span><span class="token class-name">CustomPartitioner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5.\u6307\u5B9A ReduceTask \u7684\u6570\u91CF\u4E0E\u5206\u533A\u6570\u91CF\u4FDD\u6301\u4E00\u81F4</span>
        job<span class="token punctuation">.</span><span class="token function">setNumReduceTasks</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 6.\u6307\u5B9A\u8F93\u5165\u548C\u8F93\u51FA\u6570\u636E\u8DEF\u5F84</span>
        <span class="token class-name">FileInputFormat</span><span class="token punctuation">.</span><span class="token function">setInputPaths</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:/tmp/test/mr/input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileOutputFormat</span><span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:/tmp/test/partition/output&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 7.\u63D0\u4EA4\u4EFB\u52A1</span>
        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>flag <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>\u603B\u7ED3</p><ol><li>\u81EA\u5B9A\u4E49\u5206\u533A\u5668\u65F6\uFF0C\u6700\u597D\u4FDD\u8BC1\u5206\u533A\u6570\u91CF\u4E0EreduceTask\u6570\u91CF\u4FDD\u6301\u4E00\u81F4\u3002</li><li>\u5982\u679C\u5206\u533A\u6570\u91CF\u4E0D\u6B621\u4E2A\uFF0C\u4F46\u662FreduceTask\u6570\u91CF\u53EA\u67091\u4E2A\uFF0C\u6B64\u65F6\u53EA\u4F1A\u8F93\u51FA\u4E00\u4E2A\u6587\u4EF6(\u6B64\u65F6\u4E0D\u4F1A\u62A5\u9519\uFF0C\u4F46\u662F\u5206\u533A\u5C06\u6CA1\u6709\u610F\u4E49)\u3002</li><li>\u5982\u679CreduceTask\u6570\u91CF\u5927\u4E8E\u5206\u533A\u6570\u91CF\uFF0C\u4F1A\u8F93\u51FA\u591A\u4E2A\u7A7A\u6587\u4EF6\u3002</li><li>\u5982\u679CreduceTask\u6570\u91CF\u5C0F\u4E8E\u5206\u533A\u6570\u91CF\uFF0C\u6709\u53EF\u80FD\u4F1A\u62A5\u9519\u3002</li></ol><h4 id="_6-5-5-2-mapreduce-\u4E2D\u7684-combiner" tabindex="-1"><a class="header-anchor" href="#_6-5-5-2-mapreduce-\u4E2D\u7684-combiner" aria-hidden="true">#</a> 6.5.5.2 MapReduce \u4E2D\u7684 Combiner</h4><blockquote><p>combiner \u8FD0\u884C\u673A\u5236: combiner \u8FD0\u884C\u5728 mapTask \u7684\u6EA2\u5199\u6587\u4EF6\u4E4B\u540E\uFF0CreduceTask \u62C9\u53D6\u6570\u636E\u4E4B\u524D\uFF0C\u8FDB\u884C\u6587\u4EF6\u7684\u9884\u805A\u5408\u3002</p></blockquote><ol><li>Combiner\u662FMR\u7A0B\u5E8F\u4E2DMapper\u548CReducer\u4E4B\u5916\u7684\u4E00\u79CD\u7EC4\u4EF6</li><li>Combiner\u7EC4\u4EF6\u7684\u7236\u7C7B\u5C31\u662F <em>Reducer</em></li><li>Combiner\u548Creducer\u7684\u533A\u522B\u5728\u4E8E\u8FD0\u884C\u7684\u4F4D\u7F6E</li><li>Combiner\u662F\u5728\u6BCF\u4E00\u4E2AmapTask\u6240\u5728\u7684\u8282\u70B9\u8FD0\u884C;</li><li>Combiner\u7684\u610F\u4E49\u5C31\u662F\u5BF9\u6BCF\u4E00\u4E2AmapTask\u7684\u8F93\u51FA\u8FDB\u884C\u5C40\u90E8\u6C47\u603B\uFF0C\u4EE5\u51CF\u5C0F\u7F51\u7EDC\u4F20\u8F93\u91CF\u3002</li><li>Combiner\u80FD\u591F\u5E94\u7528\u7684\u524D\u63D0\u662F\u4E0D\u80FD\u5F71\u54CD\u6700\u7EC8\u7684\u4E1A\u52A1\u903B\u8F91\uFF0C\u6B64\u5916\uFF0CCombiner\u7684\u8F93\u51FAkv\u5E94\u8BE5\u8DDFreducer\u7684\u8F93\u5165kv\u7C7B\u578B\u8981\u5BF9\u5E94\u8D77\u6765\u3002</li></ol><p>\u4E3E\u4F8B\u8BF4\u660E</p><p>\u5047\u8BBE\u4E00\u4E2A\u8BA1\u7B97\u5E73\u5747\u503C\u7684MR\u4EFB\u52A1</p><p>Map\u9636\u6BB5: 2\u4E2AMapTask</p><p>MapTask1\u8F93\u51FA\u6570\u636E: 10,5,15 \u5982\u679C\u4F7F\u7528Combiner:(10+5+15)/3=10</p><p>MapTask2\u8F93\u51FA\u6570\u636E:2,6 \u5982\u679C\u4F7F\u7528Combiner:(2+6)/2=4</p><p>Reduce\u9636\u6BB5\u6C47\u603B: (10+4)/2=7</p><p>\u800C\u6B63\u786E\u7ED3\u679C\u5E94\u8BE5\u662F: 10+5+15+2+6)/5=7.6</p><ul><li>\u81EA\u5B9A\u4E49Combiner\u5B9E\u73B0\u6B65\u9AA4</li></ul><ol><li>\u81EA\u5B9A\u4E49\u4E00\u4E2ACombiner\u7EE7\u627FReducer\uFF0C\u91CD\u5199Reduce\u65B9\u6CD5</li><li>\u5728\u9A71\u52A8(Driver)\u8BBE\u7F6E\u4F7F\u7528Combiner(\u9ED8\u8BA4\u662F\u4E0D\u4F7F\u7528Combiner\u7EC4\u4EF6)</li></ol><p><strong>\u4EE3\u7801\u5B9E\u73B0</strong></p><p>\u6539\u9020WordCount\u7A0B\u5E8F\uFF0C\u6DFB\u52A0 combine \u7EC4\u4EF6</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// combiner \u7EC4\u4EF6\u7684\u8F93\u5165\u548C\u8F93\u51FA\u7C7B\u578B\uFF0C\u4E0E map() \u65B9\u6CD5\u4FDD\u6301\u4E00\u81F4</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WordCountCombiner</span> <span class="token keyword">extends</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">IntWritable</span> total <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Text</span> key<span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntWritable</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">,</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">IntWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u8FDB\u884C\u5C40\u90E8\u6C47\u603B\uFF0C\u903B\u8F91\u662F\u4E0E reduce \u65B9\u6CD5\u4FDD\u6301\u4E00\u81F4</span>
        <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">IntWritable</span> value <span class="token operator">:</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            num <span class="token operator">+=</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// \u8F93\u51FA\u5355\u8BCD\u548C\u7D2F\u52A0\u7ED3\u679C</span>
        total<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>\u5728\u9A71\u52A8(Driver)\u8BBE\u7F6E\u4F7F\u7528Combiner</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 5.1 \u8BBE\u7F6E\u4F7F\u7528 combiner \u7EC4\u4EF6</span>
job<span class="token punctuation">.</span><span class="token function">setCombinerClass</span><span class="token punctuation">(</span><span class="token class-name">WordCountCombiner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u9A8C\u8BC1\u7ED3\u679C</p><p>\u89C2\u5BDF\u7A0B\u5E8F\u8FD0\u884C\u65E5\u5FD7</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Map-Reduce Framework
	Map input records=9
	Map output records=9
	Map output bytes=104
	Map output materialized bytes=128
	Input split bytes=102
	Combine input records=0     // \u672A\u4F7F\u7528
	Combine output records=0    // \u672A\u4F7F\u7528
	Reduce input groups=6
	Reduce shuffle bytes=128
	Reduce input records=9
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Map-Reduce Framework
	Map input records=9
	Map output records=9
	Map output bytes=104
	Map output materialized bytes=86
	Input split bytes=102
	Combine input records=9     // \u4F7F\u7528 combine \u7EC4\u4EF6
	Combine output records=6    // \u51CF\u5C11\u4E86 map \u8F93\u5165\u5230 reduce \u7684\u6570\u636E
	Reduce input groups=6
	Reduce shuffle bytes=86
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>\u5982\u679C\u76F4\u63A5\u4F7F\u7528WordCountReducer\u4F5C\u4E3ACombiner\u4F7F\u7528\u662F\u5426\u53EF\u4EE5?</p><p>\u76F4\u63A5\u4F7F\u7528Reducer\u4F5C\u4E3ACombiner\u7EC4\u4EF6\u6765\u4F7F\u7528\u662F\u53EF\u4EE5\u7684!!</p></blockquote><h3 id="_6-5-6-mapreduce\u4E2D\u7684\u6392\u5E8F" tabindex="-1"><a class="header-anchor" href="#_6-5-6-mapreduce\u4E2D\u7684\u6392\u5E8F" aria-hidden="true">#</a> 6.5.6 MapReduce\u4E2D\u7684\u6392\u5E8F</h3><blockquote><p>\u6392\u5E8F\u662FMapReduce\u6846\u67B6\u4E2D\u6700\u91CD\u8981\u7684\u64CD\u4F5C\u4E4B\u4E00\u3002</p></blockquote><p>MapTask \u548C ReduceTask \u5747\u4F1A\u5BF9\u6570\u636E\u6309\u7167key\u8FDB\u884C\u6392\u5E8F\u3002\u8BE5\u64CD\u4F5C\u5C5E\u4E8EHadoop\u7684\u9ED8\u8BA4\u884C\u4E3A\u3002\u4EFB\u4F55\u5E94\u7528\u7A0B\u5E8F\u4E2D\u7684\u6570\u636E\u5747\u4F1A\u88AB\u6392\u5E8F\uFF0C\u800C\u4E0D\u7BA1\u903B\u8F91\u4E0A\u662F\u5426\u9700\u8981\u3002\u9ED8\u8BA4\u6392\u5E8F\u662F\u6309\u7167\u5B57\u5178\u987A\u5E8F\u6392\u5E8F\uFF0C\u4E14\u5B9E\u73B0\u8BE5\u6392\u5E8F\u7684\u65B9\u6CD5\u662F\u5FEB\u901F\u6392\u5E8F\u3002</p><p>MapTask</p><p>\u5B83\u4F1A\u5C06\u5904\u7406\u7684\u7ED3\u679C\u6682\u65F6\u653E\u5230\u73AF\u5F62\u7F13\u51B2\u533A\u4E2D\uFF0C\u5F53\u73AF\u5F62\u7F13\u51B2\u533A\u4F7F\u7528\u7387\u8FBE\u5230\u4E00\u5B9A\u9608\u503C\u540E\uFF0C\u518D\u5BF9\u7F13\u51B2\u533A\u4E2D\u7684\u6570\u636E\u8FDB\u884C\u4E00\u6B21\u5FEB\u901F\u6392\u5E8F\uFF0C\u5E76\u5C06\u8FD9\u4E9B\u6709\u5E8F\u6570\u636E\u6EA2\u5199\u5230\u78C1\u76D8\u4E0A\uFF0C\u6EA2\u5199\u5B8C\u6BD5\u540E\uFF0C\u5B83\u4F1A\u5BF9\u78C1\u76D8\u4E0A\u6240\u6709\u6587\u4EF6\u8FDB\u884C\u5F52\u5E76\u6392\u5E8F\u3002</p><p>ReduceTask</p><p>\u5F53\u6240\u6709\u6570\u636E\u62F7\u8D1D\u5B8C\u6BD5\u540E\uFF0CReduceTask \u7EDF\u4E00\u5BF9\u5185\u5B58\u548C\u78C1\u76D8\u4E0A\u7684\u6240\u6709\u6570\u636E\u8FDB\u884C\u4E00\u6B21\u5F52\u5E76\u6392\u5E8F\u3002</p><ol><li>\u90E8\u5206\u6392\u5E8F</li></ol><p>MapReduce\u6839\u636E\u8F93\u5165\u8BB0\u5F55\u7684\u952E\u5BF9\u6570\u636E\u96C6\u6392\u5E8F\u3002\u4FDD\u8BC1\u8F93\u51FA\u7684\u6BCF\u4E2A\u6587\u4EF6\u5185\u90E8\u6709\u5E8F\u3002</p><ol start="2"><li>\u5168\u6392\u5E8F</li></ol><p>\u6700\u7EC8\u8F93\u51FA\u7ED3\u679C\u53EA\u6709\u4E00\u4E2A\u6587\u4EF6\uFF0C\u4E14\u6587\u4EF6\u5185\u90E8\u6709\u5E8F\u3002</p><p>\u5B9E\u73B0\u65B9\u5F0F\u662F\u53EA\u8BBE\u7F6E\u4E00\u4E2AReduceTask\u3002\u4F46\u8BE5\u65B9\u6CD5\u5728\u5904\u7406\u5927\u578B\u6587\u4EF6\u65F6\u6548\u7387\u6781\u4F4E\uFF0C\u56E0\u4E3A\u4E00\u53F0\u673A\u5668\u5904\u7406\u6240\u6709\u6587\u4EF6\uFF0C\u5B8C\u5168\u4E27\u5931\u4E86MapReduce\u6240\u63D0\u4F9B\u7684\u5E76\u884C\u67B6\u6784\u3002</p><ol start="3"><li>\u8F85\u52A9\u6392\u5E8F: (GroupingComparator\u5206\u7EC4) \u5728Reduce\u7AEF\u5BF9key\u8FDB\u884C\u5206\u7EC4\u3002</li></ol><p>\u5E94\u7528\u4E8E:\u5728\u63A5\u6536\u7684key\u4E3Abean\u5BF9\u8C61\u65F6\uFF0C\u60F3\u8BA9\u4E00\u4E2A\u6216\u51E0\u4E2A\u5B57\u6BB5\u76F8\u540C(\u5168\u90E8\u5B57\u6BB5\u6BD4\u8F83\u4E0D\u76F8\u540C)\u7684key\u8FDB\u5165\u5230\u540C\u4E00\u4E2Areduce\u65B9\u6CD5\u65F6\uFF0C\u53EF\u4EE5\u91C7\u7528\u5206\u7EC4\u6392\u5E8F\u3002</p><ol start="4"><li>\u4E8C\u6B21\u6392\u5E8F. \u5728\u81EA\u5B9A\u4E49\u6392\u5E8F\u8FC7\u7A0B\u4E2D\uFF0C\u5982\u679CcompareTo\u4E2D\u7684\u5224\u65AD\u6761\u4EF6\u4E3A\u4E24\u4E2A\u5373\u4E3A\u4E8C\u6B21\u6392\u5E8F\u3002</li></ol><h4 id="_6-5-6-1-writablecomparable" tabindex="-1"><a class="header-anchor" href="#_6-5-6-1-writablecomparable" aria-hidden="true">#</a> 6.5.6.1 WritableComparable</h4><p>Bean\u5BF9\u8C61\u5982\u679C\u4F5C\u4E3AMap\u8F93\u51FA\u7684key\u65F6\uFF0C\u9700\u8981\u5B9E\u73B0WritableComparable\u63A5\u53E3\u5E76\u91CD\u5199compareTo\u65B9\u6CD5\u6307\u5B9A\u6392\u5E8F\u89C4\u5219</p><h5 id="_1-\u5168\u6392\u5E8F" tabindex="-1"><a class="header-anchor" href="#_1-\u5168\u6392\u5E8F" aria-hidden="true">#</a> 1.\u5168\u6392\u5E8F</h5><p>\u57FA\u4E8E\u7EDF\u8BA1\u7684\u64AD\u653E\u65F6\u957F\u6848\u4F8B\u7684\u8F93\u51FA\u7ED3\u679C\u5BF9\u603B\u65F6\u957F\u8FDB\u884C\u6392\u5E8F</p><p>\u5B9E\u73B0\u5168\u5C40\u6392\u5E8F\u53EA\u80FD\u8BBE\u7F6E\u4E00\u4E2AReduceTask!!</p><p><strong>\u6D4B\u8BD5\u6848\u4F8B</strong></p><p>\u64AD\u653E\u65F6\u957F\u6848\u4F8B\u8F93\u51FA\u7ED3\u679C</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>00fdaf3	33180	33420	00fdaf3	66600
00wersa4	30689	35191	00wersa4	65880
0a0fe2	43085	44254	0a0fe2	87339
0ad0s7	31702	29183	0ad0s7	60885
0sfs01	31883	29101	0sfs01	60984
a00df6s	33239	36882	a00df6s	70121
adfd00fd5	30727	31491	adfd00fd5	62218
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>\u9700\u6C42\u5206\u6790</strong></p><p>\u5982\u4F55\u8BBE\u8BA1 <code>map()</code> \u65B9\u6CD5\u8F93\u51FA\u7684 key, value ?</p><blockquote><p>MR\u6846\u67B6\u4E2Dshuffle\u9636\u6BB5\u7684\u6392\u5E8F\u662F\u9ED8\u8BA4\u884C\u4E3A\uFF0C\u4E0D\u7BA1\u4F60\u662F\u5426\u9700\u8981\u90FD\u4F1A\u8FDB\u884C\u6392\u5E8F\u3002</p></blockquote><p>key: \u628A\u6240\u6709\u5B57\u6BB5\u5C01\u88C5\u6210\u4E3A\u4E00\u4E2Abean\u5BF9\u8C61\uFF0C\u5E76\u4E14\u6307\u5B9Abean\u5BF9\u8C61\u4F5C\u4E3Akey\u8F93\u51FA\uFF0C\u5982\u679C\u4F5C\u4E3Akey\u8F93\u51FA\uFF0C\u9700\u8981\u5B9E\u73B0\u6392\u5E8F\u63A5\u53E3\uFF0C\u6307\u5B9A\u81EA\u5DF1\u7684\u6392\u5E8F\u89C4\u5219;</p><p><strong>\u5177\u4F53\u6B65\u9AA4</strong></p><p>Mapper</p><ol><li>\u8BFB\u53D6\u7ED3\u679C\u6587\u4EF6\uFF0C\u6309\u7167\u5236\u8868\u7B26\u8FDB\u884C\u5207\u5206</li><li>\u89E3\u6790\u51FA\u76F8\u5E94\u5B57\u6BB5\u5C01\u88C5\u4E3ASpeakBean</li><li>SpeakBean\u5B9E\u73B0WritableComparable\u63A5\u53E3\u91CD\u5199compareTo\u65B9\u6CD5</li><li>map()\u65B9\u6CD5\u8F93\u51FAkv; key--&gt;SpeakBean,value--&gt;NullWritable.get()</li></ol><p>Reducer</p><p>\u5FAA\u73AF\u904D\u5386\u8F93\u51FA</p><p><strong>\u4EE3\u7801\u5B9E\u73B0</strong></p><p>\u81EA\u5B9A\u4E49 Bean \u5BF9\u8C61</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token comment">// \u56E0\u4E3A\u8FD9\u4E2A\u7C7B\u7684\u5B9E\u4F8B\u5BF9\u8C61\u8981\u4F5C\u4E3A map \u8F93\u51FA\u7684key\uFF0C\u6240\u4EE5\u9700\u8981\u5B9E\u73B0 WritableComparable \u63A5\u53E3</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SortSpeakBean</span> <span class="token keyword">implements</span> <span class="token class-name">WritableComparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SortSpeakBean</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token comment">// \u5C5E\u6027\u5B9A\u4E49</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> selfDuration<span class="token punctuation">;</span> <span class="token comment">// \u81EA\u6709\u5185\u5BB9\u64AD\u653E\u65F6\u957F</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> thirdPartDuration<span class="token punctuation">;</span> <span class="token comment">// \u4E09\u65B9\u5185\u5BB9\u64AD\u653E\u65F6\u957F</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> deviceId<span class="token punctuation">;</span> <span class="token comment">// \u8BBE\u5907ID</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> sumDuration<span class="token punctuation">;</span> <span class="token comment">// \u603B\u65F6\u957F</span>

    <span class="token comment">// \u6307\u5B9A\u6392\u5E8F\u89C4\u5219</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">SortSpeakBean</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5B89\u88C5Bean\u5BF9\u8C61\u7684\u603B\u65F6\u957F\u8FDB\u884C\u6392\u5E8F</span>
        <span class="token keyword">return</span> o<span class="token punctuation">.</span>sumDuration<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sumDuration<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u5982\u679C\u4E00\u4E2A\u6761\u4EF6\u76F8\u540C\uFF0C\u518D\u6BD4\u8F83\u7B2C\u4E8C\u4E2A\u6210\u5458\u53D8\u91CF\uFF0C\u5C31\u662F\u201C\u4E8C\u6B21\u6392\u5E8F\u201D</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u5E8F\u5217\u5316\u65B9\u6CD5</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">DataOutput</span> dataOutput<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        dataOutput<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>selfDuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataOutput<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>thirdPartDuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataOutput<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>deviceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataOutput<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>sumDuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u53CD\u5E8F\u5217\u5316\u65B9\u6CD5</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readFields</span><span class="token punctuation">(</span><span class="token class-name">DataInput</span> dataInput<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>selfDuration <span class="token operator">=</span> dataInput<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>thirdPartDuration <span class="token operator">=</span> dataInput<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>deviceId <span class="token operator">=</span> dataInput<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sumDuration <span class="token operator">=</span> dataInput<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> selfDuration <span class="token operator">+</span>
                <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> thirdPartDuration <span class="token operator">+</span>
                <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> deviceId <span class="token operator">+</span>
                <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> sumDuration<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>Mapper\u4EE3\u7801</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SortMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">SortSpeakBean</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token class-name">SortSpeakBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SortSpeakBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">LongWritable</span> key<span class="token punctuation">,</span> <span class="token class-name">Text</span> value<span class="token punctuation">,</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">SortSpeakBean</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.\u8BFB\u53D6\u4E00\u884C\u6587\u672C\u8F6C\u4E3A\u5B57\u7B26\u4E32\uFF0C\u5207\u5206</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.\u89E3\u6790\u51FA\u5404\u4E2A\u5B57\u6BB5\uFF0C\u5C01\u88C5\u6210 SortSpeakBean \u5BF9\u8C61</span>
        bean<span class="token punctuation">.</span><span class="token function">setDeviceId</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setSelfDuration</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setThirdPartDuration</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setSumDuration</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3.\u8F93\u51FA SortSpeakBean \u4F5C\u4E3Akey\u8F93\u51FA</span>
        context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>Reducer\u4EE3\u7801</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SortReducer</span> <span class="token keyword">extends</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SortSpeakBean</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">,</span> <span class="token class-name">SortSpeakBean</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token comment">// reduce \u65B9\u6CD5\u7684\u8C03\u7528\u662F\u76F8\u540C key \u7EC4\u6210\u7684 value \u7684\u96C6\u5408\uFF0C\u8C03\u7528\u4E00\u6B21</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">SortSpeakBean</span> key<span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">,</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SortSpeakBean</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">,</span> <span class="token class-name">SortSpeakBean</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u6309\u7167\u603B\u6D41\u91CF\u8FDB\u884C\u6392\u5E8F\uFF0C\u8FD8\u9700\u8981\u5728 reduce \u7AEF\u8FDB\u884C\u5904\u7406\u5417\uFF1F</span>
        <span class="token comment">// \u56E0\u4E3A\u4E4B\u524D\u5DF2\u7ECF\u5229\u7528 MR \u7684 shuffle \u5BF9\u6570\u636E\u8FDB\u884C\u4E86\u6392\u5E8F\uFF0C</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">NullWritable</span> value <span class="token operator">:</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u904D\u5386 value \u7684\u540C\u65F6, key \u4E5F\u4F1A\u53D8\u5316</span>
            context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Driver \u4EE3\u7801</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SortDriver</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. \u83B7\u53D6\u914D\u7F6E\u6587\u4EF6\u5BF9\u8C61\uFF0C\u83B7\u53D6job\u5BF9\u8C61\u5B9E\u4F8B</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Job</span> job <span class="token operator">=</span> <span class="token class-name">Job</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span> <span class="token string">&quot;SortDriver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. \u6307\u5B9A\u7A0B\u5E8Fjar\u7684\u672C\u5730\u8DEF\u5F84</span>
        job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">SortDriver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. \u6307\u5B9AMapper/Reducer\u7C7B</span>
        job<span class="token punctuation">.</span><span class="token function">setMapperClass</span><span class="token punctuation">(</span><span class="token class-name">SortMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setReducerClass</span><span class="token punctuation">(</span><span class="token class-name">SortReducer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. \u6307\u5B9AMapper\u8F93\u51FA\u7684kv\u6570\u636E\u7C7B\u578B</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">SortSpeakBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. \u6307\u5B9A\u6700\u7EC8\u8F93\u51FA\u7684kv\u6570\u636E\u7C7B\u578B</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">SortSpeakBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6307\u5B9A reduceTask \u7684\u6570\u91CF\uFF0C\u9ED8\u8BA4\u662F1</span>
        job<span class="token punctuation">.</span><span class="token function">setNumReduceTasks</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 6. \u6307\u5B9Ajob\u5904\u7406\u7684\u539F\u59CB\u6570\u636E\u8DEF\u5F84</span>
        <span class="token class-name">FileInputFormat</span><span class="token punctuation">.</span><span class="token function">setInputPaths</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:/tmp/test/mr/speak/output&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 7. \u6307\u5B9Ajob\u8F93\u51FA\u7ED3\u679C\u8DEF\u5F84</span>
        <span class="token class-name">FileOutputFormat</span><span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:/tmp/test/mr/sort/output&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 8. \u63D0\u4EA4\u4F5C\u4E1A</span>
        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// JVM \u9000\u51FA\uFF1A0\u6B63\u5E38\u9000\u51FA\uFF1B\u975E0\u9519\u8BEF\u9000\u51FA</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>flag <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>\u8F93\u51FA\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>43085	44254	0a0fe2	87339
33239	36882	a00df6s	70121
33180	33420	00fdaf3	66600
30689	35191	00wersa4	65880
30727	31491	adfd00fd5	62218
31883	29101	0sfs01	60984
31702	29183	0ad0s7	60885
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u603B\u7ED3</p><ol><li>\u81EA\u5B9A\u4E49\u5BF9\u8C61\u4F5C\u4E3AMap\u7684key\u8F93\u51FA\u65F6\uFF0C\u9700\u8981\u5B9E\u73B0WritableComparable\u63A5\u53E3\uFF0C\u6392\u5E8F: \u91CD\u5199 <code>compareTo()</code> \u65B9\u6CD5\uFF0C\u5E8F\u5217\u4EE5\u53CA\u53CD\u5E8F\u5217\u5316\u65B9\u6CD5</li><li>\u518D\u6B21\u7406\u89E3reduce()\u65B9\u6CD5\u7684\u53C2\u6570; reduce()\u65B9\u6CD5\u662Fmap\u8F93\u51FA\u7684kv\u4E2Dkey\u76F8\u540C\u7684kv\u4E2D\u7684v\u7EC4\u6210\u4E00\u4E2A\u96C6\u5408\u8C03\u7528\u4E00\u6B21reduce()\u65B9\u6CD5\uFF0C\u9009\u62E9\u904D\u5386values\u5F97\u5230\u6240\u6709\u7684key(\u56E0\u4E3A\u904D\u5386value,key\u4E5F\u4F1A\u968F\u4E4B\u53D8\u5316).</li><li>\u9ED8\u8BA4reduceTask\u6570\u91CF\u662F1\u4E2A;</li><li>\u5BF9\u4E8E\u5168\u5C40\u6392\u5E8F\u9700\u8981\u4FDD\u8BC1\u53EA\u6709\u4E00\u4E2AreduceTask!!</li></ol><h5 id="_2-\u5206\u533A\u6392\u5E8F" tabindex="-1"><a class="header-anchor" href="#_2-\u5206\u533A\u6392\u5E8F" aria-hidden="true">#</a> 2.\u5206\u533A\u6392\u5E8F</h5><p>(\u9ED8\u8BA4\u7684\u5206\u533A\u89C4\u5219\uFF0C\u533A\u5185\u6709\u5E8F)</p><h4 id="_6-5-6-2-groupingcomparator" tabindex="-1"><a class="header-anchor" href="#_6-5-6-2-groupingcomparator" aria-hidden="true">#</a> 6.5.6.2 GroupingComparator</h4><p>GroupingComparator\u662Fmapreduce\u5F53\u4E2Dreduce\u7AEF\u7684\u4E00\u4E2A\u529F\u80FD\u7EC4\u4EF6\uFF0C\u4E3B\u8981\u7684\u4F5C\u7528\u662F\u51B3\u5B9A\u54EA\u4E9B\u6570\u636E\u4F5C\u4E3A\u4E00\u7EC4\uFF0C\u8C03\u7528\u4E00\u6B21reduce\u7684\u903B\u8F91\u3002\u9ED8\u8BA4\u662F\u6BCF\u4E2A\u4E0D\u540C\u7684key\uFF0C\u4F5C\u4E3A\u591A\u4E2A\u4E0D\u540C\u7684\u7EC4\uFF0C\u6BCF\u4E2A\u7EC4\u8C03\u7528\u4E00\u6B21reduce\u903B\u8F91\uFF0C</p><p>\u6211\u4EEC\u53EF\u4EE5\u81EA\u5B9A\u4E49GroupingComparator\u5B9E\u73B0\u4E0D\u540C\u7684key\u4F5C\u4E3A\u540C\u4E00\u4E2A\u7EC4\uFF0C\u8C03\u7528\u4E00\u6B21reduce\u903B\u8F91\u3002</p><h5 id="\u6D4B\u8BD5\u6848\u4F8B" tabindex="-1"><a class="header-anchor" href="#\u6D4B\u8BD5\u6848\u4F8B" aria-hidden="true">#</a> \u6D4B\u8BD5\u6848\u4F8B</h5><p>\u539F\u59CB\u6570\u636E</p><table><thead><tr><th>\u8BA2\u5355id</th><th>\u5546\u54C1id</th><th>\u6210\u4EA4\u91D1\u989D</th></tr></thead><tbody><tr><td>Order_0000001</td><td>Pdt_01</td><td>222.8</td></tr><tr><td>Order_0000001</td><td>Pdt_05</td><td>25.8</td></tr><tr><td>Order_0000002</td><td>Pdt_03</td><td>522.8</td></tr><tr><td>Order_0000002</td><td>Pdt_04</td><td>122.4</td></tr><tr><td>Order_0000002</td><td>Pdt_05</td><td>722.4</td></tr><tr><td>Order_0000003</td><td>Pdt_01</td><td>232.8</td></tr></tbody></table><p>\u9700\u6C42\uFF1A\u9700\u8981\u6C42\u51FA\u6BCF\u4E00\u4E2A\u8BA2\u5355\u4E2D\u6210\u4EA4\u91D1\u989D\u6700\u5927\u7684\u4E00\u7B14\u4EA4\u6613\u3002</p><p><strong>\u5B9E\u73B0\u601D\u8DEF</strong></p><p>Mapper</p><ul><li>\u8BFB\u53D6\u4E00\u884C\u6587\u672C\u6570\u636E\uFF0C\u5207\u5206\u51FA\u6BCF\u4E2A\u5B57\u6BB5;</li><li>\u8BA2\u5355id\u548C\u91D1\u989D\u5C01\u88C5\u4E3A\u4E00\u4E2ABean\u5BF9\u8C61\uFF0CBean\u5BF9\u8C61\u7684\u6392\u5E8F\u89C4\u5219\u6307\u5B9A\u4E3A\u5148\u6309\u7167\u8BA2\u5355Id\u6392\u5E8F\uFF0C\u8BA2\u5355Id\u76F8\u7B49\u518D\u6309\u7167\u91D1\u989D\u964D\u5E8F\u6392;</li><li>map() \u65B9\u6CD5\u8F93\u51FAkv; key--&gt;bean\u5BF9\u8C61\uFF0Cvalue--&gt;NullWritable.get();</li></ul><p>Shuffle</p><ul><li>\u6307\u5B9A\u5206\u533A\u5668\uFF0C\u4FDD\u8BC1\u8BA2\u5355id\u76F8\u540C\u7684\u6570\u636E\u53BB\u5F80\u540C\u4E00\u4E2A\u5206\u533A(\u81EA\u5B9A\u4E49\u5206\u533A\u5668)</li><li>\u6307\u5B9AGroupingComparator\uFF0C\u5206\u7EC4\u89C4\u5219\u6307\u5B9A\u53EA\u8981\u8BA2\u5355Id\u76F8\u7B49\u5219\u8BA4\u4E3A\u5C5E\u4E8E\u540C\u4E00\u7EC4;</li></ul><p>Reduce</p><ul><li>\u6BCF\u4E2A <code>reduce()</code> \u65B9\u6CD5\u5199\u51FA\u4E00\u7EC4 key \u7684\u7B2C\u4E00\u4E2A</li></ul><p><strong>\u4EE3\u7801\u5B9E\u73B0</strong></p><p>\u81EA\u5B9A\u4E49Bean\u5BF9\u8C61</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderBean</span> <span class="token keyword">implements</span> <span class="token class-name">WritableComparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderBean</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> orderId<span class="token punctuation">;</span> <span class="token comment">// \u8BA2\u5355ID</span>
    <span class="token keyword">private</span> <span class="token class-name">Double</span> price<span class="token punctuation">;</span> <span class="token comment">// \u91D1\u989D</span>

    <span class="token comment">// \u6307\u5B9A\u6392\u5E8F\u89C4\u5219\u3002\u5148\u6309\u7167\u8BA2\u5355ID\u6BD4\u8F83\uFF0C\u518D\u6309\u7167\u91D1\u989D\u6BD4\u8F83</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">OrderBean</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u4E8C\u6B21\u6392\u5E8F\uFF1A\u6B64\u5904\u4E3B\u8981\u662F\u7528\u4E8E\u6240\u6709\u6570\u636E\u7684\u6392\u5E8F</span>
        <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>orderId<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> res <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>price<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u5E8F\u5217\u5316</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">DataOutput</span> dataOutput<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        dataOutput<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataOutput<span class="token punctuation">.</span><span class="token function">writeDouble</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u53CD\u5E8F\u5217\u5316\u65B9\u6CD5</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readFields</span><span class="token punctuation">(</span><span class="token class-name">DataInput</span> dataInput<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>orderId <span class="token operator">=</span> dataInput<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> dataInput<span class="token punctuation">.</span><span class="token function">readDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> orderId <span class="token operator">+</span>
                <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> price<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>Mapper</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GroupMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">OrderBean</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token class-name">OrderBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">LongWritable</span> key<span class="token punctuation">,</span> <span class="token class-name">Text</span> value<span class="token punctuation">,</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">OrderBean</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BA2\u5355ID\u4E0E\u91D1\u989D\u5C01\u88C5\u4E3A OrderBean</span>
        bean<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Partitioner</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomPartitioner</span> <span class="token keyword">extends</span> <span class="token class-name">Partitioner</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderBean</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPartition</span><span class="token punctuation">(</span><span class="token class-name">OrderBean</span> key<span class="token punctuation">,</span> <span class="token class-name">NullWritable</span> value<span class="token punctuation">,</span> <span class="token keyword">int</span> numPartitions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5E0C\u671B\u8BA2\u5355ID\u76F8\u540C\u7684\u6570\u636E\u8FDB\u5165\u540C\u4E00\u4E2A\u5206\u533A</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">)</span> <span class="token operator">%</span> numPartitions<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>CustomGroupingComparator</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomGroupingComparator</span> <span class="token keyword">extends</span> <span class="token class-name">WritableComparator</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">CustomGroupingComparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">OrderBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u6CE8\u518C\u81EA\u5B9A\u4E49\u7684 GroupingComparator \u63A5\u53D7 OrderBean \u5BF9\u8C61</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u91CD\u5199 compare() \u65B9\u6CD5\uFF0C\u6765\u8BA9 MR \u63A5\u53D7 orderId \u76F8\u7B49\u5219\u4E24\u4E2A\u5BF9\u8C61\u76F8\u7B49\u7684\u89C4\u5219</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">WritableComparable</span> a<span class="token punctuation">,</span> <span class="token class-name">WritableComparable</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u6BD4\u8F83\u4E24\u4E2A\u5BF9\u8C61\u7684 OrderId</span>
        <span class="token class-name">OrderBean</span> o1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">OrderBean</span><span class="token punctuation">)</span> a<span class="token punctuation">;</span>
        <span class="token class-name">OrderBean</span> o2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">OrderBean</span><span class="token punctuation">)</span> b<span class="token punctuation">;</span>
        <span class="token keyword">return</span> o1<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>o2<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Reducer</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GroupReducer</span> <span class="token keyword">extends</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderBean</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">,</span> <span class="token class-name">OrderBean</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">OrderBean</span> key<span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">,</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderBean</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">,</span> <span class="token class-name">OrderBean</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u76F4\u63A5\u8F93\u51FA key\uFF0C\u5C31\u662F\u91D1\u989D\u6700\u5927\u7684\u4EA4\u6613</span>
        context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Driver</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GroupDriver</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. \u83B7\u53D6\u914D\u7F6E\u6587\u4EF6\u5BF9\u8C61\uFF0C\u83B7\u53D6job\u5BF9\u8C61\u5B9E\u4F8B</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Job</span> job <span class="token operator">=</span> <span class="token class-name">Job</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span> <span class="token string">&quot;GroupDriver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. \u6307\u5B9A\u7A0B\u5E8Fjar\u7684\u672C\u5730\u8DEF\u5F84</span>
        job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">GroupDriver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. \u6307\u5B9AMapper/Reducer\u7C7B</span>
        job<span class="token punctuation">.</span><span class="token function">setMapperClass</span><span class="token punctuation">(</span><span class="token class-name">GroupMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setReducerClass</span><span class="token punctuation">(</span><span class="token class-name">GroupReducer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. \u6307\u5B9AMapper\u8F93\u51FA\u7684kv\u6570\u636E\u7C7B\u578B</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">OrderBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. \u6307\u5B9A\u6700\u7EC8\u8F93\u51FA\u7684kv\u6570\u636E\u7C7B\u578B</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">OrderBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u6307\u5B9A\u5206\u533A\u5668</span>
        job<span class="token punctuation">.</span><span class="token function">setPartitionerClass</span><span class="token punctuation">(</span><span class="token class-name">CustomPartitioner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6307\u5B9A groupingComparator</span>
        job<span class="token punctuation">.</span><span class="token function">setGroupingComparatorClass</span><span class="token punctuation">(</span><span class="token class-name">CustomGroupingComparator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6307\u5B9A reduceTask \u7684\u6570\u91CF</span>
        job<span class="token punctuation">.</span><span class="token function">setNumReduceTasks</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 6. \u6307\u5B9Ajob\u5904\u7406\u7684\u539F\u59CB\u6570\u636E\u8DEF\u5F84</span>
        <span class="token class-name">FileInputFormat</span><span class="token punctuation">.</span><span class="token function">setInputPaths</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\\\tmp\\\\test\\\\mr\\\\group\\\\input\\\\GroupingComparator\\\\groupingComparator.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 7. \u6307\u5B9Ajob\u8F93\u51FA\u7ED3\u679C\u8DEF\u5F84</span>
        <span class="token class-name">FileOutputFormat</span><span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\\\tmp\\\\test\\\\mr\\\\group\\\\output&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 8. \u63D0\u4EA4\u4F5C\u4E1A</span>
        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// JVM \u9000\u51FA\uFF1A0\u6B63\u5E38\u9000\u51FA\uFF1B\u975E0\u9519\u8BEF\u9000\u51FA</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>flag <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="_6-5-7-mapreduce-join-\u5B9E\u6218" tabindex="-1"><a class="header-anchor" href="#_6-5-7-mapreduce-join-\u5B9E\u6218" aria-hidden="true">#</a> 6.5.7 MapReduce Join \u5B9E\u6218</h3><h4 id="_6-5-7-1-mr-reduce-\u7AEF-join" tabindex="-1"><a class="header-anchor" href="#_6-5-7-1-mr-reduce-\u7AEF-join" aria-hidden="true">#</a> 6.5.7.1 MR reduce \u7AEF join</h4><h5 id="_1-\u9700\u6C42\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_1-\u9700\u6C42\u5206\u6790" aria-hidden="true">#</a> 1.\u9700\u6C42\u5206\u6790</h5><p>\u9700\u6C42: \u6295\u9012\u884C\u4E3A\u6570\u636E\u8868deliver_info:</p><table><thead><tr><th>userId</th><th>positionId</th><th>date</th></tr></thead><tbody><tr><td>1001</td><td>177725422</td><td>2020-01-03</td></tr><tr><td>1002</td><td>177725422</td><td>2020-01-04</td></tr><tr><td>1002</td><td>177725433</td><td>2020-01-03</td></tr></tbody></table><p>\u804C\u4F4D\u8868position</p><table><thead><tr><th>id</th><th>positionName</th></tr></thead><tbody><tr><td>177725422</td><td>\u4EA7\u54C1\u7ECF\u7406</td></tr><tr><td>177725433</td><td>\u5927\u6570\u636E\u5F00\u53D1\u5DE5\u7A0B\u5E08</td></tr></tbody></table><p>\u5047\u5982\u6570\u636E\u91CF\u5DE8\u5927\uFF0C\u4E24\u8868\u7684\u6570\u636E\u662F\u4EE5\u6587\u4EF6\u7684\u5F62\u5F0F\u5B58\u50A8\u5728HDFS\u4E2D\uFF0C\u9700\u8981\u7528mapreduce\u7A0B\u5E8F\u6765\u5B9E\u73B0\u4E00\u4E0BSQL\u67E5\u8BE2\u8FD0\u7B97</p><blockquote><p>\u5982\u4F55\u5224\u65AD\u8BFB\u53D6\u7684\u662F\u54EA\u4E2A\u6587\u4EF6\u7684\u6570\u636E\uFF1F</p><p>\u53EF\u4EE5\u901A\u8FC7\u5728 Mapper \u4E2D\u91CD\u5199 setup() \u65B9\u6CD5\uFF0C\u901A\u8FC7\u83B7\u53D6\u5207\u7247\u4FE1\u606F\u83B7\u53D6\u5230\u6B63\u5728\u8BFB\u53D6\u7684\u6587\u4EF6\u4FE1\u606F</p></blockquote><h5 id="_2-\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_2-\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 2.\u4EE3\u7801\u5B9E\u73B0</h5><p>\u901A\u8FC7\u5C06\u5173\u8054\u7684\u6761\u4EF6\u4F5C\u4E3Amap\u8F93\u51FA\u7684key\uFF0C\u5C06\u4E24\u8868\u6EE1\u8DB3join\u6761\u4EF6\u7684\u6570\u636E\u5E76\u643A\u5E26\u6570\u636E\u6240\u6765\u6E90\u7684\u6587\u4EF6\u4FE1\u606F\uFF0C\u53D1\u5F80\u540C\u4E00\u4E2Areduce task\uFF0C\u5728reduce\u4E2D\u8FDB\u884C\u6570\u636E\u7684\u4E32\u8054</p><p>DeliverBean</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeliverBean</span> <span class="token keyword">implements</span> <span class="token class-name">Writable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> userId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> positionId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> date<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> positionName<span class="token punctuation">;</span>
    <span class="token comment">// \u5224\u65AD\u662F\u6295\u9012\u6570\u636E\u8FD8\u662F\u804C\u4F4D\u6570\u636E\u6807\u8BC6</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> flag<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">DataOutput</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        out<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>positionId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>positionName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readFields</span><span class="token punctuation">(</span><span class="token class-name">DataInput</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userId <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>positionId <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>date <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>positionName <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>flag <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>Mapper</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReduceJoinMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">DeliverBean</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">DeliverBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeliverBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Text</span> k <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// map \u4EFB\u52A1\u542F\u52A8\u65F6\u6267\u884C\u4E00\u6B21</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">DeliverBean</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">FileSplit</span> inputSplit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">FileSplit</span><span class="token punctuation">)</span>context<span class="token punctuation">.</span><span class="token function">getInputSplit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        name <span class="token operator">=</span> inputSplit<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">LongWritable</span> key<span class="token punctuation">,</span> <span class="token class-name">Text</span> value<span class="token punctuation">,</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">DeliverBean</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;deliver_info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u8BFB\u53D6\u7684\u6295\u9012\u884C\u4E3A\u6570\u636E</span>
            bean<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bean<span class="token punctuation">.</span><span class="token function">setPositionId</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bean<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// \u7A7A\u6570\u636E\u8BBE\u7F6E\u4E3A\u7A7A\u4E32\uFF0C\u907F\u514D\u5E8F\u5217\u5316\u5F02\u5E38</span>
            bean<span class="token punctuation">.</span><span class="token function">setPositionName</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bean<span class="token punctuation">.</span><span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token string">&quot;deliver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u8BFB\u53D6\u7684\u804C\u4F4D\u6570\u636E</span>
            bean<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bean<span class="token punctuation">.</span><span class="token function">setPositionId</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bean<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bean<span class="token punctuation">.</span><span class="token function">setPositionName</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bean<span class="token punctuation">.</span><span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token string">&quot;position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        k<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>bean<span class="token punctuation">.</span><span class="token function">getPositionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>ReduceJoinReducer</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReduceJoinReducer</span> <span class="token keyword">extends</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">DeliverBean</span><span class="token punctuation">,</span> <span class="token class-name">DeliverBean</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Text</span> key<span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DeliverBean</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">,</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">DeliverBean</span><span class="token punctuation">,</span> <span class="token class-name">DeliverBean</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u76F8\u540C positionId \u7684 bean \u5BF9\u8C61\u653E\u5230\u4E86\u4E00\u8D77 \uFF081\u4E2A\u804C\u4F4D\u6570\u636E\uFF0Cn\u4E2A\u6295\u9012\u884C\u4E3A\u6570\u636E\uFF09</span>

        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DeliverBean</span><span class="token punctuation">&gt;</span></span> deBeans <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DeliverBean</span> positionBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeliverBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">DeliverBean</span> bean <span class="token operator">:</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> flag <span class="token operator">=</span> bean<span class="token punctuation">.</span><span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;deliver&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u6295\u9012\u884C\u4E3A\u6570\u636E</span>
                <span class="token class-name">DeliverBean</span> newBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeliverBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>newBean<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    deBeans<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvocationTargetException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u804C\u4F4D\u6570\u636E</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>positionBean<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvocationTargetException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// \u904D\u5386\u6295\u9012\u884C\u4E3A\u6570\u636E\uFF0C\u8865\u5168 positionName</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">DeliverBean</span> bean <span class="token operator">:</span> deBeans<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bean<span class="token punctuation">.</span><span class="token function">setPositionName</span><span class="token punctuation">(</span>positionBean<span class="token punctuation">.</span><span class="token function">getPositionName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>Driver</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReduceJoinDriver</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. \u83B7\u53D6\u914D\u7F6E\u6587\u4EF6\u5BF9\u8C61\uFF0C\u83B7\u53D6job\u5BF9\u8C61\u5B9E\u4F8B</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Job</span> job <span class="token operator">=</span> <span class="token class-name">Job</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span> <span class="token string">&quot;ReduceJoinDriver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. \u6307\u5B9A\u7A0B\u5E8Fjar\u7684\u672C\u5730\u8DEF\u5F84</span>
        job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">ReduceJoinDriver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. \u6307\u5B9AMapper/Reducer\u7C7B</span>
        job<span class="token punctuation">.</span><span class="token function">setMapperClass</span><span class="token punctuation">(</span><span class="token class-name">ReduceJoinMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setReducerClass</span><span class="token punctuation">(</span><span class="token class-name">ReduceJoinReducer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. \u6307\u5B9AMapper\u8F93\u51FA\u7684kv\u6570\u636E\u7C7B\u578B</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">DeliverBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. \u6307\u5B9A\u6700\u7EC8\u8F93\u51FA\u7684kv\u6570\u636E\u7C7B\u578B</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">DeliverBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 6. \u6307\u5B9Ajob\u5904\u7406\u7684\u539F\u59CB\u6570\u636E\u8DEF\u5F84</span>
        <span class="token class-name">FileInputFormat</span><span class="token punctuation">.</span><span class="token function">setInputPaths</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\\\tmp\\\\test\\\\mr\\\\reduce_join\\\\input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 7. \u6307\u5B9Ajob\u8F93\u51FA\u7ED3\u679C\u8DEF\u5F84</span>
        <span class="token class-name">FileOutputFormat</span><span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\\\tmp\\\\test\\\\mr\\\\reduce_join\\\\output&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 8. \u63D0\u4EA4\u4F5C\u4E1A</span>
        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// JVM \u9000\u51FA\uFF1A0\u6B63\u5E38\u9000\u51FA\uFF1B\u975E0\u9519\u8BEF\u9000\u51FA</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>flag <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>\u7F3A\u70B9: \u8FD9\u79CD\u65B9\u5F0F\u4E2D\uFF0Cjoin\u7684\u64CD\u4F5C\u662F\u5728reduce\u9636\u6BB5\u5B8C\u6210\uFF0Creduce\u7AEF\u7684\u5904\u7406\u538B\u529B\u592A\u5927\uFF0Cmap\u8282\u70B9\u7684\u8FD0\u7B97\u8D1F\u8F7D\u5219\u5F88\u4F4E\uFF0C\u8D44\u6E90\u5229\u7528\u7387\u4E0D\u9AD8\uFF0C\u4E14\u5728reduce\u9636\u6BB5\u6781\u6613\u4EA7\u751F\u6570\u636E\u503E\u659C</p><ul><li>\u6570\u636E\u805A\u5408\u529F\u80FD\u5728reduce\u7AEF\u5B8C\u6210\uFF0C\u800C reduce \u7AEF\u7684\u5E76\u884C\u5EA6\u4E00\u822C\u4E0D\u9AD8\uFF0C\u6240\u4EE5\u6267\u884C\u6548\u7387\u5B58\u5728\u9690\u60A3\u3002</li><li>\u76F8\u540C position \u7684\u6570\u636E\u53BB\u5F80\u4E86\u540C\u4E00\u4E2A\u5206\u533A\uFF0C\u5982\u679C\u6570\u636E\u672C\u8EAB\u5B58\u5728\u4E0D\u5747\u8861\uFF0C\u5BB9\u6613\u9020\u6210<em>\u6570\u636E\u503E\u659C</em></li></ul><p>\u89E3\u51B3\u65B9\u6848: map\u7AEFjoin\u5B9E\u73B0\u65B9\u5F0F</p><h4 id="_6-5-7-2-mr-map-\u7AEF-join" tabindex="-1"><a class="header-anchor" href="#_6-5-7-2-mr-map-\u7AEF-join" aria-hidden="true">#</a> 6.5.7.2 MR map \u7AEF join</h4><h5 id="_1-\u9700\u6C42\u5206\u6790-1" tabindex="-1"><a class="header-anchor" href="#_1-\u9700\u6C42\u5206\u6790-1" aria-hidden="true">#</a> 1.\u9700\u6C42\u5206\u6790</h5><p>\u9002\u7528\u4E8E\u5173\u8054\u8868\u4E2D\u6709\u5C0F\u8868\u7684\u60C5\u5F62;</p><p>\u53EF\u4EE5\u5C06\u5C0F\u8868\u5206\u53D1\u5230\u6240\u6709\u7684map\u8282\u70B9\uFF0C\u8FD9\u6837\uFF0Cmap\u8282\u70B9\u5C31\u53EF\u4EE5\u5728\u672C\u5730\u5BF9\u81EA\u5DF1\u6240\u8BFB\u5230\u7684\u5927\u8868\u6570\u636E\u8FDB\u884Cjoin\u5E76\u8F93\u51FA\u6700\u7EC8\u7ED3\u679C\uFF0C\u53EF\u4EE5\u5927\u5927\u63D0\u9AD8join\u64CD\u4F5C\u7684\u5E76\u53D1\u5EA6\uFF0C\u52A0\u5FEB\u5904\u7406\u901F\u5EA6</p><h5 id="_2-\u4EE3\u7801\u5B9E\u73B0-1" tabindex="-1"><a class="header-anchor" href="#_2-\u4EE3\u7801\u5B9E\u73B0-1" aria-hidden="true">#</a> 2.\u4EE3\u7801\u5B9E\u73B0</h5><ul><li>\u5728Mapper\u7684setup\u9636\u6BB5\uFF0C\u5C06\u6587\u4EF6\u8BFB\u53D6\u5230\u7F13\u5B58\u96C6\u5408\u4E2D</li><li>\u5728\u9A71\u52A8\u51FD\u6570\u4E2D\u52A0\u8F7D\u7F13\u5B58</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u7F13\u5B58\u666E\u901A\u6587\u4EF6\u5230Task\u8FD0\u884C\u8282\u70B9\u3002</span>
job<span class="token punctuation">.</span><span class="token function">addCacheFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URI</span><span class="token punctuation">(</span><span class="token string">&quot;file:///e:/cache/position.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>\u4EE3\u7801\u5B9E\u73B0</strong></p><p>Mapper</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u4F7F\u7528 Map \u7AEF Join</span>
<span class="token comment">// map \u7AEF\u7F13\u5B58\u6240\u6709\u804C\u4F4D\u6570\u636E\uFF0Cmap() \u65B9\u6CD5\u8BFB\u53D6\u7684\u6587\u4EF6\u6570\u636E\u662F\u6295\u9012\u884C\u4E3A\u6570\u636E\u3002\u83B7\u53D6\u5230\u6295\u9012\u884C\u4E3A\u6570\u636E\u540E\uFF0C\u53BB\u7F13\u5B58\u4E2D\u67E5\u8BE2\u51FA position \u6570\u636E\u62FC\u63A5\u8F93\u51FA\u3002</span>
<span class="token comment">// \u8FD9\u4E2A Job \u4E2D\u65E0\u987B reduce task\uFF0C\u53EF\u4EE5\u8BBE\u7F6E setnumreducetask \u4E3A 0</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapJoinMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token class-name">Text</span> k <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u521D\u59CB\u5316\u52A0\u8F7D\u804C\u4F4D\u6570\u636E</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u8BFB\u53D6\u7F13\u5B58\u6587\u4EF6</span>
        <span class="token class-name">InputStreamReader</span> inputStreamReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;position.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BufferedReader</span> bufferedReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span>inputStreamReader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BFB\u53D6\u804C\u4F4D\u6570\u636E\uFF0C\u89E3\u6790\u4E3A K/V \u7C7B\u578B</span>
        <span class="token class-name">String</span> line<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNoneEmpty</span><span class="token punctuation">(</span>line <span class="token operator">=</span> bufferedReader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> fields<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        bufferedReader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">LongWritable</span> key<span class="token punctuation">,</span> <span class="token class-name">Text</span> value<span class="token punctuation">,</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> line <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u90FD\u662F\u6295\u9012\u884C\u4E3A\u6570\u636E</span>
        <span class="token class-name">String</span> positionName <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        k<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>line <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> positionName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>Driver</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapJoinDriver</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">URISyntaxException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. \u83B7\u53D6\u914D\u7F6E\u6587\u4EF6\u5BF9\u8C61\uFF0C\u83B7\u53D6job\u5BF9\u8C61\u5B9E\u4F8B</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Job</span> job <span class="token operator">=</span> <span class="token class-name">Job</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span> <span class="token string">&quot;MapJoinDriver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. \u6307\u5B9A\u7A0B\u5E8Fjar\u7684\u672C\u5730\u8DEF\u5F84</span>
        job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">MapJoinDriver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. \u6307\u5B9AMapper/Reducer\u7C7B</span>
        job<span class="token punctuation">.</span><span class="token function">setMapperClass</span><span class="token punctuation">(</span><span class="token class-name">MapJoinMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. \u6307\u5B9AMapper\u8F93\u51FA\u7684kv\u6570\u636E\u7C7B\u578B</span>
        <span class="token comment">// 5. \u6307\u5B9A\u6700\u7EC8\u8F93\u51FA\u7684kv\u6570\u636E\u7C7B\u578B</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 6. \u6307\u5B9Ajob\u5904\u7406\u7684\u539F\u59CB\u6570\u636E\u8DEF\u5F84</span>
        <span class="token class-name">FileInputFormat</span><span class="token punctuation">.</span><span class="token function">setInputPaths</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\\\tmp\\\\test\\\\mr\\\\map_join\\\\input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 7. \u6307\u5B9Ajob\u8F93\u51FA\u7ED3\u679C\u8DEF\u5F84</span>
        <span class="token class-name">FileOutputFormat</span><span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\\\tmp\\\\test\\\\mr\\\\map_join\\\\output&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6E\u52A0\u8F7D\u7F13\u5B58\u6587\u4EF6</span>
        job<span class="token punctuation">.</span><span class="token function">addCacheFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;D:/tmp/test/mr/map_join/cache/position.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BBE\u7F6E reduceTask \u6570\u91CF\u4E3A 0</span>
        job<span class="token punctuation">.</span><span class="token function">setNumReduceTasks</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 8. \u63D0\u4EA4\u4F5C\u4E1A</span>
        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// JVM \u9000\u51FA\uFF1A0\u6B63\u5E38\u9000\u51FA\uFF1B\u975E0\u9519\u8BEF\u9000\u51FA</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>flag <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><blockquote><p>Map \u7AEF Join \u907F\u514D\u4E86 Reduce \u7AEF Join \u7684\u6570\u636E\u503E\u659C\u95EE\u9898\u3002</p></blockquote><h4 id="_6-5-7-3-\u6570\u636E\u503E\u659C\u89E3\u51B3\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#_6-5-7-3-\u6570\u636E\u503E\u659C\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a> 6.5.7.3 \u6570\u636E\u503E\u659C\u89E3\u51B3\u65B9\u6848</h4><p>\u4EC0\u4E48\u662F\u6570\u636E\u503E\u659C? \u6570\u636E\u503E\u659C\u65E0\u975E\u5C31\u662F\u5927\u91CF\u7684\u76F8\u540Ckey\u88ABpartition\u5206\u914D\u5230\u4E00\u4E2A\u5206\u533A\u91CC,</p><p>\u73B0\u8C61: \u7EDD\u5927\u591A\u6570task\u6267\u884C\u5F97\u90FD\u975E\u5E38\u5FEB\uFF0C\u4F46\u4E2A\u522Btask\u6267\u884C\u7684\u6781\u6162\u3002\u751A\u81F3\u5931\u8D25!</p><p><strong>\u901A\u7528\u89E3\u51B3\u65B9\u6848: \u5BF9key\u589E\u52A0\u968F\u673A\u6570\u3002</strong></p><h3 id="_6-5-8-mapreduce\u8BFB\u53D6\u548C\u8F93\u51FA\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_6-5-8-mapreduce\u8BFB\u53D6\u548C\u8F93\u51FA\u6570\u636E" aria-hidden="true">#</a> 6.5.8 MapReduce\u8BFB\u53D6\u548C\u8F93\u51FA\u6570\u636E</h3><h4 id="_6-5-8-1-inputformat" tabindex="-1"><a class="header-anchor" href="#_6-5-8-1-inputformat" aria-hidden="true">#</a> 6.5.8.1 InputFormat</h4><p>\u8FD0\u884CMapReduce\u7A0B\u5E8F\u65F6\uFF0C\u8F93\u5165\u7684\u6587\u4EF6\u683C\u5F0F\u5305\u62EC: \u57FA\u4E8E\u884C\u7684\u65E5\u5FD7\u6587\u4EF6\u3001\u4E8C\u8FDB\u5236\u683C\u5F0F\u6587\u4EF6\u3001\u6570\u636E\u5E93\u8868\u7B49\u3002\u90A3\u4E48\uFF0C\u9488\u5BF9\u4E0D\u540C\u7684\u6570\u636E\u7C7B\u578B\uFF0CMapReduce\u662F\u5982\u4F55\u8BFB\u53D6\u8FD9\u4E9B\u6570\u636E\u7684\u5462?</p><p>InputFormat\u662FMapReduce\u6846\u67B6\u7528\u6765\u8BFB\u53D6\u6570\u636E\u7684\u7C7B\u3002</p><p>InputFormat\u5E38\u89C1\u5B50\u7C7B\u5305\u62EC:</p><ul><li>TextInputFormat (\u666E\u901A\u6587\u672C\u6587\u4EF6\uFF0CMR\u6846\u67B6<em>\u9ED8\u8BA4</em>\u7684\u8BFB\u53D6\u5B9E\u73B0\u7C7B\u578B)</li><li>KeyValueTextInputFormat(\u8BFB\u53D6\u4E00\u884C\u6587\u672C\u6570\u636E\u6309\u7167\u6307\u5B9A\u5206\u9694\u7B26\uFF0C\u628A\u6570\u636E\u5C01\u88C5\u4E3Akv\u7C7B\u578B)</li><li>NLineInputFormat(\u8BFB\u53D6\u6570\u636E\u6309\u7167\u884C\u6570\u8FDB\u884C\u5212\u5206\u5206\u7247)</li><li>CombineTextInputFormat(\u5408\u5E76\u5C0F\u6587\u4EF6\uFF0C\u907F\u514D\u542F\u52A8\u8FC7\u591AMapTask\u4EFB\u52A1)</li><li>\u81EA\u5B9A\u4E49InputFormat</li></ul><h5 id="_1-combinetextinputformat\u6848\u4F8B" tabindex="-1"><a class="header-anchor" href="#_1-combinetextinputformat\u6848\u4F8B" aria-hidden="true">#</a> 1.CombineTextInputFormat\u6848\u4F8B</h5><p>MR\u6846\u67B6\u9ED8\u8BA4\u7684TextInputFormat\u5207\u7247\u673A\u5236\u6309\u6587\u4EF6\u5212\u5206\u5207\u7247\uFF0C\u6587\u4EF6\u65E0\u8BBA\u591A\u5C0F\uFF0C\u90FD\u662F\u5355\u72EC\u4E00\u4E2A\u5207\u7247\uFF0C \u7136\u540E\u7531\u4E00\u4E2AMapTask\u5904\u7406\uFF0C \u5982\u679C\u6709\u5927\u91CF\u5C0F\u6587\u4EF6\uFF0C\u5C31\u5BF9\u5E94\u7684\u4F1A\u751F\u6210\u5E76\u542F\u52A8\u5927\u91CF\u7684 MapTask\uFF0C\u800C\u6BCF\u4E2AMapTask\u5904\u7406\u7684\u6570\u636E\u91CF\u5F88\u5C0F\uFF0C\u5927\u91CF\u65F6\u95F4\u6D6A\u8D39\u5728\u521D\u59CB\u5316\u8D44\u6E90\u542F\u52A8\u6536\u56DE\u7B49\u9636\u6BB5\uFF0C\u8FD9\u79CD\u65B9\u5F0F\u5BFC\u81F4\u8D44\u6E90\u5229\u7528\u7387\u4E0D\u9AD8\u3002</p><p>CombineTextInputFormat\u7528\u4E8E\u5C0F\u6587\u4EF6\u8FC7\u591A\u7684\u573A\u666F\uFF0C\u5B83\u53EF\u4EE5\u5C06\u591A\u4E2A\u5C0F\u6587\u4EF6\u4ECE\u903B\u8F91\u4E0A\u5212\u5206\u6210\u4E00\u4E2A\u5207\u7247\uFF0C\u8FD9\u6837\u591A\u4E2A\u5C0F\u6587\u4EF6\u5C31\u53EF\u4EE5\u4EA4\u7ED9\u4E00\u4E2AMapTask\u5904\u7406\uFF0C\u63D0\u9AD8\u8D44\u6E90\u5229\u7528\u7387\u3002</p><p>\u9700\u6C42\uFF1A\u5C06\u8F93\u5165\u6570\u636E\u4E2D\u7684\u591A\u4E2A\u5C0F\u6587\u4EF6\u5408\u5E76\u4E3A\u4E00\u4E2A\u5207\u7247\u5904\u7406</p><p>\u8FD0\u884CWordCount\u6848\u4F8B\uFF0C\u51C6\u5907\u591A\u4E2A\u5C0F\u6587\u4EF6</p><p>\u5177\u4F53\u4F7F\u7528\u65B9\u5F0F\uFF1A</p><p>\u5728 Driver \u4E2D\u6DFB\u52A0\u5982\u4E0B\u4EE3\u7801\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u5982\u679C\u4E0D\u8BBE\u7F6EInputFormat\uFF0C\u5B83\u9ED8\u8BA4\u7528\u7684\u662FTextInputFormat.class </span>
job<span class="token punctuation">.</span><span class="token function">setInputFormatClass</span><span class="token punctuation">(</span><span class="token class-name">CombineTextInputFormat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u865A\u62DF\u5B58\u50A8\u5207\u7247\u6700\u5927\u503C\u8BBE\u7F6E4m, \u6B64\u5904\u7684\u5355\u4F4D\u662F Byte</span>
<span class="token class-name">CombineTextInputFormat</span><span class="token punctuation">.</span><span class="token function">setMaxInputSplitSize</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token number">4194304</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>CombineTextInputFormat\u5207\u7247\u539F\u7406</strong></p><p>\u5207\u7247\u751F\u6210\u8FC7\u7A0B\u5206\u4E3A\u4E24\u90E8\u5206: \u865A\u62DF\u5B58\u50A8\u8FC7\u7A0B\u548C\u5207\u7247\u8FC7\u7A0B</p><p>\u5047\u8BBE\u8BBE\u7F6EsetMaxInputSplitSize\u503C\u4E3A4M</p><p>\u56DB\u4E2A\u5C0F\u6587\u4EF6: 1.txt --&gt;2M; 2.txt--&gt;7M; 3.txt--&gt;0.3M; 4.txt---&gt;8.2M</p><p>\u865A\u62DF\u5B58\u50A8\u8FC7\u7A0B: \u628A\u8F93\u5165\u76EE\u5F55\u4E0B\u6240\u6709\u6587\u4EF6\u5927\u5C0F\uFF0C\u4F9D\u6B21\u548C<code>setMaxInputSplitSize</code>\u7684\u503C\u8FDB\u884C\u6BD4\u8F83\uFF0C\u5982\u679C\u4E0D\u5927\u4E8E\u8BBE\u7F6E\u7684\u6700\u5927\u503C\uFF0C\u903B\u8F91\u4E0A\u5212\u5206\u4E00\u4E2A\u5757\u3002 \u5982\u679C\u8F93\u5165\u6587\u4EF6\u5927\u4E8E\u8BBE\u7F6E\u7684\u6700\u5927\u503C\u4E14\u5927\u4E8E\u4E24\u500D\uFF0C\u90A3\u4E48\u4EE5\u6700\u5927\u503C\u5207\u5272\u4E00\u5757; \u5F53\u5269\u4F59\u6570\u636E\u5927\u5C0F\u8D85\u8FC7\u8BBE\u7F6E\u7684\u6700\u5927\u503C\u4E14\u4E0D\u5927\u4E8E\u6700\u5927\u503C2\u500D\uFF0C\u6B64\u65F6\u5C06\u6587\u4EF6\u5747\u5206\u62102\u4E2A\u865A\u62DF\u5B58\u50A8\u5757(\u9632\u6B62\u51FA\u73B0\u592A\u5C0F\u5207\u7247)\u3002</p><blockquote><p>\u6BD4\u5982 <code>setMaxInputSplitSize</code> \u503C\u4E3A4M\uFF0C\u8F93\u5165\u6587\u4EF6\u5927\u5C0F\u4E3A8.02M\uFF0C\u5219\u5148\u903B\u8F91\u4E0A\u5206\u51FA\u4E00\u4E2A4M\u7684\u5757\u3002\u5269\u4F59\u7684\u5927\u5C0F\u4E3A4.02M\uFF0C\u5982\u679C\u6309\u71674M\u903B\u8F91\u5212\u5206\uFF0C\u5C31\u4F1A\u51FA\u73B00.02M\u7684\u975E\u5E38\u5C0F\u7684\u865A\u62DF\u5B58\u50A8\u6587\u4EF6\uFF0C \u6240\u4EE5\u5C06\u5269\u4F59\u76844.02M\u6587\u4EF6\u5207\u5206\u6210(2.01M\u548C2.01M)\u4E24\u4E2A\u6587\u4EF6\u3002</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u5212\u5206\u60C5\u51B5

1.txt--&gt;2M; 2M&lt;4M; \u4E00\u4E2A\u5757;
2.txt--&gt;7M; 7M&gt;4M,\u4F46\u662F\u4E0D\u5927\u4E8E\u4E24\u500D\uFF0C\u5747\u5300\u5206\u6210\u4E24\u5757; \u4E24\u5757:\u6BCF\u57573.5M; 
3.txt--&gt;0.3M; 0.3&lt;4M; \u4E00\u4E2A\u5757 
4.txt--&gt;8.2M; \u5927\u4E8E\u6700\u5927\u503C\u4E14\u5927\u4E8E\u4E24\u500D; \u4E00\u4E2A4M\u7684\u5757\uFF0C\u5269\u4F594.2M\u5206\u6210\u4E24\u5757\uFF0C\u6BCF\u57572.1M 

\u6240\u6709\u5757\u4FE1\u606F:

2M\uFF0C3.5M\uFF0C3.5M\uFF0C0.3M\uFF0C4M\uFF0C2.1M\uFF0C2.1M \u51717\u4E2A\u865A\u62DF\u5B58\u50A8\u5757\u3002 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u5207\u7247\u8FC7\u7A0B</p><p>\u5224\u65AD\u865A\u62DF\u5B58\u50A8\u7684\u6587\u4EF6\u5927\u5C0F\u662F\u5426\u5927\u4E8E <code>setMaxInputSplitSize</code> \u7684\u503C\uFF0C\u5927\u4E8E\u7B49\u4E8E\u5219\u5355\u72EC\u5F62\u6210\u4E00\u4E2A\u5207\u7247\u3002</p><p>\u5982\u679C\u4E0D\u5927\u4E8E\u5219\u8DDF\u4E0B\u4E00\u4E2A\u865A\u62DF\u5B58\u50A8\u6587\u4EF6\u8FDB\u884C\u5408\u5E76\uFF0C\u5171\u540C\u5F62\u6210\u4E00\u4E2A\u5207\u7247\u3002</p><p>\u6309\u7167\u4E4B\u524D\u8F93\u5165\u6587\u4EF6: \u67094\u4E2A\u5C0F\u6587\u4EF6\u5927\u5C0F\u5206\u522B\u4E3A 2M\u30017M\u30010.3M\u4EE5\u53CA8.2M\u8FD9\u56DB\u4E2A\u5C0F\u6587\u4EF6\uFF0C\u5219\u865A\u62DF\u5B58\u50A8\u4E4B\u540E\u5F62\u62107\u4E2A\u6587\u4EF6\u5757\uFF0C\u5927\u5C0F\u5206\u522B\u4E3A: 2M\uFF0C3.5M\uFF0C3.5M\uFF0C0.3M\uFF0C4M\uFF0C2.1M\uFF0C2.1M</p><p>\u6700\u7EC8\u4F1A\u5F62\u62103\u4E2A\u5207\u7247\uFF0C\u5927\u5C0F\u5206\u522B\u4E3A: (2+3.5)M\uFF0C(3.5+0.3+4)M\uFF0C(2.1+2.1)M</p><blockquote><p>\u6CE8\u610F: \u865A\u62DF\u5B58\u50A8\u5207\u7247\u6700\u5927\u503C\u8BBE\u7F6E\u6700\u597D\u6839\u636E\u5B9E\u9645\u7684\u5C0F\u6587\u4EF6\u5927\u5C0F\u60C5\u51B5\u6765\u8BBE\u7F6E\u5177\u4F53\u7684\u503C\u3002</p></blockquote><h5 id="_2-\u81EA\u5B9A\u4E49inputformat" tabindex="-1"><a class="header-anchor" href="#_2-\u81EA\u5B9A\u4E49inputformat" aria-hidden="true">#</a> 2.\u81EA\u5B9A\u4E49InputFormat</h5><p>\u65E0\u8BBA\u662FHDFS\u8FD8\u662FMapReduce\uFF0C\u5728\u5904\u7406\u5C0F\u6587\u4EF6\u65F6\u6548\u7387\u90FD\u975E\u5E38\u4F4E\uFF0C\u4F46\u53C8\u96BE\u514D\u9762\u4E34\u5904\u7406\u5927\u91CF\u5C0F\u6587\u4EF6\u7684\u573A\u666F\uFF0C\u6B64\u65F6\uFF0C\u5C31\u9700\u8981\u6709\u76F8\u5E94\u89E3\u51B3\u65B9\u6848\u3002</p><p>\u53EF\u4EE5\u81EA\u5B9A\u4E49InputFormat\u5B9E\u73B0\u5C0F\u6587\u4EF6\u7684\u5408\u5E76\u3002</p><p><strong>\u9700\u6C42</strong></p><p>\u5C06\u591A\u4E2A\u5C0F\u6587\u4EF6\u5408\u5E76\u6210\u4E00\u4E2ASequenceFile\u6587\u4EF6(SequenceFile\u6587\u4EF6\u662FHadoop\u7528\u6765\u5B58\u50A8\u4E8C\u8FDB\u5236\u5F62\u5F0F\u7684key-value\u5BF9\u7684\u6587\u4EF6\u683C\u5F0F)\u3002 SequenceFile\u91CC\u9762\u5B58\u50A8\u7740\u591A\u4E2A\u6587\u4EF6\uFF0C\u5B58\u50A8\u7684\u5F62\u5F0F\u4E3A <code>\u6587\u4EF6\u8DEF\u5F84+\u540D\u79F0</code> \u4E3Akey\uFF0C\u6587\u4EF6\u5185\u5BB9\u4E3Avalue\u3002</p><p>\u7ED3\u679C</p><p>\u5F97\u5230\u4E00\u4E2A\u5408\u5E76\u4E86\u591A\u4E2A\u5C0F\u6587\u4EF6\u7684SequenceFile\u6587\u4EF6</p><p>\u6574\u4F53\u601D\u8DEF</p><ol><li>\u5B9A\u4E49\u4E00\u4E2A\u7C7B\u7EE7\u627FFileInputFormat \uFF08TextInputFormat\u7684\u7236\u7C7B\u5C31\u662F FileInputFormat\uFF09</li><li>\u91CD\u5199 <code>isSplitable()</code> \u65B9\u6CD5\u6307\u5B9A\u4E3A\u4E0D\u53EF\u5207\u5206; \u91CD\u5199 <code>createRecordReader()</code> \u65B9\u6CD5\uFF0C\u521B\u5EFA\u81EA\u5DF1\u7684RecorderReader\u5BF9\u8C61\uFF0C\u5B9E\u73B0\u81EA\u5B9A\u4E49\u8BFB\u53D6\u6570\u636E\u903B\u8F91</li><li>\u6539\u53D8\u9ED8\u8BA4\u8BFB\u53D6\u6570\u636E\u65B9\u5F0F\uFF0C\u5B9E\u73B0\u4E00\u6B21\u8BFB\u53D6\u4E00\u4E2A\u5B8C\u6574\u6587\u4EF6\u4F5C\u4E3Akv\u8F93\u51FA;</li><li>Driver\u6307\u5B9A\u4F7F\u7528\u7684InputFormat\u7C7B\u578B</li></ol><p>\u4EE3\u7801\u5B9E\u73B0</p><p>CustomInputFormat</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u81EA\u5B9A\u4E49 InputFormat \u5B9E\u73B0\u591A\u4E2A\u5C0F\u6587\u4EF6\u5408\u5E76\u4E3A\u4E00\u4E2A SequenceFile \u6587\u4EF6</span>
<span class="token comment">// SequenceFile \u6587\u4EF6\u4E2D\u4EE5 K/V \u5F62\u5F0F\u5B58\u50A8\u6587\u4EF6\u3002 key -&gt; \u6587\u4EF6\u8DEF\u5F84+\u6587\u4EF6\u540D\u79F0\uFF1Bvalue -&gt; \u6587\u4EF6\u7684\u5B8C\u6574\u5185\u5BB9</span>
<span class="token comment">// TextInputFormat \u7684\u6CDB\u578B\u662F\uFF1ALongWritable(\u6587\u672C\u504F\u79FB\u91CF), Text(\u6587\u672C\u5185\u5BB9)\u3002\u8868\u660E\u5F53\u524D InputFormat \u7684\u8F93\u51FA\u7C7B\u578B</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomInputFormat</span> <span class="token keyword">extends</span> <span class="token class-name">FileInputFormat</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">BytesWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token comment">// RecordReader \u7528\u6765\u8BFB\u53D6\u6570\u636E\u7684\u5BF9\u8C61</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">RecordReader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">BytesWritable</span><span class="token punctuation">&gt;</span></span> <span class="token function">createRecordReader</span><span class="token punctuation">(</span><span class="token class-name">InputSplit</span> split<span class="token punctuation">,</span> <span class="token class-name">TaskAttemptContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">CustomRecordReader</span> recordReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomRecordReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8C03\u7528 recordReader \u7684\u521D\u59CB\u5316\u65B9\u6CD5</span>
        recordReader<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>split<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> recordReader<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u5224\u65AD\u5F53\u524D\u6587\u4EF6\u662F\u5426\u53EF\u5207\u5206</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">isSplitable</span><span class="token punctuation">(</span><span class="token class-name">JobContext</span> context<span class="token punctuation">,</span> <span class="token class-name">Path</span> filename<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5BF9\u4E8E\u5F53\u524D\u9700\u6C42\uFF0C\u4E0D\u9700\u8981\u5207\u5206\u6587\u4EF6\uFF0C\u4FDD\u8BC1\u4E00\u4E2A\u5207\u7247\u5C31\u662F\u4E00\u4E2A\u6587\u4EF6</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>CustomRecordReader</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u8D1F\u8D23\u8BFB\u53D6\u6570\u636E\u3002\u4E00\u6B21\u8BFB\u53D6\u6574\u4E2A\u6587\u4EF6\u5185\u5BB9\uFF0C\u5C01\u88C5\u6210 kv \u8F93\u51FA</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomRecordReader</span> <span class="token keyword">extends</span> <span class="token class-name">RecordReader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">BytesWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">FileSplit</span> fileSplit<span class="token punctuation">;</span>

    <span class="token comment">// hadoop \u914D\u7F6E\u6587\u4EF6\u5BF9\u8C61</span>
    <span class="token keyword">private</span> <span class="token class-name">Configuration</span> conf<span class="token punctuation">;</span>

    <span class="token comment">// \u5B9A\u4E49 key\u3001value \u7684\u6210\u5458\u53D8\u91CF</span>
    <span class="token keyword">private</span> <span class="token class-name">Text</span> key <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">BytesWritable</span> value <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BytesWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u521D\u59CB\u5316\u65B9\u6CD5\uFF0C\u628A\u5207\u7247\u4EE5\u53CA\u4E0A\u4E0B\u6587\u63D0\u5347\u4E3A\u5168\u5C40</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">InputSplit</span> split<span class="token punctuation">,</span> <span class="token class-name">TaskAttemptContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        fileSplit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">FileSplit</span><span class="token punctuation">)</span> split<span class="token punctuation">;</span>
        conf <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">// \u7528\u6765\u8BFB\u53D6\u6570\u636E\u7684\u65B9\u6CD5</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">nextKeyValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

        <span class="token comment">// \u5BF9\u4E8E\u5F53\u524D split \u6765\u8BF4\uFF0C\u53EA\u9700\u8981\u8BFB\u53D6\u4E00\u6B21\u5373\u53EF\uFF0C\u56E0\u4E3A\u4E00\u6B21\u5C31\u8BFB\u53D6\u4E86\u6574\u4E2A\u6587\u4EF6</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token comment">// \u83B7\u53D6\u5207\u7247\u7684 path \u4FE1\u606F</span>
        <span class="token class-name">Path</span> path <span class="token operator">=</span> fileSplit<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u83B7\u53D6\u6587\u4EF6\u7CFB\u7EDF\u5BF9\u8C61</span>
        <span class="token class-name">FileSystem</span> fs <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">getFileSystem</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u83B7\u53D6\u8F93\u5165\u6D41</span>
        <span class="token class-name">FSDataInputStream</span> fsDataInputStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u51C6\u5907\u4E00\u4E2A\u6570\u7EC4\u5B58\u653E\u8BFB\u53D6\u5230\u7684\u6570\u636E</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> fileSplit<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8BFB\u53D6\u6570\u636E\uFF0C\u5E76\u628A\u6570\u636E\u653E\u5165 byte \u6570\u7EC4\u4E2D</span>
        <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">readFully</span><span class="token punctuation">(</span>fsDataInputStream<span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> content<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u5C01\u88C5 key/value</span>
        key<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        value<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> content<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u5173\u95ED\u8D44\u6E90</span>
        <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">closeStream</span><span class="token punctuation">(</span>fsDataInputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u5173\u95ED\u53EF\u4EE5\u518D\u6B21\u8BFB\u53D6\u7684\u5F00\u5173</span>
        flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u83B7\u53D6 Key</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Text</span> <span class="token function">getCurrentKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u83B7\u53D6 Value</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">BytesWritable</span> <span class="token function">getCurrentValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u83B7\u53D6\u8FDB\u5EA6</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">float</span> <span class="token function">getProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u5173\u95ED\u8D44\u6E90</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br></div></div><p>SequenceMapper</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Text \u5728\u6B64\u4EE3\u8868\u7684\u662F\u4E00\u4E2A\u6587\u4EF6\u7684 &#39;path + \u540D\u79F0&#39;\uFF0CBytesWritable \u4E00\u4E2A\u6587\u4EF6\u7684\u5185\u5BB9</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SequenceMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">BytesWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">BytesWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Text</span> key<span class="token punctuation">,</span> <span class="token class-name">BytesWritable</span> value<span class="token punctuation">,</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">BytesWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">BytesWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>SequenceReducer</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SequenceReducer</span> <span class="token keyword">extends</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">BytesWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">BytesWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Text</span> key<span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BytesWritable</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">,</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">BytesWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">BytesWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u8F93\u51FA value \u503C(\u6587\u4EF6\u5185\u5BB9)\uFF0C\u53EA\u83B7\u53D6\u5176\u4E2D\u7B2C\u4E00\u4E2A\u5373\u53EF\uFF08\u5185\u5BB9\u53EA\u6709\u4E00\u4E2A\uFF09</span>
        context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> values<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Driver</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SequenceDriver</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. \u83B7\u53D6\u914D\u7F6E\u6587\u4EF6\u5BF9\u8C61\uFF0C\u83B7\u53D6job\u5BF9\u8C61\u5B9E\u4F8B</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Job</span> job <span class="token operator">=</span> <span class="token class-name">Job</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span> <span class="token string">&quot;SequenceDriver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. \u6307\u5B9A\u7A0B\u5E8Fjar\u7684\u672C\u5730\u8DEF\u5F84</span>
        job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">SequenceDriver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. \u6307\u5B9AMapper/Reducer\u7C7B</span>
        job<span class="token punctuation">.</span><span class="token function">setMapperClass</span><span class="token punctuation">(</span><span class="token class-name">SequenceMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setReducerClass</span><span class="token punctuation">(</span><span class="token class-name">SequenceReducer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. \u6307\u5B9AMapper\u8F93\u51FA\u7684kv\u6570\u636E\u7C7B\u578B</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">BytesWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. \u6307\u5B9A\u6700\u7EC8\u8F93\u51FA\u7684kv\u6570\u636E\u7C7B\u578B</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">BytesWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u4F7F\u7528\u81EA\u5B9A\u4E49 InputFormat \u8BFB\u53D6\u6570\u636E</span>
        job<span class="token punctuation">.</span><span class="token function">setInputFormatClass</span><span class="token punctuation">(</span><span class="token class-name">CustomInputFormat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 6. \u6307\u5B9Ajob\u5904\u7406\u7684\u539F\u59CB\u6570\u636E\u8DEF\u5F84</span>
        <span class="token class-name">FileInputFormat</span><span class="token punctuation">.</span><span class="token function">setInputPaths</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 7. \u6307\u5B9Ajob\u8F93\u51FA\u7ED3\u679C\u8DEF\u5F84</span>
        <span class="token class-name">FileOutputFormat</span><span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 8. \u63D0\u4EA4\u4F5C\u4E1A</span>
        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// JVM \u9000\u51FA\uFF1A0\u6B63\u5E38\u9000\u51FA\uFF1B\u975E0\u9519\u8BEF\u9000\u51FA</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>flag <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="_6-5-8-2-outputformat" tabindex="-1"><a class="header-anchor" href="#_6-5-8-2-outputformat" aria-hidden="true">#</a> 6.5.8.2 OutputFormat</h4><p><code>OutputFormat</code> \u662F MapReduce \u8F93\u51FA\u6570\u636E\u7684\u57FA\u7C7B\uFF0C\u6240\u6709MapReduce\u7684\u6570\u636E\u8F93\u51FA\u90FD\u7EE7\u627F\u4E86OutputFormat \u62BD\u8C61\u7C7B\u3002</p><p>\u4E0B\u9762\u6211\u4EEC\u4ECB\u7ECD\u51E0\u79CD\u5E38\u89C1\u7684OutputFormat\u5B50\u7C7B\uFF1A</p><ul><li>TextOutputFormat</li></ul><p>\u9ED8\u8BA4\u7684\u8F93\u51FA\u683C\u5F0F\u662FTextOutputFormat\uFF0C\u5B83\u628A\u6BCF\u6761\u8BB0\u5F55\u5199\u4E3A\u6587\u672C\u884C\u3002\u5B83\u7684\u952E\u548C\u503C\u53EF\u4EE5\u662F\u4EFB\u610F\u7C7B\u578B\uFF0C\u56E0\u4E3ATextOutputFormat\u8C03\u7528toString()\u65B9\u6CD5\u628A\u5B83\u4EEC\u8F6C\u6362\u4E3A\u5B57\u7B26\u4E32\u3002</p><ul><li>SequenceFileOutputFormat</li></ul><p>\u5C06SequenceFileOutputFormat\u8F93\u51FA\u4F5C\u4E3A\u540E\u7EEDMapReduce\u4EFB\u52A1\u7684\u8F93\u5165\uFF0C\u8FD9\u662F\u4E00\u79CD\u597D\u7684\u8F93\u51FA\u683C\u5F0F\uFF0C\u56E0\u4E3A\u5B83\u7684\u683C\u5F0F\u7D27\u51D1\uFF0C\u5F88\u5BB9\u6613\u88AB\u538B\u7F29\u3002</p><h5 id="\u81EA\u5B9A\u4E49outputformat" tabindex="-1"><a class="header-anchor" href="#\u81EA\u5B9A\u4E49outputformat" aria-hidden="true">#</a> \u81EA\u5B9A\u4E49OutputFormat</h5><p><strong>\u9700\u6C42\u5206\u6790</strong></p><p>\u8981\u5728\u4E00\u4E2AMapReduce\u7A0B\u5E8F\u4E2D\u6839\u636E\u6570\u636E\u7684\u4E0D\u540C\u8F93\u51FA\u4E24\u7C7B\u7ED3\u679C\u5230\u4E0D\u540C\u76EE\u5F55\uFF0C\u8FD9\u7C7B\u8F93\u51FA\u9700\u6C42\u53EF\u4EE5\u901A\u8FC7\u81EA\u5B9A\u4E49 OutputFormat\u6765\u5B9E\u73B0\u3002</p><p><strong>\u5B9E\u73B0\u6B65\u9AA4</strong></p><ol><li>\u81EA\u5B9A\u4E49\u4E00\u4E2A\u7C7B\u7EE7\u627FFileOutputFormat\u3002</li><li>\u6539\u5199RecordWriter\uFF0C\u6539\u5199\u8F93\u51FA\u6570\u636E\u7684\u65B9\u6CD5write()\u3002</li></ol><p><strong>\u9700\u6C42</strong></p><p>\u7F51\u7EDC\u8BF7\u6C42\u65E5\u5FD7\u6570\u636E</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>http://www.baidu.com
http://www.google.com
http://cn.bing.com
http://www.zmn.cn
http://www.sohu.com
http://www.sina.com
http://www.sin2a.com
http://www.sin2desa.com
http://www.sindsafa.com
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u8F93\u51FA\u7ED3\u679C:</p><p>zmn.log</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>http://www.zmn.com
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>other.log</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>http://cn.bing.com
http://www.baidu.com
http://www.google.com
http://www.sin2a.com
http://www.sin2desa.com
http://www.sina.com
http://www.sindsafa.com
http://www.sohu.com
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>\u53C2\u8003\u4EE3\u7801</strong></p><p>Mapper\u548CReducer\u4E3A\u4E86\u7B80\u5355\u8D77\u89C1\uFF0C\u90FD\u4E0D\u505A\u4EFB\u4F55\u4E8B\u60C5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OutputMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">LongWritable</span> key<span class="token punctuation">,</span> <span class="token class-name">Text</span> value<span class="token punctuation">,</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OutputReducer</span> <span class="token keyword">extends</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Text</span> key<span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">,</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span>Context context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>CustomOutputFormat</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomOutputFormat</span> <span class="token keyword">extends</span> <span class="token class-name">FileOutputFormat</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token comment">// \u5199\u51FA\u6570\u636E\u7684\u5BF9\u8C61</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">RecordWriter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRecordWriter</span><span class="token punctuation">(</span><span class="token class-name">TaskAttemptContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5B9A\u4E49\u5199\u51FA\u6570\u636E\u7684\u8DEF\u5F84\uFF0C\u5E76\u83B7\u53D6\u5230\u8F93\u51FA\u6D41\u4F20\u5165 writer \u5BF9\u8C61\u4E2D</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileSystem</span> fs <span class="token operator">=</span> <span class="token class-name">FileSystem</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5B9A\u4E49\u8F93\u51FA\u7684\u8DEF\u5F84</span>
        <span class="token class-name">FSDataOutputStream</span> zmnOut <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:/tmp/test/mr/output/zmn.log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FSDataOutputStream</span> otherOut <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:/tmp/test/mr/output/other.log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">CustomWriter</span> customWriter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomWriter</span><span class="token punctuation">(</span>zmnOut<span class="token punctuation">,</span> otherOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> customWriter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>CustomWriter</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomWriter</span> <span class="token keyword">extends</span> <span class="token class-name">RecordWriter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token comment">// \u5B9A\u4E49\u6210\u5458\u53D8\u91CF</span>
    <span class="token keyword">private</span> <span class="token class-name">FSDataOutputStream</span> zmnOut<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">FSDataOutputStream</span> otherOut<span class="token punctuation">;</span>

    <span class="token comment">// \u5199\u51FA\u6570\u636E\u7684\u903B\u8F91</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Text</span> key<span class="token punctuation">,</span> <span class="token class-name">NullWritable</span> value<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> line <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;zmn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            zmnOut<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            zmnOut<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;\\r\\n&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            otherOut<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            otherOut<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;\\r\\n&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u5173\u95ED\u3001\u91CA\u653E\u8D44\u6E90</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">TaskAttemptContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">closeStream</span><span class="token punctuation">(</span>zmnOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">closeStream</span><span class="token punctuation">(</span>otherOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>OutputDriver</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OutputDriver</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. \u83B7\u53D6\u914D\u7F6E\u6587\u4EF6\u5BF9\u8C61\uFF0C\u83B7\u53D6job\u5BF9\u8C61\u5B9E\u4F8B</span>
        <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Job</span> job <span class="token operator">=</span> <span class="token class-name">Job</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span> <span class="token string">&quot;OutputDriver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. \u6307\u5B9A\u7A0B\u5E8Fjar\u7684\u672C\u5730\u8DEF\u5F84</span>
        job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">OutputDriver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. \u6307\u5B9AMapper/Reducer\u7C7B</span>
        job<span class="token punctuation">.</span><span class="token function">setMapperClass</span><span class="token punctuation">(</span><span class="token class-name">OutputMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setReducerClass</span><span class="token punctuation">(</span><span class="token class-name">OutputReducer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. \u6307\u5B9AMapper\u8F93\u51FA\u7684kv\u6570\u636E\u7C7B\u578B</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">LongWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setMapOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. \u6307\u5B9A\u6700\u7EC8\u8F93\u51FA\u7684kv\u6570\u636E\u7C7B\u578B</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u4F7F\u7528\u81EA\u5B9A\u4E49 OutputFormat</span>
        job<span class="token punctuation">.</span><span class="token function">setOutputFormatClass</span><span class="token punctuation">(</span><span class="token class-name">CustomOutputFormat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 6. \u6307\u5B9Ajob\u5904\u7406\u7684\u539F\u59CB\u6570\u636E\u8DEF\u5F84 (click_log)</span>
        <span class="token class-name">FileInputFormat</span><span class="token punctuation">.</span><span class="token function">setInputPaths</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 7. \u6307\u5B9Ajob\u8F93\u51FA\u7ED3\u679C\u8DEF\u5F84 \u3010</span>
        <span class="token comment">// \u867D\u7136\u5728\u4EE3\u7801\u4E2D\u5DF2\u7ECF\u901A\u8FC7\u6D41\u7684\u65B9\u5F0F\u6307\u5B9A\u4E86\u8F93\u51FA\u8DEF\u5F84\uFF0C\u4F46\u662F\u56E0\u4E3A\u8FD8\u9700\u8981\u8F93\u51FA\u57FA\u672C\u6570\u636E\uFF0C\u5982 SUCCESS \u6587\u4EF6\uFF0C\u6240\u4EE5\u6B64\u5904\u4ECD\u7136\u9700\u8981\u6307\u5B9A\u8F93\u51FA\u8DEF\u5F84\u3011</span>
        <span class="token class-name">FileOutputFormat</span><span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 8. \u63D0\u4EA4\u4F5C\u4E1A</span>
        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// JVM \u9000\u51FA\uFF1A0\u6B63\u5E38\u9000\u51FA\uFF1B\u975E0\u9519\u8BEF\u9000\u51FA</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>flag <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="_6-5-9-shuffle\u9636\u6BB5\u6570\u636E\u7684\u538B\u7F29\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#_6-5-9-shuffle\u9636\u6BB5\u6570\u636E\u7684\u538B\u7F29\u673A\u5236" aria-hidden="true">#</a> 6.5.9 shuffle\u9636\u6BB5\u6570\u636E\u7684\u538B\u7F29\u673A\u5236</h3><h4 id="_6-5-9-1-hadoop-\u5F53\u4E2D\u652F\u6301\u7684\u538B\u7F29\u7B97\u6CD5" tabindex="-1"><a class="header-anchor" href="#_6-5-9-1-hadoop-\u5F53\u4E2D\u652F\u6301\u7684\u538B\u7F29\u7B97\u6CD5" aria-hidden="true">#</a> 6.5.9.1 hadoop \u5F53\u4E2D\u652F\u6301\u7684\u538B\u7F29\u7B97\u6CD5</h4><p>\u6570\u636E\u538B\u7F29\u6709\u4E24\u5927\u597D\u5904: \u8282\u7EA6\u78C1\u76D8\u7A7A\u95F4\uFF0C\u52A0\u901F\u6570\u636E\u5728\u7F51\u7EDC\u548C\u78C1\u76D8\u4E0A\u7684\u4F20\u8F93!!</p><p>\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 <code>bin/hadoop checknative</code> \u6765\u67E5\u770B\u6211\u4EEC\u7F16\u8BD1\u4E4B\u540E\u7684hadoop\u652F\u6301\u7684\u5404\u79CD\u538B\u7F29\uFF0C\u5982\u679C\u51FA\u73B0 openssl \u4E3Afalse\uFF0C\u90A3\u4E48\u5C31\u5728\u7EBF\u5B89\u88C5\u4E00\u4E0B\u4F9D\u8D56\u5305!!</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>hadoop checknative

<span class="token number">22</span>/01/12 <span class="token number">17</span>:36:13 WARN util.NativeCodeLoader: Unable to load native-hadoop library <span class="token keyword">for</span> your platform<span class="token punctuation">..</span>. using builtin-java classes where applicable
Native library checking:
hadoop:  <span class="token boolean">false</span>
zlib:    <span class="token boolean">false</span>
snappy:  <span class="token boolean">false</span>
zstd  <span class="token builtin class-name">:</span>  <span class="token boolean">false</span>
lz4:     <span class="token boolean">false</span>
bzip2:   <span class="token boolean">false</span>
openssl: <span class="token boolean">false</span>
<span class="token number">22</span>/01/12 <span class="token number">17</span>:36:14 INFO util.ExitUtil: Exiting with status <span class="token number">1</span>: ExitException
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u5B89\u88C5 openssl</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum <span class="token function">install</span> -y openssl-devel
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><table><thead><tr><th>\u538B\u7F29\u683C\u5F0F</th><th>Hadoop\u81EA\u5E26</th><th>\u7B97\u6CD5</th><th>\u6587\u4EF6\u6269\u5C55\u540D</th><th>\u662F\u5426\u53EF\u5207\u5206</th><th>\u6362\u6210\u538B\u7F29\u683C\u5F0F\u540E\uFF0C\u539F\u6765\u7684\u7A0B\u5E8F\u662F\u5426\u9700\u8981\u4FEE\u6539</th></tr></thead><tbody><tr><td>DEFLATE</td><td>\u662F\uFF0C\u76F4\u63A5\u4F7F\u7528</td><td>DEFLATE</td><td>.deflate</td><td>\u5426</td><td>\u548C\u6587\u672C\u5904\u7406\u4E00\u6837\uFF0C\u4E0D\u9700\u8981\u4FEE\u6539</td></tr><tr><td>Gzip</td><td>\u662F\uFF0C\u76F4\u63A5\u4F7F\u7528</td><td>DEFLATE</td><td>.gz</td><td>\u5426</td><td>\u548C\u6587\u672C\u5904\u7406\u4E00\u6837\uFF0C\u4E0D\u9700\u8981\u4FEE\u6539</td></tr><tr><td>bzip2</td><td>\u662F\uFF0C\u76F4\u63A5\u4F7F\u7528</td><td>bzip2</td><td>.bz2</td><td>\u662F</td><td>\u548C\u6587\u672C\u5904\u7406\u4E00\u6837\uFF0C\u4E0D\u9700\u8981\u4FEE\u6539</td></tr><tr><td>LZO</td><td>\u5426\uFF0C\u9700\u8981\u5B89\u88C5</td><td>LZO</td><td>.lzo</td><td>\u662F</td><td>\u9700\u8981\u5EFA\u7D22\u5F15\uFF0C\u8FD8\u9700\u8981\u6307\u5B9A\u8F93\u5165</td></tr><tr><td>Snappy</td><td>\u5426\uFF0C\u9700\u8981\u5B89\u88C5</td><td>Snappy</td><td>.snappy</td><td>\u5426</td><td>\u548C\u6587\u672C\u5904\u7406\u4E00\u6837\uFF0C\u4E0D\u9700\u8981\u4FEE\u6539</td></tr></tbody></table><p>\u4E3A\u4E86\u652F\u6301\u591A\u79CD\u538B\u7F29/\u89E3\u538B\u7F29\u7B97\u6CD5\uFF0CHadoop\u5F15\u5165\u4E86\u7F16\u7801/\u89E3\u7801\u5668</p><table><thead><tr><th>\u538B\u7F29\u683C\u5F0F</th><th>\u5BF9\u5E94\u7684\u7F16\u7801/\u89E3\u7801\u5668</th></tr></thead><tbody><tr><td>DEFLATE</td><td>org.apache.hadoop.io.compress.DefaultCodec</td></tr><tr><td>gzip</td><td>org.apache.hadoop.io.compress.GzipCodec</td></tr><tr><td>bzip2</td><td>org.apache.hadoop.io.compress.BZip2Codec</td></tr><tr><td>LZO</td><td>com.hadoop.compression.lzo.LzopCodec</td></tr><tr><td>Snappy</td><td>org.apache.hadoop.io.compress.SnappyCodec</td></tr></tbody></table><p>\u5E38\u89C1\u538B\u7F29\u65B9\u5F0F\u5BF9\u6BD4\u5206\u6790</p><table><thead><tr><th>\u538B\u7F29\u7B97\u6CD5</th><th>\u539F\u59CB\u6587\u4EF6\u5927\u5C0F</th><th>\u538B\u7F29\u540E\u7684\u6587\u4EF6\u5927\u5C0F</th><th>\u538B\u7F29\u901F\u5EA6</th><th>\u89E3\u538B\u7F29\u901F\u5EA6</th></tr></thead><tbody><tr><td>gzip</td><td>8.3GB</td><td>1.8GB</td><td>17.5MB/s</td><td>58MB/s</td></tr><tr><td>bzip2</td><td>8.3GB</td><td>1.1GB</td><td>2.4MB/s</td><td>9.5MB/s</td></tr><tr><td>LZO-bset</td><td>8.3GB</td><td>2GB</td><td>4MB/s</td><td>60.6MB/s</td></tr><tr><td>LZO</td><td>8.3GB</td><td>2.9GB</td><td>49.3MB/S</td><td>74.6MB/s</td></tr></tbody></table><h4 id="_6-5-9-2-\u538B\u7F29\u4F4D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_6-5-9-2-\u538B\u7F29\u4F4D\u7F6E" aria-hidden="true">#</a> 6.5.9.2 \u538B\u7F29\u4F4D\u7F6E</h4><ul><li>Map\u8F93\u5165\u7AEF\u538B\u7F29</li></ul><p>\u6B64\u5904\u4F7F\u7528\u538B\u7F29\u6587\u4EF6\u4F5C\u4E3AMap\u7684\u8F93\u5165\u6570\u636E\uFF0C\u65E0\u9700\u663E\u793A\u6307\u5B9A\u7F16\u89E3\u7801\u65B9\u5F0F\uFF0CHadoop\u4F1A\u81EA\u52A8\u68C0\u67E5\u6587\u4EF6\u6269\u5C55\u540D\uFF0C\u5982\u679C\u538B\u7F29\u65B9\u5F0F\u80FD\u591F\u5339\u914D\uFF0CHadoop\u5C31\u4F1A\u9009\u62E9\u5408\u9002\u7684\u7F16\u89E3\u7801\u65B9\u5F0F\u5BF9\u6587\u4EF6\u8FDB\u884C\u538B\u7F29\u548C\u89E3\u538B\u3002</p><ul><li>Map\u8F93\u51FA\u7AEF\u538B\u7F29</li></ul><p>Shuffle \u662FHadoop MR\u8FC7\u7A0B\u4E2D\u8D44\u6E90\u6D88\u8017\u6700\u591A\u7684\u9636\u6BB5\uFF0C\u5982\u679C\u6709\u6570\u636E\u91CF\u8FC7\u5927\u9020\u6210\u7F51\u7EDC\u4F20\u8F93\u901F\u5EA6\u7F13\u6162\uFF0C\u53EF\u4EE5\u8003\u8651\u4F7F\u7528\u538B\u7F29\u3002</p><ul><li>Reduce \u7AEF\u8F93\u51FA\u538B\u7F29</li></ul><p>\u8F93\u51FA\u7684\u7ED3\u679C\u6570\u636E\u4F7F\u7528\u538B\u7F29\u80FD\u591F\u51CF\u5C11\u5B58\u50A8\u7684\u6570\u636E\u91CF\uFF0C\u964D\u4F4E\u6240\u9700\u78C1\u76D8\u7684\u7A7A\u95F4\uFF0C\u5E76\u4E14\u4F5C\u4E3A\u7B2C\u4E8C\u4E2AMR\u7684\u8F93\u5165\u65F6\u53EF\u4EE5\u590D\u7528\u538B\u7F29\u3002</p><h4 id="_6-5-9-3-\u538B\u7F29\u914D\u7F6E\u65B9\u5F0F" tabindex="-1"><a class="header-anchor" href="#_6-5-9-3-\u538B\u7F29\u914D\u7F6E\u65B9\u5F0F" aria-hidden="true">#</a> 6.5.9.3 \u538B\u7F29\u914D\u7F6E\u65B9\u5F0F</h4><ol><li>\u5728\u9A71\u52A8\u4EE3\u7801\u4E2D\u901A\u8FC7 Configuration \u76F4\u63A5\u8BBE\u7F6E\u4F7F\u7528\u7684\u538B\u7F29\u65B9\u5F0F\uFF0C\u53EF\u4EE5\u5F00\u542FMap\u8F93\u51FA\u548CReduce\u8F93\u51FA\u538B\u7F29</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u8BBE\u7F6Emap\u9636\u6BB5\u538B\u7F29</span>
<span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
configuration<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;mapreduce.map.output.compress&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
configuration<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;mapreduce.map.output.compress.codec&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;org.apache.hadoop.i o.compress.SnappyCodec&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u8BBE\u7F6Ereduce\u9636\u6BB5\u7684\u538B\u7F29 </span>
configuration<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;mapreduce.output.fileoutputformat.compress&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
configuration<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;mapreduce.output.fileoutputformat.compress.type&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;RECORD&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
configuration<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;mapreduce.output.fileoutputformat.compress.codec&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;org.ap ache.hadoop.io.compress.SnappyCodec&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="2"><li>\u914D\u7F6E mapred-site.xml(\u4FEE\u6539\u540E\u5206\u53D1\u5230\u96C6\u7FA4\u5176\u5B83\u8282\u70B9\uFF0C\u91CD\u542FHadoop\u96C6\u7FA4),\u6B64\u79CD\u65B9\u5F0F\u5BF9\u8FD0\u884C\u5728\u96C6\u7FA4\u7684\u6240\u6709MR\u4EFB\u52A1\u90FD\u4F1A\u6267\u884C\u538B\u7F29\u3002</li></ol><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.output.fileoutputformat.compress<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.output.fileoutputformat.compress.type<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>RECORD<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.output.fileoutputformat.compress.codec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop.io.compress.SnappyCodec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_6-5-9-4-\u538B\u7F29\u6848\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-5-9-4-\u538B\u7F29\u6848\u4F8B" aria-hidden="true">#</a> 6.5.9.4 \u538B\u7F29\u6848\u4F8B</h4><p>\u9700\u6C42\uFF1A\u4F7F\u7528snappy\u538B\u7F29\u65B9\u5F0F\u538B\u7F29WordCount\u6848\u4F8B\u7684\u8F93\u51FA\u7ED3\u679C\u6570\u636E</p><p>\u5177\u4F53\u5B9E\u73B0</p><p>\u5728\u9A71\u52A8\u4EE3\u7801\u4E2D\u6DFB\u52A0\u538B\u7F29\u914D\u7F6E</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>configuration<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;mapreduce.output.fileoutputformat.compress&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
configuration<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;mapreduce.output.fileoutputformat.compress.type&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;RECORD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
configuration<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;mapreduce.output.fileoutputformat.compress.codec&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;org.apache.hadoop.io.compress.SnappyCodec&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u91CD\u65B0\u6253\u6210jar\u5305\uFF0C\u63D0\u4EA4\u96C6\u7FA4\u8FD0\u884C\uFF0C\u9A8C\u8BC1\u8F93\u51FA\u7ED3\u679C\u662F\u5426\u5DF2\u8FDB\u884C\u4E86snappy\u538B\u7F29!!</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>hadoop jar wc.jar com.faustine.mr.wc2.WordCountDriver /wcinput /wcoutput
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="_6-6-6-mr\u7EFC\u5408\u6848\u4F8B" tabindex="-1"><a class="header-anchor" href="#_6-6-6-mr\u7EFC\u5408\u6848\u4F8B" aria-hidden="true">#</a> 6.6.6 MR\u7EFC\u5408\u6848\u4F8B</h2><h3 id="_1-\u9700\u6C42" tabindex="-1"><a class="header-anchor" href="#_1-\u9700\u6C42" aria-hidden="true">#</a> 1.\u9700\u6C42</h3><p>\u73B0\u5728\u6709\u4E00\u4E9B\u8BA2\u5355\u7684\u8BC4\u8BBA\u6570\u636E\uFF0C\u9700\u8981\u5C06\u8BA2\u5355\u6309\u7167\u597D\u8BC4\u4E0E\u5DEE\u8BC4\u533A\u5206\u5F00\u6765\uFF0C\u5C06\u6570\u636E\u8F93\u51FA\u5230\u4E0D\u540C\u7684\u6587\u4EF6\u76EE\u5F55\u4E0B\u3002 \u6570\u636E\u5185\u5BB9\u5982\u4E0B\uFF0C\u5176\u4E2D\u6570\u636E\u7B2C\u4E5D\u4E2A\u5B57\u6BB5\u8868\u793A\u597D\u8BC4\uFF0C\u4E2D\u8BC4\uFF0C\u5DEE\u8BC4\u30020:\u597D\u8BC4\uFF0C1:\u4E2D\u8BC4\uFF0C2:\u5DEE\u8BC4\u3002</p><p>\u73B0\u9700\u8981\u6839\u636E\u597D\u8BC4\uFF0C\u4E2D\u8BC4\uFF0C\u5DEE\u8BC4\u628A\u6570\u636E\u5206\u7C7B\u5E76\u8F93\u51FA\u5230\u4E0D\u540C\u7684\u76EE\u5F55\u4E2D,\u5E76\u4E14\u8981\u6C42\u6309\u7167\u65F6\u95F4\u987A\u5E8F\u964D\u5E8F\u6392\u5217\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>300 \u4E1C\u897F\u5F88\u4E0D\u9519\uFF0C\u7269\u6D41\u4E5F\u5F88\u5FEB \\N 1 106 131******33 0 2019-02-06 19:10:13
301 \u8FD8\u884C\uFF0C\u6D17\u5B8C\u6709\u70B9\u5E72\uFF0C\u4E0D\u77E5\u9053\u600E\u4E48\u56DE\u4E8B \\N 1 106 136******44 0   2019-03-22 14:16:41
302 \u8FD8\u53EF\u4EE5\u5427\uFF0C\u4FDD\u8D28\u671F\u77ED\uFF0C\u611F\u89C9\u8C8C\u4F3C\u66F4\u5929\u7136\u4E9B \\N 1 106 134******34  0   2019-04-10 13:40:06
303 \u8FD8\u53EF\u4EE5\u5427\uFF0C\u4FDD\u8D28\u671F\u77ED\uFF0C\u611F\u89C9\u8C8C\u4F3C\u66F4\u5929\u7136\u4E9B \\N 1 105 134******33  0   2019-01-15 14:40:21
304 \u8FD8\u6CA1\u7528\uFF0C\uFF0C\u4E0D\u77E5\u9053\u6548\u679C\u600E\u4E48\u6837 \\N 1 105 137******66 0 2019-02-28 18:55:43
305 \u521A\u6536\u5230\uFF0C\u8FD8\u6CA1\u7528\uFF0C\u7528\u540E\u518D\u8FFD\u8BC4!\u4E0D\u8FC7\uFF0C\u542C\u670B\u53CB\u8BF4\u597D\u7528\uFF0C\u624D\u4E70\u7684! \\N 1 105 138******60 0   2019-03-13 19:10:09
306 \u4E00\u822C\uFF0C\u611F\u89C9\u7528\u7740\u4E0D\u662F\u5F88\u597D\uFF0C\u53EF\u80FD\u6211\u5934\u53D1\u592A\u5E72\u4E86 \\N 1 105 132******44 0 2019- 04-09 10:35:49
307 \u975E\u5E38\u597D\u7528\uFF0C\u4E4B\u524D\u4E70\u4E8610\u652F\uFF0C\u8FD9\u6B21\u53C8\u4E70\u4E8610\u652F\uFF0C\u4E0D\u9519\uFF0C\u4F1A\u7EE7\u7EED\u652F\u6301! \\N 1 103 131******33 0 2019-01-15 13:10:46
308 \u559C\u6B22\u8336\u6811\u6CB9\u7684 \\N 1 103 135******33 0 2019-02-08 14:35:09
309 \u597D\u50CF\u6BD4\u5176\u4ED6\u7684\u5F3A\u4E00\u4E9B\uFF0C\u7EE7\u7EED\u4F7F\u7528\u4E2D \\N 1 103 133******99 0 2019-03-14 19:55:36
310 \u611F\u89C9\u6D17\u540E\u5934\u53D1\u5F88\u5E72\u51C0\uFF0C\u5934\u76AE\u6709\u4E00\u5B9A\u6539\u5584\u3002 \\N 1 103 138******44 0 2019-04-09 22:55:59
311 \u4ECE\u51FA\u751F\u5230\u73B0\u5728\u4E00\u76F4\u90FD\u662F\u60E0\u6C0F \u73B0\u5728\u5B9D\u5B9D\u4E24\u5468\u534A\u4E86 \\N 1 157 \u90A3***\u60C5 0 2017-12- 01 06:05:30
312 \u53E3\u611F\u4E0D\u9519\uFF0C\u5B69\u5B50\u5F88\u559C\u6B22\u3002\u63A8\u8350\u3002 \\N 1 157 w***4 0 2017-12-12 08:35:06
313 \u4EF7\u683C\u4F18\u60E0\uFF0C\u65E5\u671F\u65B0\u9C9C\uFF0C\u5305\u88C5\u5B8C\u597D!\u53D1\u8D27\u901F\u5EA6\u5FEB\uFF0C\u975E\u5E38\u559C\u6B22!\u8FD8\u6709\u8D60\u54C1! \\N 1 157 j***0 0   2019-01-09 22:55:41
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p>\u5907\u6CE8: \u73B0\u5728\u6709\u5927\u91CF\u7C7B\u4F3C\u4E0A\u9762\u7684\u5C0F\u6587\u4EF6!</p></blockquote><h3 id="_2-\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_2-\u5206\u6790" aria-hidden="true">#</a> 2.\u5206\u6790</h3><ul><li>\u81EA\u5B9A\u4E49InputFormat\u5408\u5E76\u5C0F\u6587\u4EF6</li><li>\u81EA\u5B9A\u4E49\u5206\u533A\u6839\u636E\u8BC4\u8BBA\u7B49\u7EA7\u628A\u6570\u636E\u5206\u533A</li><li>\u81EA\u5B9A\u4E49OutputFormat\u628A\u6570\u636E\u8F93\u51FA\u5230\u591A\u4E2A\u76EE\u5F55</li></ul><h3 id="_3-\u5F00\u53D1\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#_3-\u5F00\u53D1\u6B65\u9AA4" aria-hidden="true">#</a> 3.\u5F00\u53D1\u6B65\u9AA4</h3><h4 id="_3-1-\u5408\u5E76\u5C0F\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#_3-1-\u5408\u5E76\u5C0F\u6587\u4EF6" aria-hidden="true">#</a> 3.1.\u5408\u5E76\u5C0F\u6587\u4EF6</h4><p>1\u3001Mapper</p><p>2\u3001\u81EA\u5B9A\u4E49InputFormat</p><p>3\u3001Reducer</p><p>4\u3001Driver</p><h4 id="_3-2-\u5206\u533A\u6392\u5E8F\u591A\u76EE\u5F55\u8F93\u51FA" tabindex="-1"><a class="header-anchor" href="#_3-2-\u5206\u533A\u6392\u5E8F\u591A\u76EE\u5F55\u8F93\u51FA" aria-hidden="true">#</a> 3.2.\u5206\u533A\u6392\u5E8F\u591A\u76EE\u5F55\u8F93\u51FA</h4><p>1\u3001Mapper</p><p>2\u3001CommentBean</p><p>3\u3001\u81EA\u5B9A\u4E49\u5206\u533A\u5668</p><p>4\u3001\u81EA\u5B9A\u4E49OutputFormat</p><p>5\u3001Reducer</p><p>6\u3001Driver</p><h3 id="_4-\u7A0B\u5E8F\u8C03\u4F18" tabindex="-1"><a class="header-anchor" href="#_4-\u7A0B\u5E8F\u8C03\u4F18" aria-hidden="true">#</a> 4.\u7A0B\u5E8F\u8C03\u4F18</h3><h4 id="\u9884\u5408\u5E76" tabindex="-1"><a class="header-anchor" href="#\u9884\u5408\u5E76" aria-hidden="true">#</a> \u9884\u5408\u5E76</h4><h4 id="\u538B\u7F29\u8F93\u51FA" tabindex="-1"><a class="header-anchor" href="#\u538B\u7F29\u8F93\u51FA" aria-hidden="true">#</a> \u538B\u7F29\u8F93\u51FA</h4><h2 id="_6-6-7-mr\u7B97\u6CD5\u6269\u5C55" tabindex="-1"><a class="header-anchor" href="#_6-6-7-mr\u7B97\u6CD5\u6269\u5C55" aria-hidden="true">#</a> 6.6.7 MR\u7B97\u6CD5\u6269\u5C55</h2><h3 id="_6-7-1-mergesort-\u5F52\u5E76\u6392\u5E8F" tabindex="-1"><a class="header-anchor" href="#_6-7-1-mergesort-\u5F52\u5E76\u6392\u5E8F" aria-hidden="true">#</a> 6.7.1 MergeSort \u5F52\u5E76\u6392\u5E8F</h3><ol><li>\u4E0D\u65AD\u5730\u5C06\u5F53\u524D\u5E8F\u5217\u5E73\u5747\u5206\u5272\u6210 2\u4E2A\u5B50\u5E8F\u5217 \u76F4\u5230\u4E0D\u80FD\u518D\u5206\u5272(\u5E8F\u5217\u4E2D\u53EA\u5269 1\u4E2A\u5143\u7D20)</li><li>\u4E0D\u65AD\u5730\u5C06 2\u4E2A\u5B50\u5E8F\u5217\u5408\u5E76\u6210\u4E00\u4E2A\u6709\u5E8F\u5E8F\u5217 \u76F4\u5230\u6700\u7EC8\u53EA\u5269\u4E0B 1\u4E2A\u5B50\u5E8F\u5217</li></ol><p>\u65F6\u95F4\u590D\u6742\u5EA6:O(nlogn)</p><p>\u7A7A\u95F4\u590D\u6742\u5EA6:O(n)</p><h3 id="_6-7-2-quicksort-\u5FEB\u6392" tabindex="-1"><a class="header-anchor" href="#_6-7-2-quicksort-\u5FEB\u6392" aria-hidden="true">#</a> 6.7.2 QuickSort-\u5FEB\u6392</h3><p>\u7B2C\u4E00\u6B65</p><p>\u4ECE\u6570\u7EC4\u4E2D\u9009\u62E9\u4E00\u4E2A\u8F74\u70B9\u5143\u7D20(Pivot element)\uFF0C\u4E00\u822C\u9009\u62E90\u4F4D\u7F6E\u5143\u7D20\u4E3A\u8F74\u70B9\u5143\u7D20</p><p>\u7B2C\u4E8C\u6B65</p><ul><li>\u5229\u7528Pivot\u5C06\u6570\u7EC4\u5206\u5272\u62102\u4E2A\u5B50\u5E8F\u5217</li><li>\u5C06\u5C0F\u4E8E Pivot\u7684\u5143\u7D20\u653E\u5728Pivot\u524D\u9762(\u5DE6\u4FA7)</li><li>\u5C06\u5927\u4E8E Pivot\u7684\u5143\u7D20\u653E\u5728Pivot\u540E\u9762(\u53F3\u4FA7)</li><li>\u7B49\u4E8EPivot\u7684\u5143\u7D20\u653E\u54EA\u8FB9\u90FD\u53EF\u4EE5(\u6682\u5B9A\u653E\u5728\u5DE6\u8FB9)</li></ul><p>\u7B2C\u4E09\u6B65</p><p>\u5BF9\u5B50\u6570\u7EC4\u8FDB\u884C\u7B2C\u4E00\u6B65\uFF0C\u7B2C\u4E8C\u6B65\u64CD\u4F5C\uFF0C\u76F4\u5230\u4E0D\u80FD\u518D\u5206\u5272(\u5B50\u6570\u7EC4\u4E2D\u53EA\u6709\u4E00\u4E2A\u5143\u7D20)</p><p>\u65F6\u95F4\u590D\u6742\u5EA6</p><p>\u6700\u574F\u60C5\u51B5:</p><p>\u6700\u597D\u60C5\u51B5:</p><p>\u7A7A\u95F4\u590D\u6742\u5EA6</p><p>\u7531\u4E8E\u9012\u5F52\u8C03\u7528\uFF0C\u6BCF\u6B21\u7C7B\u4F3C\u6298\u534A\u6548\u679C\u6240\u4EE5\u7A7A\u95F4\u590D\u6742\u5EA6\u662FO(logn)</p>`,498);function l(u,i){return o}var k=n(c,[["render",l],["__file","index.html.vue"]]);export{k as default};
